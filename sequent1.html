<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2016-04-27 Wed 18:09 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>sequent1</title>
<meta name="generator" content="Org-mode" />
<meta name="author" content="XIE Yuheng" />
<link rel="stylesheet" href="asset/css/page.css" type="text/css" media="screen" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
喪以不執 所執者喪 執喪相比 方死方生
</div>
<div id="content">
<h1 class="title">sequent1</h1>
<div id="table-of-contents">
<h2>overview</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orga777333"><span class="done todo">todo</span> </a></li>
<li><a href="#org3d586a7">helper</a>
<ul>
<li><a href="#org2e9a50f">pattern match</a></li>
<li><a href="#orgc77cf5c">cat &amp; orz</a></li>
<li><a href="#org3e8c9d"><span class="done test">test</span> ing</a></li>
<li><a href="#org85e2346">list</a></li>
<li><a href="#org93e2c99">string</a></li>
</ul>
</li>
<li><a href="#org3a2dc90"><span class="todo note">note</span> </a>
<ul>
<li><a href="#orgc8d11b5">as prototype</a></li>
<li><a href="#orgdbb7dd7">sequent</a></li>
<li><a href="#orgdf0ce3b">form</a>
<ul>
<li><a href="#org9ed254">form1</a></li>
<li><a href="#orgef571e3">form2</a></li>
<li><a href="#orgd55917d">form3</a></li>
</ul>
</li>
<li><a href="#orge718001">data</a></li>
<li><a href="#org99e38c6">arity</a></li>
<li><a href="#org872606f">env</a></li>
<li><a href="#orgeaab737">meaning</a></li>
<li><a href="#orge058cad">top</a>
<ul>
<li><a href="#org74369e4">top1</a></li>
<li><a href="#org648eeb">top2</a></li>
</ul>
</li>
<li><a href="#orgce46f7f">report</a></li>
</ul>
</li>
<li><a href="#org4b5e465">pass</a>
<ul>
<li><a href="#org60977f8">pass1</a>
<ul>
<li><a href="#org20590e9">pass1/arrow</a></li>
<li><a href="#org36d70f9">pass1/cedent</a></li>
<li><a href="#org6d8745b">predicates</a></li>
<li><a href="#orgce2be5d">pass1</a></li>
<li><a href="#orgaaf2083">pass1/var</a></li>
<li><a href="#org2a2d4a1"><span class="done test">test</span> </a></li>
</ul>
</li>
<li><a href="#orgdee347f">pass2</a>
<ul>
<li><a href="#orgae1483c">pass2/arrow</a></li>
<li><a href="#org9f55f5">pass2/cedent</a></li>
<li><a href="#org2d6112d">pass2/lambda</a></li>
<li><a href="#orgcecbd2b">pass2</a></li>
<li><a href="#org7b1803">pass2/var</a></li>
<li><a href="#orgccf693e">pass2/bind</a></li>
<li><a href="#org5e0e436"><span class="done test">test</span> </a></li>
</ul>
</li>
<li><a href="#org470ba72">pass3</a>
<ul>
<li><a href="#org2683e67">pass3/get-arrow</a></li>
<li><a href="#orga7dec8">pass3/arrow</a></li>
<li><a href="#org3de6f73">pass3/cedent</a></li>
<li><a href="#org48c0103">pass3/lambda</a></li>
<li><a href="#org320c5cf">pass3</a></li>
<li><a href="#orga22527">pass3/var</a></li>
<li><a href="#org7e13c0f">id-&gt;[symbol|ls]</a></li>
<li><a href="#orga9e359a"><span class="todo _gt__lt__gt__lt__gt__lt_">&gt;&lt;&gt;&lt;&gt;&lt;</span> bs/[find|walk|deep]</a></li>
<li><a href="#org45a83fb">pass3/name</a></li>
<li><a href="#org7e9c26">pass3/name/cons</a></li>
<li><a href="#orgd664ebd">pass3/name/trunk</a></li>
<li><a href="#org9c97e">pass3/name/proj</a></li>
<li><a href="#orga30b058">pass3/bind</a></li>
<li><a href="#org2daf1c2">id/commit!</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgc9bb1df">copy-arrow</a>
<ul>
<li><a href="#org20959d7"><span class="todo note">note</span> copy</a></li>
<li><a href="#org3cc41a3">copy-arrow</a></li>
<li><a href="#orgab93244">copy/arrow</a></li>
<li><a href="#org7c3366f">copy/cedent</a></li>
<li><a href="#org7a52728">copy/lambda</a></li>
<li><a href="#orgf1f1618">copy/arrow-list</a></li>
<li><a href="#org20a5ad8">copy</a></li>
<li><a href="#org24d830b">copy/var</a></li>
<li><a href="#org670fc62">copy/ls</a></li>
<li><a href="#org8bf1a1d">copy/cons</a></li>
<li><a href="#orgc852e30">copy/trunk</a></li>
<li><a href="#orgcf888f3">copy/proj</a></li>
</ul>
</li>
<li><a href="#org2444119"><span class="todo _gt__lt_">&gt;&lt;</span> apply</a>
<ul>
<li><a href="#orgc9c66ad">apply/arrow</a></li>
<li><a href="#orgd51c6ac">apply/cedent</a></li>
<li><a href="#org350148b">apply/dispatch</a></li>
<li><a href="#orgc38a6ee">apply/literal-arrow</a></li>
<li><a href="#org7bb4a80">apply/var</a></li>
<li><a href="#org46c95d6">apply/name</a></li>
<li><a href="#org5b8330"><span class="todo _gt__lt_">&gt;&lt;</span> bs/commit!</a></li>
<li><a href="#org86dd367"><span class="todo _gt__lt_">&gt;&lt;</span> bs/extend</a></li>
</ul>
</li>
<li><a href="#org6022ae"><span class="todo _gt__lt_">&gt;&lt;</span> unify</a>
<ul>
<li><a href="#org17ffd6f"><span class="todo _gt__lt_">&gt;&lt;</span> unify</a></li>
</ul>
</li>
<li><a href="#org2fec2c5"><span class="todo _gt__lt_">&gt;&lt;</span> eva</a></li>
<li><a href="#orgefdaf46"><span class="todo _gt__lt_">&gt;&lt;</span> check</a></li>
<li><a href="#org14c8fc2"><span class="todo _gt__lt_">&gt;&lt;</span> type-apply</a></li>
<li><a href="#orgb156f6"><span class="todo _gt__lt_">&gt;&lt;</span> sequent</a></li>
<li><a href="#org9f676eb"><span class="done test">test</span> </a>
<ul>
<li><a href="#org170f6e">natural</a></li>
<li><a href="#orge5f8eac">list</a></li>
<li><a href="#org435ed9a">vector</a></li>
</ul>
</li>
</ul>
</div>
</div>
<ul class="org-ul">
<li><p>a prototype interpreter for a functional language</p><p>which uses sequent calculus as dependent type system</p></li>

<li><p>XIE Yuheng created</p></li></ul>

<div id="outline-container-orga777333" class="outline-2">
<h2 id="orga777333"><span class="done todo">todo</span> </h2>
<div class="outline-text-2" id="text-orga777333">
<ul class="org-ul">
<li><p>data/print</p><p>different var should be print differently</p></li>

<li><p>check-type</p><p>infer-arity</p><p>check-cover</p><p>check-end</p></li></ul>
</div>
</div>

<div id="outline-container-org3d586a7" class="outline-2">
<h2 id="org3d586a7">helper</h2>
<div class="outline-text-2" id="text-org3d586a7">
</div><div id="outline-container-org2e9a50f" class="outline-3">
<h3 id="org2e9a50f">pattern match</h3>
<div class="outline-text-3" id="text-org2e9a50f">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #FF8888;">;; </span><span style="color: #FF8888;">module system of guile</span>
<span style="color: #FF8888;">;; </span><span style="color: #FF8888;">using http://synthcode.com/scheme/match.scm</span>
(use-modules (ice-9 match))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc77cf5c" class="outline-3">
<h3 id="orgc77cf5c">cat &amp; orz</h3>
<div class="outline-text-3" id="text-orgc77cf5c">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define-syntax</span> <span style="color: #fd971f;">cat</span>
  (<span style="color: #f92672; font-weight: bold;">syntax-rules</span> ()
    [(cat (str . args))
     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">(format str . args)</span>
     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">guile</span>
     (format #t str . args)]
    [(cat (str . args) (str2 . args2) ...)
     (string-append
      (cat (str . args))
      (cat (str2 . args2) ...))]))

(<span style="color: #f92672; font-weight: bold;">define-syntax</span> <span style="color: #fd971f;">orz</span>
  (<span style="color: #f92672; font-weight: bold;">syntax-rules</span> ()
    [(<span style="color: #f92672; font-weight: bold;">orz</span> . body)
     (<span style="color: #f92672; font-weight: bold;">error</span> (cat . body))]))

(<span style="color: #f92672; font-weight: bold;">define-syntax</span> <span style="color: #fd971f;">note</span>
  (<span style="color: #f92672; font-weight: bold;">syntax-rules</span> ()
    [(<span style="color: #f92672; font-weight: bold;">note</span> . body)
     '()]))
</pre>
</div>
</div>
</div>

<div id="outline-container-org3e8c9d" class="outline-3">
<h3 id="org3e8c9d"><span class="done test">test</span> ing</h3>
<div class="outline-text-3" id="text-org3e8c9d">
<div class="org-src-container">

<pre class="src src-scheme">(use-modules (ice-9 pretty-print))

(<span style="color: #f92672; font-weight: bold;">define-syntax</span> <span style="color: #fd971f;">test</span>
  (<span style="color: #f92672; font-weight: bold;">syntax-rules</span> ()
    [(test b1 b2)
     (<span style="color: #f92672; font-weight: bold;">if</span> (equal? b1 b2)
       #t
       (<span style="color: #f92672; font-weight: bold;">let</span> ()
         (cat (<span style="color: #e6db74;">"\n"</span>))
         (cat (<span style="color: #e6db74;">"&lt;test-fail-report-begin&gt;\n"</span>))
         (cat (<span style="color: #e6db74;">"&lt;actual-form&gt; :\n"</span>))
         (pretty-print (<span style="color: #f92672; font-weight: bold;">quote</span> b1))
         (cat (<span style="color: #e6db74;">"&lt;actual-value&gt; :\n"</span>))
         (pretty-print b1)
         (cat (<span style="color: #e6db74;">"&lt;expect-form&gt; :\n"</span>))
         (pretty-print (<span style="color: #f92672; font-weight: bold;">quote</span> b2))
         (cat (<span style="color: #e6db74;">"&lt;expect-value&gt; :\n"</span>))
         (pretty-print b2)
         (<span style="color: #f92672; font-weight: bold;">orz</span> (<span style="color: #e6db74;">"&lt;test-fail-report-end&gt;\n"</span>))))]))
</pre>
</div>
</div>
</div>

<div id="outline-container-org85e2346" class="outline-3">
<h3 id="org85e2346">list</h3>
<div class="outline-text-3" id="text-org85e2346">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">left-of</span> s l)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">sexp, list -&gt; list</span>
  (<span style="color: #f92672; font-weight: bold;">cond</span> [(equal? s (car l)) '()]
        [else (cons (car l) (left-of s (cdr l)))]))

(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">right-of</span> s l)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">sexp, list -&gt; list</span>
  (<span style="color: #f92672; font-weight: bold;">cond</span> [(equal? s (car l)) (cdr l)]
        [else (right-of s (cdr l))]))

(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">sublist</span> l start end)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">list, index, index -&gt; list</span>
  (<span style="color: #f92672; font-weight: bold;">cond</span> [(<span style="color: #f92672; font-weight: bold;">and</span> (eq? 0 start) (&lt;= end 0)) '()]
        [(<span style="color: #f92672; font-weight: bold;">and</span> (not (eq? 0 start)))
         (sublist (cdr l) (- start 1) (- end 1))]
        [(<span style="color: #f92672; font-weight: bold;">and</span> (eq? 0 start) (not (eq? 0 end)))
         (cons (car l) (sublist (cdr l) 0 (- end 1)))]))

(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">genlist</span> len)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">length -&gt; list</span>
  (<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">recur</span> len counter)
    (<span style="color: #f92672; font-weight: bold;">cond</span> [(eq? len counter) '()]
          [else (cons counter
                      (recur len (+ 1 counter)))]))
  (recur len 0))
</pre>
</div>
</div>
</div>

<div id="outline-container-org93e2c99" class="outline-3">
<h3 id="org93e2c99">string</h3>
<div class="outline-text-3" id="text-org93e2c99">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">find-char</span> c s)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">char, string -&gt; curser or #f</span>
  (find-char/curser c s 0))

(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">find-char/curser</span> c s curser)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">char, string, curser -&gt; curser or #f</span>
  (<span style="color: #f92672; font-weight: bold;">if</span> (&gt;= curser (string-length s))
    #f
    (<span style="color: #f92672; font-weight: bold;">let</span> ([c0 (substring s curser (+ 1 curser))])
      (<span style="color: #f92672; font-weight: bold;">if</span> (equal? c c0)
        curser
        (find-char/curser c s (+ 1 curser))))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3a2dc90" class="outline-2">
<h2 id="org3a2dc90"><span class="todo note">note</span> </h2>
<div class="outline-text-2" id="text-org3a2dc90">
</div><div id="outline-container-orgc8d11b5" class="outline-3">
<h3 id="orgc8d11b5">as prototype</h3>
<div class="outline-text-3" id="text-orgc8d11b5">
<ul class="org-ul">
<li><p>lazy-eval</p><p>call-by-name</p></li></ul>
</div>
</div>

<div id="outline-container-orgdbb7dd7" class="outline-3">
<h3 id="orgdbb7dd7">sequent</h3>
<div class="outline-text-3" id="text-orgdbb7dd7">
<ul class="org-ul">
<li><p>sequent is arrow</p><p>which is the core data type of the language</p></li></ul>
</div>
</div>

<div id="outline-container-orgdf0ce3b" class="outline-3">
<h3 id="orgdf0ce3b">form</h3>
<div class="outline-text-3" id="text-orgdf0ce3b">
</div><div id="outline-container-org9ed254" class="outline-4">
<h4 id="org9ed254">form1</h4>
<div class="outline-text-4" id="text-org9ed254">
<ul class="org-ul">
<li><p>form1 =</p><p><ul class="org-ul"></p><p><li><p>form1/var =</p><p>:var</p><p>:var<sup>n</sup></p></li></p><p><li><p>form1/name =</p><p>name</p></li></p><p><li><p>form1/arrow =</p><p>(form1 &#x2026; -&gt; form1 &#x2026;)</p></li></p><p><li><p>form1/lambda =</p><p>(lambda form1/arrow</p><p>  form1/arrow</p><p>  &#x2026;)</p></li></p><p><li><p>form1/im-bind =</p><p>(form1/var &#x2026; : form1 &#x2026;)</p></li></p><p><li><p>form1/ex-bind =</p><p>(form1/var &#x2026; @ form1 &#x2026;)</p></li></ul></p></li></ul>
</div>
</div>

<div id="outline-container-orgef571e3" class="outline-4">
<h4 id="orgef571e3">form2</h4>
<div class="outline-text-4" id="text-orgef571e3">
<ul class="org-ul">
<li><p>form1 -pass1-&gt; form2</p><p>level of var is handled here</p></li>

<li><p>form2 =</p><p>('form2/var    (symbol level))</p><p>('form2/name   symbol)</p><p>('form2/arrow  ((form2 &#x2026;) (form2 &#x2026;)))</p><p>('form2/lambda (form2/arrow (form2/arrow &#x2026;)))</p><p>('form2/bind   ((form2/var &#x2026;) (form2 &#x2026;) leave?))</p></li>
<li><p>level = natural-number</p></li>
<li><p>leave? = 'leave | 'not-leave</p></li></ul>
</div>
</div>

<div id="outline-container-orgd55917d" class="outline-4">
<h4 id="orgd55917d">form3</h4>
<div class="outline-text-4" id="text-orgd55917d">
<ul class="org-ul">
<li><p>form2 -pass2-&gt; form3</p><p>id of var is handled here</p></li>

<li><p>form3 =</p><p>('form3/var    (id level))</p><p>('form3/name   symbol)</p><p>('form3/arrow  ((form3 &#x2026;) (form3 &#x2026;)))</p><p>('form3/lambda (form3/arrow (form3/arrow &#x2026;)))</p><p>('form3/bind   ((form3/var &#x2026;) (form3 &#x2026;) leave?))</p></li>
<li><p>id = #(symbol ls)</p></li></ul>
</div>
</div>
</div>

<div id="outline-container-orge718001" class="outline-3">
<h3 id="orge718001">data</h3>
<div class="outline-text-3" id="text-orge718001">
<ul class="org-ul">
<li><p>form3 -pass3-&gt; data</p><p>cons trunk proj are created here</p><p>arity is calculated here</p></li>
<li><p>pass3 will use env passing</p><p>note that</p><p>when env passing is used</p><p>those functions would not be separately testable</p></li>
<li><p>no unification here</p><p>bs is not used here</p><p>bind just effect on the id of var</p></li>
<li><p>ns is searched</p><p>but no effect on ns</p></li>
<li><p>how should I express such in type ?</p></li>

<li><p>data =</p><p>('var    (id level))</p><p>('cons   (name (data &#x2026;)))</p><p>('arrow  ((data &#x2026;) (data &#x2026;)))</p><p>('lambda (arrow (arrow &#x2026;)))</p><p>('trunk  (arrow (arrow &#x2026;) (data &#x2026;)))</p><p>('proj   (arrow (arrow &#x2026;) (data &#x2026;) index))</p></li></ul>
</div>
</div>

<div id="outline-container-org99e38c6" class="outline-3">
<h3 id="org99e38c6">arity</h3>
<div class="outline-text-3" id="text-org99e38c6">
<ul class="org-ul">
<li><p>there can be</p><p>arity = (number number)</p><p>in lambda &amp; trunk</p><p>but do not use separate arity for simplicity</p><p>arity is calculated from arrow repeatly</p></li></ul>
</div>
</div>

<div id="outline-container-org872606f" class="outline-3">
<h3 id="org872606f">env</h3>
<div class="outline-text-3" id="text-org872606f">
<ul class="org-ul">
<li><p>env = (ds bs ns)</p></li>
<li><p>ds = (data &#x2026;)</p></li>
<li><p>bs = ((id . ls) &#x2026;)</p><p><ul class="org-ul"></p><p><li><p>ls = ((level . data) &#x2026;)</p></li></ul></p></li>
<li><p>ns = ((name . meaning) &#x2026;)</p></li></ul>
</div>
</div>

<div id="outline-container-orgeaab737" class="outline-3">
<h3 id="orgeaab737">meaning</h3>
<div class="outline-text-3" id="text-orgeaab737">
<ul class="org-ul">
<li><p>meaning =</p><p>('cons/type (arrow name (name &#x2026;)))</p><p>('cons/data (arrow name name))</p><p>('lambda    (arrow (arrow &#x2026;)))</p></li></ul>
</div>
</div>

<div id="outline-container-orge058cad" class="outline-3">
<h3 id="orge058cad">top</h3>
<div class="outline-text-3" id="text-orge058cad">
</div><div id="outline-container-org74369e4" class="outline-4">
<h4 id="org74369e4">top1</h4>
<div class="outline-text-4" id="text-org74369e4">
<ul class="org-ul">
<li><p>top1 =</p><p>('dt ((form1/name form1/arrow) ((form1/name form1/arrow) &#x2026;)))</p><p>('df ((form1/name form1/arrow) (form1/arrow &#x2026;)))</p><p>('ap form1/arrow)</p></li></ul>
</div>
</div>

<div id="outline-container-org648eeb" class="outline-4">
<h4 id="org648eeb">top2</h4>
<div class="outline-text-4" id="text-org648eeb">
<ul class="org-ul">
<li><p>top2 =</p><p>('top2/dt ((form2/name form2/arrow) ((form2/name form2/arrow) &#x2026;)))</p><p>('top2/df ((form2/name form2/arrow) (form2/arrow &#x2026;)))</p><p>('top2/ap form2/arrow)</p></li></ul>
</div>
</div>
</div>

<div id="outline-container-orgce46f7f" class="outline-3">
<h3 id="orgce46f7f">report</h3>
<div class="outline-text-3" id="text-orgce46f7f">
<ul class="org-ul">
<li><p>report =</p><p>('fail (info &#x2026;))</p><p>('success (info &#x2026;) env)</p></li>
<li><p>info = &lt;free&gt;</p></li></ul>
</div>
</div>
</div>

<div id="outline-container-org4b5e465" class="outline-2">
<h2 id="org4b5e465">pass</h2>
<div class="outline-text-2" id="text-org4b5e465">
</div><div id="outline-container-org60977f8" class="outline-3">
<h3 id="org60977f8">pass1</h3>
<div class="outline-text-3" id="text-org60977f8">
</div><div id="outline-container-org20590e9" class="outline-4">
<h4 id="org20590e9">pass1/arrow</h4>
<div class="outline-text-4" id="text-org20590e9">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">pass1/arrow</span> default-level s)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">default-level, form1/arrow -&gt; form2/arrow</span>
  (list (pass1/cedent default-level (left-of '<span style="color: #66d9ef; font-weight: bold;">-&gt;</span> s))
        (pass1/cedent default-level (right-of '<span style="color: #66d9ef; font-weight: bold;">-&gt;</span> s))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org36d70f9" class="outline-4">
<h4 id="org36d70f9">pass1/cedent</h4>
<div class="outline-text-4" id="text-org36d70f9">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">pass1/cedent</span> default-level s)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">default-level, (form1 ...) -&gt; (form2 ...)</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> s
    [() '()]
    [(h . r) (cons (pass1 default-level h)
                   (pass1/cedent default-level r))]))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6d8745b" class="outline-4">
<h4 id="org6d8745b">predicates</h4>
<div class="outline-text-4" id="text-org6d8745b">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">form1/var?</span> v)
  (<span style="color: #f92672; font-weight: bold;">and</span> (symbol? v)
       (equal? <span style="color: #e6db74;">":"</span> (substring (symbol-&gt;string v) 0 1))))

(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">form1/name?</span> v)
  (<span style="color: #f92672; font-weight: bold;">and</span> (symbol? v)
       (not (eq? <span style="color: #e6db74;">":"</span> (substring (symbol-&gt;string v) 0 1)))))

(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">form1/arrow?</span> v)
  (<span style="color: #f92672; font-weight: bold;">and</span> (list? v)
       (member '<span style="color: #66d9ef; font-weight: bold;">-&gt;</span> v)))

(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">form1/lambda?</span> v)
  (<span style="color: #f92672; font-weight: bold;">and</span> (list? v)
       (eq? (car v) 'lambda)))

(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">form1/im-bind?</span> v)
  (<span style="color: #f92672; font-weight: bold;">and</span> (list? v)
       (member ': v)))

(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">form1/ex-bind?</span> v)
  (<span style="color: #f92672; font-weight: bold;">and</span> (list? v)
       (member '@ v)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgce2be5d" class="outline-4">
<h4 id="orgce2be5d">pass1</h4>
<div class="outline-text-4" id="text-orgce2be5d">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">pass1</span> default-level v)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">default-level, form1 -&gt; form2</span>
  (<span style="color: #f92672; font-weight: bold;">cond</span> [(form1/var? v)
         (list 'form2/var
               (pass1/var default-level v))]
        [(form1/name? v)
         (list 'form2/name
               v)]
        [(form1/arrow? v)
         (list 'form2/arrow
               (pass1/arrow default-level v))]
        [(form1/lambda? v)
         (list 'form2/lambda
               (list (pass1/arrow default-level (cadr v))
                     (<span style="color: #f92672; font-weight: bold;">map</span> (<span style="color: #f92672; font-weight: bold;">lambda</span> (x) (pass1/arrow default-level x))
                       (cddr v))))]
        [(form1/im-bind? v)
         (list 'form2/bind
               (list (pass1/cedent 1 (left-of ': v))
                     (pass1/cedent 0 (right-of ': v))
                     'leave))]
        [(form1/ex-bind? v)
         (list 'form2/bind
               (list (pass1/cedent 1 (left-of '@ v))
                     (pass1/cedent 0 (right-of '@ v))
                     'not-leave))]
        [else
         (<span style="color: #f92672; font-weight: bold;">orz</span> (<span style="color: #e6db74;">"pass1 can not handle sexp-form:~a"</span> v))]))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaaf2083" class="outline-4">
<h4 id="orgaaf2083">pass1/var</h4>
<div class="outline-text-4" id="text-orgaaf2083">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">pass1/var</span> default-level v)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">default-level, symbol -&gt; form2/var</span>
  (<span style="color: #f92672; font-weight: bold;">let*</span> ([str (symbol-&gt;string v)]
         [cursor (find-char <span style="color: #e6db74;">"^"</span> str)])
    (<span style="color: #f92672; font-weight: bold;">if</span> cursor
      (list (string-&gt;symbol (substring str 0 cursor))
            (string-&gt;number (substring str (+ 1 cursor))))
      (list v default-level))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2a2d4a1" class="outline-4">
<h4 id="org2a2d4a1"><span class="done test">test</span> </h4>
<div class="outline-text-4" id="text-org2a2d4a1">
<div class="org-src-container">

<pre class="src src-scheme">(test
 (<span style="color: #f92672; font-weight: bold;">map</span> (<span style="color: #f92672; font-weight: bold;">lambda</span> (x) (pass1/arrow 0 x))
   '((natural natural <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> natural)
     (natural natural <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> (natural natural <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> natural) natural)
     (<span style="color: #a6e22e;">:m</span> zero <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:m</span>)
     (<span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> succ <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> recur succ)
     (<span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> succ <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> (<span style="color: #f92672; font-weight: bold;">lambda</span> (natural natural <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> natural)
                            (<span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> succ <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> recur succ)
                            (<span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> succ <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> recur succ)))
     ((<span style="color: #a6e22e;">:t</span> : type) <span style="color: #a6e22e;">:t</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> type)
     ((<span style="color: #a6e22e;">:t</span> @ type) <span style="color: #a6e22e;">:t</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> type)
     ((<span style="color: #a6e22e;">:t^2</span> : type) <span style="color: #a6e22e;">:t</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> type)
     ((<span style="color: #a6e22e;">:t1</span> <span style="color: #a6e22e;">:t2^2</span> <span style="color: #a6e22e;">:t3^0</span> : j k) <span style="color: #a6e22e;">:t</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> type)
     ((<span style="color: #a6e22e;">:t^2</span> @ type) <span style="color: #a6e22e;">:t</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> type)))
 '((((form2/name natural) (form2/name natural))
    ((form2/name natural)))
   (((form2/name natural) (form2/name natural))
    ((form2/arrow (((form2/name natural) (form2/name natural)) ((form2/name natural)))) (form2/name natural)))
   (((form2/var (<span style="color: #a6e22e;">:m</span> 0)) (form2/name zero))
    ((form2/var (<span style="color: #a6e22e;">:m</span> 0))))
   (((form2/var (<span style="color: #a6e22e;">:m</span> 0)) (form2/var (<span style="color: #a6e22e;">:n</span> 0)) (form2/name succ))
    ((form2/var (<span style="color: #a6e22e;">:m</span> 0)) (form2/var (<span style="color: #a6e22e;">:n</span> 0)) (form2/name recur) (form2/name succ)))
   (((form2/var (<span style="color: #a6e22e;">:m</span> 0)) (form2/var (<span style="color: #a6e22e;">:n</span> 0)) (form2/name succ))
    ((form2/var (<span style="color: #a6e22e;">:m</span> 0)) (form2/var (<span style="color: #a6e22e;">:n</span> 0)) (form2/lambda ((((form2/name natural) (form2/name natural)) ((form2/name natural))) ((((form2/var (<span style="color: #a6e22e;">:m</span> 0)) (form2/var (<span style="color: #a6e22e;">:n</span> 0)) (form2/name succ)) ((form2/var (<span style="color: #a6e22e;">:m</span> 0)) (form2/var (<span style="color: #a6e22e;">:n</span> 0)) (form2/name recur) (form2/name succ))) (((form2/var (<span style="color: #a6e22e;">:m</span> 0)) (form2/var (<span style="color: #a6e22e;">:n</span> 0)) (form2/name succ)) ((form2/var (<span style="color: #a6e22e;">:m</span> 0)) (form2/var (<span style="color: #a6e22e;">:n</span> 0)) (form2/name recur) (form2/name succ))))))))
   (((form2/bind (((form2/var (<span style="color: #a6e22e;">:t</span> 1))) ((form2/name type)) leave)) (form2/var (<span style="color: #a6e22e;">:t</span> 0)))
    ((form2/name type)))
   (((form2/bind (((form2/var (<span style="color: #a6e22e;">:t</span> 1))) ((form2/name type)) not-leave)) (form2/var (<span style="color: #a6e22e;">:t</span> 0)))
    ((form2/name type)))
   (((form2/bind (((form2/var (<span style="color: #a6e22e;">:t</span> 2))) ((form2/name type)) leave)) (form2/var (<span style="color: #a6e22e;">:t</span> 0)))
    ((form2/name type)))
   (((form2/bind (((form2/var (<span style="color: #a6e22e;">:t1</span> 1)) (form2/var (<span style="color: #a6e22e;">:t2</span> 2)) (form2/var (<span style="color: #a6e22e;">:t3</span> 0))) ((form2/name j) (form2/name k)) leave)) (form2/var (<span style="color: #a6e22e;">:t</span> 0)))
    ((form2/name type)))
   (((form2/bind (((form2/var (<span style="color: #a6e22e;">:t</span> 2))) ((form2/name type)) not-leave)) (form2/var (<span style="color: #a6e22e;">:t</span> 0)))
    ((form2/name type)))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgdee347f" class="outline-3">
<h3 id="orgdee347f">pass2</h3>
<div class="outline-text-3" id="text-orgdee347f">
</div><div id="outline-container-orgae1483c" class="outline-4">
<h4 id="orgae1483c">pass2/arrow</h4>
<div class="outline-text-4" id="text-orgae1483c">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">pass2/arrow</span> a s)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">form2/arrow, scope -&gt; (form3/arrow scope)</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> a
    [(ac sc)
     (<span style="color: #f92672; font-weight: bold;">match</span> (pass2/cedent ac s)
       [(3ac s1)
        (<span style="color: #f92672; font-weight: bold;">match</span> (pass2/cedent sc s1)
          [(3sc s2)
           (list (list 3ac 3sc) s2)])])]))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9f55f5" class="outline-4">
<h4 id="org9f55f5">pass2/cedent</h4>
<div class="outline-text-4" id="text-org9f55f5">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">pass2/cedent</span> c s)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">(form2 ...), scope -&gt; ((form3 ...) scope)</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> c
    [() (list '() s)]
    [(h . r)
     (<span style="color: #f92672; font-weight: bold;">match</span> (pass2 h s)
       [(3f s1)
        (<span style="color: #f92672; font-weight: bold;">match</span> (pass2/cedent r s1)
          [(3c s2)
           (list (cons 3f 3c) s2)])])]))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2d6112d" class="outline-4">
<h4 id="org2d6112d">pass2/lambda</h4>
<div class="outline-text-4" id="text-org2d6112d">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">pass2/lambda</span> l s)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">form2/lambda, scope -&gt; (form3/lambda scope)</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> l
    [(a al)
     (list (list (pass2/arrow a s)
                 (<span style="color: #f92672; font-weight: bold;">map</span> (<span style="color: #f92672; font-weight: bold;">lambda</span> (x) (pass2/arrow x s))
                   al))
           s)]))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcecbd2b" class="outline-4">
<h4 id="orgcecbd2b">pass2</h4>
<div class="outline-text-4" id="text-orgcecbd2b">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">pass2</span> f s)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">form2, scope -&gt; (form2 scope)</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> f
    [('form2/var v)
     (<span style="color: #f92672; font-weight: bold;">match</span> (pass2/var v s)
       [(v1 s1)
        (list (list 'form3/var v1) s1)])]
    [('form2/name n)
     (list (list 'form3/name n) s)]
    [('form2/arrow a)
     (<span style="color: #f92672; font-weight: bold;">match</span> (pass2/arrow a s)
       [(a1 s1)
        (list (list 'form3/arrow a1) s1)])]
    [('form2/lambda l)
     (<span style="color: #f92672; font-weight: bold;">match</span> (pass2/lambda l s)
       [(l1 s1)
        (list (list 'form3/lambda l1) s1)])]
    [('form2/bind b)
     (<span style="color: #f92672; font-weight: bold;">match</span> (pass2/bind b s)
       [(b1 s1)
        (list (list 'form3/bind b1) s1)])]))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7b1803" class="outline-4">
<h4 id="org7b1803">pass2/var</h4>
<div class="outline-text-4" id="text-org7b1803">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">pass2/var</span> v s)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">form2/var, scope -&gt; (form3/var scope)</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> v
    [(symbol level)
     (<span style="color: #f92672; font-weight: bold;">let</span> ([found (assq symbol s)])
       (<span style="color: #f92672; font-weight: bold;">if</span> found
         (<span style="color: #f92672; font-weight: bold;">let</span> ([old (cdr found)])
           (list (list old level)
                 s))
         (<span style="color: #f92672; font-weight: bold;">let</span> ([new (vector symbol '())])
           (list (list new level)
                 (cons (cons symbol new) s)))))]))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgccf693e" class="outline-4">
<h4 id="orgccf693e">pass2/bind</h4>
<div class="outline-text-4" id="text-orgccf693e">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">pass2/bind</span> b s)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">form2/bind, scope -&gt; (form3/bind scope)</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> b
    [(vs c leave?)
     (<span style="color: #f92672; font-weight: bold;">match</span> (pass2/cedent vs s)
       [(3vs s1)
        (<span style="color: #f92672; font-weight: bold;">match</span> (pass2/cedent c s1)
          <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">this means vars in vs can occur in c</span>
          [(3c s2)
           (list (list 3vs 3c leave?) s2)])])]))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5e0e436" class="outline-4">
<h4 id="org5e0e436"><span class="done test">test</span> </h4>
<div class="outline-text-4" id="text-org5e0e436">
<div class="org-src-container">

<pre class="src src-scheme">(test
 (<span style="color: #f92672; font-weight: bold;">map</span> (<span style="color: #f92672; font-weight: bold;">lambda</span> (x) (pass2/arrow x '()))
   (<span style="color: #f92672; font-weight: bold;">map</span> (<span style="color: #f92672; font-weight: bold;">lambda</span> (x) (pass1/arrow 0 x))
     '((natural natural <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> natural)
       (natural natural <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> (natural natural <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> natural) natural)
       (<span style="color: #a6e22e;">:m</span> zero <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:m</span>)
       (<span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> succ <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> recur succ)
       (<span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> succ <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> (<span style="color: #f92672; font-weight: bold;">lambda</span> (natural natural <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> natural)
                              (<span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> succ <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> recur succ)
                              (<span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> succ <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> recur succ)))
       ((<span style="color: #a6e22e;">:t</span> : type) <span style="color: #a6e22e;">:t</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> type)
       ((<span style="color: #a6e22e;">:t</span> @ type) <span style="color: #a6e22e;">:t</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> type)
       ((<span style="color: #a6e22e;">:t^2</span> : type) <span style="color: #a6e22e;">:t</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> type)
       ((<span style="color: #a6e22e;">:t1</span> <span style="color: #a6e22e;">:t2^2</span> <span style="color: #a6e22e;">:t3^0</span> : j k) <span style="color: #a6e22e;">:t</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> type)
       ((<span style="color: #a6e22e;">:t^2</span> @ type) <span style="color: #a6e22e;">:t</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> type))))
 '(((((form3/name natural) (form3/name natural)) ((form3/name natural))) ())
   ((((form3/name natural) (form3/name natural)) ((form3/arrow (((form3/name natural) (form3/name natural)) ((form3/name natural)))) (form3/name natural))) ())
   ((((form3/var (#(<span style="color: #a6e22e;">:m</span> ()) 0)) (form3/name zero)) ((form3/var (#(<span style="color: #a6e22e;">:m</span> ()) 0)))) ((<span style="color: #a6e22e;">:m</span> . #(<span style="color: #a6e22e;">:m</span> ()))))
   ((((form3/var (#(<span style="color: #a6e22e;">:m</span> ()) 0)) (form3/var (#(<span style="color: #a6e22e;">:n</span> ()) 0)) (form3/name succ)) ((form3/var (#(<span style="color: #a6e22e;">:m</span> ()) 0)) (form3/var (#(<span style="color: #a6e22e;">:n</span> ()) 0)) (form3/name recur) (form3/name succ))) ((<span style="color: #a6e22e;">:n</span> . #(<span style="color: #a6e22e;">:n</span> ())) (<span style="color: #a6e22e;">:m</span> . #(<span style="color: #a6e22e;">:m</span> ()))))
   ((((form3/var (#(<span style="color: #a6e22e;">:m</span> ()) 0)) (form3/var (#(<span style="color: #a6e22e;">:n</span> ()) 0)) (form3/name succ)) ((form3/var (#(<span style="color: #a6e22e;">:m</span> ()) 0)) (form3/var (#(<span style="color: #a6e22e;">:n</span> ()) 0)) (form3/lambda (((((form3/name natural) (form3/name natural)) ((form3/name natural))) ((<span style="color: #a6e22e;">:n</span> . #(<span style="color: #a6e22e;">:n</span> ())) (<span style="color: #a6e22e;">:m</span> . #(<span style="color: #a6e22e;">:m</span> ())))) (((((form3/var (#(<span style="color: #a6e22e;">:m</span> ()) 0)) (form3/var (#(<span style="color: #a6e22e;">:n</span> ()) 0)) (form3/name succ)) ((form3/var (#(<span style="color: #a6e22e;">:m</span> ()) 0)) (form3/var (#(<span style="color: #a6e22e;">:n</span> ()) 0)) (form3/name recur) (form3/name succ))) ((<span style="color: #a6e22e;">:n</span> . #(<span style="color: #a6e22e;">:n</span> ())) (<span style="color: #a6e22e;">:m</span> . #(<span style="color: #a6e22e;">:m</span> ())))) ((((form3/var (#(<span style="color: #a6e22e;">:m</span> ()) 0)) (form3/var (#(<span style="color: #a6e22e;">:n</span> ()) 0)) (form3/name succ)) ((form3/var (#(<span style="color: #a6e22e;">:m</span> ()) 0)) (form3/var (#(<span style="color: #a6e22e;">:n</span> ()) 0)) (form3/name recur) (form3/name succ))) ((<span style="color: #a6e22e;">:n</span> . #(<span style="color: #a6e22e;">:n</span> ())) (<span style="color: #a6e22e;">:m</span> . #(<span style="color: #a6e22e;">:m</span> ()))))))))) ((<span style="color: #a6e22e;">:n</span> . #(<span style="color: #a6e22e;">:n</span> ())) (<span style="color: #a6e22e;">:m</span> . #(<span style="color: #a6e22e;">:m</span> ()))))
   ((((form3/bind (((form3/var (#(<span style="color: #a6e22e;">:t</span> ()) 1))) ((form3/name type)) leave)) (form3/var (#(<span style="color: #a6e22e;">:t</span> ()) 0))) ((form3/name type))) ((<span style="color: #a6e22e;">:t</span> . #(<span style="color: #a6e22e;">:t</span> ()))))
   ((((form3/bind (((form3/var (#(<span style="color: #a6e22e;">:t</span> ()) 1))) ((form3/name type)) not-leave)) (form3/var (#(<span style="color: #a6e22e;">:t</span> ()) 0))) ((form3/name type))) ((<span style="color: #a6e22e;">:t</span> . #(<span style="color: #a6e22e;">:t</span> ()))))
   ((((form3/bind (((form3/var (#(<span style="color: #a6e22e;">:t</span> ()) 2))) ((form3/name type)) leave)) (form3/var (#(<span style="color: #a6e22e;">:t</span> ()) 0))) ((form3/name type))) ((<span style="color: #a6e22e;">:t</span> . #(<span style="color: #a6e22e;">:t</span> ()))))
   ((((form3/bind (((form3/var (#(<span style="color: #a6e22e;">:t1</span> ()) 1)) (form3/var (#(<span style="color: #a6e22e;">:t2</span> ()) 2)) (form3/var (#(<span style="color: #a6e22e;">:t3</span> ()) 0))) ((form3/name j) (form3/name k)) leave)) (form3/var (#(<span style="color: #a6e22e;">:t</span> ()) 0))) ((form3/name type))) ((<span style="color: #a6e22e;">:t</span> . #(<span style="color: #a6e22e;">:t</span> ())) (<span style="color: #a6e22e;">:t3</span> . #(<span style="color: #a6e22e;">:t3</span> ())) (<span style="color: #a6e22e;">:t2</span> . #(<span style="color: #a6e22e;">:t2</span> ())) (<span style="color: #a6e22e;">:t1</span> . #(<span style="color: #a6e22e;">:t1</span> ()))))
   ((((form3/bind (((form3/var (#(<span style="color: #a6e22e;">:t</span> ()) 2))) ((form3/name type)) not-leave)) (form3/var (#(<span style="color: #a6e22e;">:t</span> ()) 0))) ((form3/name type))) ((<span style="color: #a6e22e;">:t</span> . #(<span style="color: #a6e22e;">:t</span> ()))))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org470ba72" class="outline-3">
<h3 id="org470ba72">pass3</h3>
<div class="outline-text-3" id="text-org470ba72">
</div><div id="outline-container-org2683e67" class="outline-4">
<h4 id="org2683e67">pass3/get-arrow</h4>
<div class="outline-text-4" id="text-org2683e67">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">pass3/get-arrow</span> a e)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">form3/arrow, env -&gt; arrow</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> (pass3/arrow a e)
    [((('arrow arrow) . _) _ _)
     arrow]))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga7dec8" class="outline-4">
<h4 id="orga7dec8">pass3/arrow</h4>
<div class="outline-text-4" id="text-orga7dec8">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">pass3/arrow</span> a e)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">form3/arrow, env -&gt; env</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> e
    [(ds bs ns)
     (<span style="color: #f92672; font-weight: bold;">match</span> a
       [(ac sc)
        (<span style="color: #f92672; font-weight: bold;">match</span> (pass3/cedent ac e)
          [((d1 . _) _ _)
           (<span style="color: #f92672; font-weight: bold;">match</span> (pass3/cedent sc e)
             [((d2 . _) _ _)
              (list (cons (list 'arrow (list d1 d2))
                          ds)
                    bs
                    ns)])])])]))
</pre>
</div>
</div>
</div>

<div id="outline-container-org3de6f73" class="outline-4">
<h4 id="org3de6f73">pass3/cedent</h4>
<div class="outline-text-4" id="text-org3de6f73">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">pass3/cedent</span> c e)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">(form3 ...), env -&gt; env</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> e
    [(ds bs ns)
     (<span style="color: #f92672; font-weight: bold;">match</span> c
       [() e]
       [(h . r) (pass3/cedent r (pass3 h e))])]))
</pre>
</div>
</div>
</div>

<div id="outline-container-org48c0103" class="outline-4">
<h4 id="org48c0103">pass3/lambda</h4>
<div class="outline-text-4" id="text-org48c0103">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">pass3/lambda</span> l e)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">form3/lambda, env -&gt; env</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> e
    [(ds bs ns)
     (<span style="color: #f92672; font-weight: bold;">match</span> l
       [(a al)
        (list (cons (list 'lambda
                          (pass3/get-arrow a e)
                          (<span style="color: #f92672; font-weight: bold;">map</span> (<span style="color: #f92672; font-weight: bold;">lambda</span> (x)
                                 (pass3/get-arrow x e))
                            al))
                    ds)
              bs
              ns)])]))
</pre>
</div>
</div>
</div>

<div id="outline-container-org320c5cf" class="outline-4">
<h4 id="org320c5cf">pass3</h4>
<div class="outline-text-4" id="text-org320c5cf">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">pass3</span> f e)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">form3, env -&gt; env</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> f
    [('form3/var x) (pass3/var x e)]
    [('form3/name x) (pass3/name x e)]
    [('form3/arrow x) (pass3/arrow x e)]
    [('form3/lambda x) (pass3/lambda x e)]
    [('form3/bind x) (pass3/bind x e)]))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga22527" class="outline-4">
<h4 id="orga22527">pass3/var</h4>
<div class="outline-text-4" id="text-orga22527">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">pass3/var</span> v e)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">form3/var, env -&gt; env</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> e
    [(ds bs ns)
     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">actually there is no need to search bs</span>
     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">but anyway</span>
     (list (cons (bs/deep bs (list 'var v)) ds)
           bs
           ns)]))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7e13c0f" class="outline-4">
<h4 id="org7e13c0f">id-&gt;[symbol|ls]</h4>
<div class="outline-text-4" id="text-org7e13c0f">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">id-&gt;symbol</span> id)
  (vector-ref id 0))

(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">id-&gt;ls</span> id)
  (vector-ref id 1))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga9e359a" class="outline-4">
<h4 id="orga9e359a"><span class="todo _gt__lt__gt__lt__gt__lt_">&gt;&lt;&gt;&lt;&gt;&lt;</span> bs/[find|walk|deep]</h4>
<div class="outline-text-4" id="text-orga9e359a">
<ul class="org-ul">
<li><p>infer level n can get level n+1</p></li>

<li><p>note how the types of these functions are different</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">bs/find</span> bs v)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">bs, var -&gt; data or #f</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> v
    [(id level)
     (<span style="color: #f92672; font-weight: bold;">let*</span> ([level (<span style="color: #f92672; font-weight: bold;">if</span> (eq? level #f)
                     0
                     level)]
            [found/commit (assq level (id-&gt;ls id))])
       (<span style="color: #f92672; font-weight: bold;">if</span> found/commit
         (cdr found/commit)
         (<span style="color: #f92672; font-weight: bold;">let*</span> ([found/ls (assq id bs)]
                [found/bind
                 (<span style="color: #f92672; font-weight: bold;">if</span> found/ls
                   (assq level (cdr found/ls))
                   #f)])
           (<span style="color: #f92672; font-weight: bold;">if</span> found/bind
             (cdr found/bind)
             #f))))]))

(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">bs/walk</span> bs d)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">bs, data -&gt; data</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> d
    [('var v)
     (<span style="color: #f92672; font-weight: bold;">let</span> ([found (bs/find bs v)])
       (<span style="color: #f92672; font-weight: bold;">if</span> found
         (bs/walk bs found)
         d))]
    [(_ e) d]))

(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">bs/deep</span> bs d)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">bs, data -&gt; data</span>
  (<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">bs/deep-list</span> bs dl)
    (<span style="color: #f92672; font-weight: bold;">map</span> (<span style="color: #f92672; font-weight: bold;">lambda</span> (x) (bs/deep bs x)) dl))
  (<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">bs/deep-arrow</span> bs a)
    (<span style="color: #f92672; font-weight: bold;">match</span> a
      [(dl1 dl2)
       (list (bs/deep-list bs dl1)
             (bs/deep-list bs dl2))]))
  (<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">bs/deep-arrow-list</span> bs al)
    (<span style="color: #f92672; font-weight: bold;">map</span> (<span style="color: #f92672; font-weight: bold;">lambda</span> (a) (bs/deep-arrow bs a)) al))
  (<span style="color: #f92672; font-weight: bold;">match</span> (bs/walk bs d)
    [('var v) ('var v)]
    [('cons (name dl))
     (list 'cons
           (list name (bs/deep-list bs dl)))]
    [('arrow a) (list 'arrow (bs/deep-arrow bs a))]
    [('lambda (a al))
     (list 'lambda
           (list (bs/deep-arrow bs a)
                 (bs/deep-arrow-list bs al)))]
    [('trunk (a al dl))
     (list 'trunk
           (list (bs/deep-arrow bs a)
                 (bs/deep-arrow-list bs al)
                 (bs/deep-list bs dl)))]
    [('proj (a al dl i))
     (list 'proj
           (list (bs/deep-arrow bs a)
                 (bs/deep-arrow-list bs al)
                 (bs/deep-list bs dl)
                 i))]))
</pre>
</div>
</div>
</div>

<div id="outline-container-org45a83fb" class="outline-4">
<h4 id="org45a83fb">pass3/name</h4>
<div class="outline-text-4" id="text-org45a83fb">
<ul class="org-ul">
<li><p>apply can be used to optimize</p><p>i.e. to do more computations before storing things into ns</p><p>but I leave it for now</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">pass3/name</span> n e)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">form3/name, env -&gt; env</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> e
    [(ds bs ns)
     (<span style="color: #f92672; font-weight: bold;">let</span> ([found (assq n ns)])
       (<span style="color: #f92672; font-weight: bold;">if</span> (not found)
         (<span style="color: #f92672; font-weight: bold;">orz</span> (<span style="color: #e6db74;">"pass3/name unknow name : ~a~%"</span> n))
         (<span style="color: #f92672; font-weight: bold;">let</span> ([meaning (cdr found)])
           (<span style="color: #f92672; font-weight: bold;">match</span> meaning
             [('cons/type ((ac sc) name _))
              (pass3/name/cons (length ac) name e)]
             [('cons/data ((ac sc) name _))
              (pass3/name/cons (length ac) name e)]
             [('lambda ((ac sc) al))
              (<span style="color: #f92672; font-weight: bold;">if</span> (eq? 1 (length sc))
                (pass3/name/trunk (length ac) l e)
                (pass3/name/proj (length ac) (length sc) l e))]))))]))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7e9c26" class="outline-4">
<h4 id="org7e9c26">pass3/name/cons</h4>
<div class="outline-text-4" id="text-org7e9c26">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">pass3/name/cons</span> len name e)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">length, name, env -&gt; env</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> e
    [(ds bs ns)
     (list (cons (list 'cons
                       (list name (sublist ds 0 len)))
                 (sublist ds len -1))
           bs
           ns)]))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd664ebd" class="outline-4">
<h4 id="orgd664ebd">pass3/name/trunk</h4>
<div class="outline-text-4" id="text-orgd664ebd">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">pass3/name/trunk</span> len l e)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">length, lambda, env -&gt; env</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> e
    [(ds bs ns)
     (<span style="color: #f92672; font-weight: bold;">match</span> l
       [(a al)
        (<span style="color: #f92672; font-weight: bold;">let</span> ([a (copy-arrow a)]
              [al (<span style="color: #f92672; font-weight: bold;">map</span> copy-arrow al)]
              [dl (sublist ds 0 len)])
          (list (cons (list 'trunk (list a al dl))
                      (sublist ds len -1))
                bs
                ns))])]))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9c97e" class="outline-4">
<h4 id="org9c97e">pass3/name/proj</h4>
<div class="outline-text-4" id="text-org9c97e">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">pass3/name/proj</span> len slen l e)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">length, length, lambda, env -&gt; env</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> e
    [(ds bs ns)
     (<span style="color: #f92672; font-weight: bold;">match</span> l
       [(a al)
        (<span style="color: #f92672; font-weight: bold;">let*</span> ([a (copy-arrow a)]
               [al (<span style="color: #f92672; font-weight: bold;">map</span> copy-arrow al)]
               [dl (sublist ds 0 len)]
               [make-proj (<span style="color: #f92672; font-weight: bold;">lambda</span> (i) (list 'proj (list a al dl i)))])
          (list (append (<span style="color: #f92672; font-weight: bold;">map</span> make-proj (genlist slen))
                        (sublist ds len -1))
                bs
                ns))])]))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga30b058" class="outline-4">
<h4 id="orga30b058">pass3/bind</h4>
<div class="outline-text-4" id="text-orga30b058">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">pass3/bind</span> b e)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">form3/bind, env -&gt; env</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> b
    [(vl c leave?)
     (<span style="color: #f92672; font-weight: bold;">match</span> (pass3/cedent c e)
       [((d1 . _) _ _) <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">here I assume the c of bind is simple</span>
        (<span style="color: #f92672; font-weight: bold;">letrec</span> ([recur
                  (<span style="color: #f92672; font-weight: bold;">lambda</span> (vl e)
                    (<span style="color: #f92672; font-weight: bold;">match</span> (list vl e)
                      [(() _) e]
                      [(((id level) . r) (ds bs ns))
                       <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">&gt;&lt;&gt;&lt;&gt;&lt;</span>
                       <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">need to check if the bind already exist</span>
                       (id/commit! id (list (cons level d1)))
                       (recur r (list (<span style="color: #f92672; font-weight: bold;">if</span> leave?
                                        (cons d1 ds)
                                        ds)
                                      bs
                                      ns))]))])
          (recur vl e))])]))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2daf1c2" class="outline-4">
<h4 id="org2daf1c2">id/commit!</h4>
<div class="outline-text-4" id="text-org2daf1c2">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">id/commit!</span> id ls)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">id, ls -&gt; id</span>
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">effect on id</span>
  (<span style="color: #f92672; font-weight: bold;">let</span> ()
    (<span style="color: #f92672; font-weight: bold;">vector-set!</span> id (append ls (vector-ref id 1)))
    id))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc9bb1df" class="outline-2">
<h2 id="orgc9bb1df">copy-arrow</h2>
<div class="outline-text-2" id="text-orgc9bb1df">
</div><div id="outline-container-org20959d7" class="outline-3">
<h3 id="org20959d7"><span class="todo note">note</span> copy</h3>
<div class="outline-text-3" id="text-org20959d7">
<ul class="org-ul">
<li><p>when forming trunk from lambda which is fetched from ns</p><p>we have to copy the lambda</p></li>

<li><p>copy is arrow by arrow</p><p>every var in new arrow is different from old arrow</p><p>thus</p><p><ol class="org-ol"></p><p><li>scope is also arrow by arrow</li></p><p><li>a non-determinate var can not be substituted into lambda as it is</p><p>but is copied</li></ol></p></li>

<li><p>this copy is one of the main place where this prototype can be optimized</p><p>a vm can be designed to replace this copy function</p><p>and change the interpreter to a compiler</p></li></ul>
</div>
</div>

<div id="outline-container-org3cc41a3" class="outline-3">
<h3 id="org3cc41a3">copy-arrow</h3>
<div class="outline-text-3" id="text-org3cc41a3">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">copy-arrow</span> a)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">arrow -&gt; arrow</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> (copy/arrow a '())
    [(a s) a]))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgab93244" class="outline-3">
<h3 id="orgab93244">copy/arrow</h3>
<div class="outline-text-3" id="text-orgab93244">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">copy/arrow</span> a s)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">arrow, scope -&gt; (arrow scope)</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> a
    [(ac sc)
     (<span style="color: #f92672; font-weight: bold;">match</span> (copy/cedent ac s)
       [(ac1 s1)
        (<span style="color: #f92672; font-weight: bold;">match</span> (copy/cedent sc s1)
          [(sc1 s2)
           (list ac1 sc1 s2)])])]))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7c3366f" class="outline-3">
<h3 id="org7c3366f">copy/cedent</h3>
<div class="outline-text-3" id="text-org7c3366f">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">copy/cedent</span> c s)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">(data ...), scope -&gt; ((data ...) scope)</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> c
    [() (list '() s)]
    [(h . r)
     (<span style="color: #f92672; font-weight: bold;">match</span> (copy h s)
       [(h1 s1)
        (<span style="color: #f92672; font-weight: bold;">match</span> (copy/cedent r s1)
          [(r1 s2)
           (list (cons h1 r1) s2)])])]))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7a52728" class="outline-3">
<h3 id="org7a52728">copy/lambda</h3>
<div class="outline-text-3" id="text-org7a52728">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">copy/lambda</span> l s)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">lambda, scope -&gt; (lambda scope)</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> l
    [(a al)
     (<span style="color: #f92672; font-weight: bold;">match</span> (copy/arrow a s)
       [(a1 s1)
        (<span style="color: #f92672; font-weight: bold;">match</span> (copy/arrow-list al s1)
          [(al1 s2)
           (list (list a1 al1) s2)])])]))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf1f1618" class="outline-3">
<h3 id="orgf1f1618">copy/arrow-list</h3>
<div class="outline-text-3" id="text-orgf1f1618">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">copy/arrow-list</span> al s)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">(arrow ...), scope -&gt; ((arrow ...) scope)</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> al
    [() (list '() s)]
    [(h . r)
     (<span style="color: #f92672; font-weight: bold;">match</span> (copy/arrow h s)
       [(h1 s1)
        (<span style="color: #f92672; font-weight: bold;">match</span> (copy/arrow-list r s1)
          [(r1 s2)
           (list (cons h1 r1) s2)])])]))
</pre>
</div>
</div>
</div>

<div id="outline-container-org20a5ad8" class="outline-3">
<h3 id="org20a5ad8">copy</h3>
<div class="outline-text-3" id="text-org20a5ad8">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">copy</span> d s)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">data, scope -&gt; (data scope)</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> d
    [('var x)
     (<span style="color: #f92672; font-weight: bold;">match</span> (copy/var x s)
       [(x1 s1)
        (list (list 'var x1) s1)])]
    [('cons x)
     (<span style="color: #f92672; font-weight: bold;">match</span> (copy/cons x s)
       [(x1 s1)
        (list (list 'cons x1) s1)])]
    [('arrow x)
     (<span style="color: #f92672; font-weight: bold;">match</span> (copy/arrow x s)
       [(x1 s1)
        (list (list 'arrow x1) s1)])]
    [('lambda x)
     (<span style="color: #f92672; font-weight: bold;">match</span> (copy/lambda x s)
       [(x1 s1)
        (list (list 'lambda x1) s1)])]
    [('trunk x)
     (<span style="color: #f92672; font-weight: bold;">match</span> (copy/trunk x s)
       [(x1 s1)
        (list (list 'trunk x1) s1)])]
    [('proj x)
     (<span style="color: #f92672; font-weight: bold;">match</span> (copy/proj x s)
       [(x1 s1)
        (list (list 'proj x1) s1)])]))
</pre>
</div>
</div>
</div>

<div id="outline-container-org24d830b" class="outline-3">
<h3 id="org24d830b">copy/var</h3>
<div class="outline-text-3" id="text-org24d830b">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">copy/var</span> v s)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">var, scope -&gt; (var scope)</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> v
    [(id level)
     (<span style="color: #f92672; font-weight: bold;">let</span> ([found (assq id scope)])
       (<span style="color: #f92672; font-weight: bold;">if</span> found
         (list (list (cdr found) level) s)
         (<span style="color: #f92672; font-weight: bold;">let*</span> ([ls (id-&gt;ls id)]
                [id1 (vector (id-&gt;symbol id) '())]
                [s1 (cons (cons id id1) s)])
           (<span style="color: #f92672; font-weight: bold;">match</span> (copy/ls ls s1)
             [(ls1 s2)
              (id/commit! id1 ls1)
              (list (list id1 level) s2)]))))]))
</pre>
</div>
</div>
</div>

<div id="outline-container-org670fc62" class="outline-3">
<h3 id="org670fc62">copy/ls</h3>
<div class="outline-text-3" id="text-org670fc62">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">copy/ls</span> ls s)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">ls, scope -&gt; (ls scope)</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> ls
    [() (list '() s)]
    [((level . data) . r)
     (<span style="color: #f92672; font-weight: bold;">match</span> (copy data s)
       [(data1 s1)
        (<span style="color: #f92672; font-weight: bold;">match</span> (copy/ls r s1)
          [(r1 s2)
           (list (cons (cons level data1)
                       r1)
                 s2)])])]))
</pre>
</div>
</div>
</div>

<div id="outline-container-org8bf1a1d" class="outline-3">
<h3 id="org8bf1a1d">copy/cons</h3>
<div class="outline-text-3" id="text-org8bf1a1d">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">copy/cons</span> c s)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">cons, scope -&gt; (cons scope)</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> c
    [(n dl)
     (<span style="color: #f92672; font-weight: bold;">match</span> (copy/cedent dl s)
       [(dl1 s1)
        (list (list n dl1) s1)])]))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc852e30" class="outline-3">
<h3 id="orgc852e30">copy/trunk</h3>
<div class="outline-text-3" id="text-orgc852e30">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">copy/trunk</span> t s)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">trunk, scope -&gt; (trunk scope)</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> t
    [(a al dl)
     (<span style="color: #f92672; font-weight: bold;">match</span> (copy/arrow a s)
       [(a1 s1)
        (<span style="color: #f92672; font-weight: bold;">match</span> (copy/arrow-list al s1)
          [(al1 s2)
           (<span style="color: #f92672; font-weight: bold;">match</span> (copy/cedent dl s2)
             [(dl1 s3)
              (list (list a1 al1 dl1) s3)])])])]))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcf888f3" class="outline-3">
<h3 id="orgcf888f3">copy/proj</h3>
<div class="outline-text-3" id="text-orgcf888f3">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">copy/proj</span> p s)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">proj, scope -&gt; (proj scope)</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> p
    [(a al dl i)
     (<span style="color: #f92672; font-weight: bold;">match</span> (copy/arrow a s)
       [(a1 s1)
        (<span style="color: #f92672; font-weight: bold;">match</span> (copy/arrow-list al s1)
          [(al1 s2)
           (<span style="color: #f92672; font-weight: bold;">match</span> (copy/cedent dl s2)
             [(dl1 s3)
              (list (list a1 al1 dl1 i) s3)])])])]))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2444119" class="outline-2">
<h2 id="org2444119"><span class="todo _gt__lt_">&gt;&lt;</span> apply</h2>
<div class="outline-text-2" id="text-org2444119">
</div><div id="outline-container-orgc9c66ad" class="outline-3">
<h3 id="orgc9c66ad">apply/arrow</h3>
<div class="outline-text-3" id="text-orgc9c66ad">
<ul class="org-ul">
<li><p>it returns report instead of env or #f</p><p>because when calling it</p><p>it is more easy to forget to handle the #f returned</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">apply/arrow</span> a e)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">arrow, env -&gt; report</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> e
    [(ds bs ns)
     (<span style="color: #f92672; font-weight: bold;">match</span> a
       [(ac sc)
        (<span style="color: #f92672; font-weight: bold;">match</span> (unify (<span style="color: #f92672; font-weight: bold;">lambda</span> (e) (apply/cedent ac e))
                      (list ds
                            (cons '(commit-point) bs)
                            ns))
          [('fail info-list) ('fail info-list)]
          [('success info-list e1)
           (<span style="color: #f92672; font-weight: bold;">match</span> (apply/cedent sc e1)
             [(ds2 bs2 ns2)
              (list 'success info-list
                    (list ds2 (bs/commit! bs2) ns2))])])])]))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd51c6ac" class="outline-3">
<h3 id="orgd51c6ac">apply/cedent</h3>
<div class="outline-text-3" id="text-orgd51c6ac">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">apply/cedent</span> c e)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">cedent, env -&gt; env</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> c
    [() e]
    [(h . r) (apply/cedent r (apply/dispatch h e))]))
</pre>
</div>
</div>
</div>

<div id="outline-container-org350148b" class="outline-3">
<h3 id="org350148b">apply/dispatch</h3>
<div class="outline-text-3" id="text-org350148b">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">apply/dispatch</span> f e)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">form, env -&gt; env</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> f
    [('var v) (apply/var v e)]
    [('name n) (apply/name n e)]
    [('arrow a) (apply/literal-arrow a e)]
    [('bind b) (apply/bind b e)]))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc38a6ee" class="outline-3">
<h3 id="orgc38a6ee">apply/literal-arrow</h3>
</div>

<div id="outline-container-org7bb4a80" class="outline-3">
<h3 id="org7bb4a80">apply/var</h3>
</div>

<div id="outline-container-org46c95d6" class="outline-3">
<h3 id="org46c95d6">apply/name</h3>
</div>

<div id="outline-container-org5b8330" class="outline-3">
<h3 id="org5b8330"><span class="todo _gt__lt_">&gt;&lt;</span> bs/commit!</h3>
<div class="outline-text-3" id="text-org5b8330">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">bs/commit!</span> bs)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">bs -&gt; bs</span>
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">effect on part of bs</span>
  (<span style="color: #f92672; font-weight: bold;">cond</span> [(equal? '(commit-point) (car bs))
         (cdr bs)]
        [else
         (<span style="color: #f92672; font-weight: bold;">let*</span> ([pair (car bs)]
                [id (car pair)]
                [ls (cdr pair)])
           (id/commit! id ls)
           (bs/commit! (cdr bs)))]))
</pre>
</div>
</div>
</div>

<div id="outline-container-org86dd367" class="outline-3">
<h3 id="org86dd367"><span class="todo _gt__lt_">&gt;&lt;</span> bs/extend</h3>
<div class="outline-text-3" id="text-org86dd367">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">defun</span> bs/extend (default-level bs v d)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">bs var data -&gt; bs</span>
  (<span style="color: #f92672; font-weight: bold;">match</span> v
    (id level) =&gt;
    (<span style="color: #f92672; font-weight: bold;">let*</span> ((level (<span style="color: #f92672; font-weight: bold;">if</span> (eq nil level)
                      default-level
                      level))
           (found/ls (assoc id bs <span style="color: #a6e22e;">:test</span> #'eq)))
      (<span style="color: #f92672; font-weight: bold;">if</span> found/ls
          (substitute (cons id (cons (cons level d)
                                     (cdr found/ls)))
                      (<span style="color: #f92672; font-weight: bold;">lambda</span> (pair) (eq (car pair) id))
                      bs)
          (cons (cons id (list (cons level d)))
                bs)))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6022ae" class="outline-2">
<h2 id="org6022ae"><span class="todo _gt__lt_">&gt;&lt;</span> unify</h2>
<div class="outline-text-2" id="text-org6022ae">
</div><div id="outline-container-org17ffd6f" class="outline-3">
<h3 id="org17ffd6f"><span class="todo _gt__lt_">&gt;&lt;</span> unify</h3>
<div class="outline-text-3" id="text-org17ffd6f">
<div class="org-src-container">

<pre class="src src-scheme">(<span style="color: #f92672; font-weight: bold;">define</span> (<span style="color: #a6e22e;">unify</span> e)
  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">(env -&gt; env), env -&gt; unify-report</span>
  )
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2fec2c5" class="outline-2">
<h2 id="org2fec2c5"><span class="todo _gt__lt_">&gt;&lt;</span> eva</h2>
</div>

<div id="outline-container-orgefdaf46" class="outline-2">
<h2 id="orgefdaf46"><span class="todo _gt__lt_">&gt;&lt;</span> check</h2>
</div>

<div id="outline-container-org14c8fc2" class="outline-2">
<h2 id="org14c8fc2"><span class="todo _gt__lt_">&gt;&lt;</span> type-apply</h2>
</div>

<div id="outline-container-orgb156f6" class="outline-2">
<h2 id="orgb156f6"><span class="todo _gt__lt_">&gt;&lt;</span> sequent</h2>
</div>

<div id="outline-container-org9f676eb" class="outline-2">
<h2 id="org9f676eb"><span class="done test">test</span> </h2>
<div class="outline-text-2" id="text-org9f676eb">
</div><div id="outline-container-org170f6e" class="outline-3">
<h3 id="org170f6e">natural</h3>
<div class="outline-text-3" id="text-org170f6e">
<div class="org-src-container">

<pre class="src src-scheme">(sequent

  (dt type (<span style="color: #66d9ef; font-weight: bold;">-&gt;</span> type))

  (dt natural (<span style="color: #66d9ef; font-weight: bold;">-&gt;</span> type)
      zero (<span style="color: #66d9ef; font-weight: bold;">-&gt;</span> natural)
      succ (natural <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> natural))

  (df add (natural natural <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> natural)
      (<span style="color: #a6e22e;">:m</span> zero <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:m</span>)
      (<span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> succ <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> add succ))

  (df mul (natural natural <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> natural)
      (<span style="color: #a6e22e;">:m</span> zero <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> zero)
      (<span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> succ <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> mul <span style="color: #a6e22e;">:m</span> add))

  (ap (<span style="color: #66d9ef; font-weight: bold;">-&gt;</span>
       zero succ
       zero succ succ
       add))

  (ap (<span style="color: #66d9ef; font-weight: bold;">-&gt;</span>
       zero succ succ
       zero succ succ
       mul))

  (ap (<span style="color: #66d9ef; font-weight: bold;">-&gt;</span> mul)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge5f8eac" class="outline-3">
<h3 id="orge5f8eac">list</h3>
<div class="outline-text-3" id="text-orge5f8eac">
<div class="org-src-container">

<pre class="src src-scheme">(sequent

  (dt type (<span style="color: #66d9ef; font-weight: bold;">-&gt;</span> type))

  (dt natural (<span style="color: #66d9ef; font-weight: bold;">-&gt;</span> type)
      zero (<span style="color: #66d9ef; font-weight: bold;">-&gt;</span> natural)
      succ (natural <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> natural))

  (df add (natural natural <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> natural)
      (<span style="color: #a6e22e;">:m</span> zero <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:m</span>)
      (<span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> succ <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> add succ))

  (df mul (natural natural <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> natural)
      (<span style="color: #a6e22e;">:m</span> zero <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> zero)
      (<span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> succ <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> mul <span style="color: #a6e22e;">:m</span> add))

  (dt list ((<span style="color: #a6e22e;">:t</span> : type) <span style="color: #a6e22e;">:t</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> type)
      null (<span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:t</span> list)
      cons (<span style="color: #a6e22e;">:t</span> list <span style="color: #a6e22e;">:t</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:t</span> list))

  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">(df map (:t1 list (:t1 -&gt; :t2) -&gt; :t2 list)</span>
  <span style="color: #FF8888;">;;     </span><span style="color: #FF8888;">(null :f -&gt; null)</span>
  <span style="color: #FF8888;">;;     </span><span style="color: #FF8888;">(:l :e cons :f -&gt; :e :f apply :l :f map cons))</span>

  (df append (<span style="color: #a6e22e;">:t</span> list <span style="color: #a6e22e;">:t</span> list <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:t1</span> list)
      (<span style="color: #a6e22e;">:l</span> null <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:l</span>)
      (<span style="color: #a6e22e;">:l</span> <span style="color: #a6e22e;">:r</span> <span style="color: #a6e22e;">:e</span> cons <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:l</span> <span style="color: #a6e22e;">:r</span> append <span style="color: #a6e22e;">:e</span> cons))

  (ap (<span style="color: #66d9ef; font-weight: bold;">-&gt;</span>
       null
       zero cons
       zero cons
       zero cons
       null
       zero cons
       zero cons
       zero cons
       append)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org435ed9a" class="outline-3">
<h3 id="org435ed9a">vector</h3>
<div class="outline-text-3" id="text-org435ed9a">
<div class="org-src-container">

<pre class="src src-scheme">(sequent

  (dt type (<span style="color: #66d9ef; font-weight: bold;">-&gt;</span> type))

  (dt natural (<span style="color: #66d9ef; font-weight: bold;">-&gt;</span> type)
      zero (<span style="color: #66d9ef; font-weight: bold;">-&gt;</span> natural)
      succ (natural <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> natural))

  (df add (natural natural <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> natural)
      (<span style="color: #a6e22e;">:m</span> zero <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:m</span>)
      (<span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> succ <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> add succ))

  (df mul (natural natural <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> natural)
      (<span style="color: #a6e22e;">:m</span> zero <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> zero)
      (<span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> succ <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> mul <span style="color: #a6e22e;">:m</span> add))

  (dt vector ((<span style="color: #a6e22e;">:t</span> : type) natural <span style="color: #a6e22e;">:t</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> type)
      null (<span style="color: #66d9ef; font-weight: bold;">-&gt;</span> zero <span style="color: #a6e22e;">:t</span> vector)
      cons (<span style="color: #a6e22e;">:n</span> <span style="color: #a6e22e;">:t</span> vector <span style="color: #a6e22e;">:t</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:n</span> succ <span style="color: #a6e22e;">:t</span> vector))

  <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">(df map (:n :t1 vector (:t1 -&gt; :t2) -&gt; :n :t2 vector)</span>
  <span style="color: #FF8888;">;;     </span><span style="color: #FF8888;">(null :f -&gt; null)</span>
  <span style="color: #FF8888;">;;     </span><span style="color: #FF8888;">(:l :e cons :f -&gt; :e :f apply :l :f map cons))</span>

  (df append (<span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:t</span> vector <span style="color: #a6e22e;">:n</span> <span style="color: #a6e22e;">:t</span> vector <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:m</span> <span style="color: #a6e22e;">:n</span> add <span style="color: #a6e22e;">:t</span> vector)
      (<span style="color: #a6e22e;">:l</span> null <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:l</span>)
      (<span style="color: #a6e22e;">:l</span> <span style="color: #a6e22e;">:r</span> <span style="color: #a6e22e;">:e</span> cons <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #a6e22e;">:l</span> <span style="color: #a6e22e;">:r</span> append <span style="color: #a6e22e;">:e</span> cons))

  (ap (<span style="color: #66d9ef; font-weight: bold;">-&gt;</span>
       null
       zero cons
       zero cons
       zero cons
       null
       zero cons
       zero cons
       zero cons
       append)))
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
喪以不執 所執者喪 執喪相比 方死方生
</div>
</body>
</html>
