<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2016-06-04 Sat 15:40 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>sequent1</title>
<meta name="generator" content="Org-mode" />
<meta name="author" content="XIE Yuheng" />
<link rel="stylesheet" href="http://xieyuheng.github.io/asset/css/page.css" type="text/css" media="screen" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
喪以不執 所執者喪 執喪相比 方死方生
</div>
<div id="content">
<h1 class="title">sequent1</h1>
<div id="table-of-contents">
<h2>overview</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org7329427"><span class="done todo">todo</span> </a></li>
<li><a href="#org70c6d59"><span class="todo note">note</span> </a>
<ul>
<li><a href="#orgb53f155">unsatisfactory features</a></li>
<li><a href="#org6d30e4b">sequent</a></li>
<li><a href="#org8ab5657">form1</a></li>
<li><a href="#org34d9bb3">form2</a></li>
<li><a href="#org6fcd1e1">form3</a></li>
<li><a href="#org6bb9fae">data</a></li>
<li><a href="#orgd6b7f64">env</a></li>
<li><a href="#org193ab06">report</a></li>
<li><a href="#org9e2babe">top</a></li>
<li><a href="#org6b1f1ab">no dependent type in scheme</a></li>
</ul>
</li>
<li><a href="#orga4858c4">pass1</a>
<ul>
<li><a href="#orgefea47d"><span class="todo note">note</span> </a></li>
<li><a href="#orgc9a2405">pass1/arrow</a></li>
<li><a href="#org244e69e">pass1/cedent</a></li>
<li><a href="#orgae02a7c">predicates</a></li>
<li><a href="#orge6b4306">pass1</a></li>
<li><a href="#orga0ce315">pass1/var</a></li>
</ul>
</li>
<li><a href="#orgc5f3a99">pass2</a>
<ul>
<li><a href="#orgd7d1034"><span class="todo note">note</span> </a></li>
<li><a href="#org9876715">pass2/get-arrow</a></li>
<li><a href="#orgec68809">pass2/arrow</a></li>
<li><a href="#org74b714">pass2/cedent</a></li>
<li><a href="#orgd1326ca">pass2/lambda</a></li>
<li><a href="#orgac3c4fe">pass2</a></li>
<li><a href="#org121f2c8">id/new</a></li>
<li><a href="#org961e426">pass2/var</a></li>
<li><a href="#orgc07a8dc">pass2/bind</a></li>
</ul>
</li>
<li><a href="#orgec26638">pass3</a>
<ul>
<li><a href="#org719db01"><span class="todo note">note</span> </a></li>
<li><a href="#orge45e068">env/pop</a></li>
<li><a href="#org986cbad">pass3/get-arrow</a></li>
<li><a href="#org879700f">pass3/arrow</a></li>
<li><a href="#org43b702e">pass3/get-arrow-check</a></li>
<li><a href="#org5edb8b1">pass3/arrow-check</a></li>
<li><a href="#org4c18e3b">pass3/cedent</a></li>
<li><a href="#org5be802b">pass3/lambda</a></li>
<li><a href="#orge5a12ad">pass3</a></li>
<li><a href="#org56183a7">pass3/var</a></li>
<li><a href="#org1b31907">pass3/apply</a></li>
<li><a href="#orgd635b57">pass3/apply/data</a></li>
<li><a href="#org4df6867">pass3/apply/arrow</a></li>
<li><a href="#orgcfdd164">pass3/apply/lambda</a></li>
<li><a href="#orgfd6cd27">pass3/apply/var</a></li>
<li><a href="#org9c04d03">id-&gt;name &amp; id-&gt;counter &amp; id-&gt;ls</a></li>
<li><a href="#orge190064">pass3/name</a></li>
<li><a href="#org57cc707">pass3/name/cons</a></li>
<li><a href="#org1217248">pass3/name/trunk</a></li>
<li><a href="#orgd183049">pass3/bind</a></li>
<li><a href="#org9f275c3">id/commit!</a></li>
</ul>
</li>
<li><a href="#org4299ce8">bind-stack</a>
<ul>
<li><a href="#org5128c6e"><span class="todo note">note</span> </a></li>
<li><a href="#orge1b3730">bs/find</a></li>
<li><a href="#org24abf61">bs/walk</a></li>
<li><a href="#org6bf453d">bs/deep</a></li>
<li><a href="#org988b422">var/fresh?</a></li>
<li><a href="#org688737e">bs/extend</a></li>
<li><a href="#org5e98a63">var/eq?</a></li>
</ul>
</li>
<li><a href="#org1de79c2">copy-arrow</a>
<ul>
<li><a href="#org2ccdd01"><span class="todo note">note</span> </a></li>
<li><a href="#orge294beb">copy-arrow</a></li>
<li><a href="#org36e6d5">copy-cedent</a></li>
<li><a href="#org1b4bced">copy/arrow</a></li>
<li><a href="#org41d35eb">copy/data-list</a></li>
<li><a href="#org6f771c5">copy/cedent</a></li>
<li><a href="#org5c9c4cc">copy/lambda</a></li>
<li><a href="#org7da257d">copy/arrow-list</a></li>
<li><a href="#org3acdb5e">copy</a></li>
<li><a href="#orgf9fea3b">copy/var</a></li>
<li><a href="#orgbd8871b">copy/ls</a></li>
<li><a href="#org9fac201">copy/cons</a></li>
<li><a href="#orgf32d991">copy/trunk</a></li>
<li><a href="#org31d1ea0">copy/bind</a></li>
</ul>
</li>
<li><a href="#org2959bf3">compute</a>
<ul>
<li><a href="#org33cb2f0">compute/arrow</a></li>
<li><a href="#orge1e6912">bs/commit!</a></li>
<li><a href="#orgdd45fe0">compute/cedent</a></li>
<li><a href="#orge0e1b85">compute</a></li>
<li><a href="#org798dc51">compute/var</a></li>
<li><a href="#org1452d31">compute/cons</a></li>
<li><a href="#org4c9af38">compute/trunk</a>
<ul>
<li><a href="#org1566dbf">compute/trunk</a></li>
<li><a href="#orga9078c0">compute/trunk/tody/var</a></li>
<li><a href="#org2496a7b">compute/trunk/tody/name</a></li>
<li><a href="#orgc857fc8">compute/trunk/tody/arrow-list</a></li>
<li><a href="#org63efe77">trunk-&gt;trunk*</a></li>
</ul>
</li>
<li><a href="#org9a437a8">compute/bind</a></li>
<li><a href="#orga8055b">filter-arrow-list</a></li>
<li><a href="#org2459987">proj</a></li>
</ul>
</li>
<li><a href="#orga434a14">solve</a>
<ul>
<li><a href="#org28be6d5">solve/arrow</a></li>
</ul>
</li>
<li><a href="#org37777f0">print</a>
<ul>
<li><a href="#orgf6c450b">print/cedent</a></li>
<li><a href="#org48c1523">print/data-list</a></li>
<li><a href="#org6f7fa33">print/data</a></li>
<li><a href="#org182efb5">print/var</a></li>
<li><a href="#orgffc8b4b">print/cons</a></li>
<li><a href="#orge44040f">print/arrow</a></li>
<li><a href="#org3fec5a6"><span class="todo _gt__lt_">&gt;&lt;</span> print/lambda</a></li>
<li><a href="#orgac85f95"><span class="todo _gt__lt_">&gt;&lt;</span> print/trunk</a></li>
<li><a href="#orgc357084">print/bind</a></li>
</ul>
</li>
<li><a href="#orge598ae0">consistent-check</a>
<ul>
<li><a href="#org47c1075">consistent-check</a></li>
<li><a href="#org7d0782d">consistent-check/level-diff</a></li>
<li><a href="#org2510227">type-solve/repeat</a></li>
<li><a href="#orgf7fd7f">var/highest? &amp; var/lowest?</a></li>
<li><a href="#org38d3398">var/above &amp; var/below</a></li>
</ul>
</li>
<li><a href="#org6209f75">occur-check</a>
<ul>
<li><a href="#org66c4f2e"><span class="todo note">note</span> </a></li>
<li><a href="#orgd4b0849">occur-check/data</a></li>
<li><a href="#orgc82c40e">occur-check/var</a></li>
<li><a href="#org6f68857">occur-check/cons</a></li>
<li><a href="#org3f60a21">occur-check/data-list</a></li>
<li><a href="#org8f07080">occur-check/arrow</a></li>
<li><a href="#orgaa155be">occur-check/lambda</a></li>
<li><a href="#org33629ce">occur-check/arrow-list</a></li>
<li><a href="#org98b7e93">occur-check/trunk</a></li>
<li><a href="#org6a32432">occur-check/bind</a></li>
</ul>
</li>
<li><a href="#org2347012">unify</a>
<ul>
<li><a href="#org495f126"><span class="todo note">note</span> </a></li>
<li><a href="#org6b3e59b">unify/data-list</a></li>
<li><a href="#orgd1eb05c">unify/data</a></li>
<li><a href="#orgea06641">unify/var/data</a></li>
<li><a href="#orgfa2c2a7">unify/cons</a></li>
<li><a href="#org5279baa">unify/arrow</a></li>
<li><a href="#org48a2bcc">unify/lambda</a></li>
<li><a href="#org36b96e0">unify/arrow-list</a></li>
<li><a href="#orgac3fd28">unify/trunk</a>
<ul>
<li><a href="#org8deafbc"><span class="todo note">note</span> </a></li>
<li><a href="#org8fb32c9">unify/trunk</a></li>
<li><a href="#orgf82cb09">unify/trunk/syntactic</a></li>
<li><a href="#org11e8d00">unify/trunk/semantic</a></li>
</ul>
</li>
<li><a href="#org3812422">unify/trunk/data</a></li>
</ul>
</li>
<li><a href="#org5d6b45e">cover</a>
<ul>
<li><a href="#orge5fcd6a"><span class="todo note">note</span> </a></li>
<li><a href="#orgf1714ef">cover/data-list</a></li>
<li><a href="#orgb90a3bd">cover/data</a></li>
<li><a href="#orgeb4d03d">cover/var/data</a></li>
<li><a href="#orgb4cfcde">cover/cons</a></li>
<li><a href="#org995f8e6">cover/arrow</a></li>
<li><a href="#orge1a5d00">cover/lambda</a></li>
<li><a href="#org8bd5d1a">cover/arrow-list</a></li>
<li><a href="#orgca5d18d">cover/trunk</a>
<ul>
<li><a href="#orgc051d11"><span class="todo note">note</span> </a></li>
<li><a href="#org8f9c161">cover/trunk</a></li>
<li><a href="#org17a8ba5">cover/trunk/syntactic</a></li>
<li><a href="#orgcb1fef7">cover/trunk/semantic</a></li>
</ul>
</li>
<li><a href="#org846d936">cover/trunk/data</a></li>
</ul>
</li>
<li><a href="#orgb84caae">bind-unify</a>
<ul>
<li><a href="#org870062">bind-unify/data-list</a></li>
<li><a href="#org85bfe31">bind-unify/data</a></li>
</ul>
</li>
<li><a href="#org4e41a98">eva</a>
<ul>
<li><a href="#orge6799e3">init-env</a></li>
<li><a href="#org36ccf4d">eva</a></li>
<li><a href="#orge4e280d">eva/top-list</a></li>
<li><a href="#orgd7147f0">parse/top</a></li>
<li><a href="#orgecefce7">parse/top/deftype-body</a></li>
<li><a href="#orgf1b54ee">eva/top</a></li>
<li><a href="#org5ed52f0">form1/arrow-&gt;arrow</a></li>
<li><a href="#orge28f595">form1/arrow-&gt;arrow-check</a></li>
<li><a href="#org50336e2">eva/app</a></li>
<li><a href="#org548d6d6">eva/deftype</a></li>
<li><a href="#org2d6e5f5">cover-check? &amp; cover-check- &amp; cover-check+</a></li>
<li><a href="#orge456b5a">recur-check? &amp; recur-check- &amp; recur-check+</a></li>
<li><a href="#org23070fc">eva/defn</a></li>
</ul>
</li>
<li><a href="#org2a95571">sequent</a>
<ul>
<li><a href="#orgcec7ec4">sequent</a></li>
<li><a href="#org917e1af"><span class="todo _gt__lt_">&gt;&lt;</span> sequent/repl</a></li>
</ul>
</li>
<li><a href="#org6456cc5">type-compute</a>
<ul>
<li><a href="#org4a2cbdd">type-compute/cedent</a></li>
<li><a href="#orga583f7d">type-compute</a></li>
<li><a href="#orgd0f525c">type-compute/var</a></li>
<li><a href="#org2123c72">type-compute/cons</a></li>
<li><a href="#orgdf0da11">type-compute/arrow</a></li>
<li><a href="#orge40a9a">type-compute/lambda</a></li>
<li><a href="#org9f2eb91">type-compute/trunk</a></li>
<li><a href="#org4f2f7b8">type-compute/bind</a></li>
</ul>
</li>
<li><a href="#orgbab1cda">type-solve</a>
<ul>
<li><a href="#org949ac12">type-solve/cedent</a></li>
<li><a href="#org47a25ec">type-solve</a></li>
<li><a href="#org7c7970e">type-solve/var</a></li>
<li><a href="#org376bea8">type-solve/cons</a></li>
<li><a href="#org7cd316a">type-solve/arrow</a></li>
<li><a href="#org4b64064">type-solve/lambda</a></li>
<li><a href="#org22ba326">type-solve/trunk</a></li>
<li><a href="#org361a145">type-solve/bind</a></li>
</ul>
</li>
<li><a href="#org5c3e9c2">infer</a>
<ul>
<li><a href="#orgb22cbba">infer/arrow</a></li>
<li><a href="#org19f88bd">infer/arrow-list</a></li>
<li><a href="#org2b60303">unite/arrow-list</a></li>
<li><a href="#org2b9606c">unite/two</a></li>
</ul>
</li>
<li><a href="#org110531c">cover-check</a>
<ul>
<li><a href="#orge8aaaaa"><span class="todo note">note</span> </a></li>
<li><a href="#org9916ae9">cover-check</a></li>
<li><a href="#org20b48b2">cover-check/cedent/arrow-list</a></li>
<li><a href="#org5d9474f">cover-check/cedent</a></li>
<li><a href="#orgdfb8ddb"><span class="todo note">note</span> alterdata</a></li>
<li><a href="#org3e82462">data-gen</a></li>
<li><a href="#orgaba5414">alter-expand</a>
<ul>
<li><a href="#org123f6ef">alter-expand</a></li>
<li><a href="#orgfae63b7">alter-expand/get-data-list &amp; alter-expand/get-data</a></li>
<li><a href="#orge2574a3">alter-expand/alterdata-list</a></li>
<li><a href="#orgd8b9f40">bs/extend-alter</a></li>
</ul>
</li>
<li><a href="#org1d76706">data-gen/cedent</a></li>
<li><a href="#orgccad225">data-gen/data</a></li>
<li><a href="#orgf7522b3">data-gen/cons</a></li>
<li><a href="#orgec717d5">data-gen/alterdata-list</a>
<ul>
<li><a href="#org4514097">data-gen/alterdata-list</a></li>
<li><a href="#org43aea6f">n-&gt;na</a></li>
<li><a href="#orgd173dbc">na-&gt;nadl</a></li>
<li><a href="#org1e609f">nadl-&gt;alterdata</a></li>
<li><a href="#org10d7706">d-&gt;subd</a></li>
</ul>
</li>
<li><a href="#org82b19d6">data-gen/var</a></li>
<li><a href="#orgc9d7134">data-gen/arrow</a></li>
<li><a href="#orgb991f75">data-gen/trunk</a></li>
<li><a href="#orgd90039e">data-gen/lambda</a></li>
</ul>
</li>
<li><a href="#org18e0ba2">recur-check</a>
<ul>
<li><a href="#orgbbe0e2e"><span class="todo note">note</span> </a></li>
<li><a href="#org241887a">licons</a>
<ul>
<li><a href="#orgd806166"><span class="todo note">note</span> </a></li>
<li><a href="#org44ed1a0">licons/extend-list</a></li>
<li><a href="#orgcaa593d">licons/extend</a></li>
<li><a href="#orgafee341">licons/extend/one</a></li>
<li><a href="#orga5e48c5">licons/data-less-then</a></li>
<li><a href="#org787dfbb">licons/less-or-equal</a></li>
<li><a href="#orga599d62">licons/less-then</a></li>
</ul>
</li>
<li><a href="#org5fe38b6">structural-recur-check/all</a>
<ul>
<li><a href="#org7375cc2">structural-recur-check/all</a></li>
<li><a href="#org84fc36">struct-rec/all/cedent</a></li>
<li><a href="#org12146b2">struct-rec/all/data</a></li>
<li><a href="#org184130f">struct-rec/all/arrow-list</a></li>
<li><a href="#org16c5697">struct-rec/all/arrow</a></li>
<li><a href="#org83c5cfd">licons/less-then/data-list</a></li>
<li><a href="#org737bbd3">struct-rec/all/trunk</a></li>
</ul>
</li>
<li><a href="#org79a1729">structural-recur-check/each</a>
<ul>
<li><a href="#org815718d">structural-recur-check/each</a></li>
<li><a href="#orgf2728e0">struct-rec/each/cedent</a></li>
<li><a href="#org5d3ba80">struct-rec/each/data</a></li>
<li><a href="#org7bba17e">struct-rec/each/arrow-list</a></li>
<li><a href="#orge10f545">struct-rec/each/arrow</a></li>
<li><a href="#orgfd415b5">licons/less-then/each-data</a></li>
<li><a href="#org2a3eb17">licons/less-then/each-data/info</a></li>
<li><a href="#orgbb83786">struct-rec/each/trunk</a></li>
</ul>
</li>
<li><a href="#org416ee5a">get-recur-check-list</a></li>
<li><a href="#org44d987a">recur-check</a></li>
<li><a href="#orge476a88">recur-check/list</a></li>
</ul>
</li>
</ul>
</div>
</div>
<hr  />

<ul class="org-ul">
<li><p>the implementation of the interpreter (<a href="https://github.com/xieyuheng/sequent1">source</a>)</p></li></ul>

<hr  />

<div id="outline-container-org7329427" class="outline-2">
<h2 id="org7329427"><span class="done todo">todo</span> </h2>
<div class="outline-text-2" id="text-org7329427">
<ul class="org-ul">
<li><p>report info should be strictly structured</p></li>

<li><p>module system</p></li>

<li><p>no repl</p><p>but load file</p></li>

<li><p>code is not well factored</p><p>cover is copying unify</p><p>type-solve is copying type-compute</p></li></ul>
</div>
</div>

<div id="outline-container-org70c6d59" class="outline-2">
<h2 id="org70c6d59"><span class="todo note">note</span> </h2>
<div class="outline-text-2" id="text-org70c6d59">
</div><div id="outline-container-orgb53f155" class="outline-3">
<h3 id="orgb53f155">unsatisfactory features</h3>
<div class="outline-text-3" id="text-orgb53f155">
<ul class="org-ul">
<li><p>as a prototype implementation of an interpreter</p><p>its unsatisfactory features are</p><p><ol class="org-ol"></p><p><li>call-by-name</p><p>to use graph-rewrite-system instead of term-rewriting-system</p><p>can be used to solve this</li></p><p><li>using copy to handle scope</p><p>a vm</p><p>can be used to solve this</li></p><p><li>mutual recursive function is not handled</p><p>to use compiler instead of interpreter</p><p>can be used to solve this</li></ol></p></li></ul>
</div>
</div>

<div id="outline-container-org6d30e4b" class="outline-3">
<h3 id="org6d30e4b">sequent</h3>
<div class="outline-text-3" id="text-org6d30e4b">
<ul class="org-ul">
<li><p>sequent is called arrow here</p><p>which is the core data type of the language</p></li></ul>
</div>
</div>

<div id="outline-container-org8ab5657" class="outline-3">
<h3 id="org8ab5657">form1</h3>
<div class="outline-text-3" id="text-org8ab5657">
<ul class="org-ul">
<li><p>reduction strategy is revealed by the postfix notation</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form1
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form1/var
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">example</span>
      <span style="color: #a6e22e;">:var</span>
      <span style="color: #a6e22e;">:var^n</span><span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form1/name
    symbol<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form1/arrow
    '<span style="color: #696969;">(</span>form1 ... <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> form1 ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form1/lambda
    '<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> form1/arrow
       form1/arrow
       ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form1/im-bind
    '<span style="color: #696969;">(</span>form1/var ... : form1 ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form1/ex-bind
    '<span style="color: #696969;">(</span>form1/var ... @ form1 ...<span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org34d9bb3" class="outline-3">
<h3 id="org34d9bb3">form2</h3>
<div class="outline-text-3" id="text-org34d9bb3">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form2
  <span style="color: #B380A8;">{</span>'form2/var    <span style="color: #B380A8;">{</span>symbol level<span style="color: #B380A8;">}}</span>
  <span style="color: #B380A8;">{</span>'form2/name   symbol<span style="color: #B380A8;">}</span>
  <span style="color: #B380A8;">{</span>'form2/arrow  <span style="color: #B380A8;">{{</span>form2 ...<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>form2 ...<span style="color: #B380A8;">}}}</span>
  <span style="color: #B380A8;">{</span>'form2/lambda <span style="color: #B380A8;">{</span>form2/arrow <span style="color: #B380A8;">{</span>form2/arrow ...<span style="color: #B380A8;">}}}</span>
  <span style="color: #B380A8;">{</span>'form2/bind   <span style="color: #B380A8;">{{</span>form2/var ...<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>form2 ...<span style="color: #B380A8;">}</span> leave?<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> level natural-number<span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> leave? bool<span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6fcd1e1" class="outline-3">
<h3 id="org6fcd1e1">form3</h3>
<div class="outline-text-3" id="text-org6fcd1e1">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form3
  <span style="color: #B380A8;">{</span>'form3/var    <span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}}</span>
  <span style="color: #B380A8;">{</span>'form3/name   symbol<span style="color: #B380A8;">}</span>
  <span style="color: #B380A8;">{</span>'form3/arrow  <span style="color: #B380A8;">{{</span>form3 ...<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>form3 ...<span style="color: #B380A8;">}}}</span>
  <span style="color: #B380A8;">{</span>'form3/lambda <span style="color: #B380A8;">{</span>form3/arrow <span style="color: #B380A8;">{</span>form3/arrow ...<span style="color: #B380A8;">}}}</span>
  <span style="color: #B380A8;">{</span>'form3/bind   <span style="color: #B380A8;">{{</span>form3/var ...<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>form3 ...<span style="color: #B380A8;">}</span> leave?<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> id #<span style="color: #696969;">((</span>name . counter<span style="color: #696969;">)</span> ls<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6bb9fae" class="outline-3">
<h3 id="org6bb9fae">data</h3>
<div class="outline-text-3" id="text-org6bb9fae">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> data
  <span style="color: #B380A8;">{</span>'var    <span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}}</span>
  <span style="color: #B380A8;">{</span>'cons   <span style="color: #B380A8;">{</span>name <span style="color: #B380A8;">{</span>data ...<span style="color: #B380A8;">}}}</span>
  <span style="color: #B380A8;">{</span>'arrow  <span style="color: #B380A8;">{</span>cedent cedent<span style="color: #B380A8;">}}</span>
  <span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>arrow <span style="color: #B380A8;">{</span>arrow ...<span style="color: #B380A8;">}}}</span>
  <span style="color: #B380A8;">{</span>'trunk  <span style="color: #B380A8;">{</span>arrow tody <span style="color: #B380A8;">{</span>data ...<span style="color: #B380A8;">}</span> index<span style="color: #B380A8;">}}</span>
  <span style="color: #B380A8;">{</span>'bind   <span style="color: #B380A8;">{</span>var data<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> cedent <span style="color: #B380A8;">{</span>data ...<span style="color: #B380A8;">}</span>
      <span style="color: #797979;">[</span>reverse a cedent get data-list<span style="color: #797979;">]</span><span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> tody <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">trunk-body</span>
  <span style="color: #B380A8;">{</span>'tody/name name<span style="color: #B380A8;">}</span>
  <span style="color: #B380A8;">{</span>'tody/arrow-list <span style="color: #B380A8;">{</span>arrow ...<span style="color: #B380A8;">}}</span>
  <span style="color: #B380A8;">{</span>'tody/var var<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd6b7f64" class="outline-3">
<h3 id="orgd6b7f64">env</h3>
<div class="outline-text-3" id="text-orgd6b7f64">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> env <span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> ds <span style="color: #B380A8;">{</span>data ...<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> bs <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>id . ls<span style="color: #696969;">)</span> ...<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> ns <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>name . meaning<span style="color: #696969;">)</span> ...<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> ls <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>level . data<span style="color: #696969;">)</span> ...<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> meaning
  <span style="color: #B380A8;">{</span>'cons/type <span style="color: #B380A8;">{</span>arrow name <span style="color: #B380A8;">{</span>name ...<span style="color: #B380A8;">}}}</span>
  <span style="color: #B380A8;">{</span>'cons/data <span style="color: #B380A8;">{</span>arrow name name<span style="color: #B380A8;">}}</span>
  <span style="color: #B380A8;">{</span>'lambda    <span style="color: #B380A8;">{</span>arrow <span style="color: #B380A8;">{</span>arrow ...<span style="color: #B380A8;">}}}</span><span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org193ab06" class="outline-3">
<h3 id="org193ab06">report</h3>
<div class="outline-text-3" id="text-org193ab06">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> report
  <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>info ...<span style="color: #B380A8;">}}</span>
  <span style="color: #B380A8;">{</span>'success env<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> info <span style="color: #66d9ef; font-weight: bold;">&lt;free&gt;</span><span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9e2babe" class="outline-3">
<h3 id="org9e2babe">top</h3>
<div class="outline-text-3" id="text-org9e2babe">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> top
  <span style="color: #B380A8;">{</span>'+ <span style="color: #B380A8;">{{</span>form1/name form1/arrow<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{{</span>form1/name form1/arrow<span style="color: #B380A8;">}</span> ...<span style="color: #B380A8;">}}}</span>
  <span style="color: #B380A8;">{</span>'~ <span style="color: #B380A8;">{{</span>form1/name form1/arrow<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>form1/arrow ...<span style="color: #B380A8;">}}}</span>
  <span style="color: #B380A8;">{</span>'app form1/arrow<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6b1f1ab" class="outline-3">
<h3 id="org6b1f1ab">no dependent type in scheme</h3>
<div class="outline-text-3" id="text-org6b1f1ab">
<ul class="org-ul">
<li><p>because I am not documenting these scheme functions by dependent type</p><p>the type document already fail to express</p><p>most of the natural of env passing functions</p></li>

<li><p>not to mention the invariants of functions which is described by english</p><p>neither them can be expressed by the week type notation</p></li>

<li><p>it is such a cognitive burden</p><p>it is what makes programming a hard work where mistake is too easy</p></li></ul>
</div>
</div>
</div>

<div id="outline-container-orga4858c4" class="outline-2">
<h2 id="orga4858c4">pass1</h2>
<div class="outline-text-2" id="text-orga4858c4">
</div><div id="outline-container-orgefea47d" class="outline-3">
<h3 id="orgefea47d"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-orgefea47d">
<ul class="org-ul">
<li><p>form1 -pass1-&gt; form2</p><p>default-level of var is handled here</p><p>default-level in bind is 1</p><p>default-level in other place is 0</p></li></ul>
</div>
</div>

<div id="outline-container-orgc9a2405" class="outline-3">
<h3 id="orgc9a2405">pass1/arrow</h3>
<div class="outline-text-3" id="text-orgc9a2405">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass1/arrow</span> default-level s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> default-level form1/arrow <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> form2/arrow<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>pass1/cedent default-level <span style="color: #696969;">(</span>left-of '<span style="color: #66d9ef; font-weight: bold;">-&gt;</span> s<span style="color: #696969;">))</span>
        <span style="color: #696969;">(</span>pass1/cedent default-level <span style="color: #696969;">(</span>right-of '<span style="color: #66d9ef; font-weight: bold;">-&gt;</span> s<span style="color: #696969;">))))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org244e69e" class="outline-3">
<h3 id="org244e69e">pass1/cedent</h3>
<div class="outline-text-3" id="text-org244e69e">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass1/cedent</span> default-level s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> default-level <span style="color: #696969;">(</span>form1 ...<span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>form2 ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> s
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>h . r<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>pass1 default-level h<span style="color: #696969;">)</span>
                   <span style="color: #696969;">(</span>pass1/cedent default-level r<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgae02a7c" class="outline-3">
<h3 id="orgae02a7c">predicates</h3>
<div class="outline-text-3" id="text-orgae02a7c">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">form1/var?</span> v<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>symbol? v<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>equal? <span style="color: #e6db74;">":"</span> <span style="color: #696969;">(</span>substring <span style="color: #696969;">(</span>symbol-&gt;string v<span style="color: #696969;">)</span> 0 1<span style="color: #696969;">))))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">form1/name?</span> v<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>symbol? v<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>not <span style="color: #696969;">(</span>eq? <span style="color: #e6db74;">":"</span> <span style="color: #696969;">(</span>substring <span style="color: #696969;">(</span>symbol-&gt;string v<span style="color: #696969;">)</span> 0 1<span style="color: #696969;">)))))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">form1/arrow?</span> v<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>list? v<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>member '<span style="color: #66d9ef; font-weight: bold;">-&gt;</span> v<span style="color: #696969;">)))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">form1/lambda?</span> v<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>list? v<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>eq? <span style="color: #696969;">(</span>car v<span style="color: #696969;">)</span> 'lambda<span style="color: #696969;">)))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">form1/im-bind?</span> v<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>list? v<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>pair? v<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>equal? <span style="color: #696969;">(</span>car v<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>vector 'flower-barcket/in-eva<span style="color: #696969;">))</span>
       <span style="color: #696969;">(</span>member ': v<span style="color: #696969;">)))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">form1/ex-bind?</span> v<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>list? v<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>pair? v<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>not <span style="color: #696969;">(</span>equal? <span style="color: #696969;">(</span>car v<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>vector 'flower-barcket/in-eva<span style="color: #696969;">)))</span>
       <span style="color: #696969;">(</span>member ': v<span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge6b4306" class="outline-3">
<h3 id="orge6b4306">pass1</h3>
<div class="outline-text-3" id="text-orge6b4306">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass1</span> default-level v<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> default-level form1 <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> form2<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">cond</span> <span style="color: #797979;">[</span><span style="color: #696969;">(</span>form1/var? v<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span>list 'form2/var
               <span style="color: #696969;">(</span>pass1/var default-level v<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
        <span style="color: #797979;">[</span><span style="color: #696969;">(</span>form1/name? v<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span>list 'form2/name
               v<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
        <span style="color: #797979;">[</span><span style="color: #696969;">(</span>form1/arrow? v<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span>list 'form2/arrow
               <span style="color: #696969;">(</span>pass1/arrow default-level v<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
        <span style="color: #797979;">[</span><span style="color: #696969;">(</span>form1/lambda? v<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span>list 'form2/lambda
               <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>pass1/arrow default-level <span style="color: #696969;">(</span>cadr v<span style="color: #696969;">))</span>
                     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>pass1/arrow default-level x<span style="color: #696969;">))</span>
                       <span style="color: #696969;">(</span>cddr v<span style="color: #696969;">))))</span><span style="color: #797979;">]</span>
        <span style="color: #797979;">[</span><span style="color: #696969;">(</span>form1/im-bind? v<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>v <span style="color: #696969;">(</span>cdr v<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span>list 'form2/bind
                 <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>pass1/cedent 1 <span style="color: #696969;">(</span>left-of ': v<span style="color: #696969;">))</span>
                       <span style="color: #696969;">(</span>pass1/cedent 0 <span style="color: #696969;">(</span>right-of ': v<span style="color: #696969;">))</span>
                       #f<span style="color: #696969;">)))</span><span style="color: #797979;">]</span>
        <span style="color: #797979;">[</span><span style="color: #696969;">(</span>form1/ex-bind? v<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span>list 'form2/bind
               <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>pass1/cedent 1 <span style="color: #696969;">(</span>left-of ': v<span style="color: #696969;">))</span>
                     <span style="color: #696969;">(</span>pass1/cedent 0 <span style="color: #696969;">(</span>right-of ': v<span style="color: #696969;">))</span>
                     #t<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
        <span style="color: #797979;">[</span>else
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass1 <span style="color: #696969;">(</span><span style="color: #e6db74;">"pass1 can not handle sexp-form:~a"</span> v<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga0ce315" class="outline-3">
<h3 id="orga0ce315">pass1/var</h3>
<div class="outline-text-3" id="text-orga0ce315">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass1/var</span> default-level v<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> default-level symbol <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> form2/var<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>str <span style="color: #696969;">(</span>symbol-&gt;string v<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span>cursor <span style="color: #696969;">(</span>find-char <span style="color: #e6db74;">"^"</span> str<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> cursor
      <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>string-&gt;symbol <span style="color: #696969;">(</span>substring str 0 cursor<span style="color: #696969;">))</span>
            <span style="color: #696969;">(</span>string-&gt;number <span style="color: #696969;">(</span>substring str <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+</span> 1 cursor<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>string-length str<span style="color: #696969;">))))</span>
      <span style="color: #696969;">(</span>list v default-level<span style="color: #696969;">))))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc5f3a99" class="outline-2">
<h2 id="orgc5f3a99">pass2</h2>
<div class="outline-text-2" id="text-orgc5f3a99">
</div><div id="outline-container-orgd7d1034" class="outline-3">
<h3 id="orgd7d1034"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-orgd7d1034">
<ul class="org-ul">
<li><p>form2 -pass2-&gt; form3</p><p>id of var is handled here</p></li></ul>
</div>
</div>

<div id="outline-container-org9876715" class="outline-3">
<h3 id="org9876715">pass2/get-arrow</h3>
<div class="outline-text-3" id="text-org9876715">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass2/get-arrow</span> a s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form2/arrow scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> form3/arrow<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/arrow a s<span style="color: #696969;">)</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a1 s<span style="color: #B380A8;">}</span> a1<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgec68809" class="outline-3">
<h3 id="orgec68809">pass2/arrow</h3>
<div class="outline-text-3" id="text-orgec68809">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass2/arrow</span> a s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form2/arrow scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>form3/arrow scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/cedent ac s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/cedent sc s1<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>sc1 s2<span style="color: #B380A8;">}</span>
           <span style="color: #B380A8;">{{</span>ac1 sc1<span style="color: #B380A8;">}</span> s2<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org74b714" class="outline-3">
<h3 id="org74b714">pass2/cedent</h3>
<div class="outline-text-3" id="text-org74b714">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass2/cedent</span> c s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>form2 ...<span style="color: #696969;">)</span> scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">((</span>form3 ...<span style="color: #696969;">)</span> scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{{}</span> s<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>f . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2 f s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>f1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/cedent r s1<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>c1 s2<span style="color: #B380A8;">}</span>
           <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons f1 c1<span style="color: #696969;">)</span> s2<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd1326ca" class="outline-3">
<h3 id="orgd1326ca">pass2/lambda</h3>
<div class="outline-text-3" id="text-orgd1326ca">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass2/lambda</span> l s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form2/lambda scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>form3/lambda scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> l
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a al<span style="color: #B380A8;">}</span>
     <span style="color: #B380A8;">{{</span><span style="color: #696969;">(</span>pass2/get-arrow a s<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>pass2/get-arrow x s<span style="color: #696969;">))</span>
         al<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span>
      s<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgac3c4fe" class="outline-3">
<h3 id="orgac3c4fe">pass2</h3>
<div class="outline-text-3" id="text-orgac3c4fe">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass2</span> f s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form2 scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>form2 scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> f
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'form2/var v<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/var v s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>v1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{{</span>'form3/var v1<span style="color: #B380A8;">}</span> s1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'form2/name n<span style="color: #B380A8;">}</span>
     <span style="color: #B380A8;">{{</span>'form3/name n<span style="color: #B380A8;">}</span> s<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'form2/arrow a<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/arrow a s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{{</span>'form3/arrow a1<span style="color: #B380A8;">}</span> s1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'form2/lambda l<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/lambda l s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>l1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{{</span>'form3/lambda l1<span style="color: #B380A8;">}</span> s1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'form2/bind b<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/bind b s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>b1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{{</span>'form3/bind b1<span style="color: #B380A8;">}</span> s1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org121f2c8" class="outline-3">
<h3 id="org121f2c8">id/new</h3>
<div class="outline-text-3" id="text-org121f2c8">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #a6e22e;">id/counter</span> 0<span style="color: #696969;">)</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">id/new</span> n ls<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> name ls <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> id<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">set!</span> id/counter <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+</span> 1 id/counter<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span>vector <span style="color: #696969;">(</span>cons n id/counter<span style="color: #696969;">)</span> ls<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org961e426" class="outline-3">
<h3 id="org961e426">pass2/var</h3>
<div class="outline-text-3" id="text-org961e426">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass2/var</span> v s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form2/var scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>form3/var scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> v
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>symbol level<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>found <span style="color: #696969;">(</span>assq symbol s<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> found
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>old <span style="color: #696969;">(</span>cdr found<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
           <span style="color: #B380A8;">{{</span>old level<span style="color: #B380A8;">}</span> s<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>new <span style="color: #696969;">(</span>id/new symbol '<span style="color: #696969;">())</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
           <span style="color: #B380A8;">{{</span>new level<span style="color: #B380A8;">}</span>
            <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>cons symbol new<span style="color: #696969;">)</span> s<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #696969;">)))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc07a8dc" class="outline-3">
<h3 id="orgc07a8dc">pass2/bind</h3>
<div class="outline-text-3" id="text-orgc07a8dc">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass2/bind</span> b s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form2/bind scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>form3/bind scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> b
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>vs c leave?<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/cedent vs s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>vs1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/cedent c s1<span style="color: #696969;">)</span>
          <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">this means vars in vs can occur in c</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>c1 s2<span style="color: #B380A8;">}</span>
           <span style="color: #B380A8;">{{</span>vs1 c1 leave?<span style="color: #B380A8;">}</span> s2<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgec26638" class="outline-2">
<h2 id="orgec26638">pass3</h2>
<div class="outline-text-2" id="text-orgec26638">
</div><div id="outline-container-org719db01" class="outline-3">
<h3 id="org719db01"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-org719db01">
<ul class="org-ul">
<li><p>type check is merged into this pass</p></li>

<li><p>form3 -pass3-&gt; data</p><p>cons &amp; trunk are created here</p><p><ul class="org-ul"></p><p><li><p>ns is searched</p><p>but no effect on ns</p></li></ul></p></li>

<li><p>note that</p><p>we are building new function body</p><p>with the help of the data-stack</p><p>thus</p><p>whenever a list of data in data-stack are used to form a function body</p><p>the list should be reversed</p></li>

<li><p>bind is handled here</p><p>no unification here</p><p>bs is not used here</p><p>bind just effect on the id of var</p></li>

<li><p>apply is handled here</p><p>when meet 'apply' form a trunk from arrow or lambda</p><p>if it is arrow</p><p>use infer/arrow to get the type of it</p><p>if it is lambda</p><p>use infer/arrow-list to get the type of it</p></li>

<li><p>pass3 will use env passing</p><p>note that</p><p>when env passing is used</p><p>those functions would not be separately testable</p></li>

<li><p>note that</p><p>nested arrow or lambda will not block scope</p><p>different var must have different name</p><p>this is due to the natural of non-determinate data</p></li></ul>
</div>
</div>

<div id="outline-container-orge45e068" class="outline-3">
<h3 id="orge45e068">env/pop</h3>
<div class="outline-text-3" id="text-orge45e068">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">env/pop</span> e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>data env<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>d . r<span style="color: #696969;">)</span> bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #B380A8;">{</span>d <span style="color: #B380A8;">{</span>r bs ns<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org986cbad" class="outline-3">
<h3 id="org986cbad">pass3/get-arrow</h3>
<div class="outline-text-3" id="text-org986cbad">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/get-arrow</span> a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form3/arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> arrow<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>env/pop <span style="color: #696969;">(</span>pass3/arrow a e<span style="color: #696969;">))</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'arrow arrow<span style="color: #B380A8;">}</span> __<span style="color: #B380A8;">}</span>
     arrow<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org879700f" class="outline-3">
<h3 id="org879700f">pass3/arrow</h3>
<div class="outline-text-3" id="text-org879700f">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/arrow</span> a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form3/arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass3/cedent ac <span style="color: #B380A8;">{{}</span> bs ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>dl-ac __ __<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass3/cedent sc <span style="color: #B380A8;">{{}</span> bs ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>dl-sc __ __<span style="color: #B380A8;">}</span>
              <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons <span style="color: #B380A8;">{</span>'arrow <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>reverse dl-ac<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>reverse dl-sc<span style="color: #696969;">)</span><span style="color: #B380A8;">}}</span>
                     ds<span style="color: #696969;">)</span>
               bs
               ns<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org43b702e" class="outline-3">
<h3 id="org43b702e">pass3/get-arrow-check</h3>
<div class="outline-text-3" id="text-org43b702e">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/get-arrow-check</span> ta a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow form3/arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> arrow<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>env/pop <span style="color: #696969;">(</span>pass3/arrow-check ta a e<span style="color: #696969;">))</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'arrow arrow<span style="color: #B380A8;">}</span> __<span style="color: #B380A8;">}</span>
     arrow<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5edb8b1" class="outline-3">
<h3 id="org5edb8b1">pass3/arrow-check</h3>
<div class="outline-text-3" id="text-org5edb8b1">
<ul class="org-ul">
<li><p>check should be merged into pass3</p><p>because to form trunk from var by apply</p><p>I need the type of var to arrow</p><p>to assign such type</p><p>I need to check antecedent first</p></li>

<li><p>note that the efforts of unifications here are commited</p><p>before this commite I copy the type arrow</p></li>

<li><p>I need to do commit here</p><p>because when apply a var</p><p>I need to get the type of it</p><p>to form a trunk</p></li>

<li><p>type-solve/cedent and unify/data-list</p><p>for antecedent is not enough</p><p>we also need to do a</p><p>solve/cedent and bind-unify/data-list</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/arrow-check</span> ta a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow form3/arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>ta <span style="color: #696969;">(</span>copy-arrow ta<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>ta a<span style="color: #B380A8;">}</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>tac tsc<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass3/cedent ac <span style="color: #B380A8;">{{}</span> <span style="color: #696969;">(</span>cons '<span style="color: #696969;">(</span>commit-point<span style="color: #696969;">)</span> bs<span style="color: #696969;">)</span> ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>dl-ac bs-ac __<span style="color: #B380A8;">}</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-solve/cedent <span style="color: #696969;">(</span>reverse dl-ac<span style="color: #696969;">)</span> <span style="color: #B380A8;">{{}</span> bs-ac ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
                <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/arrow-check
                  <span style="color: #696969;">(</span><span style="color: #e6db74;">"fail to type-solve/cedent~%"</span><span style="color: #696969;">)</span>
                  <span style="color: #696969;">(</span><span style="color: #e6db74;">"ac : ~a~%"</span> <span style="color: #696969;">(</span>reverse dl-ac<span style="color: #696969;">))</span>
                  <span style="color: #696969;">(</span><span style="color: #e6db74;">"info-list : ~a~%"</span> il<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>type-dl-ac type-bs-ac __<span style="color: #B380A8;">}}</span>
                <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/cedent tac <span style="color: #B380A8;">{{}</span> type-bs-ac ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
                  <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
                   <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/arrow-check
                     <span style="color: #696969;">(</span><span style="color: #e6db74;">"fail to compute/cedent~%"</span><span style="color: #696969;">)</span>
                     <span style="color: #696969;">(</span><span style="color: #e6db74;">"tac : ~a~%"</span> tac<span style="color: #696969;">)</span>
                     <span style="color: #696969;">(</span><span style="color: #e6db74;">"info-list : ~a~%"</span> il<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
                  <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>dl-tac bs-tac __<span style="color: #B380A8;">}}</span>
                   <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>unify/data-list
                           dl-tac type-dl-ac
                           <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{{}</span> bs-tac ns<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
                     <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
                      <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/arrow-check
                        <span style="color: #696969;">(</span><span style="color: #e6db74;">"fail to unify/data-list~%"</span><span style="color: #696969;">)</span>
                        <span style="color: #696969;">(</span><span style="color: #e6db74;">"dl-tac : ~a~%"</span> dl-tac<span style="color: #696969;">)</span>
                        <span style="color: #696969;">(</span><span style="color: #e6db74;">"type-dl-ac : ~a~%"</span> type-dl-ac<span style="color: #696969;">)</span>
                        <span style="color: #696969;">(</span><span style="color: #e6db74;">"info-list : ~a~%"</span> il<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
                     <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>__ bs-antecedent1 __<span style="color: #B380A8;">}}</span>
                      <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>bind-unify/data-list
                              tac <span style="color: #696969;">(</span>reverse dl-ac<span style="color: #696969;">)</span>
                              <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{{}</span> bs-antecedent1 ns<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
                        <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
                         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/arrow-check
                           <span style="color: #696969;">(</span><span style="color: #e6db74;">"fail to bind-unify/data-list~%"</span><span style="color: #696969;">)</span>
                           <span style="color: #696969;">(</span><span style="color: #e6db74;">"dl-tac : ~a~%"</span> dl-tac<span style="color: #696969;">)</span>
                           <span style="color: #696969;">(</span><span style="color: #e6db74;">"dl-ac : ~a~%"</span> dl-ac<span style="color: #696969;">)</span>
                           <span style="color: #696969;">(</span><span style="color: #e6db74;">"info-list : ~a~%"</span> il<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
                        <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>__ bs-antecedent2 __<span style="color: #B380A8;">}}</span>
                         <span style="color: #696969;">(</span>bs/commit! bs-antecedent2<span style="color: #696969;">)</span>
                         <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">------------</span>
                         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass3/cedent sc <span style="color: #B380A8;">{{}</span> <span style="color: #696969;">(</span>cons '<span style="color: #696969;">(</span>commit-point<span style="color: #696969;">)</span> bs<span style="color: #696969;">)</span> ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
                           <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>dl-sc bs-sc __<span style="color: #B380A8;">}</span>
                            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-solve/cedent <span style="color: #696969;">(</span>reverse dl-sc<span style="color: #696969;">)</span> <span style="color: #B380A8;">{{}</span> bs-sc ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
                              <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
                               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/arrow-check
                                 <span style="color: #696969;">(</span><span style="color: #e6db74;">"fail to type-solve/cedent~%"</span><span style="color: #696969;">)</span>
                                 <span style="color: #696969;">(</span><span style="color: #e6db74;">"sc : ~a~%"</span> <span style="color: #696969;">(</span>reverse dl-sc<span style="color: #696969;">))</span>
                                 <span style="color: #696969;">(</span><span style="color: #e6db74;">"info-list : ~a~%"</span> il<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
                              <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>type-dl-sc type-bs-sc __<span style="color: #B380A8;">}}</span>
                               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/cedent tsc <span style="color: #B380A8;">{{}</span> type-bs-sc ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
                                 <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
                                  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/arrow-check
                                    <span style="color: #696969;">(</span><span style="color: #e6db74;">"fail to compute/cedent~%"</span><span style="color: #696969;">)</span>
                                    <span style="color: #696969;">(</span><span style="color: #e6db74;">"tsc : ~a~%"</span> tsc<span style="color: #696969;">)</span>
                                    <span style="color: #696969;">(</span><span style="color: #e6db74;">"info-list : ~a~%"</span> il<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
                                 <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>dl-tsc bs-tsc __<span style="color: #B380A8;">}}</span>
                                  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>cover/data-list
                                          type-dl-sc dl-tsc
                                          <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{{}</span> bs-tsc ns<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
                                    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
                                     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/arrow-check
                                       <span style="color: #696969;">(</span><span style="color: #e6db74;">"fail to cover/data-list:~%"</span><span style="color: #696969;">)</span>
                                       <span style="color: #696969;">(</span><span style="color: #e6db74;">"dl-tsc : ~a~%"</span> dl-tsc<span style="color: #696969;">)</span>
                                       <span style="color: #696969;">(</span><span style="color: #e6db74;">"type-dl-sc : ~a~%"</span> type-dl-sc<span style="color: #696969;">)</span>
                                       <span style="color: #696969;">(</span><span style="color: #e6db74;">"info-list : ~a~%"</span> il<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
                                    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>__ bs-succedent __<span style="color: #B380A8;">}}</span>
                                     <span style="color: #696969;">(</span>bs/commit! bs-succedent<span style="color: #696969;">)</span>
                                     <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons <span style="color: #B380A8;">{</span>'arrow <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>reverse dl-ac<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>reverse dl-sc<span style="color: #696969;">)</span><span style="color: #B380A8;">}}</span>
                                            ds<span style="color: #696969;">)</span>
                                      bs
                                      ns<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4c18e3b" class="outline-3">
<h3 id="org4c18e3b">pass3/cedent</h3>
<div class="outline-text-3" id="text-org4c18e3b">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/cedent</span> c e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>form3 ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> e<span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #696969;">(</span>h . r<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>pass3/cedent r <span style="color: #696969;">(</span>pass3 h e<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5be802b" class="outline-3">
<h3 id="org5be802b">pass3/lambda</h3>
<div class="outline-text-3" id="text-org5be802b">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/lambda</span> l e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form3/lambda env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> l
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a al<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>ta <span style="color: #696969;">(</span>pass3/get-arrow a e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons <span style="color: #B380A8;">{</span>'lambda
                     <span style="color: #B380A8;">{</span>ta
                      <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span>
                             <span style="color: #696969;">(</span>pass3/get-arrow-check ta x e<span style="color: #696969;">))</span>
                        al<span style="color: #696969;">)</span><span style="color: #B380A8;">}}</span>
                 ds<span style="color: #696969;">)</span>
           bs
           ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge5a12ad" class="outline-3">
<h3 id="orge5a12ad">pass3</h3>
<div class="outline-text-3" id="text-orge5a12ad">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3</span> f e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form3 env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> f
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'form3/var x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>pass3/var x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'form3/name 'apply<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>pass3/apply e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'form3/name x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>pass3/name x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'form3/arrow x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>pass3/arrow x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'form3/lambda x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>pass3/lambda x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'form3/bind x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>pass3/bind x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org56183a7" class="outline-3">
<h3 id="org56183a7">pass3/var</h3>
<div class="outline-text-3" id="text-org56183a7">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/var</span> v e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form3/var env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">actually there is no need to search bs</span>
     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">but anyway</span>
     <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>bs/deep bs <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span> ds<span style="color: #696969;">)</span>
      bs
      ns<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1b31907" class="outline-3">
<h3 id="org1b31907">pass3/apply</h3>
<div class="outline-text-3" id="text-org1b31907">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/apply</span> e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>d . r<span style="color: #696969;">)</span> bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span>pass3/apply/data d <span style="color: #B380A8;">{</span>r bs ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd635b57" class="outline-3">
<h3 id="orgd635b57">pass3/apply/data</h3>
<div class="outline-text-3" id="text-orgd635b57">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/apply/data</span> d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow x<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span>pass3/apply/arrow x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda x<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span>pass3/apply/lambda x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var x<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span>pass3/apply/var x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span>__
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/apply/data
       <span style="color: #696969;">(</span><span style="color: #e6db74;">"can only apply arrow or lambda or var~%"</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #e6db74;">"but the data at the top of data-stack is : ~a~%"</span> d<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4df6867" class="outline-3">
<h3 id="org4df6867">pass3/apply/arrow</h3>
<div class="outline-text-3" id="text-org4df6867">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/apply/arrow</span> a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>t <span style="color: #696969;">(</span>infer/arrow a e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> t
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>alen <span style="color: #696969;">(</span>length ac<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
                 <span style="color: #797979;">[</span>slen <span style="color: #696969;">(</span>length sc<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
                 <span style="color: #797979;">[</span>dl <span style="color: #696969;">(</span>sublist ds 0 alen<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
                 <span style="color: #797979;">[</span>make-trunk
                  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>i<span style="color: #696969;">)</span>
                    <span style="color: #B380A8;">{</span>'trunk
                      <span style="color: #B380A8;">{</span>t <span style="color: #B380A8;">{</span>'tody/arrow-list <span style="color: #B380A8;">{</span>a<span style="color: #B380A8;">}}</span> dl i<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
            <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>append <span style="color: #696969;">(</span>reverse <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> make-trunk <span style="color: #696969;">(</span>genlist slen<span style="color: #696969;">)))</span>
                     <span style="color: #696969;">(</span>sublist ds alen <span style="color: #696969;">(</span>length ds<span style="color: #696969;">)))</span>
             bs
             ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcfdd164" class="outline-3">
<h3 id="orgcfdd164">pass3/apply/lambda</h3>
<div class="outline-text-3" id="text-orgcfdd164">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/apply/lambda</span> l e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> lambda env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> l
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>ac sc<span style="color: #B380A8;">}</span> al<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>alen <span style="color: #696969;">(</span>length ac<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span>slen <span style="color: #696969;">(</span>length sc<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span>dl <span style="color: #696969;">(</span>sublist ds 0 alen<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span>make-trunk
                <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>i<span style="color: #696969;">)</span>
                  <span style="color: #B380A8;">{</span>'trunk
                    <span style="color: #B380A8;">{{</span>ac sc<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span> dl i<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>append <span style="color: #696969;">(</span>reverse <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> make-trunk <span style="color: #696969;">(</span>genlist slen<span style="color: #696969;">)))</span>
                   <span style="color: #696969;">(</span>sublist ds alen <span style="color: #696969;">(</span>length ds<span style="color: #696969;">)))</span>
           bs
           ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfd6cd27" class="outline-3">
<h3 id="orgfd6cd27">pass3/apply/var</h3>
<div class="outline-text-3" id="text-orgfd6cd27">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/apply/var</span> v e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> var env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not <span style="color: #696969;">(</span>var/fresh? v e<span style="color: #696969;">))</span>
       <span style="color: #696969;">(</span>pass3/apply/data <span style="color: #696969;">(</span>bs/deep bs <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span> e<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-solve/var v e<span style="color: #696969;">)</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/apply/var
            <span style="color: #696969;">(</span><span style="color: #e6db74;">"fail to compute the type of var : ~a~%"</span> v<span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span><span style="color: #e6db74;">"report info :~%~a~%"</span> il<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>d . __<span style="color: #696969;">)</span> __ __<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow <span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}}</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>alen <span style="color: #696969;">(</span>length ac<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
                    <span style="color: #797979;">[</span>slen <span style="color: #696969;">(</span>length sc<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
                    <span style="color: #797979;">[</span>dl <span style="color: #696969;">(</span>sublist ds 0 alen<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
                    <span style="color: #797979;">[</span>make-trunk
                     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>i<span style="color: #696969;">)</span>
                       <span style="color: #B380A8;">{</span>'trunk
                         <span style="color: #B380A8;">{{</span>ac sc<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/var v<span style="color: #B380A8;">}</span> dl i<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
               <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>append <span style="color: #696969;">(</span>reverse <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> make-trunk <span style="color: #696969;">(</span>genlist slen<span style="color: #696969;">)))</span>
                        <span style="color: #696969;">(</span>sublist ds alen <span style="color: #696969;">(</span>length ds<span style="color: #696969;">)))</span>
                bs
                ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span>__
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/apply/var
               <span style="color: #696969;">(</span><span style="color: #e6db74;">"to form trunk from var~%"</span><span style="color: #696969;">)</span>
               <span style="color: #696969;">(</span><span style="color: #e6db74;">"the type of var must be a arrow~%"</span><span style="color: #696969;">)</span>
               <span style="color: #696969;">(</span><span style="color: #e6db74;">"var : ~a~%"</span> v<span style="color: #696969;">)</span>
               <span style="color: #696969;">(</span><span style="color: #e6db74;">"type of var : ~a~%"</span> d<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9c04d03" class="outline-3">
<h3 id="org9c04d03">id-&gt;name &amp; id-&gt;counter &amp; id-&gt;ls</h3>
<div class="outline-text-3" id="text-org9c04d03">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">id-&gt;name</span> id<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>car <span style="color: #696969;">(</span>vector-ref id 0<span style="color: #696969;">)))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">id-&gt;counter</span> id<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>cdr <span style="color: #696969;">(</span>vector-ref id 0<span style="color: #696969;">)))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">id-&gt;ls</span> id<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>vector-ref id 1<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge190064" class="outline-3">
<h3 id="orge190064">pass3/name</h3>
<div class="outline-text-3" id="text-orge190064">
<ul class="org-ul">
<li><p>this can be optimized by</p><p>to do more computations before storing things into ns</p><p>but I leave it for now</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/name</span> n e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form3/name env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>found <span style="color: #696969;">(</span>assq n ns<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not found<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/name <span style="color: #696969;">(</span><span style="color: #e6db74;">"unknow name : ~a~%"</span> n<span style="color: #696969;">))</span>
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>meaning <span style="color: #696969;">(</span>cdr found<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> meaning
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons/type <span style="color: #B380A8;">{</span>a n1 __<span style="color: #B380A8;">}}</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy-arrow a<span style="color: #696969;">)</span>
                <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac __<span style="color: #B380A8;">}</span>
                 <span style="color: #696969;">(</span>pass3/name/cons <span style="color: #696969;">(</span>length ac<span style="color: #696969;">)</span> ac n1 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons/data <span style="color: #B380A8;">{</span>a n1 __<span style="color: #B380A8;">}}</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy-arrow a<span style="color: #696969;">)</span>
                <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac __<span style="color: #B380A8;">}</span>
                 <span style="color: #696969;">(</span>pass3/name/cons <span style="color: #696969;">(</span>length ac<span style="color: #696969;">)</span> ac n1 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{{</span>ac sc<span style="color: #B380A8;">}</span> __<span style="color: #B380A8;">}}</span>
              <span style="color: #696969;">(</span>pass3/name/trunk <span style="color: #696969;">(</span>length ac<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>length sc<span style="color: #696969;">)</span> <span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span> n e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org57cc707" class="outline-3">
<h3 id="org57cc707">pass3/name/cons</h3>
<div class="outline-text-3" id="text-org57cc707">
<ul class="org-ul">
<li><p>note the commit of a copy of type</p><p>into the arguments</p><p>without such commit the information will be not enough for cover</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/name/cons</span> len ac n e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> length antecedent name env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>dl <span style="color: #696969;">(</span>sublist ds 0 len<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-solve/cedent <span style="color: #696969;">(</span>reverse dl<span style="color: #696969;">)</span>
                                 <span style="color: #B380A8;">{{}</span> <span style="color: #696969;">(</span>cons '<span style="color: #696969;">(</span>commit-point<span style="color: #696969;">)</span> bs<span style="color: #696969;">)</span> ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/name/cons
            <span style="color: #696969;">(</span><span style="color: #e6db74;">"type-compute/cedent fail~%"</span><span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span><span style="color: #e6db74;">"(reverse dl) : ~a~%"</span> <span style="color: #696969;">(</span>reverse dl<span style="color: #696969;">))</span>
            <span style="color: #696969;">(</span><span style="color: #e6db74;">"info list : ~%~a~%"</span> il<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds1 bs1 ns1<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>unify/data-list
                  ds1 <span style="color: #696969;">(</span>reverse ac<span style="color: #696969;">)</span>
                  <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds bs1 ns1<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/name/cons
               <span style="color: #696969;">(</span><span style="color: #e6db74;">"unify/data-list fail~%"</span><span style="color: #696969;">)</span>
               <span style="color: #696969;">(</span><span style="color: #e6db74;">"ds1 : ~a~%"</span> ds1<span style="color: #696969;">)</span>
               <span style="color: #696969;">(</span><span style="color: #e6db74;">"(reverse ac) : ~a~%"</span> <span style="color: #696969;">(</span>reverse ac<span style="color: #696969;">))</span>
               <span style="color: #696969;">(</span><span style="color: #e6db74;">"info list : ~%~a~%"</span> il<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds2 bs2 ns2<span style="color: #B380A8;">}}</span>
             <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons <span style="color: #B380A8;">{</span>'cons
                     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">dl in cons is as the order of dl in stack</span>
                     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">thus no reverse is needed</span>
                     <span style="color: #B380A8;">{</span>n dl<span style="color: #B380A8;">}}</span>
                    <span style="color: #696969;">(</span>sublist ds len <span style="color: #696969;">(</span>length ds<span style="color: #696969;">)))</span>
              <span style="color: #696969;">(</span>bs/commit! bs2<span style="color: #696969;">)</span>
              ns<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1217248" class="outline-3">
<h3 id="org1217248">pass3/name/trunk</h3>
<div class="outline-text-3" id="text-org1217248">
<ul class="org-ul">
<li><p>&gt;&lt;&gt;&lt;&gt;&lt;</p><p>in this first write</p><p>no redex is reduced</p></li>

<li><p>when intro a trunk from name</p><p>only name should be recorded not the body</p><p>this is to handle recursive definitions</p></li>

<li><p>type arrow needs to be copied</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/name/trunk</span> alen slen a n e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> length length arrow name env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>a <span style="color: #696969;">(</span>copy-arrow a<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>dl <span style="color: #696969;">(</span>sublist ds 0 alen<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
                 <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">dl in trunk is as the order of dl in stack</span>
                 <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">thus no reverse is needed</span>
                 <span style="color: #797979;">[</span>make-trunk <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>i<span style="color: #696969;">)</span> <span style="color: #B380A8;">{</span>'trunk <span style="color: #B380A8;">{</span>a <span style="color: #B380A8;">{</span>'tody/name n<span style="color: #B380A8;">}</span> dl i<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
            <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>append <span style="color: #696969;">(</span>reverse <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> make-trunk <span style="color: #696969;">(</span>genlist slen<span style="color: #696969;">)))</span>
                     <span style="color: #696969;">(</span>sublist ds alen <span style="color: #696969;">(</span>length ds<span style="color: #696969;">)))</span>
             bs
             ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>

<span style="color: #FF8888;">;; </span><span style="color: #FF8888;">try to fix map/has-length</span>
<span style="color: #FF8888;">;; </span><span style="color: #FF8888;">by the commit of a copy of type into the arguments</span>

<span style="color: #FF8888;">;; </span><span style="color: #FF8888;">(define (pass3/name/trunk alen slen a n e)</span>
<span style="color: #FF8888;">;;   </span><span style="color: #FF8888;">(: length length arrow name env -&gt; env)</span>
<span style="color: #FF8888;">;;   </span><span style="color: #FF8888;">(match e</span>
<span style="color: #FF8888;">;;     </span><span style="color: #FF8888;">[{ds bs ns}</span>
<span style="color: #FF8888;">;;      </span><span style="color: #FF8888;">(let ([a (copy-arrow a)])</span>
<span style="color: #FF8888;">;;        </span><span style="color: #FF8888;">(match a</span>
<span style="color: #FF8888;">;;          </span><span style="color: #FF8888;">[{ac sc}</span>
<span style="color: #FF8888;">;;           </span><span style="color: #FF8888;">(let* ([dl (sublist ds 0 alen)]</span>
<span style="color: #FF8888;">;;                  </span><span style="color: #FF8888;">;; dl in trunk is as the order of dl in stack</span>
<span style="color: #FF8888;">;;                  </span><span style="color: #FF8888;">;; thus no reverse is needed</span>
<span style="color: #FF8888;">;;                  </span><span style="color: #FF8888;">[make-trunk (lambda (i) {'trunk {a {'tody/name n} dl i}})])</span>
<span style="color: #FF8888;">;;             </span><span style="color: #FF8888;">(match (type-solve/cedent (reverse dl)</span>
<span style="color: #FF8888;">;;                                       </span><span style="color: #FF8888;">{{} (cons '(commit-point) bs) ns})</span>
<span style="color: #FF8888;">;;               </span><span style="color: #FF8888;">[{'fail il}</span>
<span style="color: #FF8888;">;;                </span><span style="color: #FF8888;">(orz 'pass3/name/trunk</span>
<span style="color: #FF8888;">;;                  </span><span style="color: #FF8888;">("type-compute/cedent fail~%")</span>
<span style="color: #FF8888;">;;                  </span><span style="color: #FF8888;">("(reverse dl) : ~a~%" (reverse dl))</span>
<span style="color: #FF8888;">;;                  </span><span style="color: #FF8888;">("info list : ~%~a~%" il))]</span>
<span style="color: #FF8888;">;;               </span><span style="color: #FF8888;">[{'success {ds1 bs1 ns1}}</span>
<span style="color: #FF8888;">;;                </span><span style="color: #FF8888;">(match (unify/data-list</span>
<span style="color: #FF8888;">;;                        </span><span style="color: #FF8888;">(reverse ac) ds1</span>
<span style="color: #FF8888;">;;                        </span><span style="color: #FF8888;">{'success {ds bs1 ns1}})</span>
<span style="color: #FF8888;">;;                  </span><span style="color: #FF8888;">[{'fail il}</span>
<span style="color: #FF8888;">;;                   </span><span style="color: #FF8888;">(orz 'pass3/name/trunk</span>
<span style="color: #FF8888;">;;                     </span><span style="color: #FF8888;">("unify/data-list fail~%")</span>
<span style="color: #FF8888;">;;                     </span><span style="color: #FF8888;">("ds1 : ~a~%" ds1)</span>
<span style="color: #FF8888;">;;                     </span><span style="color: #FF8888;">("(reverse ac) : ~a~%" (reverse ac))</span>
<span style="color: #FF8888;">;;                     </span><span style="color: #FF8888;">("info list : ~%~a~%" il))]</span>
<span style="color: #FF8888;">;;                  </span><span style="color: #FF8888;">[{'success {ds2 bs2 ns2}}</span>
<span style="color: #FF8888;">;;                   </span><span style="color: #FF8888;">{(append (reverse (map make-trunk (genlist slen)))</span>
<span style="color: #FF8888;">;;                            </span><span style="color: #FF8888;">(sublist ds alen (length ds)))</span>
<span style="color: #FF8888;">;;                    </span><span style="color: #FF8888;">(bs/commit! bs2)</span>
<span style="color: #FF8888;">;;                    </span><span style="color: #FF8888;">ns}])]))]))]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd183049" class="outline-3">
<h3 id="orgd183049">pass3/bind</h3>
<div class="outline-text-3" id="text-orgd183049">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/bind</span> b e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form3/bind env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> b
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>vl c leave?<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass3/cedent c <span style="color: #B380A8;">{{}</span> bs ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds1 __ __<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not <span style="color: #696969;">(</span>eq? 1 <span style="color: #696969;">(</span>length ds1<span style="color: #696969;">)))</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/bind
               <span style="color: #696969;">(</span><span style="color: #e6db74;">"the cedent in bind should only return one data~%"</span><span style="color: #696969;">)</span>
               <span style="color: #696969;">(</span><span style="color: #e6db74;">"bind : ~a~%"</span> b<span style="color: #696969;">))</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>d1 <span style="color: #696969;">(</span>car ds1<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">letrec</span>
                   <span style="color: #696969;">(</span><span style="color: #797979;">[</span>recur
                     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>vl e<span style="color: #696969;">)</span>
                       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>form3/var ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
                       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
                         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
                          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> vl
                            <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> e<span style="color: #797979;">]</span>
                            <span style="color: #797979;">[</span><span style="color: #696969;">(</span><span style="color: #B380A8;">{</span>'form3/var <span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}}</span> . r<span style="color: #696969;">)</span>
                             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not <span style="color: #696969;">(</span>var/fresh? <span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}</span> e<span style="color: #696969;">))</span>
                               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/bind
                                 <span style="color: #696969;">(</span><span style="color: #e6db74;">"var is not fresh : ~a~%"</span> <span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
                                 <span style="color: #696969;">(</span><span style="color: #e6db74;">"env : ~a~%"</span> e<span style="color: #696969;">))</span>
                               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not
                                    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>consistent-check
                                            <span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}</span> d1 e<span style="color: #696969;">)</span>
                                      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail __<span style="color: #B380A8;">}</span> #f<span style="color: #797979;">]</span>
                                      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span> #t<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
                                 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/bind
                                   <span style="color: #696969;">(</span><span style="color: #e6db74;">"var data is not consistent~%"</span><span style="color: #696969;">)</span>
                                   <span style="color: #696969;">(</span><span style="color: #e6db74;">"var : ~a~%"</span> <span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
                                   <span style="color: #696969;">(</span><span style="color: #e6db74;">"data : ~a~%"</span> d1<span style="color: #696969;">))</span>
                                 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">()</span>
                                   <span style="color: #696969;">(</span>id/commit! id <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons level d1<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
                                   <span style="color: #696969;">(</span>recur
                                    r
                                    <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> leave?
                                       <span style="color: #696969;">(</span>cons <span style="color: #B380A8;">{</span>'bind <span style="color: #B380A8;">{{</span>id <span style="color: #696969;">(</span>- level 1<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span> d1<span style="color: #B380A8;">}}</span>
                                             ds<span style="color: #696969;">)</span>
                                       ds<span style="color: #696969;">)</span>
                                     bs
                                     ns<span style="color: #B380A8;">}</span><span style="color: #696969;">))))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span>recur vl e<span style="color: #696969;">))))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9f275c3" class="outline-3">
<h3 id="org9f275c3">id/commit!</h3>
<div class="outline-text-3" id="text-org9f275c3">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">id/commit!</span> id ls<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> id ls <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> id
     <span style="color: #797979;">[</span>with effect on id<span style="color: #797979;">]</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">()</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">vector-set!</span> id 1 <span style="color: #696969;">(</span>append ls <span style="color: #696969;">(</span>vector-ref id 1<span style="color: #696969;">)))</span>
    id<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4299ce8" class="outline-2">
<h2 id="org4299ce8">bind-stack</h2>
<div class="outline-text-2" id="text-org4299ce8">
</div><div id="outline-container-org5128c6e" class="outline-3">
<h3 id="org5128c6e"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-org5128c6e">
<ul class="org-ul">
<li><p>&gt;&lt;&gt;&lt;&gt;&lt;</p></li>

<li><p>infer level n can get level n+1</p></li>

<li><p>note how the types of these functions are different</p></li></ul>
</div>
</div>

<div id="outline-container-orge1b3730" class="outline-3">
<h3 id="orge1b3730">bs/find</h3>
<div class="outline-text-3" id="text-orge1b3730">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">bs/find</span> bs v<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> bs var <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">or</span> data #f<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> v
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>level <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>eq? level #f<span style="color: #696969;">)</span>
                     0
                     level<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span>found/commit <span style="color: #696969;">(</span>assq level <span style="color: #696969;">(</span>id-&gt;ls id<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> found/commit
         <span style="color: #696969;">(</span>cdr found/commit<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>found/ls <span style="color: #696969;">(</span>assq id bs<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
                <span style="color: #797979;">[</span>found/bind
                 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> found/ls
                   <span style="color: #696969;">(</span>assq level <span style="color: #696969;">(</span>cdr found/ls<span style="color: #696969;">))</span>
                   #f<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> found/bind
             <span style="color: #696969;">(</span>cdr found/bind<span style="color: #696969;">)</span>
             #f<span style="color: #696969;">))))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org24abf61" class="outline-3">
<h3 id="org24abf61">bs/walk</h3>
<div class="outline-text-3" id="text-org24abf61">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">bs/walk</span> bs d<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> bs data <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> data<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>found <span style="color: #696969;">(</span>bs/find bs v<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> found
         <span style="color: #696969;">(</span>bs/walk bs found<span style="color: #696969;">)</span>
         d<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ e<span style="color: #B380A8;">}</span> d<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6bf453d" class="outline-3">
<h3 id="org6bf453d">bs/deep</h3>
<div class="outline-text-3" id="text-org6bf453d">
<ul class="org-ul">
<li><p>do not handle trunk here</p><p>because I think maybe no computations should be done in pass3</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">bs/deep</span> bs d<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> bs data <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> data<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">letrec*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>bs/deep-list
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>bs dl<span style="color: #696969;">)</span>
               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>bs/deep bs x<span style="color: #696969;">))</span> dl<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span>bs/deep-arrow
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>bs a<span style="color: #696969;">)</span>
               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
                 <span style="color: #797979;">[</span><span style="color: #696969;">(</span>dl1 dl2<span style="color: #696969;">)</span>
                  <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>bs/deep-list bs dl1<span style="color: #696969;">)</span>
                        <span style="color: #696969;">(</span>bs/deep-list bs dl2<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span>bs/deep-arrow-list
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>bs al<span style="color: #696969;">)</span>
               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>a<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>bs/deep-arrow bs a<span style="color: #696969;">))</span> al<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>bs/walk bs d<span style="color: #696969;">)</span>
      <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">a var is fresh after bs/walk</span>
      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span>
       <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons <span style="color: #B380A8;">{</span>name dl<span style="color: #B380A8;">}}</span>
       <span style="color: #B380A8;">{</span>'cons <span style="color: #B380A8;">{</span>name <span style="color: #696969;">(</span>bs/deep-list bs dl<span style="color: #696969;">)</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow a<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'arrow <span style="color: #696969;">(</span>bs/deep-arrow bs a<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>a al<span style="color: #B380A8;">}}</span>
       <span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>bs/deep-arrow bs a<span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span>bs/deep-arrow-list bs al<span style="color: #696969;">)</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'trunk <span style="color: #B380A8;">{</span>a tody dl i<span style="color: #B380A8;">}}</span>
       <span style="color: #B380A8;">{</span>'trunk
         <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>bs/deep-arrow bs a<span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> tody
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/var v<span style="color: #B380A8;">}</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>bs/deep bs <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var v1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/var v1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow a1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/arrow-list <span style="color: #B380A8;">{</span>a1<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>a al<span style="color: #B380A8;">}}</span> <span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span>d
                <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'bs/deep
                  <span style="color: #696969;">(</span><span style="color: #e6db74;">"find something wrong from the var in the tody of trunk~%"</span><span style="color: #696969;">)</span>
                  <span style="color: #696969;">(</span><span style="color: #e6db74;">"data : ~a~%"</span> d<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/name n<span style="color: #B380A8;">}</span>
             <span style="color: #B380A8;">{</span>'tody/name n<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span>
             <span style="color: #B380A8;">{</span>'tody/arrow-list <span style="color: #696969;">(</span>bs/deep-arrow-list bs al<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span>bs/deep-list bs dl<span style="color: #696969;">)</span>
          i<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'bind <span style="color: #B380A8;">{</span>v d<span style="color: #B380A8;">}}</span>
       <span style="color: #B380A8;">{</span>'bind <span style="color: #B380A8;">{</span>v <span style="color: #696969;">(</span>bs/deep bs d<span style="color: #696969;">)</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org988b422" class="outline-3">
<h3 id="org988b422">var/fresh?</h3>
<div class="outline-text-3" id="text-org988b422">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">var/fresh?</span> v e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> var env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> bool<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span>equal? <span style="color: #696969;">(</span>bs/walk bs <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
             <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org688737e" class="outline-3">
<h3 id="org688737e">bs/extend</h3>
<div class="outline-text-3" id="text-org688737e">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">bs/extend</span> bs v d<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> bs var data <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> bs<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> v
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>found/ls <span style="color: #696969;">(</span>assq id bs<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> found/ls
         <span style="color: #696969;">(</span>substitute <span style="color: #696969;">(</span>cons id <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>cons level d<span style="color: #696969;">)</span>
                                    <span style="color: #696969;">(</span>cdr found/ls<span style="color: #696969;">)))</span>
                     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>pair<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>eq? <span style="color: #696969;">(</span>car pair<span style="color: #696969;">)</span> id<span style="color: #696969;">))</span>
                     bs<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>cons id <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>cons level d<span style="color: #696969;">)))</span>
               bs<span style="color: #696969;">)))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5e98a63" class="outline-3">
<h3 id="org5e98a63">var/eq?</h3>
<div class="outline-text-3" id="text-org5e98a63">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">var/eq?</span> v1 v2<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>list v1 v2<span style="color: #696969;">)</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>id1 level1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>id2 level2<span style="color: #B380A8;">}}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>eq? id1 id2<span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span>eq? level1 level2<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1de79c2" class="outline-2">
<h2 id="org1de79c2">copy-arrow</h2>
<div class="outline-text-2" id="text-org1de79c2">
</div><div id="outline-container-org2ccdd01" class="outline-3">
<h3 id="org2ccdd01"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-org2ccdd01">
<ul class="org-ul">
<li><p>the name in trunk will be changed to (arrow &#x2026;)</p><p>(arrow &#x2026;) is fetched from ns and copied</p></li>

<li><p><p></p><p>copy-arrow is called when</p><p></p></p><p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"></p><p></p><p></p><p><colgroup></p><p><col  class="org-left" /></p><p></p><p><col  class="org-left" /></p><p></colgroup></p><p><tbody></p><p><tr></p><p><td class="org-left">trunk intro in pass3</td></p><p><td class="org-left">copy type arrow</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">trunk-&gt;trunk*</td></p><p><td class="org-left">copy body arrow-list</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">compute/arrow in type-compute</td></p><p><td class="org-left">copy arrow to maintain undo-ablity</td></p><p></tr></p><p></tbody></p><p></table></p></li>

<li><p>copy is arrow by arrow</p><p>every var in new arrow is different from old arrow</p><p>thus</p><p><ol class="org-ol"></p><p><li>scope is also arrow by arrow</li></p><p><li>a non-determinate var can not be substituted into lambda as it is</p><p>but is copied</li></ol></p></li>

<li><p>this copy is one of the main place where this prototype can be optimized</p><p>a vm can be designed to replace this copy function</p><p>and change the interpreter to a compiler</p></li></ul>
</div>
</div>

<div id="outline-container-orge294beb" class="outline-3">
<h3 id="orge294beb">copy-arrow</h3>
<div class="outline-text-3" id="text-orge294beb">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy-arrow</span> a<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> arrow<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/arrow a '<span style="color: #696969;">())</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a1 __<span style="color: #B380A8;">}</span> a1<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org36e6d5" class="outline-3">
<h3 id="org36e6d5">copy-cedent</h3>
<div class="outline-text-3" id="text-org36e6d5">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy-cedent</span> c<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cedent <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> cedent<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/cedent c '<span style="color: #696969;">())</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>c1 __<span style="color: #B380A8;">}</span> c1<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1b4bced" class="outline-3">
<h3 id="org1b4bced">copy/arrow</h3>
<div class="outline-text-3" id="text-org1b4bced">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy/arrow</span> a s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>arrow scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/cedent ac s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/cedent sc s1<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>sc1 s2<span style="color: #B380A8;">}</span>
           <span style="color: #B380A8;">{{</span>ac1 sc1<span style="color: #B380A8;">}</span> s2<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org41d35eb" class="outline-3">
<h3 id="org41d35eb">copy/data-list</h3>
<div class="outline-text-3" id="text-org41d35eb">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy/data-list</span> dl s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">((</span>data ...<span style="color: #696969;">)</span> scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span>copy/cedent dl s<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6f771c5" class="outline-3">
<h3 id="org6f771c5">copy/cedent</h3>
<div class="outline-text-3" id="text-org6f771c5">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy/cedent</span> c s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cedent scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>cedent scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{{}</span> s<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>h . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy h s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>h1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/cedent r s1<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>r1 s2<span style="color: #B380A8;">}</span>
           <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons h1 r1<span style="color: #696969;">)</span> s2<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5c9c4cc" class="outline-3">
<h3 id="org5c9c4cc">copy/lambda</h3>
<div class="outline-text-3" id="text-org5c9c4cc">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy/lambda</span> l s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> lambda scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> l
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a al<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/arrow a s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/arrow-list al s1<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>al1 s2<span style="color: #B380A8;">}</span>
           <span style="color: #B380A8;">{{</span>a1 al1<span style="color: #B380A8;">}</span> s2<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7da257d" class="outline-3">
<h3 id="org7da257d">copy/arrow-list</h3>
<div class="outline-text-3" id="text-org7da257d">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy/arrow-list</span> al s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)</span> scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">((</span>arrow ...<span style="color: #696969;">)</span> scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> al
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{{}</span> s<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>h . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/arrow h s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>h1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/arrow-list r s1<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>r1 s2<span style="color: #B380A8;">}</span>
           <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons h1 r1<span style="color: #696969;">)</span> s2<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3acdb5e" class="outline-3">
<h3 id="org3acdb5e">copy</h3>
<div class="outline-text-3" id="text-org3acdb5e">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy</span> d s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> data scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>data scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var x<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/var x s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>x1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{{</span>'var x1<span style="color: #B380A8;">}</span> s1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons x<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/cons x s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>x1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{{</span>'cons x1<span style="color: #B380A8;">}</span> s1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow x<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/arrow x s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>x1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{{</span>'arrow x1<span style="color: #B380A8;">}</span> s1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda x<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/lambda x s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>x1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{{</span>'lambda x1<span style="color: #B380A8;">}</span> s1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'trunk x<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/trunk x s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>x1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{{</span>'trunk x1<span style="color: #B380A8;">}</span> s1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'bind x<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/bind x s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>x1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{{</span>'bind x1<span style="color: #B380A8;">}</span> s1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf9fea3b" class="outline-3">
<h3 id="orgf9fea3b">copy/var</h3>
<div class="outline-text-3" id="text-orgf9fea3b">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy/var</span> v s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> var scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>var scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> v
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>found <span style="color: #696969;">(</span>assq id s<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> found
         <span style="color: #B380A8;">{{</span><span style="color: #696969;">(</span>cdr found<span style="color: #696969;">)</span> level<span style="color: #B380A8;">}</span> s<span style="color: #B380A8;">}</span>
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>ls <span style="color: #696969;">(</span>id-&gt;ls id<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
                <span style="color: #797979;">[</span>id1 <span style="color: #696969;">(</span>id/new <span style="color: #696969;">(</span>id-&gt;name id<span style="color: #696969;">)</span> '<span style="color: #696969;">())</span><span style="color: #797979;">]</span>
                <span style="color: #797979;">[</span>s1 <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>cons id id1<span style="color: #696969;">)</span> s<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/ls ls s1<span style="color: #696969;">)</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ls1 s2<span style="color: #B380A8;">}</span>
              <span style="color: #696969;">(</span>id/commit! id1 ls1<span style="color: #696969;">)</span>
              <span style="color: #B380A8;">{{</span>id1 level<span style="color: #B380A8;">}</span> s2<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">))))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbd8871b" class="outline-3">
<h3 id="orgbd8871b">copy/ls</h3>
<div class="outline-text-3" id="text-orgbd8871b">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy/ls</span> ls s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> ls scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>ls scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> ls
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{{}</span> s<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">((</span>level . data<span style="color: #696969;">)</span> . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy data s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>data1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/ls r s1<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>r1 s2<span style="color: #B380A8;">}</span>
           <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>cons level data1<span style="color: #696969;">)</span>
                  r1<span style="color: #696969;">)</span>
            s2<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9fac201" class="outline-3">
<h3 id="org9fac201">copy/cons</h3>
<div class="outline-text-3" id="text-org9fac201">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy/cons</span> c s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cons scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>cons scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>n dl<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/data-list dl s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>dl1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{{</span>n dl1<span style="color: #B380A8;">}</span> s1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf32d991" class="outline-3">
<h3 id="orgf32d991">copy/trunk</h3>
<div class="outline-text-3" id="text-orgf32d991">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy/trunk</span> p s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">trunk</span> scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> p
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a tody dl i<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> tody
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/var v<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/arrow a s<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a1 s1<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/data-list dl s1<span style="color: #696969;">)</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>dl1 s2<span style="color: #B380A8;">}</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/var v s2<span style="color: #696969;">)</span>
                <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>v1 s3<span style="color: #B380A8;">}</span>
                 <span style="color: #B380A8;">{{</span>a1 <span style="color: #B380A8;">{</span>'tody/var v1<span style="color: #B380A8;">}</span> dl1 i<span style="color: #B380A8;">}</span> s3<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/name n<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/arrow a s<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a1 s1<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/data-list dl s1<span style="color: #696969;">)</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>dl1 s2<span style="color: #B380A8;">}</span>
              <span style="color: #B380A8;">{{</span>a1 <span style="color: #B380A8;">{</span>'tody/name n<span style="color: #B380A8;">}</span> dl1 i<span style="color: #B380A8;">}</span> s2<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/arrow a s<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a1 s1<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/arrow-list al s1<span style="color: #696969;">)</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>al1 s2<span style="color: #B380A8;">}</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/data-list dl s2<span style="color: #696969;">)</span>
                <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>dl1 s3<span style="color: #B380A8;">}</span>
                 <span style="color: #B380A8;">{{</span>a1 <span style="color: #B380A8;">{</span>'tody/arrow-list al1<span style="color: #B380A8;">}</span> dl1 i<span style="color: #B380A8;">}</span> s3<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org31d1ea0" class="outline-3">
<h3 id="org31d1ea0">copy/bind</h3>
<div class="outline-text-3" id="text-org31d1ea0">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy/bind</span> b s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> bind scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>bind scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> b
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>v d<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/var v s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>v1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy d s1<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>d1 s2<span style="color: #B380A8;">}</span>
           <span style="color: #B380A8;">{{</span>v1 d1<span style="color: #B380A8;">}</span> s2<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2959bf3" class="outline-2">
<h2 id="org2959bf3">compute</h2>
<div class="outline-text-2" id="text-org2959bf3">
</div><div id="outline-container-org33cb2f0" class="outline-3">
<h3 id="org33cb2f0">compute/arrow</h3>
<div class="outline-text-3" id="text-org33cb2f0">
<ul class="org-ul">
<li><p>commit should be preformed arrow by arrow</p><p>one arrow can only commit on its own var</p><p>this is achieve by the natural of the structure of bs</p></li>

<li><p>note that</p><p>commit is only meant to handle non-determinate var</p><p>of which the level n is bound</p><p>where n &gt; 0</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">compute/arrow</span> a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>alen <span style="color: #696969;">(</span>length ac<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
              <span style="color: #797979;">[</span>slen <span style="color: #696969;">(</span>length sc<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/cedent ac <span style="color: #B380A8;">{</span>ds <span style="color: #696969;">(</span>cons '<span style="color: #696969;">(</span>commit-point<span style="color: #696969;">)</span> bs<span style="color: #696969;">)</span> ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds1 bs1 ns1<span style="color: #B380A8;">}}</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>cover/data-list
                     <span style="color: #696969;">(</span>take ds1 alen<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>take <span style="color: #696969;">(</span>drop ds1 alen<span style="color: #696969;">)</span> alen<span style="color: #696969;">)</span>
                     <span style="color: #B380A8;">{</span>'success
                      <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>drop <span style="color: #696969;">(</span>drop ds1 alen<span style="color: #696969;">)</span> alen<span style="color: #696969;">)</span>
                       bs1
                       ns1<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e2<span style="color: #B380A8;">}</span>
                <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/cedent sc e2<span style="color: #696969;">)</span>
                  <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
                  <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds3 bs3 ns3<span style="color: #B380A8;">}}</span>
                   <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds3 <span style="color: #696969;">(</span>bs/commit! bs3<span style="color: #696969;">)</span> ns3<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge1e6912" class="outline-3">
<h3 id="orge1e6912">bs/commit!</h3>
<div class="outline-text-3" id="text-orge1e6912">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">bs/commit!</span> bs<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> bs <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> bs
     <span style="color: #797979;">[</span>with effect on part of elements of bs<span style="color: #797979;">]</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">cond</span> <span style="color: #797979;">[</span><span style="color: #696969;">(</span>equal? '<span style="color: #696969;">(</span>commit-point<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>car bs<span style="color: #696969;">))</span>
         <span style="color: #696969;">(</span>cdr bs<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
        <span style="color: #797979;">[</span>else
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>pair <span style="color: #696969;">(</span>car bs<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
                <span style="color: #797979;">[</span>id <span style="color: #696969;">(</span>car pair<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
                <span style="color: #797979;">[</span>ls <span style="color: #696969;">(</span>cdr pair<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span>id/commit! id ls<span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span>bs/commit! <span style="color: #696969;">(</span>cdr bs<span style="color: #696969;">)))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdd45fe0" class="outline-3">
<h3 id="orgdd45fe0">compute/cedent</h3>
<div class="outline-text-3" id="text-orgdd45fe0">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">compute/cedent</span> c e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cedent env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
    <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">proper tail call</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>h<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>compute h e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>h . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute h e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>compute/cedent r e1<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge0e1b85" class="outline-3">
<h3 id="orge0e1b85">compute</h3>
<div class="outline-text-3" id="text-orge0e1b85">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">compute</span> d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>ds bs ns<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>compute/var x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>compute/cons x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'trunk x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>compute/trunk x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'bind x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>compute/bind x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">note that arrow in arrow is computed as literal</span>
       <span style="color: #797979;">[</span>__ <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons d ds<span style="color: #696969;">)</span> bs ns<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org798dc51" class="outline-3">
<h3 id="org798dc51">compute/var</h3>
<div class="outline-text-3" id="text-org798dc51">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">compute/var</span> v e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> var env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>ds bs ns<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>d <span style="color: #696969;">(</span>bs/deep bs <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
         <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">result found from this var needs to be compute again</span>
         <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">except for fresh var</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var __<span style="color: #B380A8;">}</span>
          <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons d ds<span style="color: #696969;">)</span> bs ns<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ __<span style="color: #B380A8;">}</span>
          <span style="color: #696969;">(</span>compute d e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1452d31" class="outline-3">
<h3 id="org1452d31">compute/cons</h3>
<div class="outline-text-3" id="text-org1452d31">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">compute/cons</span> c e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cons env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>ds bs ns<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
       <span style="color: #797979;">[</span><span style="color: #696969;">(</span>n dl<span style="color: #696969;">)</span>
        <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">the following reverse</span>
        <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">dl in stack -&gt; dl in function body</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/cedent <span style="color: #696969;">(</span>reverse dl<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>list '<span style="color: #696969;">()</span> bs ns<span style="color: #696969;">))</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
           <span style="color: #B380A8;">{</span>'fail <span style="color: #696969;">(</span>cons `<span style="color: #696969;">(</span>compute/cons
                          fail
                          <span style="color: #696969;">(</span>cons: ,c<span style="color: #696969;">))</span>
                        il<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds1 bs1 ns1<span style="color: #B380A8;">}}</span>
           <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons <span style="color: #B380A8;">{</span>'cons <span style="color: #B380A8;">{</span>n ds1<span style="color: #B380A8;">}}</span>
                            ds<span style="color: #696969;">)</span>
                      bs
                      ns<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4c9af38" class="outline-3">
<h3 id="org4c9af38">compute/trunk</h3>
<div class="outline-text-3" id="text-org4c9af38">
</div><div id="outline-container-org1566dbf" class="outline-4">
<h4 id="org1566dbf">compute/trunk</h4>
<div class="outline-text-4" id="text-org1566dbf">
<ul class="org-ul">
<li><p>I thought</p><p>there is no reducible trunk after compute/trunk</p><p>thus no reducible trunk after compute/arrow</p><p>but it is actually not true</p><p>because computations after a non-reducible trunk</p><p>might make the trunk reducible</p><p>but no look-back is implemented to handle such case</p></li>

<li><p>&gt;&lt;&gt;&lt;&gt;&lt;</p><p>since I do not really have this invariant</p><p>I should be careful to make sure that</p><p>no functions rely on this invariant</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">compute/trunk</span> t e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> t
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a tody dl i<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> tody
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/var __<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>compute/trunk/tody/var t e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/name __<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>compute/trunk/tody/name t e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/arrow-list __<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>compute/trunk/tody/arrow-list t e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga9078c0" class="outline-4">
<h4 id="orga9078c0">compute/trunk/tody/var</h4>
<div class="outline-text-4" id="text-orga9078c0">
<ul class="org-ul">
<li><p>non-determinate may still here</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">compute/trunk/tody/var</span> t e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> t
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a <span style="color: #B380A8;">{</span>'tody/var v<span style="color: #B380A8;">}</span> dl i<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>bs/deep bs <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var v1<span style="color: #B380A8;">}</span>
           <span style="color: #B380A8;">{</span>'success
            <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons <span style="color: #B380A8;">{</span>'trunk <span style="color: #B380A8;">{</span>a <span style="color: #B380A8;">{</span>'tody/var v1<span style="color: #B380A8;">}</span> dl i<span style="color: #B380A8;">}}</span> ds<span style="color: #696969;">)</span>
             bs
             ns<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow a1<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span>compute/trunk/tody/arrow-list
            <span style="color: #B380A8;">{</span>a <span style="color: #B380A8;">{</span>'tody/arrow-list <span style="color: #B380A8;">{</span>a1<span style="color: #B380A8;">}}</span> dl i<span style="color: #B380A8;">}</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>a1 al<span style="color: #B380A8;">}}</span>
           <span style="color: #696969;">(</span>compute/trunk/tody/arrow-list
            <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">I can use a1 or a</span>
            <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">I use a here</span>
            <span style="color: #B380A8;">{</span>a <span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span> dl i<span style="color: #B380A8;">}</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span>d
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'compute/trunk/tody/var
             <span style="color: #696969;">(</span><span style="color: #e6db74;">"find something wrong from the var in the tody of trunk~%"</span><span style="color: #696969;">)</span>
             <span style="color: #696969;">(</span><span style="color: #e6db74;">"data : ~a~%"</span> d<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2496a7b" class="outline-4">
<h4 id="org2496a7b">compute/trunk/tody/name</h4>
<div class="outline-text-4" id="text-org2496a7b">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">compute/trunk/tody/name</span> t e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> t
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a <span style="color: #B380A8;">{</span>'tody/name n<span style="color: #B380A8;">}</span> dl i<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>compute/trunk/tody/arrow-list <span style="color: #696969;">(</span>trunk-&gt;trunk* t e<span style="color: #696969;">)</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc857fc8" class="outline-4">
<h4 id="orgc857fc8">compute/trunk/tody/arrow-list</h4>
<div class="outline-text-4" id="text-orgc857fc8">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">compute/trunk/tody/arrow-list</span> t e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> t
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a <span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span> dl i<span style="color: #B380A8;">}</span>
        <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">the following reverse</span>
        <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">dl in stack -&gt; dl in function body</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/cedent <span style="color: #696969;">(</span>reverse dl<span style="color: #696969;">)</span> <span style="color: #B380A8;">{{}</span> bs ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
           <span style="color: #B380A8;">{</span>'fail <span style="color: #696969;">(</span>cons `<span style="color: #696969;">(</span>compute/trunk/tody/arrow-list
                          fail when computing data-list
                          <span style="color: #696969;">(</span>data-list: ,dl<span style="color: #696969;">))</span>
                        il<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e1
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds1 bs1 ns1<span style="color: #B380A8;">}</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>dl1 ds1<span style="color: #797979;">]</span>
                     <span style="color: #797979;">[</span>al1 <span style="color: #696969;">(</span>filter-arrow-list al dl1 e1<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
                <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> al1
                  <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span>
                   <span style="color: #B380A8;">{</span>'success
                    <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons <span style="color: #B380A8;">{</span>'trunk <span style="color: #B380A8;">{</span>a <span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span> dl1 i<span style="color: #B380A8;">}}</span>
                           ds<span style="color: #696969;">)</span>
                     bs1
                     ns1<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
                  <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a1<span style="color: #B380A8;">}</span>
                   <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/arrow a1 e1<span style="color: #696969;">)</span>
                     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">after this compute/arrow</span>
                     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">binds are commited</span>
                     <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e2<span style="color: #B380A8;">}</span>
                      <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>proj i e2<span style="color: #696969;">)</span> ds<span style="color: #696969;">)</span>
                                 bs1
                                 ns1<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
                     <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org63efe77" class="outline-4">
<h4 id="org63efe77">trunk-&gt;trunk*</h4>
<div class="outline-text-4" id="text-org63efe77">
<ul class="org-ul">
<li><p>replace the name in trunk by arrow-list</p></li>

<li><p>the ns of env is needed</p><p>to find the arrow-list under the name</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">trunk-&gt;trunk*</span> t e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> trunk<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> t
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a <span style="color: #B380A8;">{</span>'tody/name n<span style="color: #B380A8;">}</span> dl i<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>found <span style="color: #696969;">(</span>assq n ns<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not found<span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'trunk-&gt;trunk*
              <span style="color: #696969;">(</span><span style="color: #e6db74;">"fail~%"</span><span style="color: #696969;">)</span>
              <span style="color: #696969;">(</span><span style="color: #e6db74;">"unknow name : ~a~%"</span> n<span style="color: #696969;">))</span>
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>meaning <span style="color: #696969;">(</span>cdr found<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> meaning
                <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{{</span>ac sc<span style="color: #B380A8;">}</span> al1<span style="color: #B380A8;">}}</span>
                 <span style="color: #B380A8;">{</span>a <span style="color: #B380A8;">{</span>'tody/arrow-list <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> copy-arrow al1<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span> dl i<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
                <span style="color: #797979;">[</span>__
                 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'trunk-&gt;trunk*
                   <span style="color: #696969;">(</span><span style="color: #e6db74;">"trunk-&gt;trunk* fail~%"</span> <span style="color: #696969;">)</span>
                   <span style="color: #696969;">(</span><span style="color: #e6db74;">"name is not lambda : ~a~%"</span> n<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))))</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a tody dl i<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>a tody dl i<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9a437a8" class="outline-3">
<h3 id="org9a437a8">compute/bind</h3>
<div class="outline-text-3" id="text-org9a437a8">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">compute/bind</span> b e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> bind env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> b
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>v d<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>compute d e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga8055b" class="outline-3">
<h3 id="orga8055b">filter-arrow-list</h3>
<div class="outline-text-3" id="text-orga8055b">
<ul class="org-ul">
<li><p>no commit should be made here</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">filter-arrow-list</span> al dl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>eq? '<span style="color: #696969;">()</span> al<span style="color: #696969;">)</span>
    '<span style="color: #696969;">()</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>car al<span style="color: #696969;">)</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac __<span style="color: #B380A8;">}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>alen <span style="color: #696969;">(</span>length ac<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/cedent ac e<span style="color: #696969;">)</span>
              <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail __<span style="color: #B380A8;">}</span>
               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'filter-arrow-list <span style="color: #696969;">(</span><span style="color: #e6db74;">"fail to compute/cedent~%"</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span>
              <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds1 bs1 ns1<span style="color: #B380A8;">}}</span>
               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>cover/data-list
                       <span style="color: #696969;">(</span>take ds1 alen<span style="color: #696969;">)</span> dl
                       <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>drop ds1 alen<span style="color: #696969;">)</span>
                                  bs1
                                  ns1<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
                 <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail __<span style="color: #B380A8;">}</span>
                  <span style="color: #696969;">(</span>filter-arrow-list <span style="color: #696969;">(</span>cdr al<span style="color: #696969;">)</span> dl e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
                 <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
                  <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>car al<span style="color: #696969;">)</span> '<span style="color: #696969;">())</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2459987" class="outline-3">
<h3 id="org2459987">proj</h3>
<div class="outline-text-3" id="text-org2459987">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">proj</span> i e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> index env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> data<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>ds bs ns<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>list-ref ds <span style="color: #696969;">(</span>- <span style="color: #696969;">(</span>length ds<span style="color: #696969;">)</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+</span> 1 i<span style="color: #696969;">)))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga434a14" class="outline-2">
<h2 id="orga434a14">solve</h2>
<div class="outline-text-2" id="text-orga434a14">
</div><div id="outline-container-org28be6d5" class="outline-3">
<h3 id="org28be6d5">solve/arrow</h3>
<div class="outline-text-3" id="text-org28be6d5">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">solve/arrow</span> a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>alen <span style="color: #696969;">(</span>length ac<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
              <span style="color: #797979;">[</span>slen <span style="color: #696969;">(</span>length sc<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/cedent ac <span style="color: #B380A8;">{</span>ds <span style="color: #696969;">(</span>cons '<span style="color: #696969;">(</span>commit-point<span style="color: #696969;">)</span> bs<span style="color: #696969;">)</span> ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds1 bs1 ns1<span style="color: #B380A8;">}}</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>unify/data-list
                     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">cover/data-list</span>
                     <span style="color: #696969;">(</span>take ds1 alen<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>take <span style="color: #696969;">(</span>drop ds1 alen<span style="color: #696969;">)</span> alen<span style="color: #696969;">)</span>
                     <span style="color: #B380A8;">{</span>'success
                      <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>drop <span style="color: #696969;">(</span>drop ds1 alen<span style="color: #696969;">)</span> alen<span style="color: #696969;">)</span>
                       bs1
                       ns1<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e2<span style="color: #B380A8;">}</span>
                <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/cedent sc e2<span style="color: #696969;">)</span>
                  <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
                  <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds3 bs3 ns3<span style="color: #B380A8;">}}</span>
                   <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds3 <span style="color: #696969;">(</span>bs/commit! bs3<span style="color: #696969;">)</span> ns3<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org37777f0" class="outline-2">
<h2 id="org37777f0">print</h2>
<div class="outline-text-2" id="text-org37777f0">
</div><div id="outline-container-orgf6c450b" class="outline-3">
<h3 id="orgf6c450b">print/cedent</h3>
<div class="outline-text-3" id="text-orgf6c450b">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">print/cedent</span> c e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cedent env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #797979;">[</span>effect on terminal<span style="color: #797979;">]</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #696969;">(</span>void<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>d<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>print/data d e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>d . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>print/data d e<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>format #t <span style="color: #e6db74;">" "</span><span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>print/cedent r e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org48c1523" class="outline-3">
<h3 id="org48c1523">print/data-list</h3>
<div class="outline-text-3" id="text-org48c1523">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">print/data-list</span> dl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #797979;">[</span>effect on terminal<span style="color: #797979;">]</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>print/cedent <span style="color: #696969;">(</span>reverse dl<span style="color: #696969;">)</span> e<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6f7fa33" class="outline-3">
<h3 id="org6f7fa33">print/data</h3>
<div class="outline-text-3" id="text-org6f7fa33">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">print/data</span> d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #797979;">[</span>effect on terminal<span style="color: #797979;">]</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>print/var x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>print/cons x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>print/arrow x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>print/lambda x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'trunk x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>print/trunk x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'bind x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>print/bind x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org182efb5" class="outline-3">
<h3 id="org182efb5">print/var</h3>
<div class="outline-text-3" id="text-org182efb5">
<ul class="org-ul">
<li><p>different var should be print differently</p></li>

<li><p>note that</p><p>the env is not used by even print/var</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">print/var</span> v e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> var env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #797979;">[</span>effect on terminal<span style="color: #797979;">]</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> v
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>name <span style="color: #696969;">(</span>id-&gt;name id<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span>counter <span style="color: #696969;">(</span>id-&gt;counter id<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>format #t <span style="color: #e6db74;">":~a:~a^~a"</span> counter name level<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgffc8b4b" class="outline-3">
<h3 id="orgffc8b4b">print/cons</h3>
<div class="outline-text-3" id="text-orgffc8b4b">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">print/cons</span> c e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cons env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #797979;">[</span>effect on terminal<span style="color: #797979;">]</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>n dl<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span>format #t <span style="color: #e6db74;">"["</span><span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>print/data-list dl e<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>null? dl<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>format #t <span style="color: #e6db74;">"~a]"</span> n<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>format #t <span style="color: #e6db74;">" ~a]"</span> n<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge44040f" class="outline-3">
<h3 id="orge44040f">print/arrow</h3>
<div class="outline-text-3" id="text-orge44040f">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">print/arrow</span> a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #797979;">[</span>effect on terminal<span style="color: #797979;">]</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span>format #t <span style="color: #e6db74;">"("</span><span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>print/cedent ac e<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>format #t <span style="color: #e6db74;">" -&gt; "</span><span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>print/cedent sc e<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>format #t <span style="color: #e6db74;">")"</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3fec5a6" class="outline-3">
<h3 id="org3fec5a6"><span class="todo _gt__lt_">&gt;&lt;</span> print/lambda</h3>
<div class="outline-text-3" id="text-org3fec5a6">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">print/lambda</span> l e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> lambda env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #797979;">[</span>effect on terminal<span style="color: #797979;">]</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> l
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a al<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span>format #t <span style="color: #e6db74;">"&lt;lambda&gt;"</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgac85f95" class="outline-3">
<h3 id="orgac85f95"><span class="todo _gt__lt_">&gt;&lt;</span> print/trunk</h3>
<div class="outline-text-3" id="text-orgac85f95">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">print/trunk</span> t e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #797979;">[</span>effect on terminal<span style="color: #797979;">]</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> t
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a tody dl i<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span>format #t <span style="color: #e6db74;">"&lt;trunk&gt;"</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc357084" class="outline-3">
<h3 id="orgc357084">print/bind</h3>
<div class="outline-text-3" id="text-orgc357084">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">print/bind</span> b e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> bind env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #797979;">[</span>effect on terminal<span style="color: #797979;">]</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> b
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>v d<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>print/data d e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge598ae0" class="outline-2">
<h2 id="orge598ae0">consistent-check</h2>
<div class="outline-text-2" id="text-orge598ae0">
</div><div id="outline-container-org47c1075" class="outline-3">
<h3 id="org47c1075">consistent-check</h3>
<div class="outline-text-3" id="text-org47c1075">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">consistent-check</span> v d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>v e<span style="color: #B380A8;">}</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>id level<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>var/highest? v e<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>var/lowest? v e<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>#t #t<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>#t #f<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>var/below v e<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>__ low-level<span style="color: #B380A8;">}</span> low-d<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span>consistent-check/level-diff <span style="color: #696969;">(</span>- level low-level<span style="color: #696969;">)</span> low-d d e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>#f #t<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>var/above v e<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>__ high-level<span style="color: #B380A8;">}</span> high-d<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span>consistent-check/level-diff <span style="color: #696969;">(</span>- high-level level<span style="color: #696969;">)</span> d high-d e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>#f #f<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>var/below v e<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>__ low-level<span style="color: #B380A8;">}</span> low-d<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>consistent-check/level-diff <span style="color: #696969;">(</span>- level low-level<span style="color: #696969;">)</span> low-d d e<span style="color: #696969;">)</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>var/above v e<span style="color: #696969;">)</span>
                <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>__ high-level<span style="color: #B380A8;">}</span> high-d<span style="color: #B380A8;">}</span>
                 <span style="color: #696969;">(</span>consistent-check/level-diff <span style="color: #696969;">(</span>- high-level level<span style="color: #696969;">)</span> d high-d e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7d0782d" class="outline-3">
<h3 id="org7d0782d">consistent-check/level-diff</h3>
<div class="outline-text-3" id="text-org7d0782d">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">consistent-check/level-diff</span> level-diff d1 d2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> level-diff data data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-solve/repeat level-diff d1 e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>d0 . __<span style="color: #696969;">)</span> bs1 ns1<span style="color: #B380A8;">}}</span>
        <span style="color: #696969;">(</span>unify/data d0 d2 <span style="color: #B380A8;">{</span>ds bs1 ns1<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2510227" class="outline-3">
<h3 id="org2510227">type-solve/repeat</h3>
<div class="outline-text-3" id="text-org2510227">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-solve/repeat</span> c d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> counter data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>eq? 0 c<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span>#t <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons d ds<span style="color: #696969;">)</span> bs ns<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span>#f <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-solve d e<span style="color: #696969;">)</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>d1 . r<span style="color: #696969;">)</span> bs1 ns1<span style="color: #B380A8;">}}</span>
              <span style="color: #696969;">(</span>type-solve/repeat <span style="color: #696969;">(</span>- c 1<span style="color: #696969;">)</span> d1 <span style="color: #B380A8;">{</span>r bs1 ns1<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf7fd7f" class="outline-3">
<h3 id="orgf7fd7f">var/highest? &amp; var/lowest?</h3>
<div class="outline-text-3" id="text-orgf7fd7f">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">var/highest?</span> v e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> bool<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> v
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>found <span style="color: #696969;">(</span>assq id bs<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span>ls <span style="color: #696969;">(</span>append <span style="color: #696969;">(</span>id-&gt;ls id<span style="color: #696969;">)</span>
                           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> found <span style="color: #696969;">(</span>cdr found<span style="color: #696969;">)</span> '<span style="color: #696969;">()))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span>list-every?
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>&gt; level <span style="color: #696969;">(</span>car x<span style="color: #696969;">)))</span>
           ls<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">var/lowest?</span> v e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> bool<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> v
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>found <span style="color: #696969;">(</span>assq id bs<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span>ls <span style="color: #696969;">(</span>append <span style="color: #696969;">(</span>id-&gt;ls id<span style="color: #696969;">)</span>
                           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> found <span style="color: #696969;">(</span>cdr found<span style="color: #696969;">)</span> '<span style="color: #696969;">()))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span>list-every?
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>&lt; level <span style="color: #696969;">(</span>car x<span style="color: #696969;">)))</span>
           ls<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org38d3398" class="outline-3">
<h3 id="org38d3398">var/above &amp; var/below</h3>
<div class="outline-text-3" id="text-org38d3398">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">var/above</span> v e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>var data<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> v
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>found <span style="color: #696969;">(</span>assq id bs<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span>ls <span style="color: #696969;">(</span>append <span style="color: #696969;">(</span>id-&gt;ls id<span style="color: #696969;">)</span>
                           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> found <span style="color: #696969;">(</span>cdr found<span style="color: #696969;">)</span> '<span style="color: #696969;">()))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>pair
                 <span style="color: #696969;">(</span>car <span style="color: #696969;">(</span>filter <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>&gt; <span style="color: #696969;">(</span>car x<span style="color: #696969;">)</span> level<span style="color: #696969;">))</span>
                              <span style="color: #696969;">(</span>sort <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x y<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>&lt; <span style="color: #696969;">(</span>car x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>car y<span style="color: #696969;">)))</span>
                                    ls<span style="color: #696969;">)))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
            <span style="color: #B380A8;">{{</span>id <span style="color: #696969;">(</span>car pair<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>cdr pair<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">var/below</span> v e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>var data<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> v
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>found <span style="color: #696969;">(</span>assq id bs<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span>ls <span style="color: #696969;">(</span>append <span style="color: #696969;">(</span>id-&gt;ls id<span style="color: #696969;">)</span>
                           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> found <span style="color: #696969;">(</span>cdr found<span style="color: #696969;">)</span> '<span style="color: #696969;">()))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>pair
                 <span style="color: #696969;">(</span>car <span style="color: #696969;">(</span>filter <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>&lt; <span style="color: #696969;">(</span>car x<span style="color: #696969;">)</span> level<span style="color: #696969;">))</span>
                              <span style="color: #696969;">(</span>sort <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x y<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>&gt; <span style="color: #696969;">(</span>car x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>car y<span style="color: #696969;">)))</span>
                                    ls<span style="color: #696969;">)))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
            <span style="color: #B380A8;">{{</span>id <span style="color: #696969;">(</span>car pair<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>cdr pair<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6209f75" class="outline-2">
<h2 id="org6209f75">occur-check</h2>
<div class="outline-text-2" id="text-org6209f75">
</div><div id="outline-container-org66c4f2e" class="outline-3">
<h3 id="org66c4f2e"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-org66c4f2e">
<ul class="org-ul">
<li><p>this is a simple occurrence check</p><p>&gt;&lt;&gt;&lt;&gt;&lt;</p><p>it should be merged with consistent check</p><p>without such merging</p><p>the occurrence check will be not complete</p></li></ul>
</div>
</div>

<div id="outline-container-orgd4b0849" class="outline-3">
<h3 id="orgd4b0849">occur-check/data</h3>
<div class="outline-text-3" id="text-orgd4b0849">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">occur-check/data</span> v d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>bs/deep bs d<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>occur-check/var v x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>occur-check/cons v x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>occur-check/arrow v x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>occur-check/lambda v x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'trunk x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>occur-check/trunk v x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'bind x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>occur-check/bind v x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc82c40e" class="outline-3">
<h3 id="orgc82c40e">occur-check/var</h3>
<div class="outline-text-3" id="text-orgc82c40e">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">occur-check/var</span> v v0 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var var env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>var/eq? v v0<span style="color: #696969;">)</span>
    <span style="color: #797979;">[</span>#t <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>occur-check/var fail <span style="color: #696969;">(</span>v: ,v<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span>#f <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6f68857" class="outline-3">
<h3 id="org6f68857">occur-check/cons</h3>
<div class="outline-text-3" id="text-org6f68857">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">occur-check/cons</span> v c e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var cons env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>n dl<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span>occur-check/data-list v dl e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3f60a21" class="outline-3">
<h3 id="org3f60a21">occur-check/data-list</h3>
<div class="outline-text-3" id="text-org3f60a21">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">occur-check/data-list</span> v dl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> dl
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>d . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>occur-check/data v d e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>occur-check/data-list v r e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8f07080" class="outline-3">
<h3 id="org8f07080">occur-check/arrow</h3>
<div class="outline-text-3" id="text-org8f07080">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">occur-check/arrow</span> v a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>occur-check/data-list v ac e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>occur-check/data-list v sc e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaa155be" class="outline-3">
<h3 id="orgaa155be">occur-check/lambda</h3>
<div class="outline-text-3" id="text-orgaa155be">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">occur-check/lambda</span> v l e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var lambda env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> l
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a al<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>occur-check/arrow v a e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>occur-check/arrow-list v al e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org33629ce" class="outline-3">
<h3 id="org33629ce">occur-check/arrow-list</h3>
<div class="outline-text-3" id="text-org33629ce">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">occur-check/arrow-list</span> v al e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> al
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>a . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>occur-check/arrow v a e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>occur-check/arrow-list v r e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org98b7e93" class="outline-3">
<h3 id="org98b7e93">occur-check/trunk</h3>
<div class="outline-text-3" id="text-org98b7e93">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">occur-check/trunk</span> v t e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> t
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a tody dl i<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>occur-check/arrow v a e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>occur-check/data-list v dl e<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> tody
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/name __<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>occur-check/arrow-list v al e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/var v1<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>occur-check/var v v1 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6a32432" class="outline-3">
<h3 id="org6a32432">occur-check/bind</h3>
<div class="outline-text-3" id="text-org6a32432">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">occur-check/bind</span> v b e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var bind env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> b
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>v0 d<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>var/eq? v v0<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span>#t <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>occur-check/var fail <span style="color: #696969;">(</span>v: ,v<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span>#f <span style="color: #696969;">(</span>occur-check/data v d e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2347012" class="outline-2">
<h2 id="org2347012">unify</h2>
<div class="outline-text-2" id="text-org2347012">
</div><div id="outline-container-org495f126" class="outline-3">
<h3 id="org495f126"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-org495f126">
<ul class="org-ul">
<li><p>firstly we have first order syntactic unification</p></li>

<li><p>except for unify/trunk/data</p><p>where semantic unification is used</p></li>

<li><p>and for unify/trunk</p><p>where first syntactic unification is tried</p><p>if it fail</p><p>semantic unification is used</p></li>

<li><p>semantic unification is unification modulo theory</p><p>the theory here is term-rewriting-system</p></li></ul>
</div>
</div>

<div id="outline-container-org6b3e59b" class="outline-3">
<h3 id="org6b3e59b">unify/data-list</h3>
<div class="outline-text-3" id="text-org6b3e59b">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/data-list</span> pl dl r<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>pattern ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> report <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> r
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">cond</span> <span style="color: #797979;">[</span><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>eq? pl '<span style="color: #696969;">())</span> <span style="color: #696969;">(</span>eq? dl '<span style="color: #696969;">()))</span>
            r<span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span><span style="color: #696969;">(</span>eq? pl <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span>
            <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>unify/data-list
                      fail pl and dl is not of the same length
                      <span style="color: #696969;">(</span>additional-dl: ,dl<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span><span style="color: #696969;">(</span>eq? dl <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span>
            <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>unify/data-list
                      fail pl and dl is not of the same length
                      <span style="color: #696969;">(</span>additional-pl: ,pl<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span>else
            <span style="color: #696969;">(</span>unify/data-list
             <span style="color: #696969;">(</span>cdr pl<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>cdr dl<span style="color: #696969;">)</span>
             <span style="color: #696969;">(</span>unify/data <span style="color: #696969;">(</span>car pl<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>car dl<span style="color: #696969;">)</span> e<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd1eb05c" class="outline-3">
<h3 id="orgd1eb05c">unify/data</h3>
<div class="outline-text-3" id="text-orgd1eb05c">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/data</span> p d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> pattern data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">var -walk-&gt; fresh-var</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>p <span style="color: #696969;">(</span>bs/walk bs p<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span>d <span style="color: #696969;">(</span>bs/walk bs d<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>p d<span style="color: #B380A8;">}</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'bind <span style="color: #B380A8;">{</span>__ p0<span style="color: #B380A8;">}}</span> __<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>unify/data p0 d e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ <span style="color: #B380A8;">{</span>'bind <span style="color: #B380A8;">{</span>__ d0<span style="color: #B380A8;">}}}</span> <span style="color: #696969;">(</span>unify/data p d0 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'var v1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'var v2<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>var/eq? v1 v2<span style="color: #696969;">)</span>
            <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span>
            <span style="color: #696969;">(</span>unify/var/data v1 d e<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'var v<span style="color: #B380A8;">}</span> __<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>unify/var/data v d e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>unify/var/data v p e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>

         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'trunk t1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'trunk t2<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>unify/trunk t1 t2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'trunk t<span style="color: #B380A8;">}</span> __<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>unify/trunk/data t d e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ <span style="color: #B380A8;">{</span>'trunk t<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>unify/trunk/data t p e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>

         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'cons c1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'cons c2<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>unify/cons c1 c2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'arrow a1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'arrow a2<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>unify/arrow a1 a2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'lambda l1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'lambda l2<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>unify/lambda l1 l2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ __<span style="color: #B380A8;">}</span>
          <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>unify/data
                    fail to unify
                    <span style="color: #696969;">(</span>pattern: ,p<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>data: ,d<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgea06641" class="outline-3">
<h3 id="orgea06641">unify/var/data</h3>
<div class="outline-text-3" id="text-orgea06641">
<ul class="org-ul">
<li><p>before bs/extend need to ensure that</p><p>the bind to be added is consistent with binds already in bs</p><p>this is where the levels of var come into the game</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/var/data</span> v d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">{'success {ds (bs/extend bs v d) ns}}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>consistent-check v d e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{</span>'fail <span style="color: #696969;">(</span>cons `<span style="color: #696969;">(</span>unify/var/data
                       consistent-check fail
                       <span style="color: #696969;">(</span>v: ,v<span style="color: #696969;">)</span>
                       <span style="color: #696969;">(</span>d: ,d<span style="color: #696969;">))</span>
                     il<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>occur-check/data v d e<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
           <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds <span style="color: #696969;">(</span>bs/extend bs v d<span style="color: #696969;">)</span> ns<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfa2c2a7" class="outline-3">
<h3 id="orgfa2c2a7">unify/cons</h3>
<div class="outline-text-3" id="text-orgfa2c2a7">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/cons</span> c1 c2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cons cons env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>c1 c2<span style="color: #B380A8;">}</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>n1 dl1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>n2 dl2<span style="color: #B380A8;">}}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>eq? n1 n2<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>unify/data-list dl1 dl2 <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
       <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>unify/cons
                 fail
                 <span style="color: #696969;">(</span>cons1: ,c1<span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span>cons2: ,c2<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5279baa" class="outline-3">
<h3 id="org5279baa">unify/arrow</h3>
<div class="outline-text-3" id="text-org5279baa">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/arrow</span> a1 a2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>a1 a2<span style="color: #B380A8;">}</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>ac1 sc1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>ac2 sc2<span style="color: #B380A8;">}}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>unify/data-list ac1 ac2 <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>unify/data-list sc1 sc2 <span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{</span>'fail <span style="color: #696969;">(</span>cons `<span style="color: #696969;">(</span>unify/arrow
                       fail <span style="color: #696969;">(</span>arrow1: ,a1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>arrow2: ,a2<span style="color: #696969;">))</span>
                     il<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org48a2bcc" class="outline-3">
<h3 id="org48a2bcc">unify/lambda</h3>
<div class="outline-text-3" id="text-org48a2bcc">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/lambda</span> l1 l2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> lambda lambda env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>l1 l2<span style="color: #B380A8;">}</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>a1 al1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>a2 al2<span style="color: #B380A8;">}}</span>
     <span style="color: #696969;">(</span>unify/arrow-list al1 al2 <span style="color: #696969;">(</span>unify/arrow a1 a2 e<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org36b96e0" class="outline-3">
<h3 id="org36b96e0">unify/arrow-list</h3>
<div class="outline-text-3" id="text-org36b96e0">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/arrow-list</span> al1 al2 r<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)</span> report <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> r
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">cond</span>  <span style="color: #797979;">[</span><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>eq? al1 <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span> <span style="color: #696969;">(</span>eq? al2 <span style="color: #B380A8;">{}</span><span style="color: #696969;">))</span>
             r<span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span><span style="color: #696969;">(</span>eq? al1 <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span>
             <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>unify/arrow-list
                       fail al1 and al2 is not of the same length
                       <span style="color: #696969;">(</span>additional-al2: ,al2<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span><span style="color: #696969;">(</span>eq? al2 <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span>
             <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>unify/arrow-list
                       fail al1 and al2 is not of the same length
                       <span style="color: #696969;">(</span>additional-al1: ,al1<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span>else
             <span style="color: #696969;">(</span>unify/arrow-list
              <span style="color: #696969;">(</span>cdr al1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>cdr al2<span style="color: #696969;">)</span>
              <span style="color: #696969;">(</span>unify/arrow <span style="color: #696969;">(</span>car al1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>car al2<span style="color: #696969;">)</span> e<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgac3fd28" class="outline-3">
<h3 id="orgac3fd28">unify/trunk</h3>
<div class="outline-text-3" id="text-orgac3fd28">
</div><div id="outline-container-org8deafbc" class="outline-4">
<h4 id="org8deafbc"><span class="todo note">note</span> </h4>
<div class="outline-text-4" id="text-org8deafbc">
<ul class="org-ul">
<li><p>it will not diverge on recursive call here</p><p>because the trunk of recursive call</p><p>only have name in it</p><p>but not have the arrow-list</p></li>

<li><p>to be able to unify on trunk</p><p>is different from</p><p>to be able to unify on arrow or lambda</p><p>we do not really have</p><p>second order semantic unification here</p></li></ul>
</div>
</div>

<div id="outline-container-org8fb32c9" class="outline-4">
<h4 id="org8fb32c9">unify/trunk</h4>
<div class="outline-text-4" id="text-org8fb32c9">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/trunk</span> t1 t2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>unify/trunk/syntactic t1 t2 e<span style="color: #696969;">)</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il1<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>unify/trunk/semantic t1 t2 e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e2<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'success e2<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il2<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{</span>'fail <span style="color: #696969;">(</span>append il2 il1<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf82cb09" class="outline-4">
<h4 id="orgf82cb09">unify/trunk/syntactic</h4>
<div class="outline-text-4" id="text-orgf82cb09">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/trunk/syntactic</span> t1 t2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>t1 t2<span style="color: #B380A8;">}</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>a1 tody1 dl1 i1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>a2 tody2 dl2 i2<span style="color: #B380A8;">}}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not <span style="color: #696969;">(</span>eq? i1 i2<span style="color: #696969;">))</span>
       <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>unify/trunk/syntactic
                 fail indexes are different
                 <span style="color: #696969;">(</span>trunk1: ,t1<span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span>trunk2: ,t2<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>tody1 tody2<span style="color: #B380A8;">}</span>
         <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">about name</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/name n1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/name n2<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>eq? n1 n2<span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span>unify/data-list dl1 dl2 <span style="color: #696969;">(</span>unify/arrow a1 a2 e<span style="color: #696969;">))</span>
            <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>unify/trunk/syntactic
                      fail names are different
                      <span style="color: #696969;">(</span>trunk1: ,t1<span style="color: #696969;">)</span>
                      <span style="color: #696969;">(</span>trunk2: ,t2<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/name n<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/var v<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span>unify/trunk/syntactic <span style="color: #696969;">(</span>trunk-&gt;trunk* t1 e<span style="color: #696969;">)</span> t2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/var v<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/name n<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span>unify/trunk/syntactic  t1 <span style="color: #696969;">(</span>trunk-&gt;trunk* t2 e<span style="color: #696969;">)</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/name n<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span>unify/trunk/syntactic <span style="color: #696969;">(</span>trunk-&gt;trunk* t1 e<span style="color: #696969;">)</span> t2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/name n<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span>unify/trunk/syntactic  t1 <span style="color: #696969;">(</span>trunk-&gt;trunk* t2 e<span style="color: #696969;">)</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">about var</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/var v1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/var v2<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>unify/data <span style="color: #B380A8;">{</span>'var v1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'var v2<span style="color: #B380A8;">}</span> e<span style="color: #696969;">)</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
             <span style="color: #696969;">(</span>unify/data-list dl1 dl2 <span style="color: #696969;">(</span>unify/arrow a1 a2 e1<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/var v<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>unify/data <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>a2 al<span style="color: #B380A8;">}}</span> e<span style="color: #696969;">)</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
             <span style="color: #696969;">(</span>unify/data-list dl1 dl2 <span style="color: #696969;">(</span>unify/arrow a1 a2 e1<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/var v<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>unify/data <span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>a1 al<span style="color: #B380A8;">}}</span> <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span> e<span style="color: #696969;">)</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
             <span style="color: #696969;">(</span>unify/data-list dl1 dl2 <span style="color: #696969;">(</span>unify/arrow a1 a2 e1<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">about arrow-list</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/arrow-list al1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/arrow-list al2<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span>unify/data-list
           dl1 dl2
           <span style="color: #696969;">(</span>unify/lambda <span style="color: #B380A8;">{</span>a1 al1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>a2 al2<span style="color: #B380A8;">}</span> e<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org11e8d00" class="outline-4">
<h4 id="org11e8d00">unify/trunk/semantic</h4>
<div class="outline-text-4" id="text-org11e8d00">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/trunk/semantic</span> t1 t2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>t1 t2<span style="color: #B380A8;">}</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>a1 tody1 dl1 i1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>a2 tody2 dl2 i2<span style="color: #B380A8;">}}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>tody1 tody2<span style="color: #B380A8;">}</span>
       <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">about name</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/name n<span style="color: #B380A8;">}</span> __<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>unify/trunk/semantic <span style="color: #696969;">(</span>trunk-&gt;trunk* t1 e<span style="color: #696969;">)</span> t2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ <span style="color: #B380A8;">{</span>'tody/name n<span style="color: #B380A8;">}}</span>
        <span style="color: #696969;">(</span>unify/trunk/semantic t1 <span style="color: #696969;">(</span>trunk-&gt;trunk* t2 e<span style="color: #696969;">)</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">about var</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/var v<span style="color: #B380A8;">}</span> __<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/var v e<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>d . __<span style="color: #696969;">)</span> __ __<span style="color: #B380A8;">}}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow a<span style="color: #B380A8;">}</span>
              <span style="color: #696969;">(</span>unify/trunk/semantic
               <span style="color: #B380A8;">{</span>a1 <span style="color: #B380A8;">{</span>'tody/arrow-list <span style="color: #B380A8;">{</span>a<span style="color: #B380A8;">}}</span> dl1 i1<span style="color: #B380A8;">}</span> t2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>a al<span style="color: #B380A8;">}}</span>
              <span style="color: #696969;">(</span>unify/trunk/semantic
               <span style="color: #B380A8;">{</span>a1 <span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span> dl1 i1<span style="color: #B380A8;">}</span> t2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span>__
              <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>unify/trunk/semantic
                        a var computes to neither arrow nor lambda
                        <span style="color: #696969;">(</span>var: ,v<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ <span style="color: #B380A8;">{</span>'tody/var v<span style="color: #B380A8;">}}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/var v e<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>d . __<span style="color: #696969;">)</span> __ __<span style="color: #B380A8;">}}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow a<span style="color: #B380A8;">}</span>
              <span style="color: #696969;">(</span>unify/trunk/semantic
               t1 <span style="color: #B380A8;">{</span>a2 <span style="color: #B380A8;">{</span>'tody/arrow-list <span style="color: #B380A8;">{</span>a<span style="color: #B380A8;">}}</span> dl2 i2<span style="color: #B380A8;">}</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>a al<span style="color: #B380A8;">}}</span>
              <span style="color: #696969;">(</span>unify/trunk/semantic
               t1 <span style="color: #B380A8;">{</span>a2 <span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span> dl2 i2<span style="color: #B380A8;">}</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span>__
              <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>unify/trunk/semantic
                        a var computes to neither arrow nor lambda
                        <span style="color: #696969;">(</span>var: ,v<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">about arrow-list</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/arrow-list al1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/arrow-list al2<span style="color: #B380A8;">}}</span>
        <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">recur to unify/data</span>
        <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">only when at least one of the trunk is reducible</span>
        <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">and if the arguments of this recur are both trunk</span>
        <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">one of them may still be reducible</span>
        <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">thus will get in to this branch again</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>filter-arrow-list al1 dl1 e<span style="color: #696969;">)</span>
                <span style="color: #696969;">(</span>filter-arrow-list al2 dl2 e<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>l1 l2<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">or</span> <span style="color: #696969;">(</span>eq? 1 <span style="color: #696969;">(</span>length l1<span style="color: #696969;">))</span> <span style="color: #696969;">(</span>eq? 1 <span style="color: #696969;">(</span>length l2<span style="color: #696969;">))))</span>
             <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>unify/trunk/semantic
                       fail both trunks are non-reducible
                       <span style="color: #696969;">(</span>trunk1: ,t1<span style="color: #696969;">)</span>
                       <span style="color: #696969;">(</span>trunk2: ,t2<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>compute/trunk t1 e<span style="color: #696969;">)</span>
                     <span style="color: #696969;">(</span>compute/trunk t2 e<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>d1 . __<span style="color: #696969;">)</span> __ __<span style="color: #B380A8;">}}</span>
                 <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>d2 . __<span style="color: #696969;">)</span> __ __<span style="color: #B380A8;">}}}</span>
                <span style="color: #696969;">(</span>cat <span style="color: #696969;">(</span><span style="color: #e6db74;">"&lt;unify&gt;~%"</span><span style="color: #696969;">))</span>
                <span style="color: #696969;">(</span>unify/data d1 d2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ __<span style="color: #B380A8;">}</span>
                <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>unify/trunk/semantic
                          fail to compute/trunk one of the trunks
                          <span style="color: #696969;">(</span>trunk1: ,t1<span style="color: #696969;">)</span>
                          <span style="color: #696969;">(</span>trunk2: ,t2<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3812422" class="outline-3">
<h3 id="org3812422">unify/trunk/data</h3>
<div class="outline-text-3" id="text-org3812422">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/trunk/data</span> t d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/trunk t e<span style="color: #696969;">)</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
     <span style="color: #B380A8;">{</span>'fail <span style="color: #696969;">(</span>cons `<span style="color: #696969;">(</span>unify/trunk/data
                    <span style="color: #696969;">(</span>trunk: ,t<span style="color: #696969;">)</span>
                    <span style="color: #696969;">(</span>data: ,d<span style="color: #696969;">))</span>
                  il<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>env/pop e1<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'trunk t1<span style="color: #B380A8;">}</span> e2<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>unify/trunk/data
                  <span style="color: #696969;">(</span>trunk: ,t<span style="color: #696969;">)</span>
                  compute to
                  <span style="color: #696969;">(</span>trunk: ,t1<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>d1 e2<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>unify/data d1 d e2<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5d6b45e" class="outline-2">
<h2 id="org5d6b45e">cover</h2>
<div class="outline-text-2" id="text-org5d6b45e">
</div><div id="outline-container-orge5fcd6a" class="outline-3">
<h3 id="orge5fcd6a"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-orge5fcd6a">
<ul class="org-ul">
<li><p>this is the poset structure of term lattice</p></li></ul>
</div>
</div>

<div id="outline-container-orgf1714ef" class="outline-3">
<h3 id="orgf1714ef">cover/data-list</h3>
<div class="outline-text-3" id="text-orgf1714ef">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover/data-list</span> pl dl r<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>pattern ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> report <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> r
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">cond</span> <span style="color: #797979;">[</span><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>eq? pl '<span style="color: #696969;">())</span> <span style="color: #696969;">(</span>eq? dl '<span style="color: #696969;">()))</span>
            r<span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span><span style="color: #696969;">(</span>eq? pl <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span>
            <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>cover/data-list
                      fail pl and dl is not of the same length
                      <span style="color: #696969;">(</span>additional-dl: ,dl<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span><span style="color: #696969;">(</span>eq? dl <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span>
            <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>cover/data-list
                      fail pl and dl is not of the same length
                      <span style="color: #696969;">(</span>additional-pl: ,pl<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span>else
            <span style="color: #696969;">(</span>cover/data-list
             <span style="color: #696969;">(</span>cdr pl<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>cdr dl<span style="color: #696969;">)</span>
             <span style="color: #696969;">(</span>cover/data <span style="color: #696969;">(</span>car pl<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>car dl<span style="color: #696969;">)</span> e<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb90a3bd" class="outline-3">
<h3 id="orgb90a3bd">cover/data</h3>
<div class="outline-text-3" id="text-orgb90a3bd">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover/data</span> p d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> pattern data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">var -walk-&gt; fresh-var</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>p <span style="color: #696969;">(</span>bs/walk bs p<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span>d <span style="color: #696969;">(</span>bs/walk bs d<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>p d<span style="color: #B380A8;">}</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'bind <span style="color: #B380A8;">{</span>__ p0<span style="color: #B380A8;">}}</span> __<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>cover/data p0 d e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ <span style="color: #B380A8;">{</span>'bind <span style="color: #B380A8;">{</span>__ d0<span style="color: #B380A8;">}}}</span> <span style="color: #696969;">(</span>cover/data p d0 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'var v1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'var v2<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>var/eq? v1 v2<span style="color: #696969;">)</span>
            <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span>
            <span style="color: #696969;">(</span>cover/var/data v1 d e<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'var v<span style="color: #B380A8;">}</span> __<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>cover/var/data v d e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}}</span>
          <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">here is the only different between unify/data</span>
          <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>cover/data
                    fail because non-var can never cover var
                    <span style="color: #696969;">(</span>pattern: ,p<span style="color: #696969;">)</span>
                    <span style="color: #696969;">(</span>data: ,d<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'trunk t1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'trunk t2<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>cover/trunk t1 t2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'trunk t<span style="color: #B380A8;">}</span> __<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>cover/trunk/data t d e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ <span style="color: #B380A8;">{</span>'trunk t<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>cover/trunk/data t p e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>

         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'cons c1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'cons c2<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>cover/cons c1 c2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'arrow a1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'arrow a2<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>cover/arrow a1 a2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'lambda l1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'lambda l2<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>cover/lambda l1 l2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ __<span style="color: #B380A8;">}</span>
          <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>cover/data
                    fail to unify
                    <span style="color: #696969;">(</span>pattern: ,p<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>data: ,d<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeb4d03d" class="outline-3">
<h3 id="orgeb4d03d">cover/var/data</h3>
<div class="outline-text-3" id="text-orgeb4d03d">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover/var/data</span> v d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">{'success {ds (bs/extend bs v d) ns}}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>consistent-check v d e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{</span>'fail <span style="color: #696969;">(</span>cons `<span style="color: #696969;">(</span>cover/var/data
                       consistent-check fail
                       <span style="color: #696969;">(</span>v: ,v<span style="color: #696969;">)</span>
                       <span style="color: #696969;">(</span>d: ,d<span style="color: #696969;">))</span>
                     il<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>occur-check/data v d e<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
           <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds <span style="color: #696969;">(</span>bs/extend bs v d<span style="color: #696969;">)</span> ns<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb4cfcde" class="outline-3">
<h3 id="orgb4cfcde">cover/cons</h3>
<div class="outline-text-3" id="text-orgb4cfcde">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover/cons</span> c1 c2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cons cons env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>c1 c2<span style="color: #B380A8;">}</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>n1 dl1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>n2 dl2<span style="color: #B380A8;">}}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>eq? n1 n2<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>cover/data-list dl1 dl2 <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
       <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>cover/cons
                 fail
                 <span style="color: #696969;">(</span>cons1: ,c1<span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span>cons2: ,c2<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org995f8e6" class="outline-3">
<h3 id="org995f8e6">cover/arrow</h3>
<div class="outline-text-3" id="text-org995f8e6">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover/arrow</span> a1 a2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>a1 a2<span style="color: #B380A8;">}</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>ac1 sc1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>ac2 sc2<span style="color: #B380A8;">}}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>cover/data-list ac1 ac2 <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>cover/data-list sc1 sc2 <span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{</span>'fail <span style="color: #696969;">(</span>cons `<span style="color: #696969;">(</span>cover/arrow
                       fail <span style="color: #696969;">(</span>arrow1: ,a1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>arrow2: ,a2<span style="color: #696969;">))</span>
                     il<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge1a5d00" class="outline-3">
<h3 id="orge1a5d00">cover/lambda</h3>
<div class="outline-text-3" id="text-orge1a5d00">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover/lambda</span> l1 l2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> lambda lambda env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>l1 l2<span style="color: #B380A8;">}</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>a1 al1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>a2 al2<span style="color: #B380A8;">}}</span>
     <span style="color: #696969;">(</span>cover/arrow-list al1 al2 <span style="color: #696969;">(</span>cover/arrow a1 a2 e<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8bd5d1a" class="outline-3">
<h3 id="org8bd5d1a">cover/arrow-list</h3>
<div class="outline-text-3" id="text-org8bd5d1a">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover/arrow-list</span> al1 al2 r<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)</span> report <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> r
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>eq? al1 <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span>
       r
       <span style="color: #696969;">(</span>cover/arrow-list
        <span style="color: #696969;">(</span>cdr al1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>cdr al2<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span>cover/arrow <span style="color: #696969;">(</span>car al1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>car al2<span style="color: #696969;">)</span> e<span style="color: #696969;">)))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgca5d18d" class="outline-3">
<h3 id="orgca5d18d">cover/trunk</h3>
<div class="outline-text-3" id="text-orgca5d18d">
</div><div id="outline-container-orgc051d11" class="outline-4">
<h4 id="orgc051d11"><span class="todo note">note</span> </h4>
<div class="outline-text-4" id="text-orgc051d11">
<ul class="org-ul">
<li><p>it will not diverge on recursive call here</p><p>because the trunk of recursive call</p><p>only have name in it</p><p>but not have the arrow-list</p></li>

<li><p>to be able to unify on trunk</p><p>is different from</p><p>to be able to unify on arrow or lambda</p><p>we do not really have</p><p>second order semantic unification here</p></li></ul>
</div>
</div>

<div id="outline-container-org8f9c161" class="outline-4">
<h4 id="org8f9c161">cover/trunk</h4>
<div class="outline-text-4" id="text-org8f9c161">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover/trunk</span> t1 t2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>cover/trunk/syntactic t1 t2 e<span style="color: #696969;">)</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il1<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>cover/trunk/semantic t1 t2 e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e2<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'success e2<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il2<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{</span>'fail <span style="color: #696969;">(</span>append il2 il1<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org17a8ba5" class="outline-4">
<h4 id="org17a8ba5">cover/trunk/syntactic</h4>
<div class="outline-text-4" id="text-org17a8ba5">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover/trunk/syntactic</span> t1 t2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>t1 t2<span style="color: #B380A8;">}</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>a1 tody1 dl1 i1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>a2 tody2 dl2 i2<span style="color: #B380A8;">}}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not <span style="color: #696969;">(</span>eq? i1 i2<span style="color: #696969;">))</span>
       <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>cover/trunk/syntactic
                 fail indexes are different
                 <span style="color: #696969;">(</span>trunk1: ,t1<span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span>trunk2: ,t2<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>tody1 tody2<span style="color: #B380A8;">}</span>
         <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">about name</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/name n1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/name n2<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>eq? n1 n2<span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span>cover/data-list dl1 dl2 <span style="color: #696969;">(</span>cover/arrow a1 a2 e<span style="color: #696969;">))</span>
            <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>cover/trunk/syntactic
                      fail names are different
                      <span style="color: #696969;">(</span>trunk1: ,t1<span style="color: #696969;">)</span>
                      <span style="color: #696969;">(</span>trunk2: ,t2<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/name n<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/var v<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span>cover/trunk/syntactic <span style="color: #696969;">(</span>trunk-&gt;trunk* t1 e<span style="color: #696969;">)</span> t2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/var v<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/name n<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span>cover/trunk/syntactic  t1 <span style="color: #696969;">(</span>trunk-&gt;trunk* t2 e<span style="color: #696969;">)</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/name n<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span>cover/trunk/syntactic <span style="color: #696969;">(</span>trunk-&gt;trunk* t1 e<span style="color: #696969;">)</span> t2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/name n<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span>cover/trunk/syntactic  t1 <span style="color: #696969;">(</span>trunk-&gt;trunk* t2 e<span style="color: #696969;">)</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">about var</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/var v1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/var v2<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>cover/data <span style="color: #B380A8;">{</span>'var v1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'var v2<span style="color: #B380A8;">}</span> e<span style="color: #696969;">)</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
             <span style="color: #696969;">(</span>cover/data-list dl1 dl2 <span style="color: #696969;">(</span>cover/arrow a1 a2 e1<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/var v<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>cover/data <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>a2 al<span style="color: #B380A8;">}}</span> e<span style="color: #696969;">)</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
             <span style="color: #696969;">(</span>cover/data-list dl1 dl2 <span style="color: #696969;">(</span>cover/arrow a1 a2 e1<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/var v<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>cover/data <span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>a1 al<span style="color: #B380A8;">}}</span> <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span> e<span style="color: #696969;">)</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
             <span style="color: #696969;">(</span>cover/data-list dl1 dl2 <span style="color: #696969;">(</span>cover/arrow a1 a2 e1<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">about arrow-list</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/arrow-list al1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/arrow-list al2<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span>cover/data-list
           dl1 dl2
           <span style="color: #696969;">(</span>cover/lambda <span style="color: #B380A8;">{</span>a1 al1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>a2 al2<span style="color: #B380A8;">}</span> e<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcb1fef7" class="outline-4">
<h4 id="orgcb1fef7">cover/trunk/semantic</h4>
<div class="outline-text-4" id="text-orgcb1fef7">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover/trunk/semantic</span> t1 t2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>t1 t2<span style="color: #B380A8;">}</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>a1 tody1 dl1 i1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>a2 tody2 dl2 i2<span style="color: #B380A8;">}}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>tody1 tody2<span style="color: #B380A8;">}</span>
       <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">about name</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/name n<span style="color: #B380A8;">}</span> __<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>cover/trunk/semantic <span style="color: #696969;">(</span>trunk-&gt;trunk* t1 e<span style="color: #696969;">)</span> t2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ <span style="color: #B380A8;">{</span>'tody/name n<span style="color: #B380A8;">}}</span>
        <span style="color: #696969;">(</span>cover/trunk/semantic t1 <span style="color: #696969;">(</span>trunk-&gt;trunk* t2 e<span style="color: #696969;">)</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">about var</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/var v<span style="color: #B380A8;">}</span> __<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/var v e<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>d . __<span style="color: #696969;">)</span> __ __<span style="color: #B380A8;">}}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow a<span style="color: #B380A8;">}</span>
              <span style="color: #696969;">(</span>cover/trunk/semantic
               <span style="color: #B380A8;">{</span>a1 <span style="color: #B380A8;">{</span>'tody/arrow-list <span style="color: #B380A8;">{</span>a<span style="color: #B380A8;">}}</span> dl1 i1<span style="color: #B380A8;">}</span> t2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>a al<span style="color: #B380A8;">}}</span>
              <span style="color: #696969;">(</span>cover/trunk/semantic
               <span style="color: #B380A8;">{</span>a1 <span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span> dl1 i1<span style="color: #B380A8;">}</span> t2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span>__
              <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>cover/trunk/semantic
                        a var computes to neither arrow nor lambda
                        <span style="color: #696969;">(</span>var: ,v<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ <span style="color: #B380A8;">{</span>'tody/var v<span style="color: #B380A8;">}}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/var v e<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>d . __<span style="color: #696969;">)</span> __ __<span style="color: #B380A8;">}}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow a<span style="color: #B380A8;">}</span>
              <span style="color: #696969;">(</span>cover/trunk/semantic
               t1 <span style="color: #B380A8;">{</span>a2 <span style="color: #B380A8;">{</span>'tody/arrow-list <span style="color: #B380A8;">{</span>a<span style="color: #B380A8;">}}</span> dl2 i2<span style="color: #B380A8;">}</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>a al<span style="color: #B380A8;">}}</span>
              <span style="color: #696969;">(</span>cover/trunk/semantic
               t1 <span style="color: #B380A8;">{</span>a2 <span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span> dl2 i2<span style="color: #B380A8;">}</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span>__
              <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>cover/trunk/semantic
                        a var computes to neither arrow nor lambda
                        <span style="color: #696969;">(</span>var: ,v<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">about arrow-list</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/arrow-list al1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/arrow-list al2<span style="color: #B380A8;">}}</span>
        <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">recur to cover/data</span>
        <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">only when at least one of the trunk is reducible</span>
        <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">and if the arguments of this recur are both trunk</span>
        <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">one of them may still be reducible</span>
        <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">thus will get in to this branch again</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>filter-arrow-list al1 dl1 e<span style="color: #696969;">)</span>
                <span style="color: #696969;">(</span>filter-arrow-list al2 dl2 e<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>l1 l2<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">or</span> <span style="color: #696969;">(</span>eq? 1 <span style="color: #696969;">(</span>length l1<span style="color: #696969;">))</span> <span style="color: #696969;">(</span>eq? 1 <span style="color: #696969;">(</span>length l2<span style="color: #696969;">))))</span>
             <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>cover/trunk/semantic
                       fail both trunks are non-reducible
                       <span style="color: #696969;">(</span>trunk1: ,t1<span style="color: #696969;">)</span>
                       <span style="color: #696969;">(</span>trunk2: ,t2<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>compute/trunk t1 e<span style="color: #696969;">)</span>
                     <span style="color: #696969;">(</span>compute/trunk t2 e<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>d1 . __<span style="color: #696969;">)</span> __ __<span style="color: #B380A8;">}}</span>
                 <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>d2 . __<span style="color: #696969;">)</span> __ __<span style="color: #B380A8;">}}}</span>
                <span style="color: #696969;">(</span>cat <span style="color: #696969;">(</span><span style="color: #e6db74;">"&lt;cover&gt;~%"</span><span style="color: #696969;">))</span>
                <span style="color: #696969;">(</span>cover/data d1 d2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ __<span style="color: #B380A8;">}</span>
                <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>cover/trunk/semantic
                          fail to compute/trunk one of the trunks
                          <span style="color: #696969;">(</span>trunk1: ,t1<span style="color: #696969;">)</span>
                          <span style="color: #696969;">(</span>trunk2: ,t2<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org846d936" class="outline-3">
<h3 id="org846d936">cover/trunk/data</h3>
<div class="outline-text-3" id="text-org846d936">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover/trunk/data</span> t d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/trunk t e<span style="color: #696969;">)</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
     <span style="color: #B380A8;">{</span>'fail <span style="color: #696969;">(</span>cons `<span style="color: #696969;">(</span>cover/trunk/data
                    <span style="color: #696969;">(</span>trunk: ,t<span style="color: #696969;">)</span>
                    <span style="color: #696969;">(</span>data: ,d<span style="color: #696969;">))</span>
                  il<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>env/pop e1<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'trunk t1<span style="color: #B380A8;">}</span> e2<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>cover/trunk/data
                  <span style="color: #696969;">(</span>trunk: ,t<span style="color: #696969;">)</span>
                  compute to
                  <span style="color: #696969;">(</span>trunk: ,t1<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>d1 e2<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>cover/data d1 d e2<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb84caae" class="outline-2">
<h2 id="orgb84caae">bind-unify</h2>
<div class="outline-text-2" id="text-orgb84caae">
</div><div id="outline-container-org870062" class="outline-3">
<h3 id="org870062">bind-unify/data-list</h3>
<div class="outline-text-3" id="text-org870062">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">bind-unify/data-list</span> pl dl r<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>pattern ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> report <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> r
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">cond</span> <span style="color: #797979;">[</span><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>eq? pl '<span style="color: #696969;">())</span> <span style="color: #696969;">(</span>eq? dl '<span style="color: #696969;">()))</span>
            r<span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span><span style="color: #696969;">(</span>eq? pl <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span>
            <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>bind-unify/data-list
                      fail pl and dl is not of the same length
                      <span style="color: #696969;">(</span>additional-dl: ,dl<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span><span style="color: #696969;">(</span>eq? dl <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span>
            <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>bind-unify/data-list
                      fail pl and dl is not of the same length
                      <span style="color: #696969;">(</span>additional-pl: ,pl<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span>else
            <span style="color: #696969;">(</span>bind-unify/data-list
             <span style="color: #696969;">(</span>cdr pl<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>cdr dl<span style="color: #696969;">)</span>
             <span style="color: #696969;">(</span>bind-unify/data <span style="color: #696969;">(</span>car pl<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>car dl<span style="color: #696969;">)</span> e<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org85bfe31" class="outline-3">
<h3 id="org85bfe31">bind-unify/data</h3>
<div class="outline-text-3" id="text-org85bfe31">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">bind-unify/data</span> p d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> pattern data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">var -walk-&gt; fresh-var</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>p <span style="color: #696969;">(</span>bs/walk bs p<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span>d <span style="color: #696969;">(</span>bs/walk bs d<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>p d<span style="color: #B380A8;">}</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'bind <span style="color: #B380A8;">{</span>v __<span style="color: #B380A8;">}}</span> __<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>unify/var/data v d e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ __<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4e41a98" class="outline-2">
<h2 id="org4e41a98">eva</h2>
<div class="outline-text-2" id="text-org4e41a98">
</div><div id="outline-container-orge6799e3" class="outline-3">
<h3 id="orge6799e3">init-env</h3>
<div class="outline-text-3" id="text-orge6799e3">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #a6e22e;">init-env</span>
  '<span style="color: #696969;">(()</span>
    <span style="color: #696969;">()</span>
    <span style="color: #696969;">((</span><span style="color: #f92672; font-weight: bold;">type</span> . <span style="color: #696969;">(</span>cons/type <span style="color: #696969;">((()</span>
                          <span style="color: #696969;">((</span>cons <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> <span style="color: #696969;">()))))</span>
                         type
                         type<span style="color: #696969;">))))))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org36ccf4d" class="outline-3">
<h3 id="org36ccf4d">eva</h3>
<div class="outline-text-3" id="text-org36ccf4d">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define-macro</span> <span style="color: #696969;">(</span><span style="color: #fd971f;">eva</span> . body<span style="color: #696969;">)</span>
  `<span style="color: #696969;">(</span>eva/top-list
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> parse/top
      <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">quote</span> ,<span style="color: #696969;">(</span>flower-barcket <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>dl<span style="color: #696969;">)</span>
                                <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>vector 'flower-barcket/in-eva<span style="color: #696969;">)</span>
                                      dl<span style="color: #696969;">))</span>
                              body<span style="color: #696969;">)))</span>
    init-env<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge4e280d" class="outline-3">
<h3 id="orge4e280d">eva/top-list</h3>
<div class="outline-text-3" id="text-orge4e280d">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">eva/top-list</span> tl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>top ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> tl
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> e<span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>t . r<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>eva/top-list r <span style="color: #696969;">(</span>eva/top t e<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd7147f0" class="outline-3">
<h3 id="orgd7147f0">parse/top</h3>
<div class="outline-text-3" id="text-orgd7147f0">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">parse/top</span> s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> sexp-top <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> top<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> s
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>'+ n a . body<span style="color: #696969;">)</span>
     <span style="color: #B380A8;">{</span>'+ <span style="color: #B380A8;">{{</span>n a<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>parse/top/deftype-body body<span style="color: #696969;">)</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>'~ n a . al<span style="color: #696969;">)</span>
     <span style="color: #B380A8;">{</span>'~ <span style="color: #B380A8;">{{</span>n a<span style="color: #B380A8;">}</span> al<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'app a<span style="color: #B380A8;">}</span>
     <span style="color: #B380A8;">{</span>'app a<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgecefce7" class="outline-3">
<h3 id="orgecefce7">parse/top/deftype-body</h3>
<div class="outline-text-3" id="text-orgecefce7">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">parse/top/deftype-body</span> body<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> deftype-body <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">((</span>form1/name form1/arrow<span style="color: #696969;">)</span> ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">cond</span> <span style="color: #797979;">[</span><span style="color: #696969;">(</span>eq? '<span style="color: #696969;">()</span> body<span style="color: #696969;">)</span> '<span style="color: #696969;">()</span><span style="color: #797979;">]</span>
        <span style="color: #797979;">[</span><span style="color: #696969;">(</span>eq? '<span style="color: #696969;">()</span> <span style="color: #696969;">(</span>cdr body<span style="color: #696969;">))</span>
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'parse/top/deftype-body <span style="color: #696969;">(</span><span style="color: #e6db74;">"wrong body : ~a~%"</span> body<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
        <span style="color: #797979;">[</span>else
         <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>car body<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>cadr body<span style="color: #696969;">))</span>
               <span style="color: #696969;">(</span>parse/top/deftype-body <span style="color: #696969;">(</span>cddr body<span style="color: #696969;">)))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf1b54ee" class="outline-3">
<h3 id="orgf1b54ee">eva/top</h3>
<div class="outline-text-3" id="text-orgf1b54ee">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">eva/top</span> t e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> top env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> t
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'+ deftype<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>eva/deftype deftype e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'~ defn<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>eva/defn defn e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'app a<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>eva/app a e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5ed52f0" class="outline-3">
<h3 id="org5ed52f0">form1/arrow-&gt;arrow</h3>
<div class="outline-text-3" id="text-org5ed52f0">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">form1/arrow-&gt;arrow</span> a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form1/arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> arrow<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/arrow <span style="color: #696969;">(</span>pass1/arrow 0 a<span style="color: #696969;">)</span> <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a1 s<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>pass3/get-arrow a1 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge28f595" class="outline-3">
<h3 id="orge28f595">form1/arrow-&gt;arrow-check</h3>
<div class="outline-text-3" id="text-orge28f595">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">form1/arrow-&gt;arrow-check</span> ta a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form1/arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> arrow<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/arrow <span style="color: #696969;">(</span>pass1/arrow 0 a<span style="color: #696969;">)</span> <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a1 s<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>pass3/get-arrow-check ta a1 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org50336e2" class="outline-3">
<h3 id="org50336e2">eva/app</h3>
<div class="outline-text-3" id="text-org50336e2">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">eva/app</span> a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form1/arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>a0 <span style="color: #696969;">(</span>form1/arrow-&gt;arrow a e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/arrow a0 e<span style="color: #696969;">)</span>
      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span> e1<span style="color: #797979;">]</span>
      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
       <span style="color: #696969;">(</span>cat <span style="color: #696969;">(</span><span style="color: #e6db74;">"eva/app fail~%"</span><span style="color: #696969;">))</span>
       <span style="color: #696969;">(</span>pretty-print il<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>cat <span style="color: #696969;">(</span><span style="color: #e6db74;">"~%"</span><span style="color: #696969;">))</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'eva/ap <span style="color: #696969;">(</span><span style="color: #e6db74;">"end of report~%"</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org548d6d6" class="outline-3">
<h3 id="org548d6d6">eva/deftype</h3>
<div class="outline-text-3" id="text-org548d6d6">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">eva/deftype</span> deftype e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">((</span>form1/name form1/arrow<span style="color: #696969;">)</span> <span style="color: #696969;">((</span>form1/name form1/arrow<span style="color: #696969;">)</span> ...<span style="color: #696969;">))</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> deftype
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>n a<span style="color: #B380A8;">}</span> nal<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>nl <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> car nal<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span>a0 <span style="color: #696969;">(</span>form1/arrow-&gt;arrow a e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span>ns1 <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>cons n
                                <span style="color: #B380A8;">{</span>'cons/type <span style="color: #B380A8;">{</span>a0 n nl<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
                          ns<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span>eva/deftype/data-constructor-list n nal <span style="color: #B380A8;">{</span>ds bs ns1<span style="color: #B380A8;">}</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">eva/deftype/data-constructor</span> type-name na e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> name <span style="color: #696969;">(</span>form1/name form1/arrow<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> na
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>n a<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>a0 <span style="color: #696969;">(</span>form1/arrow-&gt;arrow a e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #B380A8;">{</span>ds
           bs
           <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>cons n <span style="color: #B380A8;">{</span>'cons/data <span style="color: #B380A8;">{</span>a0 n type-name<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
                 ns<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">eva/deftype/data-constructor-list</span> type-name nal e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> name <span style="color: #696969;">((</span>form1/name form1/arrow<span style="color: #696969;">)</span> ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> nal
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> e<span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>na . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>eva/deftype/data-constructor-list
      type-name r
      <span style="color: #696969;">(</span>eva/deftype/data-constructor type-name na e<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2d6e5f5" class="outline-3">
<h3 id="org2d6e5f5">cover-check? &amp; cover-check- &amp; cover-check+</h3>
<div class="outline-text-3" id="text-org2d6e5f5">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #a6e22e;">cover-check?</span> #t<span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover-check-</span><span style="color: #696969;">)</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">set!</span> cover-check? #f<span style="color: #696969;">)</span> #f<span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover-check+</span><span style="color: #696969;">)</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">set!</span> cover-check? #t<span style="color: #696969;">)</span> #t<span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge456b5a" class="outline-3">
<h3 id="orge456b5a">recur-check? &amp; recur-check- &amp; recur-check+</h3>
<div class="outline-text-3" id="text-orge456b5a">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #a6e22e;">recur-check?</span> #t<span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">recur-check-</span><span style="color: #696969;">)</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">set!</span> recur-check? #f<span style="color: #696969;">)</span> #f<span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">recur-check+</span><span style="color: #696969;">)</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">set!</span> recur-check? #t<span style="color: #696969;">)</span> #t<span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org23070fc" class="outline-3">
<h3 id="org23070fc">eva/defn</h3>
<div class="outline-text-3" id="text-org23070fc">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">eva/defn</span> defn e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">((</span>form1/name form1/arrow<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>form1/arrow ...<span style="color: #696969;">))</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> defn
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>n a<span style="color: #B380A8;">}</span> al<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>a0 <span style="color: #696969;">(</span>form1/arrow-&gt;arrow a e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">need to put the type into ns first</span>
               <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">for recursive call in arrow-list</span>
               <span style="color: #797979;">[</span>ns0 <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>cons n <span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>a0 'placeholder<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span> ns<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span>l1 <span style="color: #B380A8;">{</span>a0 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span>
                              <span style="color: #696969;">(</span>form1/arrow-&gt;arrow-check
                               a0 x <span style="color: #B380A8;">{</span>ds bs ns0<span style="color: #B380A8;">}</span><span style="color: #696969;">))</span>
                         al<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span>ns1 <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>cons n <span style="color: #B380A8;">{</span>'lambda l1<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span> ns<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span>e1 <span style="color: #B380A8;">{</span>ds bs ns1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> cover-check?
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>cover-check l1 e1<span style="color: #696969;">)</span>
              <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'eva/defn
                            <span style="color: #696969;">(</span><span style="color: #e6db74;">"info-list :~%~a~%"</span> il<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
              <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span> 'ok<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> recur-check?
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>recur-check n l1 e1<span style="color: #696969;">)</span>
              <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'eva/defn
                            <span style="color: #696969;">(</span><span style="color: #e6db74;">"info-list :~%~a~%"</span> il<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
              <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span> 'ok<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
          e1<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2a95571" class="outline-2">
<h2 id="org2a95571">sequent</h2>
<div class="outline-text-2" id="text-org2a95571">
</div><div id="outline-container-orgcec7ec4" class="outline-3">
<h3 id="orgcec7ec4">sequent</h3>
<div class="outline-text-3" id="text-orgcec7ec4">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">sequent</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #797979;">[</span>loop<span style="color: #797979;">]</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>cat <span style="color: #696969;">(</span><span style="color: #e6db74;">"welcome to sequent ^-^/~%"</span><span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span>sequent/repl init-env<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org917e1af" class="outline-3">
<h3 id="org917e1af"><span class="todo _gt__lt_">&gt;&lt;</span> sequent/repl</h3>
<div class="outline-text-3" id="text-org917e1af">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">sequent/repl</span> e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #797979;">[</span>loop<span style="color: #797979;">]</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>top <span style="color: #696969;">(</span>read<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span>e1 <span style="color: #696969;">(</span>eva/top <span style="color: #696969;">(</span>parse/top top<span style="color: #696969;">)</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e1
      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds1 bs1 ns1<span style="color: #B380A8;">}</span>
       <span style="color: #696969;">(</span>print/data-list ds1 e1<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>newline<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>sequent/repl e1<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6456cc5" class="outline-2">
<h2 id="org6456cc5">type-compute</h2>
<div class="outline-text-2" id="text-org6456cc5">
</div><div id="outline-container-org4a2cbdd" class="outline-3">
<h3 id="org4a2cbdd">type-compute/cedent</h3>
<div class="outline-text-3" id="text-org4a2cbdd">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-compute/cedent</span> c e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cedent env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>d . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-compute d e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>type-compute/cedent r e1<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga583f7d" class="outline-3">
<h3 id="orga583f7d">type-compute</h3>
<div class="outline-text-3" id="text-orga583f7d">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-compute</span> d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>type-compute/var x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>type-compute/cons x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>type-compute/arrow x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>type-compute/lambda x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'trunk x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>type-compute/trunk x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'bind x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>type-compute/bind x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd0f525c" class="outline-3">
<h3 id="orgd0f525c">type-compute/var</h3>
<div class="outline-text-3" id="text-orgd0f525c">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-compute/var</span> v e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> var env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> v
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span>compute/var <span style="color: #B380A8;">{</span>id <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+</span> 1 level<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2123c72" class="outline-3">
<h3 id="org2123c72">type-compute/cons</h3>
<div class="outline-text-3" id="text-org2123c72">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-compute/cons</span> c e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cons env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>n dl<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>found <span style="color: #696969;">(</span>assq n ns<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not found<span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'type-compute/cons
              <span style="color: #696969;">(</span><span style="color: #e6db74;">"unknow name : ~a~%"</span> n<span style="color: #696969;">)</span>
              <span style="color: #696969;">(</span><span style="color: #e6db74;">"cons : ~a~%"</span> c<span style="color: #696969;">))</span>
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>meaning <span style="color: #696969;">(</span>cdr found<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> meaning
                <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>any-type <span style="color: #696969;">(</span>t . __<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span>
                 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-compute/cedent <span style="color: #696969;">(</span>reverse dl<span style="color: #696969;">)</span> e<span style="color: #696969;">)</span>
                   <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
                   <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
                    <span style="color: #696969;">(</span>compute/arrow <span style="color: #696969;">(</span>copy-arrow t<span style="color: #696969;">)</span> e1<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdf0da11" class="outline-3">
<h3 id="orgdf0da11">type-compute/arrow</h3>
<div class="outline-text-3" id="text-orgdf0da11">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-compute/arrow</span> a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy-arrow a<span style="color: #696969;">)</span>
       <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">need to copy the arrow first</span>
       <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">because the return arrow might be applied somewhere else</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-compute/cedent ac <span style="color: #B380A8;">{{}</span> <span style="color: #696969;">(</span>cons '<span style="color: #696969;">(</span>commit-point<span style="color: #696969;">)</span> bs<span style="color: #696969;">)</span> ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds1 bs1 ns1<span style="color: #B380A8;">}}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-compute/cedent sc <span style="color: #B380A8;">{{}</span> bs1 ns1<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds2 bs2 ns2<span style="color: #B380A8;">}}</span>
              <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons <span style="color: #B380A8;">{</span>'arrow <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>reverse ds1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>reverse ds2<span style="color: #696969;">)</span><span style="color: #B380A8;">}}</span>
                               ds<span style="color: #696969;">)</span>
                         <span style="color: #696969;">(</span>bs/commit! bs2<span style="color: #696969;">)</span>
                         ns2<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge40a9a" class="outline-3">
<h3 id="orge40a9a">type-compute/lambda</h3>
<div class="outline-text-3" id="text-orge40a9a">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-compute/lambda</span> l e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> lambda env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> l
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a al<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons <span style="color: #B380A8;">{</span>'arrow a<span style="color: #B380A8;">}</span> ds<span style="color: #696969;">)</span>
                   bs
                   ns<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9f2eb91" class="outline-3">
<h3 id="org9f2eb91">type-compute/trunk</h3>
<div class="outline-text-3" id="text-org9f2eb91">
<ul class="org-ul">
<li><p>note the use of bind-unify/data-list here</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-compute/trunk</span> t e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> t
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a __ dl i<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>a <span style="color: #696969;">(</span>copy-arrow a<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>bind-unify/data-list
                     ac <span style="color: #696969;">(</span>reverse dl<span style="color: #696969;">)</span>
                     <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}}</span>
                <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-compute/cedent <span style="color: #696969;">(</span>reverse dl<span style="color: #696969;">)</span> <span style="color: #B380A8;">{{}</span> bs ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
                  <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
                  <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
                   <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e1
                     <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds1 bs1 ns1<span style="color: #B380A8;">}</span>
                      <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/arrow a e1<span style="color: #696969;">)</span>
                        <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
                        <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds2 bs2 ns2<span style="color: #B380A8;">}}</span>
                         <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>proj i <span style="color: #B380A8;">{</span>ds2 bs2 ns2<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span> ds<span style="color: #696969;">)</span>
                                    bs2
                                    ns2<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4f2f7b8" class="outline-3">
<h3 id="org4f2f7b8">type-compute/bind</h3>
<div class="outline-text-3" id="text-org4f2f7b8">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-compute/bind</span> b e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> bind env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> b
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ d<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>type-compute d e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgbab1cda" class="outline-2">
<h2 id="orgbab1cda">type-solve</h2>
<div class="outline-text-2" id="text-orgbab1cda">
</div><div id="outline-container-org949ac12" class="outline-3">
<h3 id="org949ac12">type-solve/cedent</h3>
<div class="outline-text-3" id="text-org949ac12">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-solve/cedent</span> c e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cedent env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>d . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-solve d e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>type-solve/cedent r e1<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org47a25ec" class="outline-3">
<h3 id="org47a25ec">type-solve</h3>
<div class="outline-text-3" id="text-org47a25ec">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-solve</span> d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>type-solve/var x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>type-solve/cons x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>type-solve/arrow x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>type-solve/lambda x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'trunk x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>type-solve/trunk x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'bind x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>type-solve/bind x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7c7970e" class="outline-3">
<h3 id="org7c7970e">type-solve/var</h3>
<div class="outline-text-3" id="text-org7c7970e">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-solve/var</span> v e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> var env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> v
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span>compute/var <span style="color: #B380A8;">{</span>id <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+</span> 1 level<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org376bea8" class="outline-3">
<h3 id="org376bea8">type-solve/cons</h3>
<div class="outline-text-3" id="text-org376bea8">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-solve/cons</span> c e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cons env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>n dl<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>found <span style="color: #696969;">(</span>assq n ns<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not found<span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'type-solve/cons
              <span style="color: #696969;">(</span><span style="color: #e6db74;">"unknow name : ~a~%"</span> n<span style="color: #696969;">)</span>
              <span style="color: #696969;">(</span><span style="color: #e6db74;">"cons : ~a~%"</span> c<span style="color: #696969;">))</span>
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>meaning <span style="color: #696969;">(</span>cdr found<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> meaning
                <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>any-type <span style="color: #696969;">(</span>t . __<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span>
                 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-solve/cedent <span style="color: #696969;">(</span>reverse dl<span style="color: #696969;">)</span> e<span style="color: #696969;">)</span>
                   <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
                   <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
                    <span style="color: #696969;">(</span>solve/arrow <span style="color: #696969;">(</span>copy-arrow t<span style="color: #696969;">)</span> e1<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7cd316a" class="outline-3">
<h3 id="org7cd316a">type-solve/arrow</h3>
<div class="outline-text-3" id="text-org7cd316a">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-solve/arrow</span> a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy-arrow a<span style="color: #696969;">)</span>
       <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">need to copy the arrow first</span>
       <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">because the return arrow might be applied somewhere else</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-solve/cedent ac <span style="color: #B380A8;">{{}</span> <span style="color: #696969;">(</span>cons '<span style="color: #696969;">(</span>commit-point<span style="color: #696969;">)</span> bs<span style="color: #696969;">)</span> ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds1 bs1 ns1<span style="color: #B380A8;">}}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-solve/cedent sc <span style="color: #B380A8;">{{}</span> bs1 ns1<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds2 bs2 ns2<span style="color: #B380A8;">}}</span>
              <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons <span style="color: #B380A8;">{</span>'arrow <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>reverse ds1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>reverse ds2<span style="color: #696969;">)</span><span style="color: #B380A8;">}}</span>
                               ds<span style="color: #696969;">)</span>
                         <span style="color: #696969;">(</span>bs/commit! bs2<span style="color: #696969;">)</span>
                         ns2<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4b64064" class="outline-3">
<h3 id="org4b64064">type-solve/lambda</h3>
<div class="outline-text-3" id="text-org4b64064">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-solve/lambda</span> l e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> lambda env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> l
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a al<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons <span style="color: #B380A8;">{</span>'arrow a<span style="color: #B380A8;">}</span> ds<span style="color: #696969;">)</span>
                   bs
                   ns<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org22ba326" class="outline-3">
<h3 id="org22ba326">type-solve/trunk</h3>
<div class="outline-text-3" id="text-org22ba326">
<ul class="org-ul">
<li><p>note the use of bind-unify/data-list here</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-solve/trunk</span> t e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> t
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a __ dl i<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>a <span style="color: #696969;">(</span>copy-arrow a<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>bind-unify/data-list
                     ac <span style="color: #696969;">(</span>reverse dl<span style="color: #696969;">)</span>
                     <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}}</span>
                <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-solve/cedent <span style="color: #696969;">(</span>reverse dl<span style="color: #696969;">)</span> <span style="color: #B380A8;">{{}</span> bs ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
                  <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
                  <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
                   <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e1
                     <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds1 bs1 ns1<span style="color: #B380A8;">}</span>
                      <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>solve/arrow a e1<span style="color: #696969;">)</span>
                        <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
                        <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds2 bs2 ns2<span style="color: #B380A8;">}}</span>
                         <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>proj i <span style="color: #B380A8;">{</span>ds2 bs2 ns2<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span> ds<span style="color: #696969;">)</span>
                                    bs2
                                    ns2<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org361a145" class="outline-3">
<h3 id="org361a145">type-solve/bind</h3>
<div class="outline-text-3" id="text-org361a145">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-solve/bind</span> b e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> bind env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> b
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ d<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>type-solve d e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5c3e9c2" class="outline-2">
<h2 id="org5c3e9c2">infer</h2>
<div class="outline-text-2" id="text-org5c3e9c2">
</div><div id="outline-container-orgb22cbba" class="outline-3">
<h3 id="orgb22cbba">infer/arrow</h3>
<div class="outline-text-3" id="text-orgb22cbba">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">infer/arrow</span> a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> arrow<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-solve/arrow a e<span style="color: #696969;">)</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'infer/arrow
       <span style="color: #696969;">(</span><span style="color: #e6db74;">"fail to type-solve/arrow : ~a~%"</span> a<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #e6db74;">"reported info-list : ~a~%"</span> il<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>a1 . __<span style="color: #696969;">)</span> __ __<span style="color: #B380A8;">}}</span>
     a1<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org19f88bd" class="outline-3">
<h3 id="org19f88bd">infer/arrow-list</h3>
<div class="outline-text-3" id="text-org19f88bd">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">infer/arrow-list</span> al e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> arrow<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>unite/arrow-list
   <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>infer/arrow x e<span style="color: #696969;">))</span> al<span style="color: #696969;">)</span>
   e<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2b60303" class="outline-3">
<h3 id="org2b60303">unite/arrow-list</h3>
<div class="outline-text-3" id="text-org2b60303">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unite/arrow-list</span> al e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> arrow<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">letrec</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>recur
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>a l<span style="color: #696969;">)</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> arrow<span style="color: #696969;">)</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> l
                <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> a<span style="color: #797979;">]</span>
                <span style="color: #797979;">[</span><span style="color: #696969;">(</span>h . r<span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span>recur <span style="color: #696969;">(</span>unite/two a h e<span style="color: #696969;">)</span> r<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span>recur <span style="color: #696969;">(</span>car al<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>cdr al<span style="color: #696969;">))))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2b9606c" class="outline-3">
<h3 id="org2b9606c">unite/two</h3>
<div class="outline-text-3" id="text-org2b9606c">
<ul class="org-ul">
<li><p>this is the meet operation of the subsumption lattice of arrow</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unite/two</span> a1 a2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> arrow<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>a1 a2<span style="color: #B380A8;">}</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>ac1 sc1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>ac2 sc2<span style="color: #B380A8;">}}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>ac1 <span style="color: #696969;">(</span>copy-arrow ac1<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
              <span style="color: #797979;">[</span>sc1 <span style="color: #696969;">(</span>copy-arrow sc1<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
              <span style="color: #797979;">[</span>ac2 <span style="color: #696969;">(</span>copy-arrow ac2<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
              <span style="color: #797979;">[</span>sc2 <span style="color: #696969;">(</span>copy-arrow sc2<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>unify/data-list
                  ac1 ac2
                  <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{{}</span> <span style="color: #696969;">(</span>cons '<span style="color: #696969;">(</span>commit-point<span style="color: #696969;">)</span> bs<span style="color: #696969;">)</span> ns<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'unite/two
                          <span style="color: #696969;">(</span><span style="color: #e6db74;">"fail to unify antecedent~%"</span><span style="color: #696969;">)</span>
                          <span style="color: #696969;">(</span><span style="color: #e6db74;">"ac1 : ~a~%"</span> ac1<span style="color: #696969;">)</span>
                          <span style="color: #696969;">(</span><span style="color: #e6db74;">"ac2 : ~a~%"</span> ac2<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>__ bs1 ns1<span style="color: #B380A8;">}}</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>unify/data-list
                     sc1 sc2
                     <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{{}</span> bs1 ns1<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'unite/two
                             <span style="color: #696969;">(</span><span style="color: #e6db74;">"fail to unify succedent~%"</span><span style="color: #696969;">)</span>
                             <span style="color: #696969;">(</span><span style="color: #e6db74;">"sc1 : ~a~%"</span> sc1<span style="color: #696969;">)</span>
                             <span style="color: #696969;">(</span><span style="color: #e6db74;">"sc2 : ~a~%"</span> sc2<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds2 bs2 ns2<span style="color: #B380A8;">}}</span>
                <span style="color: #696969;">(</span>bs/commit! bs2<span style="color: #696969;">)</span>
                <span style="color: #B380A8;">{</span>ac1 sc1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org110531c" class="outline-2">
<h2 id="org110531c">cover-check</h2>
<div class="outline-text-2" id="text-org110531c">
</div><div id="outline-container-orge8aaaaa" class="outline-3">
<h3 id="orge8aaaaa"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-orge8aaaaa">
<ul class="org-ul">
<li><p>first data-gen</p><p>of type (: type-antecedent (antecedent &#x2026;) env -&gt; (cedent (bs &#x2026;)))</p></li></ul>
</div>
</div>

<div id="outline-container-org9916ae9" class="outline-3">
<h3 id="org9916ae9">cover-check</h3>
<div class="outline-text-3" id="text-org9916ae9">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover-check</span> l e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> lambda env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> l
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>ac __<span style="color: #B380A8;">}</span> al<span style="color: #B380A8;">}</span>
        <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">no cover-check on sc</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>data-gen ac <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> car al<span style="color: #696969;">)</span> e<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>c bsl<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>report-list
                  <span style="color: #696969;">(</span>filter
                   <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>r<span style="color: #696969;">)</span>
                     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> r
                       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail __<span style="color: #B380A8;">}</span> #t<span style="color: #797979;">]</span>
                       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span> #f<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
                   <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>bs0<span style="color: #696969;">)</span>
                          <span style="color: #696969;">(</span>cover-check/cedent/arrow-list
                           c al
                           <span style="color: #B380A8;">{</span>ds <span style="color: #696969;">(</span>append bs0 bs<span style="color: #696969;">)</span> ns<span style="color: #B380A8;">}</span><span style="color: #696969;">))</span>
                     bsl<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>null? report-list<span style="color: #696969;">)</span>
               <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span>
               <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>cover-check
                         fail
                         <span style="color: #696969;">(</span>report-list: ,report-list<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org20b48b2" class="outline-3">
<h3 id="org20b48b2">cover-check/cedent/arrow-list</h3>
<div class="outline-text-3" id="text-org20b48b2">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover-check/cedent/arrow-list</span> c al e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cedent <span style="color: #696969;">(</span>cedent ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>report-list
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>a<span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span>cover-check/cedent c <span style="color: #696969;">(</span>car a<span style="color: #696969;">)</span> e<span style="color: #696969;">))</span>
            al<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span>good-report-list
          <span style="color: #696969;">(</span>filter <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>report<span style="color: #696969;">)</span>
                    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> report
                      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span> #t<span style="color: #797979;">]</span>
                      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail __<span style="color: #B380A8;">}</span> #t<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
                  report-list<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>null? good-report-list<span style="color: #696969;">)</span>
      <span style="color: #696969;">(</span>list 'fail
            <span style="color: #696969;">(</span>list
             `<span style="color: #696969;">(</span>cover-check/cedent/arrow-list
               fail
               <span style="color: #696969;">(</span>report-list: ,report-list<span style="color: #696969;">))))</span>
      <span style="color: #696969;">(</span>list 'success e<span style="color: #696969;">))))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5d9474f" class="outline-3">
<h3 id="org5d9474f">cover-check/cedent</h3>
<div class="outline-text-3" id="text-org5d9474f">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover-check/cedent</span> c1 c2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cedent cedent env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>cover/data-list c1 c2 <span style="color: #696969;">(</span>list 'success e<span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdfb8ddb" class="outline-3">
<h3 id="orgdfb8ddb"><span class="todo note">note</span> alterdata</h3>
<div class="outline-text-3" id="text-orgdfb8ddb">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> alterdata
  <span style="color: #B380A8;">{</span>'altervar <span style="color: #696969;">(</span>var . <span style="color: #B380A8;">{</span>alterdata ...<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #B380A8;">}</span>
  <span style="color: #B380A8;">{</span>'cons   <span style="color: #B380A8;">{</span>name <span style="color: #B380A8;">{</span>alterdata ...<span style="color: #B380A8;">}}}</span>
  <span style="color: #B380A8;">{</span>'arrow  <span style="color: #B380A8;">{</span>cedent cedent<span style="color: #B380A8;">}}</span>
  <span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>arrow <span style="color: #B380A8;">{</span>arrow ...<span style="color: #B380A8;">}}}</span>
  <span style="color: #B380A8;">{</span>'trunk  <span style="color: #B380A8;">{</span>arrow tody <span style="color: #B380A8;">{</span>data ...<span style="color: #B380A8;">}</span> index<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3e82462" class="outline-3">
<h3 id="org3e82462">data-gen</h3>
<div class="outline-text-3" id="text-org3e82462">
<ul class="org-ul">
<li><p>this can be viewed as the reverse of infer</p><p>it generate data from type</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">data-gen</span> ac acl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> antecedent <span style="color: #696969;">(</span>antecedent ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>cedent <span style="color: #696969;">(</span>bs ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>alter-expand <span style="color: #696969;">(</span>data-gen/cedent ac acl e<span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaba5414" class="outline-3">
<h3 id="orgaba5414">alter-expand</h3>
<div class="outline-text-3" id="text-orgaba5414">
</div><div id="outline-container-org123f6ef" class="outline-4">
<h4 id="org123f6ef">alter-expand</h4>
<div class="outline-text-4" id="text-org123f6ef">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">alter-expand</span> adl<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>alterdata ...<span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">((</span>data ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>bs ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>alter-expand/get-data-list adl<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span>alter-expand/alterdata-list adl<span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfae63b7" class="outline-4">
<h4 id="orgfae63b7">alter-expand/get-data-list &amp; alter-expand/get-data</h4>
<div class="outline-text-4" id="text-orgfae63b7">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">alter-expand/get-data-list</span> adl<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>alterdata ...<span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> adl
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>ad . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>alter-expand/get-data ad<span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span>alter-expand/get-data-list r<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">alter-expand/get-data</span> ad<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> alterdata <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> data<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> ad
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'altervar <span style="color: #696969;">(</span>v . __<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span>__ <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'alter-expand/get-data
          <span style="color: #696969;">(</span><span style="color: #e6db74;">"alterdata is not altervar : ~a~%"</span> ad<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge2574a3" class="outline-4">
<h4 id="orge2574a3">alter-expand/alterdata-list</h4>
<div class="outline-text-4" id="text-orge2574a3">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">alter-expand/alterdata-list</span> adl<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>alterdata ...<span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>bs ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> adl
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{{}}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span><span style="color: #B380A8;">{</span>'altervar <span style="color: #696969;">(</span>v . adl<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span> . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>alter-expand/more
      v adl
      <span style="color: #696969;">(</span>alter-expand/alterdata-list r<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">alter-expand/more</span> v adl bsl<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> var <span style="color: #696969;">(</span>alterdata ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>bs ...<span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>bs ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>null? adl<span style="color: #696969;">)</span>
    bsl
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">apply</span> append
      <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>ad<span style="color: #696969;">)</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">apply</span> append
               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>bs<span style="color: #696969;">)</span>
                      <span style="color: #696969;">(</span>bs/extend-alter bs v ad<span style="color: #696969;">))</span>
                 bsl<span style="color: #696969;">)))</span>
        adl<span style="color: #696969;">))))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd8b9f40" class="outline-4">
<h4 id="orgd8b9f40">bs/extend-alter</h4>
<div class="outline-text-4" id="text-orgd8b9f40">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">bs/extend-alter</span> bs v ad<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> bs var alterdata <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>bs ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> ad
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons <span style="color: #B380A8;">{</span>n adl<span style="color: #B380A8;">}}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>bsl1 <span style="color: #696969;">(</span>alter-expand/alterdata-list adl<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span>bsl2 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span>
                         <span style="color: #696969;">(</span>bs/extend
                          x v
                          <span style="color: #B380A8;">{</span>'cons <span style="color: #B380A8;">{</span>n <span style="color: #696969;">(</span>alter-expand/get-data-list adl<span style="color: #696969;">)</span><span style="color: #B380A8;">}}</span><span style="color: #696969;">))</span>
                    bsl1<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span>bsl3 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span>
                         <span style="color: #696969;">(</span>append x bs<span style="color: #696969;">))</span>
                    bsl2<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       bsl3<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span>__ <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'bs/extend-alter
          <span style="color: #696969;">(</span><span style="color: #e6db74;">"alterdata is not cons : ~a~%"</span> ad<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1d76706" class="outline-3">
<h3 id="org1d76706">data-gen/cedent</h3>
<div class="outline-text-3" id="text-org1d76706">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">data-gen/cedent</span> c cl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cedent <span style="color: #696969;">(</span>cedent ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>alterdata ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>h . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>data-gen/data h <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> car cl<span style="color: #696969;">)</span> e<span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span>data-gen/cedent r <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> cdr cl<span style="color: #696969;">)</span> e<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgccad225" class="outline-3">
<h3 id="orgccad225">data-gen/data</h3>
<div class="outline-text-3" id="text-orgccad225">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">data-gen/data</span> d dl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> data <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> alterdata<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>data-gen/var x dl e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>data-gen/cons x dl e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>data-gen/arrow x dl e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>data-gen/lambda x dl e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'trunk x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>data-gen/trunk x dl e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'bind <span style="color: #B380A8;">{</span>__ d0<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>data-gen/data d0 dl e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf7522b3" class="outline-3">
<h3 id="orgf7522b3">data-gen/cons</h3>
<div class="outline-text-3" id="text-orgf7522b3">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">data-gen/cons</span> c dl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cons <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> alterdata<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>n dl0<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>found <span style="color: #696969;">(</span>assq n ns<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not found<span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'data-gen/cons
              <span style="color: #696969;">(</span><span style="color: #e6db74;">"unknow name : ~a~%"</span> n<span style="color: #696969;">))</span>
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>cdr found<span style="color: #696969;">)</span>
              <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons/data __<span style="color: #B380A8;">}</span>
               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'data-gen/cons
                 <span style="color: #696969;">(</span><span style="color: #e6db74;">"name is not type constructor but a data constructor : ~a~%"</span> n<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
              <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda __<span style="color: #B380A8;">}</span>
               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'data-gen/cons
                 <span style="color: #696969;">(</span><span style="color: #e6db74;">"name is not type constructor but a lambda : ~a~%"</span> n<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
              <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons/type <span style="color: #B380A8;">{</span>__ __ nl<span style="color: #B380A8;">}}</span>
               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>id1 <span style="color: #696969;">(</span>id/new <span style="color: #696969;">(</span>symbol-append n '<span style="color: #a6e22e;">:gen</span><span style="color: #696969;">)</span>
                                  <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons 1 <span style="color: #B380A8;">{</span>'cons c<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
                 <span style="color: #B380A8;">{</span>'altervar
                  <span style="color: #696969;">(</span>cons <span style="color: #B380A8;">{</span>id1 0<span style="color: #B380A8;">}</span>
                        <span style="color: #696969;">(</span>data-gen/alterdata-list c nl dl e<span style="color: #696969;">))</span><span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgec717d5" class="outline-3">
<h3 id="orgec717d5">data-gen/alterdata-list</h3>
<div class="outline-text-3" id="text-orgec717d5">
</div><div id="outline-container-org4514097" class="outline-4">
<h4 id="org4514097">data-gen/alterdata-list</h4>
<div class="outline-text-4" id="text-org4514097">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">data-gen/alterdata-list</span> c nl dl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cons <span style="color: #696969;">(</span>name ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>alterdata ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>list-any? <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span>
                   <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> x
                     <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>var/fresh? v e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
                     <span style="color: #797979;">[</span>__ #f<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
                 dl<span style="color: #696969;">)</span>
    '<span style="color: #696969;">()</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>nal <span style="color: #696969;">(</span>remove #f <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>n-&gt;na c x e<span style="color: #696969;">))</span> nl<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span>nadll <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>na-&gt;nadl x dl<span style="color: #696969;">))</span> nal<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span>alterdata-list <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>nadl-&gt;alterdata x e<span style="color: #696969;">))</span> nadll<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
      alterdata-list<span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org43aea6f" class="outline-4">
<h4 id="org43aea6f">n-&gt;na</h4>
<div class="outline-text-4" id="text-org43aea6f">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">n-&gt;na</span> c n e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cons name env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">or</span> #f <span style="color: #696969;">(</span>name . arrow<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>found <span style="color: #696969;">(</span>assq n ns<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not found<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'n-&gt;na
           <span style="color: #696969;">(</span><span style="color: #e6db74;">"unknow name : ~a~%"</span> n<span style="color: #696969;">))</span>
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>cdr found<span style="color: #696969;">)</span>
           <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda __<span style="color: #B380A8;">}</span>
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'n-&gt;na
              <span style="color: #696969;">(</span><span style="color: #e6db74;">"name is not data constructor but a lambda : ~a~%"</span> n<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons/type __<span style="color: #B380A8;">}</span>
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'n-&gt;na
              <span style="color: #696969;">(</span><span style="color: #e6db74;">"name is not data constructor but a type constructor : ~a~%"</span> n<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons/data <span style="color: #B380A8;">{</span>a __ __<span style="color: #B380A8;">}}</span>
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>a <span style="color: #696969;">(</span>copy-arrow a<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
                <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span>
                 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>cover/data-list
                         <span style="color: #B380A8;">{{</span>'cons c<span style="color: #B380A8;">}}</span> sc
                         <span style="color: #B380A8;">{</span>'success
                          <span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
                   <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>cat <span style="color: #696969;">(</span><span style="color: #e6db74;">"&lt;il&gt; : ~a~%"</span> il<span style="color: #696969;">))</span> #f<span style="color: #797979;">]</span>
                   <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds1 bs1 ns1<span style="color: #B380A8;">}}</span>
                    bs1
                    <span style="color: #696969;">(</span>cons n a<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd173dbc" class="outline-4">
<h4 id="orgd173dbc">na-&gt;nadl</h4>
<div class="outline-text-4" id="text-orgd173dbc">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">na-&gt;nadl</span> na dl<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>name . arrow<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span>
     <span style="color: #696969;">((</span>name . arrow<span style="color: #696969;">)</span> . <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>n <span style="color: #696969;">(</span>car na<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span>cons na
          <span style="color: #696969;">(</span>filter
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> x
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons <span style="color: #B380A8;">{</span>n1 __<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>eq? n n1<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span>__ #f<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
           dl<span style="color: #696969;">))))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1e609f" class="outline-4">
<h4 id="org1e609f">nadl-&gt;alterdata</h4>
<div class="outline-text-4" id="text-org1e609f">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">nadl-&gt;alterdata</span> nadl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">((</span>name . arrow<span style="color: #696969;">)</span> . <span style="color: #696969;">(</span>data ...<span style="color: #696969;">))</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> alterdata<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> nadl
    <span style="color: #797979;">[</span><span style="color: #696969;">((</span>n . a<span style="color: #696969;">)</span> . dl<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac __<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>null? dl<span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'nadl-&gt;alterdata
            <span style="color: #696969;">(</span><span style="color: #e6db74;">"na can not be covered~%"</span><span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span><span style="color: #e6db74;">"n : ~a~%"</span> n<span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span><span style="color: #e6db74;">"a : ~a~%"</span> a<span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span><span style="color: #e6db74;">"dl : ~a~%"</span> dl<span style="color: #696969;">))</span>
          <span style="color: #B380A8;">{</span>'cons
           <span style="color: #B380A8;">{</span>n <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>t i<span style="color: #696969;">)</span>
                     <span style="color: #696969;">(</span>data-gen/data t
                                    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>d-&gt;subd i x<span style="color: #696969;">))</span> dl<span style="color: #696969;">)</span>
                                    e<span style="color: #696969;">))</span>
                ac <span style="color: #696969;">(</span>genlist <span style="color: #696969;">(</span>length ac<span style="color: #696969;">)))</span><span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org10d7706" class="outline-4">
<h4 id="org10d7706">d-&gt;subd</h4>
<div class="outline-text-4" id="text-org10d7706">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">d-&gt;subd</span> i d<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> index data <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> data<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons <span style="color: #B380A8;">{</span>n dl<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>list-ref dl i<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span>__ <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'd-&gt;subd
          <span style="color: #696969;">(</span><span style="color: #e6db74;">"data is not cons : ~a~%"</span> d<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org82b19d6" class="outline-3">
<h3 id="org82b19d6">data-gen/var</h3>
<div class="outline-text-3" id="text-org82b19d6">
<ul class="org-ul">
<li><p>suppose we meet a fresh var</p><p>there must be a wild var in function body</p><p>to cover it</p></li>

<li><p>&gt;&lt;&gt;&lt;&gt;&lt;</p><p>if the type of the fresh var is a type constructor other than the 'type'</p><p>then it is possible to generate a list of type</p><p>from this type constructor</p><p>but I do not handle higher level var here</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">data-gen/var</span> v dl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> var <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> alterdata<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not <span style="color: #696969;">(</span>var/fresh? v e<span style="color: #696969;">))</span>
       <span style="color: #696969;">(</span>data-gen/data <span style="color: #696969;">(</span>bs/deep bs <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span> dl e<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> v
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>id1 <span style="color: #696969;">(</span>id/new <span style="color: #696969;">(</span>symbol-append
                              <span style="color: #696969;">(</span>id-&gt;name id<span style="color: #696969;">)</span>
                              ': <span style="color: #696969;">(</span>string-&gt;symbol <span style="color: #696969;">(</span>number-&gt;string level<span style="color: #696969;">))</span>
                              '<span style="color: #a6e22e;">:var-gen</span><span style="color: #696969;">)</span>
                             <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
            <span style="color: #B380A8;">{</span>'altervar <span style="color: #696969;">(</span>cons <span style="color: #B380A8;">{</span>id1 0<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc9d7134" class="outline-3">
<h3 id="orgc9d7134">data-gen/arrow</h3>
<div class="outline-text-3" id="text-orgc9d7134">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">data-gen/arrow</span> a dl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> alterdata<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>id1 <span style="color: #696969;">(</span>id/new '<span style="color: #a6e22e;">:arrow-gen</span>
                        <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons 1 <span style="color: #B380A8;">{</span>'arrow a<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #B380A8;">{</span>'altervar <span style="color: #696969;">(</span>cons <span style="color: #B380A8;">{</span>id1 0<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb991f75" class="outline-3">
<h3 id="orgb991f75">data-gen/trunk</h3>
<div class="outline-text-3" id="text-orgb991f75">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">data-gen/trunk</span> t dl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> alterdata<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>id1 <span style="color: #696969;">(</span>id/new '<span style="color: #a6e22e;">:trunk-gen</span>
                        <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons 1 <span style="color: #B380A8;">{</span>'trunk t<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #B380A8;">{</span>'altervar <span style="color: #696969;">(</span>cons <span style="color: #B380A8;">{</span>id1 0<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd90039e" class="outline-3">
<h3 id="orgd90039e">data-gen/lambda</h3>
<div class="outline-text-3" id="text-orgd90039e">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">data-gen/lambda</span> l dl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> lambda <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> alterdata<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'data-gen/lambda
    <span style="color: #696969;">(</span><span style="color: #e6db74;">"can not generate data from lambda~%"</span><span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #e6db74;">"l : ~a~%"</span> l<span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #e6db74;">"dl : ~a~%"</span> dl<span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org18e0ba2" class="outline-2">
<h2 id="org18e0ba2">recur-check</h2>
<div class="outline-text-2" id="text-org18e0ba2">
</div><div id="outline-container-orgbbe0e2e" class="outline-3">
<h3 id="orgbbe0e2e"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-orgbbe0e2e">
<ul class="org-ul">
<li><p>recur-check is done by functions of type :</p><p>data -&gt; bounded-total-order-set</p><p>to use bounded-total-order-set</p><p>is to use the infinite descent method of Fermat</p></li>

<li><p>recur-check is extensible</p><p>because a list of such functions can be used to confirm descent</p></li>

<li><p>note that</p><p>if "the halting problem is undecidable"</p><p>then we know that</p><p>for each checker</p><p>one can find a function which</p><p>will never running into infinite loop (i.e. a good function)</p><p>but can not pass the checker</p><p><ul class="org-ul"></p><p><li><p>I do not know how to prove this</p></li></ul></p></li>

<li><p>I merely provide two checkers for structural recursion</p><p>better checkers can be added</p><p>to make more good functions be able to written in this language</p></li></ul>
</div>
</div>

<div id="outline-container-org241887a" class="outline-3">
<h3 id="org241887a">licons</h3>
<div class="outline-text-3" id="text-org241887a">
</div><div id="outline-container-orgd806166" class="outline-4">
<h4 id="orgd806166"><span class="todo note">note</span> </h4>
<div class="outline-text-4" id="text-orgd806166">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> licons <span style="color: #797979;">[</span>ordered list of linearized cons<span style="color: #797979;">]</span><span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org44ed1a0" class="outline-4">
<h4 id="org44ed1a0">licons/extend-list</h4>
<div class="outline-text-4" id="text-org44ed1a0">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">licons/extend-list</span> lc dl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> licons <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> licons<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> dl
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> lc<span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>d . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>licons/extend-list <span style="color: #696969;">(</span>licons/extend lc d e<span style="color: #696969;">)</span>
                         r e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcaa593d" class="outline-4">
<h4 id="orgcaa593d">licons/extend</h4>
<div class="outline-text-4" id="text-orgcaa593d">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">licons/extend</span> lc d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> licons data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> licons<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>var/fresh? v e<span style="color: #696969;">)</span>
                   <span style="color: #696969;">(</span>licons/extend/one lc d e<span style="color: #696969;">)</span>
                   <span style="color: #696969;">(</span>licons/extend lc <span style="color: #696969;">(</span>bs/deep bs d<span style="color: #696969;">)</span> e<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons <span style="color: #B380A8;">{</span>n dl<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>licons/extend/one
                        <span style="color: #696969;">(</span>licons/extend-list lc dl e<span style="color: #696969;">)</span>
                        <span style="color: #B380A8;">{</span>'cons-name n<span style="color: #B380A8;">}</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'bind <span style="color: #B380A8;">{</span>__ d1<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>licons/extend/one lc d1 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span>__ <span style="color: #696969;">(</span>licons/extend/one lc d e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgafee341" class="outline-4">
<h4 id="orgafee341">licons/extend/one</h4>
<div class="outline-text-4" id="text-orgafee341">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">licons/extend/one</span> lc d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> licons data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> licons<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> lc
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{</span>d<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>d0 . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>licons/data-less-then d d0<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>cons d lc<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>cons d0 <span style="color: #696969;">(</span>licons/extend/one r d e<span style="color: #696969;">)))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga5e48c5" class="outline-4">
<h4 id="orga5e48c5">licons/data-less-then</h4>
<div class="outline-text-4" id="text-orga5e48c5">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">licons/data-less-then</span> d d0<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> data data <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> bool<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>d d0<span style="color: #B380A8;">}</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'var x<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'var x0<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>string&lt;? <span style="color: #696969;">(</span>sexp-&gt;string x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>sexp-&gt;string x0<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'var __<span style="color: #B380A8;">}</span> __<span style="color: #B380A8;">}</span> #t<span style="color: #797979;">]</span>

    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'cons-name __<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'var __<span style="color: #B380A8;">}}</span> #f<span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'cons-name x<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'cons-name x0<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>string&lt;? <span style="color: #696969;">(</span>sexp-&gt;string x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>sexp-&gt;string x0<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'cons-name __<span style="color: #B380A8;">}</span> __<span style="color: #B380A8;">}</span> #t<span style="color: #797979;">]</span>

    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'arrow __<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'var __<span style="color: #B380A8;">}}</span> #f<span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'arrow __<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'cons-name __<span style="color: #B380A8;">}}</span> #f<span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'arrow x<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'arrow x0<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>string&lt;? <span style="color: #696969;">(</span>sexp-&gt;string x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>sexp-&gt;string x0<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'arrow __<span style="color: #B380A8;">}</span> __<span style="color: #B380A8;">}</span> #t<span style="color: #797979;">]</span>

    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'lambda __<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'var __<span style="color: #B380A8;">}}</span> #f<span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'lambda __<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'cons-name __<span style="color: #B380A8;">}}</span> #f<span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'lambda __<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'arrow __<span style="color: #B380A8;">}}</span> #f<span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'lambda x<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'lambda x0<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>string&lt;? <span style="color: #696969;">(</span>sexp-&gt;string x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>sexp-&gt;string x0<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'lambda __<span style="color: #B380A8;">}</span> __<span style="color: #B380A8;">}</span> #t<span style="color: #797979;">]</span>

    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'trunk x<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'trunk x0<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>string&lt;? <span style="color: #696969;">(</span>sexp-&gt;string x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>sexp-&gt;string x0<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'trunk __<span style="color: #B380A8;">}</span> __<span style="color: #B380A8;">}</span> #f<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org787dfbb" class="outline-4">
<h4 id="org787dfbb">licons/less-or-equal</h4>
<div class="outline-text-4" id="text-org787dfbb">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">licons/less-or-equal</span> lc lc0<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> licons licons <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> bool<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>list-every? <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>member x lc0<span style="color: #696969;">))</span> lc<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga599d62" class="outline-4">
<h4 id="orga599d62">licons/less-then</h4>
<div class="outline-text-4" id="text-orga599d62">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">licons/less-then</span> lc lc0<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> licons licons <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> bool<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>not <span style="color: #696969;">(</span>licons/less-or-equal lc0 lc<span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org5fe38b6" class="outline-3">
<h3 id="org5fe38b6">structural-recur-check/all</h3>
<div class="outline-text-3" id="text-org5fe38b6">
</div><div id="outline-container-org7375cc2" class="outline-4">
<h4 id="org7375cc2">structural-recur-check/all</h4>
<div class="outline-text-4" id="text-org7375cc2">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">structural-recur-check/all</span> n l e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> name lambda env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> l
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ al<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">letrec</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>recur
               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> x
                   <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
                   <span style="color: #797979;">[</span><span style="color: #696969;">(</span><span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span> . r<span style="color: #696969;">)</span>
                    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>struct-rec/all/cedent n ac sc e<span style="color: #696969;">)</span>
                      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
                       <span style="color: #B380A8;">{</span>'fail <span style="color: #696969;">(</span>cons `<span style="color: #696969;">(</span>structural-recur-check/all
                                      fail
                                      <span style="color: #696969;">(</span>name: ,n<span style="color: #696969;">)</span>
                                      <span style="color: #696969;">(</span>arrow: ,<span style="color: #696969;">(</span>list ac sc<span style="color: #696969;">)))</span>
                                    il<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
                      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
                       <span style="color: #696969;">(</span>recur r<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>recur al<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org84fc36" class="outline-4">
<h4 id="org84fc36">struct-rec/all/cedent</h4>
<div class="outline-text-4" id="text-org84fc36">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">struct-rec/all/cedent</span> n ac sc e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> name antecedent succedent env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> sc
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>d . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>struct-rec/all/data n ac d e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>struct-rec/all/cedent n ac r e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org12146b2" class="outline-4">
<h4 id="org12146b2">struct-rec/all/data</h4>
<div class="outline-text-4" id="text-org12146b2">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">struct-rec/all/data</span> n ac d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> name antecedent data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>var/fresh? v e<span style="color: #696969;">)</span>
          <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span>
          <span style="color: #696969;">(</span>struct-rec/all/data n ac <span style="color: #696969;">(</span>bs/deep bs d<span style="color: #696969;">)</span> e<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons <span style="color: #B380A8;">{</span>__ dl<span style="color: #B380A8;">}}</span>
        <span style="color: #696969;">(</span>struct-rec/all/cedent n ac dl e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow a<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>struct-rec/all/arrow n ac a e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>a al<span style="color: #B380A8;">}}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>struct-rec/all/arrow n ac a e<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span>struct-rec/all/arrow-list n ac al e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'trunk t<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>struct-rec/all/trunk n ac t e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'bind <span style="color: #B380A8;">{</span>v d0<span style="color: #B380A8;">}}</span>
        <span style="color: #696969;">(</span>struct-rec/all/data n ac d0 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org184130f" class="outline-4">
<h4 id="org184130f">struct-rec/all/arrow-list</h4>
<div class="outline-text-4" id="text-org184130f">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">struct-rec/all/arrow-list</span> n ac al e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> name antecedent <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> al
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>a . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>struct-rec/all/arrow n ac a e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>struct-rec/all/arrow-list n ac r e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org16c5697" class="outline-4">
<h4 id="org16c5697">struct-rec/all/arrow</h4>
<div class="outline-text-4" id="text-org16c5697">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">struct-rec/all/arrow</span> n ac a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> name antecedent arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>struct-rec/all/cedent n ac ac e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>struct-rec/all/cedent n ac sc e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org83c5cfd" class="outline-4">
<h4 id="org83c5cfd">licons/less-then/data-list</h4>
<div class="outline-text-4" id="text-org83c5cfd">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">licons/less-then/data-list</span> dl1 dl2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> bool<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>licons/less-then
   <span style="color: #696969;">(</span>licons/extend-list '<span style="color: #696969;">()</span> dl1 e<span style="color: #696969;">)</span>
   <span style="color: #696969;">(</span>licons/extend-list '<span style="color: #696969;">()</span> dl2 e<span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org737bbd3" class="outline-4">
<h4 id="org737bbd3">struct-rec/all/trunk</h4>
<div class="outline-text-4" id="text-org737bbd3">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">struct-rec/all/trunk</span> n ac t e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> name antecedent trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> t
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a tody dl i<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> tody
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/name n0<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not <span style="color: #696969;">(</span>eq? n n0<span style="color: #696969;">))</span>
          <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>licons/less-then/data-list dl <span style="color: #696969;">(</span>reverse ac<span style="color: #696969;">)</span> e<span style="color: #696969;">)</span>
            <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span>
            <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>struct-rec/all/trunk
                      licons1 is not less-then licons2
                      <span style="color: #696969;">(</span>licons1: ,<span style="color: #696969;">(</span>licons/extend-list '<span style="color: #696969;">()</span> dl e<span style="color: #696969;">))</span>
                      <span style="color: #696969;">(</span>licons2: ,<span style="color: #696969;">(</span>licons/extend-list '<span style="color: #696969;">()</span> <span style="color: #696969;">(</span>reverse ac<span style="color: #696969;">)</span> e<span style="color: #696969;">)))</span><span style="color: #B380A8;">}}</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>cover/lambda <span style="color: #B380A8;">{</span>a al1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>a al2<span style="color: #B380A8;">}</span> e<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>licons/less-then/data-list dl <span style="color: #696969;">(</span>reverse ac<span style="color: #696969;">)</span> e<span style="color: #696969;">)</span>
             <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span>
             <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>struct-rec/all/trunk
                       licons1 is not less-then licons2
                       <span style="color: #696969;">(</span>licons1: ,<span style="color: #696969;">(</span>licons/extend-list '<span style="color: #696969;">()</span> dl e<span style="color: #696969;">))</span>
                       <span style="color: #696969;">(</span>licons2: ,<span style="color: #696969;">(</span>licons/extend-list '<span style="color: #696969;">()</span> <span style="color: #696969;">(</span>reverse ac<span style="color: #696969;">)</span> e<span style="color: #696969;">)))</span><span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/var v<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>var/fresh? v e<span style="color: #696969;">)</span>
          <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'struct-rec/all/trunk
            <span style="color: #696969;">(</span><span style="color: #e6db74;">"meet non fresh var : ~a~%"</span> v<span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span><span style="color: #e6db74;">"trunk : ~a~%"</span> t<span style="color: #696969;">)))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org79a1729" class="outline-3">
<h3 id="org79a1729">structural-recur-check/each</h3>
<div class="outline-text-3" id="text-org79a1729">
</div><div id="outline-container-org815718d" class="outline-4">
<h4 id="org815718d">structural-recur-check/each</h4>
<div class="outline-text-4" id="text-org815718d">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">structural-recur-check/each</span> n l e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> name lambda env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> l
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ al<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">letrec</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>recur
               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> x
                   <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
                   <span style="color: #797979;">[</span><span style="color: #696969;">(</span><span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span> . r<span style="color: #696969;">)</span>
                    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>struct-rec/each/cedent n ac sc e<span style="color: #696969;">)</span>
                      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
                       <span style="color: #B380A8;">{</span>'fail <span style="color: #696969;">(</span>cons `<span style="color: #696969;">(</span>structural-recur-check/each
                                      fail
                                      <span style="color: #696969;">(</span>name: ,n<span style="color: #696969;">)</span>
                                      <span style="color: #696969;">(</span>arrow: ,<span style="color: #696969;">(</span>list ac sc<span style="color: #696969;">)))</span>
                                    il<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
                      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
                       <span style="color: #696969;">(</span>recur r<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>recur al<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf2728e0" class="outline-4">
<h4 id="orgf2728e0">struct-rec/each/cedent</h4>
<div class="outline-text-4" id="text-orgf2728e0">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">struct-rec/each/cedent</span> n ac sc e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> name antecedent succedent env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> sc
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>d . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>struct-rec/each/data n ac d e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>struct-rec/each/cedent n ac r e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5d3ba80" class="outline-4">
<h4 id="org5d3ba80">struct-rec/each/data</h4>
<div class="outline-text-4" id="text-org5d3ba80">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">struct-rec/each/data</span> n ac d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> name antecedent data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>var/fresh? v e<span style="color: #696969;">)</span>
          <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span>
          <span style="color: #696969;">(</span>struct-rec/each/data n ac <span style="color: #696969;">(</span>bs/deep bs d<span style="color: #696969;">)</span> e<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons <span style="color: #B380A8;">{</span>__ dl<span style="color: #B380A8;">}}</span>
        <span style="color: #696969;">(</span>struct-rec/each/cedent n ac dl e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow a<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>struct-rec/each/arrow n ac a e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>a al<span style="color: #B380A8;">}}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>struct-rec/each/arrow n ac a e<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span>struct-rec/each/arrow-list n ac al e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'trunk t<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>struct-rec/each/trunk n ac t e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'bind <span style="color: #B380A8;">{</span>v d0<span style="color: #B380A8;">}}</span>
        <span style="color: #696969;">(</span>struct-rec/each/data n ac d0 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7bba17e" class="outline-4">
<h4 id="org7bba17e">struct-rec/each/arrow-list</h4>
<div class="outline-text-4" id="text-org7bba17e">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">struct-rec/each/arrow-list</span> n ac al e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> name antecedent <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> al
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>a . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>struct-rec/each/arrow n ac a e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>struct-rec/each/arrow-list n ac r e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge10f545" class="outline-4">
<h4 id="orge10f545">struct-rec/each/arrow</h4>
<div class="outline-text-4" id="text-orge10f545">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">struct-rec/each/arrow</span> n ac a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> name antecedent arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>struct-rec/each/cedent n ac ac e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>struct-rec/each/cedent n ac sc e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfd415b5" class="outline-4">
<h4 id="orgfd415b5">licons/less-then/each-data</h4>
<div class="outline-text-4" id="text-orgfd415b5">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">licons/less-then/each-data</span> dl1 dl2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> bool<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>null? <span style="color: #696969;">(</span>remove #t <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x y<span style="color: #696969;">)</span>
                           <span style="color: #696969;">(</span>licons/less-then
                            <span style="color: #696969;">(</span>licons/extend '<span style="color: #696969;">()</span> x e<span style="color: #696969;">)</span>
                            <span style="color: #696969;">(</span>licons/extend '<span style="color: #696969;">()</span> y e<span style="color: #696969;">)))</span>
                      dl1 dl2<span style="color: #696969;">))))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2a3eb17" class="outline-4">
<h4 id="org2a3eb17">licons/less-then/each-data/info</h4>
<div class="outline-text-4" id="text-org2a3eb17">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">licons/less-then/each-data/info</span> dl1 dl2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> info<span style="color: #696969;">)</span>
  `<span style="color: #696969;">(</span>licons/less-then/each-data/info
    <span style="color: #696969;">(</span>dl1: ,dl1<span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span>dl2: ,dl2<span style="color: #696969;">)</span>
    licons/less-then fail on
    ,<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>result<span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span>cdr result<span style="color: #696969;">))</span>
       <span style="color: #696969;">(</span>filter <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>result<span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span>eq? #f <span style="color: #696969;">(</span>car result<span style="color: #696969;">)))</span>
               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x y<span style="color: #696969;">)</span>
                      <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>licons/less-then
                             <span style="color: #696969;">(</span>licons/extend '<span style="color: #696969;">()</span> x e<span style="color: #696969;">)</span>
                             <span style="color: #696969;">(</span>licons/extend '<span style="color: #696969;">()</span> y e<span style="color: #696969;">))</span>
                            x y<span style="color: #696969;">))</span>
                 dl1 dl2<span style="color: #696969;">)))))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbb83786" class="outline-4">
<h4 id="orgbb83786">struct-rec/each/trunk</h4>
<div class="outline-text-4" id="text-orgbb83786">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">struct-rec/each/trunk</span> n ac t e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> name antecedent trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> t
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a tody dl i<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> tody
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/name n0<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not <span style="color: #696969;">(</span>eq? n n0<span style="color: #696969;">))</span>
          <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>licons/less-then/each-data dl <span style="color: #696969;">(</span>reverse ac<span style="color: #696969;">)</span> e<span style="color: #696969;">)</span>
            <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span>
            <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>struct-rec/each/trunk
                      fail
                      ,<span style="color: #696969;">(</span>licons/less-then/each-data/info dl <span style="color: #696969;">(</span>reverse ac<span style="color: #696969;">)</span> e<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>cover/lambda <span style="color: #B380A8;">{</span>a al1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>a al2<span style="color: #B380A8;">}</span> e<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>licons/less-then/each-data dl <span style="color: #696969;">(</span>reverse ac<span style="color: #696969;">)</span> e<span style="color: #696969;">)</span>
             <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span>
             <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>struct-rec/each/trunk
                       fail
                       ,<span style="color: #696969;">(</span>licons/less-then/each-data/info dl <span style="color: #696969;">(</span>reverse ac<span style="color: #696969;">)</span> e<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/var v<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>var/fresh? v e<span style="color: #696969;">)</span>
          <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'struct-rec/each/trunk
            <span style="color: #696969;">(</span><span style="color: #e6db74;">"meet non fresh var : ~a~%"</span> v<span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span><span style="color: #e6db74;">"trunk : ~a~%"</span> t<span style="color: #696969;">)))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org416ee5a" class="outline-3">
<h3 id="org416ee5a">get-recur-check-list</h3>
<div class="outline-text-3" id="text-org416ee5a">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">get-recur-check-list</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>list structural-recur-check/all
        structural-recur-check/each<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org44d987a" class="outline-3">
<h3 id="org44d987a">recur-check</h3>
<div class="outline-text-3" id="text-org44d987a">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">recur-check</span> n l e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> name lambda env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>recur-check/list <span style="color: #696969;">(</span>get-recur-check-list<span style="color: #696969;">)</span> n l e<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge476a88" class="outline-3">
<h3 id="orge476a88">recur-check/list</h3>
<div class="outline-text-3" id="text-orge476a88">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">recur-check/list</span> chl n l e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>checker ...<span style="color: #696969;">)</span> name lambda env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>recur-check/list/loop '<span style="color: #696969;">()</span> chl n l e<span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">recur-check/list/loop</span> ill chl n l e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>info-list ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>checker ...<span style="color: #696969;">)</span> name lambda env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> chl
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>recur-check/list
                  fail . ,ill<span style="color: #696969;">)</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>ch . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>ch n l e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>recur-check/list/loop <span style="color: #696969;">(</span>cons il ill<span style="color: #696969;">)</span> r n l e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
喪以不執 所執者喪 執喪相比 方死方生
</div>
</body>
</html>
