<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2016-04-29 Fri 23:33 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>sequent1</title>
<meta name="generator" content="Org-mode" />
<meta name="author" content="XIE Yuheng" />
<link rel="stylesheet" href="asset/css/page.css" type="text/css" media="screen" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
喪以不執 所執者喪 執喪相比 方死方生
</div>
<div id="content">
<h1 class="title">sequent1</h1>
<div id="table-of-contents">
<h2>overview</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org80d3f32"><span class="done todo">todo</span> </a></li>
<li><a href="#orga29ffd2"><span class="done todo">todo</span> problem</a></li>
<li><a href="#org449bca">helper</a>
<ul>
<li><a href="#org8f95c15">pattern match</a></li>
<li><a href="#orgdb6e2fe">cat &amp; orz</a></li>
<li><a href="#org1538abb">type &amp; :</a></li>
<li><a href="#orga781b22">little-test</a></li>
<li><a href="#org5d7a385">list</a></li>
<li><a href="#org2e33814">string</a></li>
</ul>
</li>
<li><a href="#org37f7668">summary</a>
<ul>
<li><a href="#org622ac00"><span class="todo note">note</span> form1</a></li>
<li><a href="#org2c7f9eb"><span class="todo note">note</span> form2</a></li>
<li><a href="#org28ac160"><span class="todo note">note</span> form3</a></li>
<li><a href="#org502ab6d"><span class="todo note">note</span> data</a></li>
<li><a href="#orga0d5df1"><span class="todo note">note</span> env</a></li>
<li><a href="#org178f7e9"><span class="todo note">note</span> report</a></li>
<li><a href="#org6265fcd"><span class="todo note">note</span> top</a></li>
</ul>
</li>
<li><a href="#orgdd109b9">pass1</a>
<ul>
<li><a href="#org487b4e7"><span class="todo note">note</span> </a></li>
<li><a href="#org46ec6bc"><span class="todo note">note</span> form1</a></li>
<li><a href="#orgbd67ed2"><span class="todo note">note</span> form2</a></li>
<li><a href="#orgb15aed9">pass1/arrow</a></li>
<li><a href="#orgadf376a">pass1/cedent</a></li>
<li><a href="#orgde0351f">predicates</a></li>
<li><a href="#orge8b2688">pass1</a></li>
<li><a href="#org7284cf6">pass1/var</a></li>
</ul>
</li>
<li><a href="#org7714459">pass2</a>
<ul>
<li><a href="#orge52d4e3"><span class="todo note">note</span> </a></li>
<li><a href="#org226257d"><span class="todo note">note</span> form2</a></li>
<li><a href="#org74f4941"><span class="todo note">note</span> form3</a></li>
<li><a href="#org12bb37d">pass2/arrow</a></li>
<li><a href="#orgc2ed2fc">pass2/cedent</a></li>
<li><a href="#orgc4f31a1">pass2/lambda</a></li>
<li><a href="#orgf4ef30e">pass2</a></li>
<li><a href="#orgf237f96">pass2/var</a></li>
<li><a href="#orgf6bf31">pass2/bind</a></li>
</ul>
</li>
<li><a href="#org7b525cd">pass3</a>
<ul>
<li><a href="#org2f79c1f"><span class="todo note">note</span> </a></li>
<li><a href="#org1f255c9"><span class="todo note">note</span> form3</a></li>
<li><a href="#org58dfa19"><span class="todo note">note</span> data</a></li>
<li><a href="#org9a8ab2d"><span class="todo note">note</span> env</a></li>
<li><a href="#org861c48">pass3/get-arrow</a></li>
<li><a href="#org94e9f2">pass3/arrow</a></li>
<li><a href="#orgec579f2">pass3/cedent</a></li>
<li><a href="#org36f1ed0">pass3/lambda</a></li>
<li><a href="#orgad5fef7">pass3</a></li>
<li><a href="#org5934f68">pass3/var</a></li>
<li><a href="#org7be7651">id-&gt;[symbol|ls]</a></li>
<li><a href="#orgef2281e"><span class="todo _gt__lt__gt__lt__gt__lt_">&gt;&lt;&gt;&lt;&gt;&lt;</span> bs/[find|walk|deep]</a></li>
<li><a href="#org1f2389a">pass3/name</a></li>
<li><a href="#org854758b">pass3/name/cons</a></li>
<li><a href="#orgb1a524e">pass3/name/trunk</a></li>
<li><a href="#orge5a7426"><span class="todo _gt__lt__gt__lt__gt__lt_">&gt;&lt;&gt;&lt;&gt;&lt;</span> pass3/bind</a></li>
<li><a href="#orgbac3bd4">id/commit!</a></li>
</ul>
</li>
<li><a href="#orgda5d75">copy-arrow</a>
<ul>
<li><a href="#org287ac1c"><span class="todo note">note</span> </a></li>
<li><a href="#org79d3ed9"><span class="todo note">note</span> data</a></li>
<li><a href="#org1330e84">copy-arrow</a></li>
<li><a href="#orgad9b001">copy/arrow</a></li>
<li><a href="#org926c9e">copy/cedent</a></li>
<li><a href="#orgd857c2e">copy/lambda</a></li>
<li><a href="#org6c95585">copy/arrow-list</a></li>
<li><a href="#org66e5d88">copy</a></li>
<li><a href="#org6b9e9c">copy/var</a></li>
<li><a href="#org7526a3c">copy/ls</a></li>
<li><a href="#org6393c22">copy/cons</a></li>
<li><a href="#org353ce99">copy/trunk</a></li>
</ul>
</li>
<li><a href="#org98833b3">compute</a>
<ul>
<li><a href="#orgdf3b5ca"><span class="todo note">note</span> data</a></li>
<li><a href="#org49ec817"><span class="todo note">note</span> env</a></li>
<li><a href="#org70ef0a3">compute/arrow</a></li>
<li><a href="#orge3e02a6">bs/commit!</a></li>
<li><a href="#org21624af">compute/cedent</a></li>
<li><a href="#org2801c43">compute</a></li>
<li><a href="#org2916056">ompute/var</a></li>
<li><a href="#orga43961a">trunk-&gt;trunk*</a></li>
<li><a href="#orgfd7bb89">compute/trunk</a></li>
<li><a href="#org22ff76e">filter-arrow-list</a></li>
<li><a href="#org56531c0">proj</a></li>
</ul>
</li>
<li><a href="#org82e734e">unify</a>
<ul>
<li><a href="#org3636935"><span class="todo note">note</span> report</a></li>
<li><a href="#org68a5887">unify</a></li>
<li><a href="#orgee018fb">unify/data-list</a></li>
<li><a href="#org1e911db">var/eq?</a></li>
<li><a href="#orgcba4fb8"><span class="todo _gt__lt__gt__lt__gt__lt_">&gt;&lt;&gt;&lt;&gt;&lt;</span> unify/data</a></li>
<li><a href="#orgb527f57">bs/extend</a></li>
<li><a href="#orge5514b3">unify/var/data</a></li>
<li><a href="#org4619195">unify/cons</a></li>
<li><a href="#orgc416710">unify/arrow</a></li>
<li><a href="#orgf9e1526">unify/lambda</a></li>
<li><a href="#org2f2baa1">unify/arrow-list</a></li>
<li><a href="#orgc3d02ee">unify/trunk</a></li>
<li><a href="#orgfda7243">unify/trunk/data</a></li>
<li><a href="#org2f517f">env/pop</a></li>
</ul>
</li>
<li><a href="#orgf10f6ac">eva</a>
<ul>
<li><a href="#org242762e"><span class="todo note">note</span> top</a></li>
<li><a href="#orgd7ea8bb"><span class="todo note">note</span> env</a></li>
<li><a href="#org19e40ba">eva</a></li>
<li><a href="#org50034f5">eva/top-list</a></li>
<li><a href="#org224c347">eva/top</a></li>
<li><a href="#orgde68da">form1/arrow-&gt;arrow</a></li>
<li><a href="#orgd377c2">eva/dt</a></li>
<li><a href="#orgab2275d">eva/df</a></li>
<li><a href="#org11ee6d2">eva/ap</a></li>
</ul>
</li>
<li><a href="#org273ab3">check</a>
<ul>
<li><a href="#org1801493">check</a></li>
<li><a href="#orgc64faad">check/arrow</a></li>
</ul>
</li>
<li><a href="#org1e3b3e8">type-compute</a>
<ul>
<li><a href="#orga7ca4f2"><span class="todo note">note</span> data</a></li>
<li><a href="#orgdfcbaa0">type-compute/cedent</a></li>
<li><a href="#org8fea977">type-compute</a></li>
<li><a href="#org5b7d2d2">type-compute/var</a></li>
<li><a href="#org2aa262a">type-compute/cons</a></li>
<li><a href="#orgb1b81eb"><span class="todo _gt__lt_">&gt;&lt;</span> type-compute/arrow</a></li>
<li><a href="#orgb95c30a">type-compute/lambda</a></li>
<li><a href="#org7c416fd">type-compute/trunk</a></li>
</ul>
</li>
<li><a href="#org7ca621"><span class="todo _gt__lt_">&gt;&lt;</span> infer</a></li>
</ul>
</div>
</div>
<ul class="org-ul">
<li><p>a prototype interpreter for a lovely functional language</p><p>which uses sequent calculus as dependent type system</p></li>

<li><p>sequent is called arrow here</p><p>which is the core data type of the language</p></li>

<li><p>as a prototype implementation its unsatisfactory features are</p><p><ol class="org-ol"></p><p><li>call-by-name</li></p><p><li>can not define mutually recursive functions</li></ol></p></li>

<li><p>source code is here <a href="https://github.com/xieyuheng/sequent1">https://github.com/xieyuheng/sequent1</a></p></li>

<li><p>XIE Yuheng created</p></li></ul>

<div id="outline-container-org80d3f32" class="outline-2">
<h2 id="org80d3f32"><span class="done todo">todo</span> </h2>
<div class="outline-text-2" id="text-org80d3f32">
<ul class="org-ul">
<li><p>finish type-apply, and ready to debug &gt;_&lt;</p></li>
<li><p>data/print</p><p>different var should be print differently</p></li>

<li><p>infer</p><p>type-compute/arrow</p></li>

<li><p>check-cover</p></li>

<li><p>check-end</p></li></ul>
</div>
</div>

<div id="outline-container-orga29ffd2" class="outline-2">
<h2 id="orga29ffd2"><span class="done todo">todo</span> problem</h2>
<div class="outline-text-2" id="text-orga29ffd2">
<ul class="org-ul">
<li><p>I do not clearly know the nature of the mechanism</p><p>what uses id/commit!</p><p>I do not know how to remove this side effect</p></li></ul>
</div>
</div>

<div id="outline-container-org449bca" class="outline-2">
<h2 id="org449bca">helper</h2>
<div class="outline-text-2" id="text-org449bca">
</div><div id="outline-container-org8f95c15" class="outline-3">
<h3 id="org8f95c15">pattern match</h3>
<div class="outline-text-3" id="text-org8f95c15">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #FF8888;">;; </span><span style="color: #FF8888;">module system of guile</span>
<span style="color: #FF8888;">;; </span><span style="color: #FF8888;">using http://synthcode.com/scheme/match.scm</span>
<span style="color: #696969;">(</span>use-modules <span style="color: #696969;">(</span>ice-9 match<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdb6e2fe" class="outline-3">
<h3 id="orgdb6e2fe">cat &amp; orz</h3>
<div class="outline-text-3" id="text-orgdb6e2fe">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define-syntax</span> <span style="color: #fd971f;">cat</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">syntax-rules</span> <span style="color: #696969;">()</span>
    <span style="color: #696969;">[(</span>cat <span style="color: #696969;">(</span>str . args<span style="color: #696969;">))</span>
     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">(format str . args)</span>
     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">guile</span>
     <span style="color: #696969;">(</span>format #t str . args<span style="color: #696969;">)]</span>
    <span style="color: #696969;">[(</span>cat <span style="color: #696969;">(</span>str . args<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>str2 . args2<span style="color: #696969;">)</span> ...<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>string-append
      <span style="color: #696969;">(</span>cat <span style="color: #696969;">(</span>str . args<span style="color: #696969;">))</span>
      <span style="color: #696969;">(</span>cat <span style="color: #696969;">(</span>str2 . args2<span style="color: #696969;">)</span> ...<span style="color: #696969;">))]))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define-syntax</span> <span style="color: #fd971f;">orz</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">syntax-rules</span> <span style="color: #696969;">()</span>
    <span style="color: #696969;">[(</span><span style="color: #f92672; font-weight: bold;">orz</span> . body<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">error</span> <span style="color: #696969;">(</span>cat . body<span style="color: #696969;">))]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1538abb" class="outline-3">
<h3 id="org1538abb">type &amp; :</h3>
<div class="outline-text-3" id="text-org1538abb">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">void</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">([</span>x '<span style="color: #696969;">()])</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">set!</span> x '<span style="color: #696969;">())))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define-syntax</span> <span style="color: #fd971f;">type</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">syntax-rules</span> <span style="color: #696969;">()</span>
    <span style="color: #696969;">[(</span><span style="color: #f92672; font-weight: bold;">type</span> . body<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>void<span style="color: #696969;">)]))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define-syntax</span> <span style="color: #fd971f;">:</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">syntax-rules</span> <span style="color: #696969;">()</span>
    <span style="color: #696969;">[(</span><span style="color: #f92672; font-weight: bold;">:</span> . body<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>void<span style="color: #696969;">)]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga781b22" class="outline-3">
<h3 id="orga781b22">little-test</h3>
<div class="outline-text-3" id="text-orga781b22">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span>use-modules <span style="color: #696969;">(</span>ice-9 pretty-print<span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define-syntax</span> <span style="color: #fd971f;">test</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">syntax-rules</span> <span style="color: #696969;">()</span>
    <span style="color: #696969;">[(</span>test b1 b2<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>equal? b1 b2<span style="color: #696969;">)</span>
       #t
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">()</span>
         <span style="color: #696969;">(</span>cat <span style="color: #696969;">(</span><span style="color: #e6db74;">"\n"</span><span style="color: #696969;">))</span>
         <span style="color: #696969;">(</span>cat <span style="color: #696969;">(</span><span style="color: #e6db74;">"&lt;test-fail-report-begin&gt;\n"</span><span style="color: #696969;">))</span>
         <span style="color: #696969;">(</span>cat <span style="color: #696969;">(</span><span style="color: #e6db74;">"&lt;actual-form&gt; :\n"</span><span style="color: #696969;">))</span>
         <span style="color: #696969;">(</span>pretty-print <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">quote</span> b1<span style="color: #696969;">))</span>
         <span style="color: #696969;">(</span>cat <span style="color: #696969;">(</span><span style="color: #e6db74;">"&lt;actual-value&gt; :\n"</span><span style="color: #696969;">))</span>
         <span style="color: #696969;">(</span>pretty-print b1<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span>cat <span style="color: #696969;">(</span><span style="color: #e6db74;">"&lt;expect-form&gt; :\n"</span><span style="color: #696969;">))</span>
         <span style="color: #696969;">(</span>pretty-print <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">quote</span> b2<span style="color: #696969;">))</span>
         <span style="color: #696969;">(</span>cat <span style="color: #696969;">(</span><span style="color: #e6db74;">"&lt;expect-value&gt; :\n"</span><span style="color: #696969;">))</span>
         <span style="color: #696969;">(</span>pretty-print b2<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> <span style="color: #696969;">(</span><span style="color: #e6db74;">"&lt;test-fail-report-end&gt;\n"</span><span style="color: #696969;">))))]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5d7a385" class="outline-3">
<h3 id="org5d7a385">list</h3>
<div class="outline-text-3" id="text-org5d7a385">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">left-of</span> s l<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> sexp list <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> list<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">cond</span> <span style="color: #696969;">[(</span>equal? s <span style="color: #696969;">(</span>car l<span style="color: #696969;">))</span> '<span style="color: #696969;">()]</span>
        <span style="color: #696969;">[</span>else <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>car l<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>left-of s <span style="color: #696969;">(</span>cdr l<span style="color: #696969;">)))]))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">right-of</span> s l<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> sexp list <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> list<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">cond</span> <span style="color: #696969;">[(</span>equal? s <span style="color: #696969;">(</span>car l<span style="color: #696969;">))</span> <span style="color: #696969;">(</span>cdr l<span style="color: #696969;">)]</span>
        <span style="color: #696969;">[</span>else <span style="color: #696969;">(</span>right-of s <span style="color: #696969;">(</span>cdr l<span style="color: #696969;">))]))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">sublist</span> l start end<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> list index index <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> list<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">cond</span> <span style="color: #696969;">[(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>eq? 0 start<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>&lt;= end 0<span style="color: #696969;">))</span> '<span style="color: #696969;">()]</span>
        <span style="color: #696969;">[(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>not <span style="color: #696969;">(</span>eq? 0 start<span style="color: #696969;">)))</span>
         <span style="color: #696969;">(</span>sublist <span style="color: #696969;">(</span>cdr l<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>- start 1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>- end 1<span style="color: #696969;">))]</span>
        <span style="color: #696969;">[(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>eq? 0 start<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>not <span style="color: #696969;">(</span>eq? 0 end<span style="color: #696969;">)))</span>
         <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>car l<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>sublist <span style="color: #696969;">(</span>cdr l<span style="color: #696969;">)</span> 0 <span style="color: #696969;">(</span>- end 1<span style="color: #696969;">)))]))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">genlist</span> len<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> length <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> list<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">letrec</span> <span style="color: #696969;">([</span>recur
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>len counter<span style="color: #696969;">)</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">cond</span> <span style="color: #696969;">[(</span>eq? len counter<span style="color: #696969;">)</span> '<span style="color: #696969;">()]</span>
                    <span style="color: #696969;">[</span>else <span style="color: #696969;">(</span>cons counter
                                <span style="color: #696969;">(</span>recur len <span style="color: #696969;">(</span>+ 1 counter<span style="color: #696969;">)))]))])</span>
    <span style="color: #696969;">(</span>recur len 0<span style="color: #696969;">)))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">substitute</span> e p? l<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> element <span style="color: #696969;">(</span>element <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> bool<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>element ...<span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>element ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">cond</span> <span style="color: #696969;">[(</span>eq? '<span style="color: #696969;">()</span> l<span style="color: #696969;">)</span> '<span style="color: #696969;">()]</span>
        <span style="color: #696969;">[(</span>p? <span style="color: #696969;">(</span>car l<span style="color: #696969;">))</span> <span style="color: #696969;">(</span>cons e <span style="color: #696969;">(</span>cdr l<span style="color: #696969;">))]</span>
        <span style="color: #696969;">[</span>else <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>car l<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>substitute e p? <span style="color: #696969;">(</span>cdr l<span style="color: #696969;">)))]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2e33814" class="outline-3">
<h3 id="org2e33814">string</h3>
<div class="outline-text-3" id="text-org2e33814">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">find-char</span> c s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> char string <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">or</span> curser #f<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span>find-char/curser c s 0<span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">find-char/curser</span> c s curser<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> char string curser <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">or</span> curser #f<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>&gt;= curser <span style="color: #696969;">(</span>string-length s<span style="color: #696969;">))</span>
    #f
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">([</span>c0 <span style="color: #696969;">(</span>substring s curser <span style="color: #696969;">(</span>+ 1 curser<span style="color: #696969;">))])</span>
      <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>equal? c c0<span style="color: #696969;">)</span>
        curser
        <span style="color: #696969;">(</span>find-char/curser c s <span style="color: #696969;">(</span>+ 1 curser<span style="color: #696969;">))))))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org37f7668" class="outline-2">
<h2 id="org37f7668">summary</h2>
<div class="outline-text-2" id="text-org37f7668">
</div><div id="outline-container-org622ac00" class="outline-3">
<h3 id="org622ac00"><span class="todo note">note</span> form1</h3>
<div class="outline-text-3" id="text-org622ac00">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form1
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form1/var
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">example</span>
      <span style="color: #a6e22e;">:var</span>
      <span style="color: #a6e22e;">:var^n</span><span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form1/name
    symbol<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form1/arrow
    '<span style="color: #696969;">(</span>form1 ... <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> form1 ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form1/lambda
    '<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> form1/arrow
       form1/arrow
       ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form1/im-bind
    '<span style="color: #696969;">(</span>form1/var ... : form1 ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form1/ex-bind
    '<span style="color: #696969;">(</span>form1/var ... @ form1 ...<span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2c7f9eb" class="outline-3">
<h3 id="org2c7f9eb"><span class="todo note">note</span> form2</h3>
<div class="outline-text-3" id="text-org2c7f9eb">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form2
  <span style="color: #696969;">(</span>'form2/var    <span style="color: #696969;">(</span>symbol level<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span>'form2/name   symbol<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>'form2/arrow  <span style="color: #696969;">((</span>form2 ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>form2 ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'form2/lambda <span style="color: #696969;">(</span>form2/arrow <span style="color: #696969;">(</span>form2/arrow ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'form2/bind   <span style="color: #696969;">((</span>form2/var ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>form2 ...<span style="color: #696969;">)</span> leave?<span style="color: #696969;">)))</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> level natural-number<span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> leave?
  'leave
  'not-leave<span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org28ac160" class="outline-3">
<h3 id="org28ac160"><span class="todo note">note</span> form3</h3>
<div class="outline-text-3" id="text-org28ac160">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form3
  <span style="color: #696969;">(</span>'form3/var    <span style="color: #696969;">(</span>id level<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span>'form3/name   symbol<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>'form3/arrow  <span style="color: #696969;">((</span>form3 ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>form3 ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'form3/lambda <span style="color: #696969;">(</span>form3/arrow <span style="color: #696969;">(</span>form3/arrow ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'form3/bind   <span style="color: #696969;">((</span>form3/var ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>form3 ...<span style="color: #696969;">)</span> leave?<span style="color: #696969;">)))</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> id #<span style="color: #696969;">(</span>symbol ls<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org502ab6d" class="outline-3">
<h3 id="org502ab6d"><span class="todo note">note</span> data</h3>
<div class="outline-text-3" id="text-org502ab6d">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> data
  <span style="color: #696969;">(</span>'var    <span style="color: #696969;">(</span>id level<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span>'cons   <span style="color: #696969;">(</span>name <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'arrow  <span style="color: #696969;">((</span>data ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'lambda <span style="color: #696969;">(</span>arrow <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'trunk  <span style="color: #696969;">(</span>arrow <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">or</span> name <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">))</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> index<span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga0d5df1" class="outline-3">
<h3 id="orga0d5df1"><span class="todo note">note</span> env</h3>
<div class="outline-text-3" id="text-orga0d5df1">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> env <span style="color: #696969;">(</span>ds bs ns<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> ds <span style="color: #696969;">(</span>data ...<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> bs <span style="color: #696969;">((</span>id . ls<span style="color: #696969;">)</span> ...<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> ns <span style="color: #696969;">((</span>name . meaning<span style="color: #696969;">)</span> ...<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> ls <span style="color: #696969;">((</span>level . data<span style="color: #696969;">)</span> ...<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> meaning
  <span style="color: #696969;">(</span>'cons/type <span style="color: #696969;">(</span>arrow name <span style="color: #696969;">(</span>name ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'cons/data <span style="color: #696969;">(</span>arrow name name<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span>'lambda    <span style="color: #696969;">(</span>arrow <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">))))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org178f7e9" class="outline-3">
<h3 id="org178f7e9"><span class="todo note">note</span> report</h3>
<div class="outline-text-3" id="text-org178f7e9">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> report
  <span style="color: #696969;">(</span>'fail <span style="color: #696969;">(</span>info ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span>'success env<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> info <span style="color: #66d9ef; font-weight: bold;">&lt;free&gt;</span><span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6265fcd" class="outline-3">
<h3 id="org6265fcd"><span class="todo note">note</span> top</h3>
<div class="outline-text-3" id="text-org6265fcd">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> top
  <span style="color: #696969;">(</span>'dt <span style="color: #696969;">((</span>form1/name form1/arrow<span style="color: #696969;">)</span> <span style="color: #696969;">((</span>form1/name form1/arrow<span style="color: #696969;">)</span> ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'df <span style="color: #696969;">((</span>form1/name form1/arrow<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>form1/arrow ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'ap form1/arrow<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgdd109b9" class="outline-2">
<h2 id="orgdd109b9">pass1</h2>
<div class="outline-text-2" id="text-orgdd109b9">
</div><div id="outline-container-org487b4e7" class="outline-3">
<h3 id="org487b4e7"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-org487b4e7">
<ul class="org-ul">
<li><p>form1 -pass1-&gt; form2</p><p>default-level of var is handled here</p></li></ul>
</div>
</div>

<div id="outline-container-org46ec6bc" class="outline-3">
<h3 id="org46ec6bc"><span class="todo note">note</span> form1</h3>
<div class="outline-text-3" id="text-org46ec6bc">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form1
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form1/var
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">example</span>
      <span style="color: #a6e22e;">:var</span>
      <span style="color: #a6e22e;">:var^n</span><span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form1/name
    symbol<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form1/arrow
    '<span style="color: #696969;">(</span>form1 ... <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> form1 ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form1/lambda
    '<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> form1/arrow
       form1/arrow
       ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form1/im-bind
    '<span style="color: #696969;">(</span>form1/var ... : form1 ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form1/ex-bind
    '<span style="color: #696969;">(</span>form1/var ... @ form1 ...<span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbd67ed2" class="outline-3">
<h3 id="orgbd67ed2"><span class="todo note">note</span> form2</h3>
<div class="outline-text-3" id="text-orgbd67ed2">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form2
  <span style="color: #696969;">(</span>'form2/var    <span style="color: #696969;">(</span>symbol level<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span>'form2/name   symbol<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>'form2/arrow  <span style="color: #696969;">((</span>form2 ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>form2 ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'form2/lambda <span style="color: #696969;">(</span>form2/arrow <span style="color: #696969;">(</span>form2/arrow ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'form2/bind   <span style="color: #696969;">((</span>form2/var ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>form2 ...<span style="color: #696969;">)</span> leave?<span style="color: #696969;">)))</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> level natural-number<span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> leave?
  'leave
  'not-leave<span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb15aed9" class="outline-3">
<h3 id="orgb15aed9">pass1/arrow</h3>
<div class="outline-text-3" id="text-orgb15aed9">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass1/arrow</span> default-level s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> default-level form1/arrow <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> form2/arrow<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>pass1/cedent default-level <span style="color: #696969;">(</span>left-of '<span style="color: #66d9ef; font-weight: bold;">-&gt;</span> s<span style="color: #696969;">))</span>
        <span style="color: #696969;">(</span>pass1/cedent default-level <span style="color: #696969;">(</span>right-of '<span style="color: #66d9ef; font-weight: bold;">-&gt;</span> s<span style="color: #696969;">))))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgadf376a" class="outline-3">
<h3 id="orgadf376a">pass1/cedent</h3>
<div class="outline-text-3" id="text-orgadf376a">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass1/cedent</span> default-level s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> default-level <span style="color: #696969;">(</span>form1 ...<span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>form2 ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> s
    <span style="color: #696969;">[()</span> '<span style="color: #696969;">()]</span>
    <span style="color: #696969;">[(</span>h . r<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>pass1 default-level h<span style="color: #696969;">)</span>
                   <span style="color: #696969;">(</span>pass1/cedent default-level r<span style="color: #696969;">))]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgde0351f" class="outline-3">
<h3 id="orgde0351f">predicates</h3>
<div class="outline-text-3" id="text-orgde0351f">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">form1/var?</span> v<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>symbol? v<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>equal? <span style="color: #e6db74;">":"</span> <span style="color: #696969;">(</span>substring <span style="color: #696969;">(</span>symbol-&gt;string v<span style="color: #696969;">)</span> 0 1<span style="color: #696969;">))))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">form1/name?</span> v<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>symbol? v<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>not <span style="color: #696969;">(</span>eq? <span style="color: #e6db74;">":"</span> <span style="color: #696969;">(</span>substring <span style="color: #696969;">(</span>symbol-&gt;string v<span style="color: #696969;">)</span> 0 1<span style="color: #696969;">)))))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">form1/arrow?</span> v<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>list? v<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>member '<span style="color: #66d9ef; font-weight: bold;">-&gt;</span> v<span style="color: #696969;">)))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">form1/lambda?</span> v<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>list? v<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>eq? <span style="color: #696969;">(</span>car v<span style="color: #696969;">)</span> 'lambda<span style="color: #696969;">)))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">form1/im-bind?</span> v<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>list? v<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>member ': v<span style="color: #696969;">)))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">form1/ex-bind?</span> v<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>list? v<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>member '@ v<span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge8b2688" class="outline-3">
<h3 id="orge8b2688">pass1</h3>
<div class="outline-text-3" id="text-orge8b2688">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass1</span> default-level v<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> default-level form1 <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> form2<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">cond</span> <span style="color: #696969;">[(</span>form1/var? v<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span>list 'form2/var
               <span style="color: #696969;">(</span>pass1/var default-level v<span style="color: #696969;">))]</span>
        <span style="color: #696969;">[(</span>form1/name? v<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span>list 'form2/name
               v<span style="color: #696969;">)]</span>
        <span style="color: #696969;">[(</span>form1/arrow? v<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span>list 'form2/arrow
               <span style="color: #696969;">(</span>pass1/arrow default-level v<span style="color: #696969;">))]</span>
        <span style="color: #696969;">[(</span>form1/lambda? v<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span>list 'form2/lambda
               <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>pass1/arrow default-level <span style="color: #696969;">(</span>cadr v<span style="color: #696969;">))</span>
                     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>pass1/arrow default-level x<span style="color: #696969;">))</span>
                       <span style="color: #696969;">(</span>cddr v<span style="color: #696969;">))))]</span>
        <span style="color: #696969;">[(</span>form1/im-bind? v<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span>list 'form2/bind
               <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>pass1/cedent 1 <span style="color: #696969;">(</span>left-of ': v<span style="color: #696969;">))</span>
                     <span style="color: #696969;">(</span>pass1/cedent 0 <span style="color: #696969;">(</span>right-of ': v<span style="color: #696969;">))</span>
                     'leave<span style="color: #696969;">))]</span>
        <span style="color: #696969;">[(</span>form1/ex-bind? v<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span>list 'form2/bind
               <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>pass1/cedent 1 <span style="color: #696969;">(</span>left-of '@ v<span style="color: #696969;">))</span>
                     <span style="color: #696969;">(</span>pass1/cedent 0 <span style="color: #696969;">(</span>right-of '@ v<span style="color: #696969;">))</span>
                     'not-leave<span style="color: #696969;">))]</span>
        <span style="color: #696969;">[</span>else
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> <span style="color: #696969;">(</span><span style="color: #e6db74;">"pass1 can not handle sexp-form:~a"</span> v<span style="color: #696969;">))]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7284cf6" class="outline-3">
<h3 id="org7284cf6">pass1/var</h3>
<div class="outline-text-3" id="text-org7284cf6">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass1/var</span> default-level v<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> default-level symbol <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> form2/var<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">([</span>str <span style="color: #696969;">(</span>symbol-&gt;string v<span style="color: #696969;">)]</span>
         <span style="color: #696969;">[</span>cursor <span style="color: #696969;">(</span>find-char <span style="color: #e6db74;">"^"</span> str<span style="color: #696969;">)])</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> cursor
      <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>string-&gt;symbol <span style="color: #696969;">(</span>substring str 0 cursor<span style="color: #696969;">))</span>
            <span style="color: #696969;">(</span>string-&gt;number <span style="color: #696969;">(</span>substring str <span style="color: #696969;">(</span>+ 1 cursor<span style="color: #696969;">))))</span>
      <span style="color: #696969;">(</span>list v default-level<span style="color: #696969;">))))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7714459" class="outline-2">
<h2 id="org7714459">pass2</h2>
<div class="outline-text-2" id="text-org7714459">
</div><div id="outline-container-orge52d4e3" class="outline-3">
<h3 id="orge52d4e3"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-orge52d4e3">
<ul class="org-ul">
<li><p>form2 -pass2-&gt; form3</p><p>id of var is handled here</p></li></ul>
</div>
</div>

<div id="outline-container-org226257d" class="outline-3">
<h3 id="org226257d"><span class="todo note">note</span> form2</h3>
<div class="outline-text-3" id="text-org226257d">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form2
  <span style="color: #696969;">(</span>'form2/var    <span style="color: #696969;">(</span>symbol level<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span>'form2/name   symbol<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>'form2/arrow  <span style="color: #696969;">((</span>form2 ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>form2 ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'form2/lambda <span style="color: #696969;">(</span>form2/arrow <span style="color: #696969;">(</span>form2/arrow ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'form2/bind   <span style="color: #696969;">((</span>form2/var ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>form2 ...<span style="color: #696969;">)</span> leave?<span style="color: #696969;">)))</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> level natural-number<span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> leave?
  'leave
  'not-leave<span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org74f4941" class="outline-3">
<h3 id="org74f4941"><span class="todo note">note</span> form3</h3>
<div class="outline-text-3" id="text-org74f4941">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form3
  <span style="color: #696969;">(</span>'form3/var    <span style="color: #696969;">(</span>id level<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span>'form3/name   symbol<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>'form3/arrow  <span style="color: #696969;">((</span>form3 ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>form3 ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'form3/lambda <span style="color: #696969;">(</span>form3/arrow <span style="color: #696969;">(</span>form3/arrow ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'form3/bind   <span style="color: #696969;">((</span>form3/var ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>form3 ...<span style="color: #696969;">)</span> leave?<span style="color: #696969;">)))</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> id #<span style="color: #696969;">(</span>symbol ls<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org12bb37d" class="outline-3">
<h3 id="org12bb37d">pass2/arrow</h3>
<div class="outline-text-3" id="text-org12bb37d">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass2/arrow</span> a s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form2/arrow scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>form3/arrow scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
    <span style="color: #696969;">[(</span>ac sc<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/cedent ac s<span style="color: #696969;">)</span>
       <span style="color: #696969;">[(</span>3ac s1<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/cedent sc s1<span style="color: #696969;">)</span>
          <span style="color: #696969;">[(</span>3sc s2<span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>list 3ac 3sc<span style="color: #696969;">)</span> s2<span style="color: #696969;">)])])]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc2ed2fc" class="outline-3">
<h3 id="orgc2ed2fc">pass2/cedent</h3>
<div class="outline-text-3" id="text-orgc2ed2fc">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass2/cedent</span> c s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>form2 ...<span style="color: #696969;">)</span> scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">((</span>form3 ...<span style="color: #696969;">)</span> scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
    <span style="color: #696969;">[()</span> <span style="color: #696969;">(</span>list '<span style="color: #696969;">()</span> s<span style="color: #696969;">)]</span>
    <span style="color: #696969;">[(</span>h . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2 h s<span style="color: #696969;">)</span>
       <span style="color: #696969;">[(</span>3f s1<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/cedent r s1<span style="color: #696969;">)</span>
          <span style="color: #696969;">[(</span>3c s2<span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>cons 3f 3c<span style="color: #696969;">)</span> s2<span style="color: #696969;">)])])]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc4f31a1" class="outline-3">
<h3 id="orgc4f31a1">pass2/lambda</h3>
<div class="outline-text-3" id="text-orgc4f31a1">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass2/lambda</span> l s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form2/lambda scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>form3/lambda scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> l
    <span style="color: #696969;">[(</span>a al<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>pass2/arrow a s<span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>pass2/arrow x s<span style="color: #696969;">))</span>
                   al<span style="color: #696969;">))</span>
           s<span style="color: #696969;">)]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf4ef30e" class="outline-3">
<h3 id="orgf4ef30e">pass2</h3>
<div class="outline-text-3" id="text-orgf4ef30e">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass2</span> f s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form2 scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>form2 scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> f
    <span style="color: #696969;">[(</span>'form2/var v<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/var v s<span style="color: #696969;">)</span>
       <span style="color: #696969;">[(</span>v1 s1<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>list 'form3/var v1<span style="color: #696969;">)</span> s1<span style="color: #696969;">)])]</span>
    <span style="color: #696969;">[(</span>'form2/name n<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>list 'form3/name n<span style="color: #696969;">)</span> s<span style="color: #696969;">)]</span>
    <span style="color: #696969;">[(</span>'form2/arrow a<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/arrow a s<span style="color: #696969;">)</span>
       <span style="color: #696969;">[(</span>a1 s1<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>list 'form3/arrow a1<span style="color: #696969;">)</span> s1<span style="color: #696969;">)])]</span>
    <span style="color: #696969;">[(</span>'form2/lambda l<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/lambda l s<span style="color: #696969;">)</span>
       <span style="color: #696969;">[(</span>l1 s1<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>list 'form3/lambda l1<span style="color: #696969;">)</span> s1<span style="color: #696969;">)])]</span>
    <span style="color: #696969;">[(</span>'form2/bind b<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/bind b s<span style="color: #696969;">)</span>
       <span style="color: #696969;">[(</span>b1 s1<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>list 'form3/bind b1<span style="color: #696969;">)</span> s1<span style="color: #696969;">)])]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf237f96" class="outline-3">
<h3 id="orgf237f96">pass2/var</h3>
<div class="outline-text-3" id="text-orgf237f96">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass2/var</span> v s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form2/var scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>form3/var scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> v
    <span style="color: #696969;">[(</span>symbol level<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">([</span>found <span style="color: #696969;">(</span>assq symbol s<span style="color: #696969;">)])</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> found
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">([</span>old <span style="color: #696969;">(</span>cdr found<span style="color: #696969;">)])</span>
           <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>list old level<span style="color: #696969;">)</span>
                 s<span style="color: #696969;">))</span>
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">([</span>new <span style="color: #696969;">(</span>vector symbol '<span style="color: #696969;">())])</span>
           <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>list new level<span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>cons symbol new<span style="color: #696969;">)</span> s<span style="color: #696969;">)))))]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf6bf31" class="outline-3">
<h3 id="orgf6bf31">pass2/bind</h3>
<div class="outline-text-3" id="text-orgf6bf31">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass2/bind</span> b s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form2/bind scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>form3/bind scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> b
    <span style="color: #696969;">[(</span>vs c leave?<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/cedent vs s<span style="color: #696969;">)</span>
       <span style="color: #696969;">[(</span>3vs s1<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/cedent c s1<span style="color: #696969;">)</span>
          <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">this means vars in vs can occur in c</span>
          <span style="color: #696969;">[(</span>3c s2<span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>list 3vs 3c leave?<span style="color: #696969;">)</span> s2<span style="color: #696969;">)])])]))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7b525cd" class="outline-2">
<h2 id="org7b525cd">pass3</h2>
<div class="outline-text-2" id="text-org7b525cd">
</div><div id="outline-container-org2f79c1f" class="outline-3">
<h3 id="org2f79c1f"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-org2f79c1f">
<ul class="org-ul">
<li><p>form3 -pass3-&gt; data</p><p>cons &amp; trunk are created here</p></li>

<li><p>pass3 will use env passing</p><p>note that</p><p>when env passing is used</p><p>those functions would not be separately testable</p></li>

<li><p>no unification here</p><p>bs is not used here</p><p>bind just effect on the id of var</p></li>

<li><p>ns is searched</p><p>but no effect on ns</p></li>

<li><p>how should I express such in type ?</p></li></ul>
</div>
</div>

<div id="outline-container-org1f255c9" class="outline-3">
<h3 id="org1f255c9"><span class="todo note">note</span> form3</h3>
<div class="outline-text-3" id="text-org1f255c9">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form3
  <span style="color: #696969;">(</span>'form3/var    <span style="color: #696969;">(</span>id level<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span>'form3/name   symbol<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>'form3/arrow  <span style="color: #696969;">((</span>form3 ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>form3 ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'form3/lambda <span style="color: #696969;">(</span>form3/arrow <span style="color: #696969;">(</span>form3/arrow ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'form3/bind   <span style="color: #696969;">((</span>form3/var ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>form3 ...<span style="color: #696969;">)</span> leave?<span style="color: #696969;">)))</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> id #<span style="color: #696969;">(</span>symbol ls<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org58dfa19" class="outline-3">
<h3 id="org58dfa19"><span class="todo note">note</span> data</h3>
<div class="outline-text-3" id="text-org58dfa19">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> data
  <span style="color: #696969;">(</span>'var    <span style="color: #696969;">(</span>id level<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span>'cons   <span style="color: #696969;">(</span>name <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'arrow  <span style="color: #696969;">((</span>data ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'lambda <span style="color: #696969;">(</span>arrow <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'trunk  <span style="color: #696969;">(</span>arrow <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">or</span> name <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">))</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> index<span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9a8ab2d" class="outline-3">
<h3 id="org9a8ab2d"><span class="todo note">note</span> env</h3>
<div class="outline-text-3" id="text-org9a8ab2d">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> env <span style="color: #696969;">(</span>ds bs ns<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> ds <span style="color: #696969;">(</span>data ...<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> bs <span style="color: #696969;">((</span>id . ls<span style="color: #696969;">)</span> ...<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> ns <span style="color: #696969;">((</span>name . meaning<span style="color: #696969;">)</span> ...<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> ls <span style="color: #696969;">((</span>level . data<span style="color: #696969;">)</span> ...<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> meaning
  <span style="color: #696969;">(</span>'cons/type <span style="color: #696969;">(</span>arrow name <span style="color: #696969;">(</span>name ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'cons/data <span style="color: #696969;">(</span>arrow name name<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span>'lambda    <span style="color: #696969;">(</span>arrow <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">))))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org861c48" class="outline-3">
<h3 id="org861c48">pass3/get-arrow</h3>
<div class="outline-text-3" id="text-org861c48">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/get-arrow</span> a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form3/arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> arrow<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass3/arrow a e<span style="color: #696969;">)</span>
    <span style="color: #696969;">[(((</span>'arrow arrow<span style="color: #696969;">)</span> . _<span style="color: #696969;">)</span> _ _<span style="color: #696969;">)</span>
     arrow<span style="color: #696969;">]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org94e9f2" class="outline-3">
<h3 id="org94e9f2">pass3/arrow</h3>
<div class="outline-text-3" id="text-org94e9f2">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/arrow</span> a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form3/arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #696969;">[(</span>ds bs ns<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
       <span style="color: #696969;">[(</span>ac sc<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass3/cedent ac e<span style="color: #696969;">)</span>
          <span style="color: #696969;">[((</span>d1 . _<span style="color: #696969;">)</span> _ _<span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass3/cedent sc e<span style="color: #696969;">)</span>
             <span style="color: #696969;">[((</span>d2 . _<span style="color: #696969;">)</span> _ _<span style="color: #696969;">)</span>
              <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>list 'arrow <span style="color: #696969;">(</span>list d1 d2<span style="color: #696969;">))</span>
                          ds<span style="color: #696969;">)</span>
                    bs
                    ns<span style="color: #696969;">)])])])]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgec579f2" class="outline-3">
<h3 id="orgec579f2">pass3/cedent</h3>
<div class="outline-text-3" id="text-orgec579f2">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/cedent</span> c e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>form3 ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #696969;">[(</span>ds bs ns<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
       <span style="color: #696969;">[()</span> e<span style="color: #696969;">]</span>
       <span style="color: #696969;">[(</span>h . r<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>pass3/cedent r <span style="color: #696969;">(</span>pass3 h e<span style="color: #696969;">))])]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org36f1ed0" class="outline-3">
<h3 id="org36f1ed0">pass3/lambda</h3>
<div class="outline-text-3" id="text-org36f1ed0">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/lambda</span> l e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form3/lambda env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #696969;">[(</span>ds bs ns<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> l
       <span style="color: #696969;">[(</span>a al<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>list 'lambda
                          <span style="color: #696969;">(</span>pass3/get-arrow a e<span style="color: #696969;">)</span>
                          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span>
                                 <span style="color: #696969;">(</span>pass3/get-arrow x e<span style="color: #696969;">))</span>
                            al<span style="color: #696969;">))</span>
                    ds<span style="color: #696969;">)</span>
              bs
              ns<span style="color: #696969;">)])]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgad5fef7" class="outline-3">
<h3 id="orgad5fef7">pass3</h3>
<div class="outline-text-3" id="text-orgad5fef7">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3</span> f e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form3 env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> f
    <span style="color: #696969;">[(</span>'form3/var x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>pass3/var x e<span style="color: #696969;">)]</span>
    <span style="color: #696969;">[(</span>'form3/name x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>pass3/name x e<span style="color: #696969;">)]</span>
    <span style="color: #696969;">[(</span>'form3/arrow x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>pass3/arrow x e<span style="color: #696969;">)]</span>
    <span style="color: #696969;">[(</span>'form3/lambda x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>pass3/lambda x e<span style="color: #696969;">)]</span>
    <span style="color: #696969;">[(</span>'form3/bind x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>pass3/bind x e<span style="color: #696969;">)]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5934f68" class="outline-3">
<h3 id="org5934f68">pass3/var</h3>
<div class="outline-text-3" id="text-org5934f68">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/var</span> v e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form3/var env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #696969;">[(</span>ds bs ns<span style="color: #696969;">)</span>
     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">actually there is no need to search bs</span>
     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">but anyway</span>
     <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>bs/deep bs <span style="color: #696969;">(</span>list 'var v<span style="color: #696969;">))</span> ds<span style="color: #696969;">)</span>
           bs
           ns<span style="color: #696969;">)]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7be7651" class="outline-3">
<h3 id="org7be7651">id-&gt;[symbol|ls]</h3>
<div class="outline-text-3" id="text-org7be7651">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">id-&gt;symbol</span> id<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>vector-ref id 0<span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">id-&gt;ls</span> id<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>vector-ref id 1<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgef2281e" class="outline-3">
<h3 id="orgef2281e"><span class="todo _gt__lt__gt__lt__gt__lt_">&gt;&lt;&gt;&lt;&gt;&lt;</span> bs/[find|walk|deep]</h3>
<div class="outline-text-3" id="text-orgef2281e">
<ul class="org-ul">
<li><p>infer level n can get level n+1</p></li>

<li><p>note how the types of these functions are different</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">bs/find</span> bs v<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> bs var <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">or</span> data #f<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> v
    <span style="color: #696969;">[(</span>id level<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">([</span>level <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>eq? level #f<span style="color: #696969;">)</span>
                     0
                     level<span style="color: #696969;">)]</span>
            <span style="color: #696969;">[</span>found/commit <span style="color: #696969;">(</span>assq level <span style="color: #696969;">(</span>id-&gt;ls id<span style="color: #696969;">))])</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> found/commit
         <span style="color: #696969;">(</span>cdr found/commit<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">([</span>found/ls <span style="color: #696969;">(</span>assq id bs<span style="color: #696969;">)]</span>
                <span style="color: #696969;">[</span>found/bind
                 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> found/ls
                   <span style="color: #696969;">(</span>assq level <span style="color: #696969;">(</span>cdr found/ls<span style="color: #696969;">))</span>
                   #f<span style="color: #696969;">)])</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> found/bind
             <span style="color: #696969;">(</span>cdr found/bind<span style="color: #696969;">)</span>
             #f<span style="color: #696969;">))))]))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">bs/walk</span> bs d<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> bs data <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> data<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
    <span style="color: #696969;">[(</span>'var v<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">([</span>found <span style="color: #696969;">(</span>bs/find bs v<span style="color: #696969;">)])</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> found
         <span style="color: #696969;">(</span>bs/walk bs found<span style="color: #696969;">)</span>
         d<span style="color: #696969;">))]</span>
    <span style="color: #696969;">[(</span>_ e<span style="color: #696969;">)</span> d<span style="color: #696969;">]))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">bs/deep</span> bs d<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> bs data <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> data<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">letrec*</span> <span style="color: #696969;">([</span>bs/deep-list
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>bs dl<span style="color: #696969;">)</span>
               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>bs/deep bs x<span style="color: #696969;">))</span> dl<span style="color: #696969;">))]</span>
            <span style="color: #696969;">[</span>bs/deep-arrow
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>bs a<span style="color: #696969;">)</span>
               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
                 <span style="color: #696969;">[(</span>dl1 dl2<span style="color: #696969;">)</span>
                  <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>bs/deep-list bs dl1<span style="color: #696969;">)</span>
                        <span style="color: #696969;">(</span>bs/deep-list bs dl2<span style="color: #696969;">))]))]</span>
            <span style="color: #696969;">[</span>bs/deep-arrow-list
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>bs al<span style="color: #696969;">)</span>
               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>a<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>bs/deep-arrow bs a<span style="color: #696969;">))</span> al<span style="color: #696969;">))])</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>bs/walk bs d<span style="color: #696969;">)</span>
      <span style="color: #696969;">[(</span>'var v<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>'var v<span style="color: #696969;">)]</span>
      <span style="color: #696969;">[(</span>'cons <span style="color: #696969;">(</span>name dl<span style="color: #696969;">))</span>
       <span style="color: #696969;">(</span>list 'cons
             <span style="color: #696969;">(</span>list name <span style="color: #696969;">(</span>bs/deep-list bs dl<span style="color: #696969;">)))]</span>
      <span style="color: #696969;">[(</span>'arrow a<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>list 'arrow <span style="color: #696969;">(</span>bs/deep-arrow bs a<span style="color: #696969;">))]</span>
      <span style="color: #696969;">[(</span>'lambda <span style="color: #696969;">(</span>a al<span style="color: #696969;">))</span>
       <span style="color: #696969;">(</span>list 'lambda
             <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>bs/deep-arrow bs a<span style="color: #696969;">)</span>
                   <span style="color: #696969;">(</span>bs/deep-arrow-list bs al<span style="color: #696969;">)))]</span>
      <span style="color: #696969;">[(</span>'trunk <span style="color: #696969;">(</span>a al dl i<span style="color: #696969;">))</span>
       <span style="color: #696969;">(</span>list 'trunk
             <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>bs/deep-arrow bs a<span style="color: #696969;">)</span>
                   <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>symbol? al<span style="color: #696969;">)</span>
                     al
                     <span style="color: #696969;">(</span>bs/deep-arrow-list bs al<span style="color: #696969;">))</span>
                   <span style="color: #696969;">(</span>bs/deep-list bs dl<span style="color: #696969;">)</span>
                   i<span style="color: #696969;">))])))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1f2389a" class="outline-3">
<h3 id="org1f2389a">pass3/name</h3>
<div class="outline-text-3" id="text-org1f2389a">
<ul class="org-ul">
<li><p>this can be optimized by</p><p>to do more computations before storing things into ns</p><p>but I leave it for now</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/name</span> n e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form3/name env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #696969;">[(</span>ds bs ns<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">([</span>found <span style="color: #696969;">(</span>assq n ns<span style="color: #696969;">)])</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not found<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> <span style="color: #696969;">(</span><span style="color: #e6db74;">"pass3/name unknow name : ~a~%"</span> n<span style="color: #696969;">))</span>
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">([</span>meaning <span style="color: #696969;">(</span>cdr found<span style="color: #696969;">)])</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> meaning
             <span style="color: #696969;">[(</span>'cons/type <span style="color: #696969;">((</span>ac sc<span style="color: #696969;">)</span> name _<span style="color: #696969;">))</span>
              <span style="color: #696969;">(</span>pass3/name/cons <span style="color: #696969;">(</span>length ac<span style="color: #696969;">)</span> name e<span style="color: #696969;">)]</span>
             <span style="color: #696969;">[(</span>'cons/data <span style="color: #696969;">((</span>ac sc<span style="color: #696969;">)</span> name _<span style="color: #696969;">))</span>
              <span style="color: #696969;">(</span>pass3/name/cons <span style="color: #696969;">(</span>length ac<span style="color: #696969;">)</span> name e<span style="color: #696969;">)]</span>
             <span style="color: #696969;">[(</span>'lambda <span style="color: #696969;">((</span>ac sc<span style="color: #696969;">)</span> al<span style="color: #696969;">))</span>
              <span style="color: #696969;">(</span>pass3/name/trunk <span style="color: #696969;">(</span>length ac<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>length sc<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>list ac sc<span style="color: #696969;">)</span> n e<span style="color: #696969;">)]))))]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org854758b" class="outline-3">
<h3 id="org854758b">pass3/name/cons</h3>
<div class="outline-text-3" id="text-org854758b">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/name/cons</span> len name e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> length name env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #696969;">[(</span>ds bs ns<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>list 'cons
                       <span style="color: #696969;">(</span>list name <span style="color: #696969;">(</span>sublist ds 0 len<span style="color: #696969;">)))</span>
                 <span style="color: #696969;">(</span>sublist ds len -1<span style="color: #696969;">))</span>
           bs
           ns<span style="color: #696969;">)]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb1a524e" class="outline-3">
<h3 id="orgb1a524e">pass3/name/trunk</h3>
<div class="outline-text-3" id="text-orgb1a524e">
<ul class="org-ul">
<li><p>when intro a trunk</p><p>only name should be recorded not the body</p><p>this is to handle recursive definitions</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/name/trunk</span> len slen a n e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> length length arrow name env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #696969;">[(</span>ds bs ns<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">([</span>a <span style="color: #696969;">(</span>copy-arrow a<span style="color: #696969;">)]</span>
            <span style="color: #696969;">[</span>dl <span style="color: #696969;">(</span>sublist ds 0 len<span style="color: #696969;">)]</span>
            <span style="color: #696969;">[</span>make-trunk <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>i<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>list 'trunk <span style="color: #696969;">(</span>list a n dl i<span style="color: #696969;">)))])</span>
       <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>append <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> make-trunk <span style="color: #696969;">(</span>genlist slen<span style="color: #696969;">))</span>
                     <span style="color: #696969;">(</span>sublist ds len -1<span style="color: #696969;">))</span>
             bs
             ns<span style="color: #696969;">))]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge5a7426" class="outline-3">
<h3 id="orge5a7426"><span class="todo _gt__lt__gt__lt__gt__lt_">&gt;&lt;&gt;&lt;&gt;&lt;</span> pass3/bind</h3>
<div class="outline-text-3" id="text-orge5a7426">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/bind</span> b e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form3/bind env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> b
    <span style="color: #696969;">[(</span>vl c leave?<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass3/cedent c e<span style="color: #696969;">)</span>
       <span style="color: #696969;">[((</span>d1 . _<span style="color: #696969;">)</span> _ _<span style="color: #696969;">)</span> <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">here I assume the c of bind is simple</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">letrec</span> <span style="color: #696969;">([</span>recur
                  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>vl e<span style="color: #696969;">)</span>
                    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>list vl e<span style="color: #696969;">)</span>
                      <span style="color: #696969;">[(()</span> _<span style="color: #696969;">)</span> e<span style="color: #696969;">]</span>
                      <span style="color: #696969;">[(((</span>id level<span style="color: #696969;">)</span> . r<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>ds bs ns<span style="color: #696969;">))</span>
                       <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">&gt;&lt;&gt;&lt;&gt;&lt;</span>
                       <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">need to check if the bind already exist</span>
                       <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">and to check type</span>
                       <span style="color: #696969;">(</span>id/commit! id <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>cons level d1<span style="color: #696969;">)))</span>
                       <span style="color: #696969;">(</span>recur r <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> leave?
                                        <span style="color: #696969;">(</span>cons d1 ds<span style="color: #696969;">)</span>
                                        ds<span style="color: #696969;">)</span>
                                      bs
                                      ns<span style="color: #696969;">))]))])</span>
          <span style="color: #696969;">(</span>recur vl e<span style="color: #696969;">))])]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbac3bd4" class="outline-3">
<h3 id="orgbac3bd4">id/commit!</h3>
<div class="outline-text-3" id="text-orgbac3bd4">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">id/commit!</span> id ls<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> id ls <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> id
     <span style="color: #696969;">[</span>with effect on id<span style="color: #696969;">])</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">()</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">vector-set!</span> id 1 <span style="color: #696969;">(</span>append ls <span style="color: #696969;">(</span>vector-ref id 1<span style="color: #696969;">)))</span>
    id<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgda5d75" class="outline-2">
<h2 id="orgda5d75">copy-arrow</h2>
<div class="outline-text-2" id="text-orgda5d75">
</div><div id="outline-container-org287ac1c" class="outline-3">
<h3 id="org287ac1c"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-org287ac1c">
<ul class="org-ul">
<li><p>the name in trunk will be changed to (arrow &#x2026;)</p><p>(arrow &#x2026;) is fetched from ns and copied</p></li>

<li><p>copy is arrow by arrow</p><p>every var in new arrow is different from old arrow</p><p>thus</p><p><ol class="org-ol"></p><p><li>scope is also arrow by arrow</li></p><p><li>a non-determinate var can not be substituted into lambda as it is</p><p>but is copied</li></ol></p></li>

<li><p>this copy is one of the main place where this prototype can be optimized</p><p>a vm can be designed to replace this copy function</p><p>and change the interpreter to a compiler</p></li></ul>
</div>
</div>

<div id="outline-container-org79d3ed9" class="outline-3">
<h3 id="org79d3ed9"><span class="todo note">note</span> data</h3>
<div class="outline-text-3" id="text-org79d3ed9">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> data
  <span style="color: #696969;">(</span>'var    <span style="color: #696969;">(</span>id level<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span>'cons   <span style="color: #696969;">(</span>name <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'arrow  <span style="color: #696969;">((</span>data ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'lambda <span style="color: #696969;">(</span>arrow <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'trunk  <span style="color: #696969;">(</span>arrow <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">or</span> name <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">))</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> index<span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1330e84" class="outline-3">
<h3 id="org1330e84">copy-arrow</h3>
<div class="outline-text-3" id="text-org1330e84">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy-arrow</span> a<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> arrow<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/arrow a '<span style="color: #696969;">())</span>
    <span style="color: #696969;">[(</span>a s<span style="color: #696969;">)</span> a<span style="color: #696969;">]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgad9b001" class="outline-3">
<h3 id="orgad9b001">copy/arrow</h3>
<div class="outline-text-3" id="text-orgad9b001">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy/arrow</span> a s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>arrow scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
    <span style="color: #696969;">[(</span>ac sc<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/cedent ac s<span style="color: #696969;">)</span>
       <span style="color: #696969;">[(</span>ac1 s1<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/cedent sc s1<span style="color: #696969;">)</span>
          <span style="color: #696969;">[(</span>sc1 s2<span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span>list ac1 sc1 s2<span style="color: #696969;">)])])]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org926c9e" class="outline-3">
<h3 id="org926c9e">copy/cedent</h3>
<div class="outline-text-3" id="text-org926c9e">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy/cedent</span> c s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">((</span>data ...<span style="color: #696969;">)</span> scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
    <span style="color: #696969;">[()</span> <span style="color: #696969;">(</span>list '<span style="color: #696969;">()</span> s<span style="color: #696969;">)]</span>
    <span style="color: #696969;">[(</span>h . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy h s<span style="color: #696969;">)</span>
       <span style="color: #696969;">[(</span>h1 s1<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/cedent r s1<span style="color: #696969;">)</span>
          <span style="color: #696969;">[(</span>r1 s2<span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>cons h1 r1<span style="color: #696969;">)</span> s2<span style="color: #696969;">)])])]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd857c2e" class="outline-3">
<h3 id="orgd857c2e">copy/lambda</h3>
<div class="outline-text-3" id="text-orgd857c2e">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy/lambda</span> l s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> lambda scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> l
    <span style="color: #696969;">[(</span>a al<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/arrow a s<span style="color: #696969;">)</span>
       <span style="color: #696969;">[(</span>a1 s1<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/arrow-list al s1<span style="color: #696969;">)</span>
          <span style="color: #696969;">[(</span>al1 s2<span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>list a1 al1<span style="color: #696969;">)</span> s2<span style="color: #696969;">)])])]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6c95585" class="outline-3">
<h3 id="org6c95585">copy/arrow-list</h3>
<div class="outline-text-3" id="text-org6c95585">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy/arrow-list</span> al s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)</span> scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">((</span>arrow ...<span style="color: #696969;">)</span> scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> al
    <span style="color: #696969;">[()</span> <span style="color: #696969;">(</span>list '<span style="color: #696969;">()</span> s<span style="color: #696969;">)]</span>
    <span style="color: #696969;">[(</span>h . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/arrow h s<span style="color: #696969;">)</span>
       <span style="color: #696969;">[(</span>h1 s1<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/arrow-list r s1<span style="color: #696969;">)</span>
          <span style="color: #696969;">[(</span>r1 s2<span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>cons h1 r1<span style="color: #696969;">)</span> s2<span style="color: #696969;">)])])]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org66e5d88" class="outline-3">
<h3 id="org66e5d88">copy</h3>
<div class="outline-text-3" id="text-org66e5d88">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy</span> d s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> data scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>data scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
    <span style="color: #696969;">[(</span>'var x<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/var x s<span style="color: #696969;">)</span>
       <span style="color: #696969;">[(</span>x1 s1<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>list 'var x1<span style="color: #696969;">)</span> s1<span style="color: #696969;">)])]</span>
    <span style="color: #696969;">[(</span>'cons x<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/cons x s<span style="color: #696969;">)</span>
       <span style="color: #696969;">[(</span>x1 s1<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>list 'cons x1<span style="color: #696969;">)</span> s1<span style="color: #696969;">)])]</span>
    <span style="color: #696969;">[(</span>'arrow x<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/arrow x s<span style="color: #696969;">)</span>
       <span style="color: #696969;">[(</span>x1 s1<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>list 'arrow x1<span style="color: #696969;">)</span> s1<span style="color: #696969;">)])]</span>
    <span style="color: #696969;">[(</span>'lambda x<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/lambda x s<span style="color: #696969;">)</span>
       <span style="color: #696969;">[(</span>x1 s1<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>list 'lambda x1<span style="color: #696969;">)</span> s1<span style="color: #696969;">)])]</span>
    <span style="color: #696969;">[(</span>'trunk x<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/trunk x s<span style="color: #696969;">)</span>
       <span style="color: #696969;">[(</span>x1 s1<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>list 'trunk x1<span style="color: #696969;">)</span> s1<span style="color: #696969;">)])]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6b9e9c" class="outline-3">
<h3 id="org6b9e9c">copy/var</h3>
<div class="outline-text-3" id="text-org6b9e9c">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy/var</span> v s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> var scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>var scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> v
    <span style="color: #696969;">[(</span>id level<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">([</span>found <span style="color: #696969;">(</span>assq id s<span style="color: #696969;">)])</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> found
         <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>cdr found<span style="color: #696969;">)</span> level<span style="color: #696969;">)</span> s<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">([</span>ls <span style="color: #696969;">(</span>id-&gt;ls id<span style="color: #696969;">)]</span>
                <span style="color: #696969;">[</span>id1 <span style="color: #696969;">(</span>vector <span style="color: #696969;">(</span>id-&gt;symbol id<span style="color: #696969;">)</span> '<span style="color: #696969;">())]</span>
                <span style="color: #696969;">[</span>s1 <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>cons id id1<span style="color: #696969;">)</span> s<span style="color: #696969;">)])</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/ls ls s1<span style="color: #696969;">)</span>
             <span style="color: #696969;">[(</span>ls1 s2<span style="color: #696969;">)</span>
              <span style="color: #696969;">(</span>id/commit! id1 ls1<span style="color: #696969;">)</span>
              <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>list id1 level<span style="color: #696969;">)</span> s2<span style="color: #696969;">)]))))]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7526a3c" class="outline-3">
<h3 id="org7526a3c">copy/ls</h3>
<div class="outline-text-3" id="text-org7526a3c">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy/ls</span> ls s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> ls scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>ls scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> ls
    <span style="color: #696969;">[()</span> <span style="color: #696969;">(</span>list '<span style="color: #696969;">()</span> s<span style="color: #696969;">)]</span>
    <span style="color: #696969;">[((</span>level . data<span style="color: #696969;">)</span> . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy data s<span style="color: #696969;">)</span>
       <span style="color: #696969;">[(</span>data1 s1<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/ls r s1<span style="color: #696969;">)</span>
          <span style="color: #696969;">[(</span>r1 s2<span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>cons level data1<span style="color: #696969;">)</span>
                       r1<span style="color: #696969;">)</span>
                 s2<span style="color: #696969;">)])])]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6393c22" class="outline-3">
<h3 id="org6393c22">copy/cons</h3>
<div class="outline-text-3" id="text-org6393c22">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy/cons</span> c s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cons scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>cons scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
    <span style="color: #696969;">[(</span>n dl<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/cedent dl s<span style="color: #696969;">)</span>
       <span style="color: #696969;">[(</span>dl1 s1<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>list n dl1<span style="color: #696969;">)</span> s1<span style="color: #696969;">)])]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org353ce99" class="outline-3">
<h3 id="org353ce99">copy/trunk</h3>
<div class="outline-text-3" id="text-org353ce99">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy/trunk</span> p s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">trunk</span> scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> p
    <span style="color: #696969;">[(</span>a al dl i<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>symbol? al<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/arrow a s<span style="color: #696969;">)</span>
         <span style="color: #696969;">[(</span>a1 s1<span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/cedent dl s1<span style="color: #696969;">)</span>
            <span style="color: #696969;">[(</span>dl1 s2<span style="color: #696969;">)</span>
             <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>list a1 al dl1 i<span style="color: #696969;">)</span> s2<span style="color: #696969;">)])])</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/arrow a s<span style="color: #696969;">)</span>
         <span style="color: #696969;">[(</span>a1 s1<span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/arrow-list al s1<span style="color: #696969;">)</span>
            <span style="color: #696969;">[(</span>al1 s2<span style="color: #696969;">)</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/cedent dl s2<span style="color: #696969;">)</span>
               <span style="color: #696969;">[(</span>dl1 s3<span style="color: #696969;">)</span>
                <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>list a1 al1 dl1 i<span style="color: #696969;">)</span> s3<span style="color: #696969;">)])])]))]))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org98833b3" class="outline-2">
<h2 id="org98833b3">compute</h2>
<div class="outline-text-2" id="text-org98833b3">
</div><div id="outline-container-orgdf3b5ca" class="outline-3">
<h3 id="orgdf3b5ca"><span class="todo note">note</span> data</h3>
<div class="outline-text-3" id="text-orgdf3b5ca">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> data
  <span style="color: #696969;">(</span>'var    <span style="color: #696969;">(</span>id level<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span>'cons   <span style="color: #696969;">(</span>name <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'arrow  <span style="color: #696969;">((</span>data ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'lambda <span style="color: #696969;">(</span>arrow <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'trunk  <span style="color: #696969;">(</span>arrow <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">or</span> name <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">))</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> index<span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org49ec817" class="outline-3">
<h3 id="org49ec817"><span class="todo note">note</span> env</h3>
<div class="outline-text-3" id="text-org49ec817">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> env <span style="color: #696969;">(</span>ds bs ns<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> ds <span style="color: #696969;">(</span>data ...<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> bs <span style="color: #696969;">((</span>id . ls<span style="color: #696969;">)</span> ...<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> ns <span style="color: #696969;">((</span>name . meaning<span style="color: #696969;">)</span> ...<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> ls <span style="color: #696969;">((</span>level . data<span style="color: #696969;">)</span> ...<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> meaning
  <span style="color: #696969;">(</span>'cons/type <span style="color: #696969;">(</span>arrow name <span style="color: #696969;">(</span>name ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'cons/data <span style="color: #696969;">(</span>arrow name name<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span>'lambda    <span style="color: #696969;">(</span>arrow <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">))))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org70ef0a3" class="outline-3">
<h3 id="org70ef0a3">compute/arrow</h3>
<div class="outline-text-3" id="text-org70ef0a3">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">compute/arrow</span> a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #696969;">[(</span>ds bs ns<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
       <span style="color: #696969;">[(</span>ac sc<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>unify <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>compute/cedent ac x<span style="color: #696969;">))</span>
                      <span style="color: #696969;">(</span>list ds
                            <span style="color: #696969;">(</span>cons '<span style="color: #696969;">(</span>commit-point<span style="color: #696969;">)</span> bs<span style="color: #696969;">)</span>
                            ns<span style="color: #696969;">))</span>
          <span style="color: #696969;">[(</span>'fail il<span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span>list 'fail
                 <span style="color: #696969;">(</span>cons `<span style="color: #696969;">(</span>compute/arrow fail <span style="color: #696969;">(</span>arrow: ,a<span style="color: #696969;">))</span> il<span style="color: #696969;">))]</span>
          <span style="color: #696969;">[(</span>'success e1<span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/cedent sc e1<span style="color: #696969;">)</span>
             <span style="color: #696969;">[(</span>ds2 bs2 ns2<span style="color: #696969;">)</span>
              <span style="color: #696969;">(</span>list 'success
                    <span style="color: #696969;">(</span>list ds2 <span style="color: #696969;">(</span>bs/commit! bs2<span style="color: #696969;">)</span> ns2<span style="color: #696969;">))])])])]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge3e02a6" class="outline-3">
<h3 id="orge3e02a6">bs/commit!</h3>
<div class="outline-text-3" id="text-orge3e02a6">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">bs/commit!</span> bs<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> bs <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> bs
     <span style="color: #696969;">[</span>with effect on part of elements of bs<span style="color: #696969;">])</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">cond</span> <span style="color: #696969;">[(</span>equal? '<span style="color: #696969;">(</span>commit-point<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>car bs<span style="color: #696969;">))</span>
         <span style="color: #696969;">(</span>cdr bs<span style="color: #696969;">)]</span>
        <span style="color: #696969;">[</span>else
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">([</span>pair <span style="color: #696969;">(</span>car bs<span style="color: #696969;">)]</span>
                <span style="color: #696969;">[</span>id <span style="color: #696969;">(</span>car pair<span style="color: #696969;">)]</span>
                <span style="color: #696969;">[</span>ls <span style="color: #696969;">(</span>cdr pair<span style="color: #696969;">)])</span>
           <span style="color: #696969;">(</span>id/commit! id ls<span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span>bs/commit! <span style="color: #696969;">(</span>cdr bs<span style="color: #696969;">)))]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org21624af" class="outline-3">
<h3 id="org21624af">compute/cedent</h3>
<div class="outline-text-3" id="text-org21624af">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">compute/cedent</span> c e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cedent env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
    <span style="color: #696969;">[()</span> <span style="color: #696969;">(</span>list 'success e<span style="color: #696969;">)]</span>
    <span style="color: #696969;">[(</span>h . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute h e<span style="color: #696969;">)</span>
       <span style="color: #696969;">[(</span>'fail il<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>'fail il<span style="color: #696969;">)]</span>
       <span style="color: #696969;">[(</span>'success e1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>compute/cedent r e1<span style="color: #696969;">)])]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2801c43" class="outline-3">
<h3 id="org2801c43">compute</h3>
<div class="outline-text-3" id="text-org2801c43">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">compute</span> d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #696969;">[(</span>ds bs ns<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
       <span style="color: #696969;">[(</span>'var v<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>compute/var v e<span style="color: #696969;">)]</span>
       <span style="color: #696969;">[(</span>'trunk t<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>compute/trunk t e<span style="color: #696969;">)]</span>
       <span style="color: #696969;">[</span>_
        <span style="color: #696969;">(</span>list 'success
              <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>cons d ds<span style="color: #696969;">)</span> bs ns<span style="color: #696969;">))])]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2916056" class="outline-3">
<h3 id="org2916056">ompute/var</h3>
<div class="outline-text-3" id="text-org2916056">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">compute/var</span> v e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> var env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #696969;">[(</span>ds bs ns<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>list 'success
           <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>bs/deep bs <span style="color: #696969;">(</span>list 'var v<span style="color: #696969;">))</span>
                       ds<span style="color: #696969;">)</span>
                 bs
                 ns<span style="color: #696969;">))]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga43961a" class="outline-3">
<h3 id="orga43961a">trunk-&gt;trunk*</h3>
<div class="outline-text-3" id="text-orga43961a">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">trunk-&gt;trunk*</span> t e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> trunk<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #696969;">[(</span>ds bs ns<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> t
       <span style="color: #696969;">[(</span>a al dl i<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not <span style="color: #696969;">(</span>symbol? al<span style="color: #696969;">))</span>
          al
          <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">this is the only place (arrow ...) is copied</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">([</span>n al<span style="color: #696969;">]</span>
                 <span style="color: #696969;">[</span>found <span style="color: #696969;">(</span>assq n ns<span style="color: #696969;">)])</span>
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not found<span style="color: #696969;">)</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> <span style="color: #696969;">(</span><span style="color: #e6db74;">"trunk-&gt;trunk* fail~%"</span> <span style="color: #696969;">)</span>
                   <span style="color: #696969;">(</span><span style="color: #e6db74;">"unknow name : ~a~%"</span> n<span style="color: #696969;">))</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">([</span>meaning <span style="color: #696969;">(</span>cdr found<span style="color: #696969;">)])</span>
                <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> meaning
                  <span style="color: #696969;">[(</span>'lambda <span style="color: #696969;">((</span>ac sc<span style="color: #696969;">)</span> al1<span style="color: #696969;">))</span>
                   <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> copy-arrow al1<span style="color: #696969;">)]</span>
                  <span style="color: #696969;">[</span>_
                   <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> <span style="color: #696969;">(</span><span style="color: #e6db74;">"trunk-&gt;trunk* fail~%"</span> <span style="color: #696969;">)</span>
                        <span style="color: #696969;">(</span><span style="color: #e6db74;">"name is not lambda : ~a~%"</span> n<span style="color: #696969;">))])))))])]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfd7bb89" class="outline-3">
<h3 id="orgfd7bb89">compute/trunk</h3>
<div class="outline-text-3" id="text-orgfd7bb89">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">compute/trunk</span> t e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #696969;">[(</span>ds bs ns<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>trunk-&gt;trunk* t e<span style="color: #696969;">)</span>
       <span style="color: #696969;">[(</span>a al dl i<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">([</span>dl1 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>bs/deep bs x<span style="color: #696969;">))</span> dl<span style="color: #696969;">)]</span>
               <span style="color: #696969;">[</span>al1 <span style="color: #696969;">(</span>filter-arrow-list al dl1 e<span style="color: #696969;">)])</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> al1
            <span style="color: #696969;">[()</span>
             <span style="color: #696969;">(</span>list 'fail
                   <span style="color: #696969;">(</span>list `<span style="color: #696969;">(</span>compute/trunk
                           no antecedent match
                           <span style="color: #696969;">(</span>trunk: ,t<span style="color: #696969;">))))]</span>
            <span style="color: #696969;">[(</span>a1<span style="color: #696969;">)</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/arrow a1 <span style="color: #696969;">(</span>list dl1 bs ns<span style="color: #696969;">))</span>
               <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">after this compute/arrow</span>
               <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">binds are commited</span>
               <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">then the old env e is used</span>
               <span style="color: #696969;">[(</span>'success e1<span style="color: #696969;">)</span>
                <span style="color: #696969;">(</span>list 'success
                      <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>proj i e1<span style="color: #696969;">)</span> ds<span style="color: #696969;">)</span>
                            bs
                            ns<span style="color: #696969;">))]</span>
               <span style="color: #696969;">[(</span>'fail il<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>'fail il<span style="color: #696969;">)])]</span>
            <span style="color: #696969;">[(</span>a1 a2 . _<span style="color: #696969;">)</span>
             <span style="color: #696969;">(</span>list 'success
                   <span style="color: #696969;">(</span>list a al1 dl i<span style="color: #696969;">))]))])]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org22ff76e" class="outline-3">
<h3 id="org22ff76e">filter-arrow-list</h3>
<div class="outline-text-3" id="text-org22ff76e">
<ul class="org-ul">
<li><p>no commit should be made here</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">filter-arrow-list</span> al dl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>eq? '<span style="color: #696969;">()</span> al<span style="color: #696969;">)</span>
    '<span style="color: #696969;">()</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
      <span style="color: #696969;">[(</span>ds bs ns<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>car al<span style="color: #696969;">)</span>
         <span style="color: #696969;">[(</span>ac sc<span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>unify <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>compute/cedent ac x<span style="color: #696969;">))</span>
                        <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>append dl ds<span style="color: #696969;">)</span>
                              bs
                              ns<span style="color: #696969;">))</span>
            <span style="color: #696969;">[(</span>'fail _<span style="color: #696969;">)</span>
             <span style="color: #696969;">(</span>filter-arrow-list <span style="color: #696969;">(</span>cdr al<span style="color: #696969;">)</span> dl e<span style="color: #696969;">)]</span>
            <span style="color: #696969;">[(</span>'success e1<span style="color: #696969;">)</span>
             <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>car al<span style="color: #696969;">)</span>
                   <span style="color: #696969;">(</span>filter-arrow-list <span style="color: #696969;">(</span>cdr al<span style="color: #696969;">)</span> dl e<span style="color: #696969;">))])])])))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org56531c0" class="outline-3">
<h3 id="org56531c0">proj</h3>
<div class="outline-text-3" id="text-org56531c0">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">proj</span> i e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> index env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> data<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #696969;">[(</span>ds bs ns<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>list-ref ds <span style="color: #696969;">(</span>- <span style="color: #696969;">(</span>length ds<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>+ 1 i<span style="color: #696969;">)))]))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org82e734e" class="outline-2">
<h2 id="org82e734e">unify</h2>
<div class="outline-text-2" id="text-org82e734e">
</div><div id="outline-container-org3636935" class="outline-3">
<h3 id="org3636935"><span class="todo note">note</span> report</h3>
<div class="outline-text-3" id="text-org3636935">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> report
  <span style="color: #696969;">(</span>'fail <span style="color: #696969;">(</span>info ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span>'success env<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> info <span style="color: #66d9ef; font-weight: bold;">&lt;free&gt;</span><span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org68a5887" class="outline-3">
<h3 id="org68a5887">unify</h3>
<div class="outline-text-3" id="text-org68a5887">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify</span> f e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #696969;">[(</span>ds bs ns<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>f <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>cons 'unify-point ds<span style="color: #696969;">)</span> bs ns<span style="color: #696969;">))</span>
       <span style="color: #696969;">[(</span>'fail il<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span>list 'fail
              <span style="color: #696969;">(</span>cons `<span style="color: #696969;">(</span>unify <span style="color: #696969;">(</span>with: ,f<span style="color: #696969;">))</span> il<span style="color: #696969;">))]</span>
       <span style="color: #696969;">[(</span>'success <span style="color: #696969;">(</span>ds1 bs1 ns1<span style="color: #696969;">))</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">([</span>pl <span style="color: #696969;">(</span>left-of 'unify-point ds1<span style="color: #696969;">)]</span>
               <span style="color: #696969;">[</span>tmp <span style="color: #696969;">(</span>right-of 'unify-point ds1<span style="color: #696969;">)]</span>
               <span style="color: #696969;">[</span>len <span style="color: #696969;">(</span>length pl<span style="color: #696969;">)]</span>
               <span style="color: #696969;">[</span>dl <span style="color: #696969;">(</span>sublist tmp 0 len<span style="color: #696969;">)]</span>
               <span style="color: #696969;">[</span>ds2 <span style="color: #696969;">(</span>sublist tmp len -1<span style="color: #696969;">)])</span>
          <span style="color: #696969;">(</span>unify/data-list pl dl
                           <span style="color: #696969;">(</span>list 'success <span style="color: #696969;">(</span>list ds2 bs ns<span style="color: #696969;">))))])]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgee018fb" class="outline-3">
<h3 id="orgee018fb">unify/data-list</h3>
<div class="outline-text-3" id="text-orgee018fb">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/data-list</span> pl dl r<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>pattern ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> report <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> r
    <span style="color: #696969;">[(</span>'fail il<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>'fail il<span style="color: #696969;">)]</span>
    <span style="color: #696969;">[(</span>'success e<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>eq? pl '<span style="color: #696969;">())</span>
       r
       <span style="color: #696969;">(</span>unify/data-list
        <span style="color: #696969;">(</span>cdr pl<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>cdr dl<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span>unify/data <span style="color: #696969;">(</span>car pl<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>car dl<span style="color: #696969;">)</span> e<span style="color: #696969;">)))]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1e911db" class="outline-3">
<h3 id="org1e911db">var/eq?</h3>
<div class="outline-text-3" id="text-org1e911db">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">var/eq?</span> v1 v2<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>list v1 v2<span style="color: #696969;">)</span>
    <span style="color: #696969;">[((</span>id1 level1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>id2 level2<span style="color: #696969;">))</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>eq? id1 id2<span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span>eq? level1 level2<span style="color: #696969;">))]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcba4fb8" class="outline-3">
<h3 id="orgcba4fb8"><span class="todo _gt__lt__gt__lt__gt__lt_">&gt;&lt;&gt;&lt;&gt;&lt;</span> unify/data</h3>
<div class="outline-text-3" id="text-orgcba4fb8">
<ul class="org-ul">
<li><p>need to check type for fresh var</p><p>maybe more then var</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/data</span> p d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> pattern data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #696969;">[(</span>ds bs ns<span style="color: #696969;">)</span>
     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">var -walk-&gt; fresh-var</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">([</span>p <span style="color: #696969;">(</span>bs/walk bs p<span style="color: #696969;">)]</span>
           <span style="color: #696969;">[</span>d <span style="color: #696969;">(</span>bs/walk bs d<span style="color: #696969;">)])</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>list p d<span style="color: #696969;">)</span>
         <span style="color: #696969;">[((</span>'var v1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>'var v2<span style="color: #696969;">))</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>var/eq? v1 v2<span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span>list 'success e<span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span>list 'success
                  <span style="color: #696969;">(</span>list ds
                        <span style="color: #696969;">(</span>bs/extend bs v1 d<span style="color: #696969;">)</span>
                        ns<span style="color: #696969;">)))]</span>
         <span style="color: #696969;">[((</span>'var v<span style="color: #696969;">)</span> _<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>unify/var/data v d e<span style="color: #696969;">)]</span>
         <span style="color: #696969;">[(</span>_ <span style="color: #696969;">(</span>'var v<span style="color: #696969;">))</span> <span style="color: #696969;">(</span>unify/var/data v p e<span style="color: #696969;">)]</span>

         <span style="color: #696969;">[((</span>'trunk t1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>'trunk t2<span style="color: #696969;">))</span> <span style="color: #696969;">(</span>unify/trunk t1 t2 e<span style="color: #696969;">)]</span>
         <span style="color: #696969;">[((</span>'trunk t<span style="color: #696969;">)</span> _<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>unify/trunk/data t d e<span style="color: #696969;">)]</span>
         <span style="color: #696969;">[(</span>_ <span style="color: #696969;">(</span>'trunk t<span style="color: #696969;">))</span> <span style="color: #696969;">(</span>unify/trunk/data t p e<span style="color: #696969;">)]</span>

         <span style="color: #696969;">[((</span>'cons c1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>'cons c2<span style="color: #696969;">))</span> <span style="color: #696969;">(</span>unify/cons c1 c2 e<span style="color: #696969;">)]</span>
         <span style="color: #696969;">[((</span>'arrow a1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>'arrow a2<span style="color: #696969;">))</span> <span style="color: #696969;">(</span>unify/arrow a1 a2 e<span style="color: #696969;">)]</span>
         <span style="color: #696969;">[((</span>'lambda l1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>'lambda l2<span style="color: #696969;">))</span> <span style="color: #696969;">(</span>unify/lambda l1 l2 e<span style="color: #696969;">)]</span>
         <span style="color: #696969;">[(</span>_ _<span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span>list 'fail
                <span style="color: #696969;">(</span>list '<span style="color: #696969;">(</span>unify/data
                        fail to unify
                        <span style="color: #696969;">(</span>pattern: ,p<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>data: ,d<span style="color: #696969;">))))]))]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb527f57" class="outline-3">
<h3 id="orgb527f57">bs/extend</h3>
<div class="outline-text-3" id="text-orgb527f57">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">bs/extend</span> bs v d<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> bs var data <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> bs<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> v
    <span style="color: #696969;">[(</span>id level<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">([</span>found/ls <span style="color: #696969;">(</span>assq id bs<span style="color: #696969;">)])</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> found/ls
         <span style="color: #696969;">(</span>substitute <span style="color: #696969;">(</span>cons id <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>cons level d<span style="color: #696969;">)</span>
                                    <span style="color: #696969;">(</span>cdr found/ls<span style="color: #696969;">)))</span>
                     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>pair<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>eq? <span style="color: #696969;">(</span>car pair<span style="color: #696969;">)</span> id<span style="color: #696969;">))</span>
                     bs<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>cons id <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>cons level d<span style="color: #696969;">)))</span>
               bs<span style="color: #696969;">)))]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge5514b3" class="outline-3">
<h3 id="orge5514b3">unify/var/data</h3>
<div class="outline-text-3" id="text-orge5514b3">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/var/data</span> v d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> var data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #696969;">[(</span>ds bs ns<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>list 'success
           <span style="color: #696969;">(</span>list ds <span style="color: #696969;">(</span>bs/extend bs v d<span style="color: #696969;">)</span> ns<span style="color: #696969;">))]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4619195" class="outline-3">
<h3 id="org4619195">unify/cons</h3>
<div class="outline-text-3" id="text-org4619195">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/cons</span> c1 c2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cons cons env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>list c1 c2<span style="color: #696969;">)</span>
    <span style="color: #696969;">[((</span>n1 dl1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>n2 dl2<span style="color: #696969;">))</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>eq? n1 n2<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>unify/data-list dl1 dl2 <span style="color: #696969;">(</span>list 'success e<span style="color: #696969;">))</span>
       <span style="color: #696969;">(</span>list 'fail
             <span style="color: #696969;">(</span>list `<span style="color: #696969;">(</span>unify/cons
                     fail <span style="color: #696969;">(</span>cons1: ,c1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>cons: ,c2<span style="color: #696969;">)))))]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc416710" class="outline-3">
<h3 id="orgc416710">unify/arrow</h3>
<div class="outline-text-3" id="text-orgc416710">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/arrow</span> a1 a2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>list a1 a2<span style="color: #696969;">)</span>
    <span style="color: #696969;">[((</span>ac1 sc1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>ac2 sc2<span style="color: #696969;">))</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>unify/data-list ac1 ac2 <span style="color: #696969;">(</span>list 'success e<span style="color: #696969;">))</span>
       <span style="color: #696969;">[(</span>'success e1<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span>unify/data-list sc1 sc2 <span style="color: #696969;">(</span>list 'success e1<span style="color: #696969;">))]</span>
       <span style="color: #696969;">[(</span>'fail il<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span>list 'fail
              <span style="color: #696969;">(</span>cons `<span style="color: #696969;">(</span>unify/arrow
                      fail  <span style="color: #696969;">(</span>arrow1: ,a1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>arrow2: ,a2<span style="color: #696969;">))</span>
                    il<span style="color: #696969;">))])]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf9e1526" class="outline-3">
<h3 id="orgf9e1526">unify/lambda</h3>
<div class="outline-text-3" id="text-orgf9e1526">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/lambda</span> l1 l2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> lambda lambda env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>list l1 l2<span style="color: #696969;">)</span>
    <span style="color: #696969;">[((</span>a1 al1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>a2 al2<span style="color: #696969;">))</span>
     <span style="color: #696969;">(</span>unify/arrow-list al1 al2 <span style="color: #696969;">(</span>unify/arrow a1 a2 e<span style="color: #696969;">))]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2f2baa1" class="outline-3">
<h3 id="org2f2baa1">unify/arrow-list</h3>
<div class="outline-text-3" id="text-org2f2baa1">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/arrow-list</span> al1 al2 r<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)</span> report <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> r
    <span style="color: #696969;">[(</span>'fail il<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>'fail il<span style="color: #696969;">)]</span>
    <span style="color: #696969;">[(</span>'success e<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>eq? al1 '<span style="color: #696969;">())</span>
       r
       <span style="color: #696969;">(</span>unify/arrow-list
        <span style="color: #696969;">(</span>cdr al1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>cdr al2<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span>unify/arrow <span style="color: #696969;">(</span>car al1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>car al2<span style="color: #696969;">)</span> e<span style="color: #696969;">)))]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc3d02ee" class="outline-3">
<h3 id="orgc3d02ee">unify/trunk</h3>
<div class="outline-text-3" id="text-orgc3d02ee">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/trunk</span> t1 t2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>trunk-&gt;trunk* t1 e<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>trunk-&gt;trunk* t2 e<span style="color: #696969;">))</span>
    <span style="color: #696969;">[((</span>a1 al1 dl1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>a2 al2 dl2<span style="color: #696969;">))</span>
     <span style="color: #696969;">(</span>unify/data-list dl1 dl2 <span style="color: #696969;">(</span>unify/lambda <span style="color: #696969;">(</span>list a1 al1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>list a2 al2<span style="color: #696969;">)</span> e<span style="color: #696969;">))]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfda7243" class="outline-3">
<h3 id="orgfda7243">unify/trunk/data</h3>
<div class="outline-text-3" id="text-orgfda7243">
<ul class="org-ul">
<li><p>filter here arrow-list</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/trunk/data</span> t d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/trunk t e<span style="color: #696969;">)</span>
    <span style="color: #696969;">[(</span>'fail il<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>list 'fail
           <span style="color: #696969;">(</span>cons `<span style="color: #696969;">(</span>unify/trunk/data
                   <span style="color: #696969;">(</span>trunk: ,t<span style="color: #696969;">)</span>
                   <span style="color: #696969;">(</span>data: ,d<span style="color: #696969;">))</span>
                 il<span style="color: #696969;">))]</span>
    <span style="color: #696969;">[(</span>'success e1<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>env/pop e1<span style="color: #696969;">)</span>
       <span style="color: #696969;">[((</span>'trunk t1<span style="color: #696969;">)</span> e2<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span>list 'fail
              <span style="color: #696969;">(</span>list `<span style="color: #696969;">(</span>unify/trunk/data
                      <span style="color: #696969;">(</span>trunk: ,t<span style="color: #696969;">)</span>
                      compute to
                      <span style="color: #696969;">(</span>trunk: ,t1<span style="color: #696969;">))))]</span>
       <span style="color: #696969;">[(</span>d1 e2<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span>unify/data d1 d e2<span style="color: #696969;">)])]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2f517f" class="outline-3">
<h3 id="org2f517f">env/pop</h3>
<div class="outline-text-3" id="text-org2f517f">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">env/pop</span> e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>data env<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #696969;">[((</span>d . r<span style="color: #696969;">)</span> bs ns<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>list d <span style="color: #696969;">(</span>list r bs ns<span style="color: #696969;">))]))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf10f6ac" class="outline-2">
<h2 id="orgf10f6ac">eva</h2>
<div class="outline-text-2" id="text-orgf10f6ac">
</div><div id="outline-container-org242762e" class="outline-3">
<h3 id="org242762e"><span class="todo note">note</span> top</h3>
<div class="outline-text-3" id="text-org242762e">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> top
  <span style="color: #696969;">(</span>'dt <span style="color: #696969;">((</span>form1/name form1/arrow<span style="color: #696969;">)</span> <span style="color: #696969;">((</span>form1/name form1/arrow<span style="color: #696969;">)</span> ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'df <span style="color: #696969;">((</span>form1/name form1/arrow<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>form1/arrow ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'ap form1/arrow<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd7ea8bb" class="outline-3">
<h3 id="orgd7ea8bb"><span class="todo note">note</span> env</h3>
<div class="outline-text-3" id="text-orgd7ea8bb">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> env <span style="color: #696969;">(</span>ds bs ns<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> ds <span style="color: #696969;">(</span>data ...<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> bs <span style="color: #696969;">((</span>id . ls<span style="color: #696969;">)</span> ...<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> ns <span style="color: #696969;">((</span>name . meaning<span style="color: #696969;">)</span> ...<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> ls <span style="color: #696969;">((</span>level . data<span style="color: #696969;">)</span> ...<span style="color: #696969;">))</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> meaning
  <span style="color: #696969;">(</span>'cons/type <span style="color: #696969;">(</span>arrow name <span style="color: #696969;">(</span>name ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'cons/data <span style="color: #696969;">(</span>arrow name name<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span>'lambda    <span style="color: #696969;">(</span>arrow <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">))))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org19e40ba" class="outline-3">
<h3 id="org19e40ba">eva</h3>
<div class="outline-text-3" id="text-org19e40ba">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define-syntax</span> <span style="color: #fd971f;">eva</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">syntax-rules</span> <span style="color: #696969;">()</span>
    <span style="color: #696969;">[(</span>eva e ...<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>eva/top-list
      <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">quote</span> <span style="color: #696969;">(</span>e ...<span style="color: #696969;">))</span>
      '<span style="color: #696969;">(()</span> <span style="color: #696969;">()</span> <span style="color: #696969;">()))]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org50034f5" class="outline-3">
<h3 id="org50034f5">eva/top-list</h3>
<div class="outline-text-3" id="text-org50034f5">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">eva/top-list</span> tl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>top ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> tl
    <span style="color: #696969;">[()</span> e<span style="color: #696969;">]</span>
    <span style="color: #696969;">[(</span>t . r<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>eva/top-list r <span style="color: #696969;">(</span>eva/top t e<span style="color: #696969;">))]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org224c347" class="outline-3">
<h3 id="org224c347">eva/top</h3>
<div class="outline-text-3" id="text-org224c347">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">eva/top</span> t e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> top env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> t
    <span style="color: #696969;">[(</span>'dt dt<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>eva/dt dt e<span style="color: #696969;">)]</span>
    <span style="color: #696969;">[(</span>'df df<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>eva/df df e<span style="color: #696969;">)]</span>
    <span style="color: #696969;">[(</span>'ap a<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>eva/ap a e<span style="color: #696969;">)]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgde68da" class="outline-3">
<h3 id="orgde68da">form1/arrow-&gt;arrow</h3>
<div class="outline-text-3" id="text-orgde68da">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">form1/arrow-&gt;arrow</span> a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form1/arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> arrow<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/arrow <span style="color: #696969;">(</span>pass1/arrow 0 a<span style="color: #696969;">)</span> '<span style="color: #696969;">())</span>
    <span style="color: #696969;">[(</span>a1 s<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>pass3/get-arrow a1 e<span style="color: #696969;">)]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd377c2" class="outline-3">
<h3 id="orgd377c2">eva/dt</h3>
<div class="outline-text-3" id="text-orgd377c2">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">eva/dt</span> dt e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">((</span>form1/name form1/arrow<span style="color: #696969;">)</span> <span style="color: #696969;">((</span>form1/name form1/arrow<span style="color: #696969;">)</span> ...<span style="color: #696969;">))</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #696969;">[(</span>ds bs ns<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> dt
       <span style="color: #696969;">[((</span>n a<span style="color: #696969;">)</span> nal<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">([</span>nl <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> car nal<span style="color: #696969;">)]</span>
               <span style="color: #696969;">[</span>a0 <span style="color: #696969;">(</span>form1/arrow-&gt;arrow a e<span style="color: #696969;">)]</span>
               <span style="color: #696969;">[</span>ns1 <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>list 'cons/type
                                <span style="color: #696969;">(</span>list a0 n nl<span style="color: #696969;">))</span>
                          ns<span style="color: #696969;">)])</span>
          <span style="color: #696969;">(</span>eva/dt/data-constructor-list n nal <span style="color: #696969;">(</span>list ds bs ns1<span style="color: #696969;">)))])]))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">eva/dt/data-constructor</span> type-name na e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> name <span style="color: #696969;">(</span>form1/name form1/arrow<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #696969;">[(</span>ds bs ns<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> na
       <span style="color: #696969;">[(</span>n a<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">([</span>a0 <span style="color: #696969;">(</span>form1/arrow-&gt;arrow a e<span style="color: #696969;">)])</span>
          <span style="color: #696969;">(</span>list ds
                bs
                <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>cons n
                            <span style="color: #696969;">(</span>list 'cons/data
                                  <span style="color: #696969;">(</span>list a0 n type-name<span style="color: #696969;">)))</span>
                      ns<span style="color: #696969;">)))])]))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">eva/dt/data-constructor-list</span> type-name nal e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> name <span style="color: #696969;">((</span>form1/name form1/arrow<span style="color: #696969;">)</span> ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> nal
    <span style="color: #696969;">[()</span> e<span style="color: #696969;">]</span>
    <span style="color: #696969;">[(</span>na . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>eva/dt/data-constructor-list
      type-name r
      <span style="color: #696969;">(</span>eva/dt/data-constructor type-name na e<span style="color: #696969;">))]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgab2275d" class="outline-3">
<h3 id="orgab2275d">eva/df</h3>
<div class="outline-text-3" id="text-orgab2275d">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">eva/df</span> df e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">((</span>form1/name form1/arrow<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>form1/arrow ...<span style="color: #696969;">))</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #696969;">[(</span>ds bs ns<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> df
       <span style="color: #696969;">[((</span>n a<span style="color: #696969;">)</span> al<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">([</span>a0 <span style="color: #696969;">(</span>form1/arrow-&gt;arrow a e<span style="color: #696969;">)]</span>
               <span style="color: #696969;">[</span>al0 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>form1/arrow-&gt;arrow x e<span style="color: #696969;">))</span> al<span style="color: #696969;">)]</span>
               <span style="color: #696969;">[</span>ns1 <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>cons n
                                <span style="color: #696969;">(</span>list 'lambda
                                      <span style="color: #696969;">(</span>list a0 al0<span style="color: #696969;">)))</span>
                          ns<span style="color: #696969;">)])</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>check <span style="color: #696969;">(</span>copy-arrow a0<span style="color: #696969;">)</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> copy-arrow al0<span style="color: #696969;">)</span>
                        <span style="color: #696969;">(</span>list ds bs ns1<span style="color: #696969;">))</span>
            <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">note that the bs of the env</span>
            <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">returned by check is not clean</span>
            <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">thus e1 is not used as return env</span>
            <span style="color: #696969;">[(</span>'success e1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>list ds bs ns1<span style="color: #696969;">)]</span>
            <span style="color: #696969;">[(</span>'fail il<span style="color: #696969;">)</span>
             <span style="color: #696969;">(</span>cat <span style="color: #696969;">(</span><span style="color: #e6db74;">"eva/df fail to define : ~a~%"</span> df<span style="color: #696969;">))</span>
             <span style="color: #696969;">(</span>pretty-print il<span style="color: #696969;">)</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> <span style="color: #696969;">(</span><span style="color: #e6db74;">"end of report~%"</span><span style="color: #696969;">))]))])]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org11ee6d2" class="outline-3">
<h3 id="org11ee6d2">eva/ap</h3>
<div class="outline-text-3" id="text-org11ee6d2">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">eva/ap</span> a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form1/arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">([</span>a0 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/arrow <span style="color: #696969;">(</span>pass1/arrow 0 a<span style="color: #696969;">)</span> '<span style="color: #696969;">())</span>
              <span style="color: #696969;">[(</span>a1 s<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>pass3/get-arrow a1 e<span style="color: #696969;">)])])</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/arrow a e<span style="color: #696969;">)</span>
      <span style="color: #696969;">[(</span>'success e1<span style="color: #696969;">)</span> e1<span style="color: #696969;">]</span>
      <span style="color: #696969;">[(</span>'fail il<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>cat <span style="color: #696969;">(</span><span style="color: #e6db74;">"eva/ap fail~%"</span><span style="color: #696969;">))</span>
       <span style="color: #696969;">(</span>pretty-print il<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>cat <span style="color: #696969;">(</span><span style="color: #e6db74;">"~%"</span><span style="color: #696969;">))</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> <span style="color: #696969;">(</span><span style="color: #e6db74;">"end of report~%"</span><span style="color: #696969;">))])))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org273ab3" class="outline-2">
<h2 id="org273ab3">check</h2>
<div class="outline-text-2" id="text-org273ab3">
</div><div id="outline-container-org1801493" class="outline-3">
<h3 id="org1801493">check</h3>
<div class="outline-text-3" id="text-org1801493">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">check</span> t al e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> al
    <span style="color: #696969;">[()</span> <span style="color: #696969;">(</span>list 'success e<span style="color: #696969;">)]</span>
    <span style="color: #696969;">[(</span>a . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>check/arrow t a e<span style="color: #696969;">)</span>
       <span style="color: #696969;">[(</span>'success e<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>check t r e<span style="color: #696969;">)]</span>
       <span style="color: #696969;">[(</span>'fail il<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>'fail il<span style="color: #696969;">)])]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc64faad" class="outline-3">
<h3 id="orgc64faad">check/arrow</h3>
<div class="outline-text-3" id="text-orgc64faad">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">check/arrow</span> t a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>list t a<span style="color: #696969;">)</span>
    <span style="color: #696969;">[((</span>tac tsc<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>ac sc<span style="color: #696969;">))</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/arrow tac e<span style="color: #696969;">)</span>
       <span style="color: #696969;">[(</span>'fail il<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span>list 'fail
              <span style="color: #696969;">(</span>cons `<span style="color: #696969;">(</span>check/arrow
                      fail on
                      <span style="color: #696969;">(</span>tac ,tac<span style="color: #696969;">))</span>
                    il<span style="color: #696969;">))]</span>
       <span style="color: #696969;">[(</span>'success e1<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>unify <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>type-compute/cedent ac x<span style="color: #696969;">))</span>
                      e1<span style="color: #696969;">)</span>
          <span style="color: #696969;">[(</span>'fail il<span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span>list 'fail
                 <span style="color: #696969;">(</span>cons `<span style="color: #696969;">(</span>check/arrow
                         fail on
                         <span style="color: #696969;">(</span>ac ,ac<span style="color: #696969;">))</span>
                       il<span style="color: #696969;">))]</span>
          <span style="color: #696969;">[(</span>'success e2<span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/arrow tsc e2<span style="color: #696969;">)</span>
             <span style="color: #696969;">[(</span>'fail il<span style="color: #696969;">)</span>
              <span style="color: #696969;">(</span>list 'fail
                    <span style="color: #696969;">(</span>cons `<span style="color: #696969;">(</span>check/arrow
                            fail on
                            <span style="color: #696969;">(</span>tsc ,tsc<span style="color: #696969;">))</span>
                          il<span style="color: #696969;">))]</span>
             <span style="color: #696969;">[(</span>'success e3<span style="color: #696969;">)</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>unify <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>type-compute/cedent sc x<span style="color: #696969;">))</span>
                            e3<span style="color: #696969;">)</span>
                <span style="color: #696969;">[(</span>'fail il<span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span>list 'fail
                       <span style="color: #696969;">(</span>cons `<span style="color: #696969;">(</span>check/arrow
                               fail on
                               <span style="color: #696969;">(</span>sc ,sc<span style="color: #696969;">))</span>
                             il<span style="color: #696969;">))]</span>
                <span style="color: #696969;">[(</span>'success e4<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>'success e4<span style="color: #696969;">)])])])])]))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1e3b3e8" class="outline-2">
<h2 id="org1e3b3e8">type-compute</h2>
<div class="outline-text-2" id="text-org1e3b3e8">
</div><div id="outline-container-orga7ca4f2" class="outline-3">
<h3 id="orga7ca4f2"><span class="todo note">note</span> data</h3>
<div class="outline-text-3" id="text-orga7ca4f2">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> data
  <span style="color: #696969;">(</span>'var    <span style="color: #696969;">(</span>id level<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span>'cons   <span style="color: #696969;">(</span>name <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'arrow  <span style="color: #696969;">((</span>data ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'lambda <span style="color: #696969;">(</span>arrow <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>'trunk  <span style="color: #696969;">(</span>arrow <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">or</span> name <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">))</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> index<span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdfcbaa0" class="outline-3">
<h3 id="orgdfcbaa0">type-compute/cedent</h3>
<div class="outline-text-3" id="text-orgdfcbaa0">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-compute/cedent</span> c e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #696969;">[()</span> e<span style="color: #696969;">]</span>
    <span style="color: #696969;">[(</span>d . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-compute d e<span style="color: #696969;">)</span>
       <span style="color: #696969;">[(</span>'fail il<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>'fail il<span style="color: #696969;">)]</span>
       <span style="color: #696969;">[(</span>'success e1<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span>type-compute/cedent r e1<span style="color: #696969;">)])]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8fea977" class="outline-3">
<h3 id="org8fea977">type-compute</h3>
<div class="outline-text-3" id="text-org8fea977">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-compute</span> d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
    <span style="color: #696969;">[(</span>'var x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>type-compute/var x e<span style="color: #696969;">)]</span>
    <span style="color: #696969;">[(</span>'cons x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>type-compute/cons x e<span style="color: #696969;">)]</span>
    <span style="color: #696969;">[(</span>'arrow x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>type-compute/arrow x e<span style="color: #696969;">)]</span>
    <span style="color: #696969;">[(</span>'lambda x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>type-compute/lambda x e<span style="color: #696969;">)]</span>
    <span style="color: #696969;">[(</span>'trunk x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>type-compute/trunk x e<span style="color: #696969;">)]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5b7d2d2" class="outline-3">
<h3 id="org5b7d2d2">type-compute/var</h3>
<div class="outline-text-3" id="text-org5b7d2d2">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-compute/var</span> v e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> var env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> v
    <span style="color: #696969;">[(</span>id level<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>compute/var <span style="color: #696969;">(</span>list id <span style="color: #696969;">(</span>+ 1 level<span style="color: #696969;">))</span> e<span style="color: #696969;">)]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2aa262a" class="outline-3">
<h3 id="org2aa262a">type-compute/cons</h3>
<div class="outline-text-3" id="text-org2aa262a">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-compute/cons</span> c e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cons env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #696969;">[(</span>ds bs ns<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
       <span style="color: #696969;">[(</span>n dl<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">([</span>found <span style="color: #696969;">(</span>assq n ns<span style="color: #696969;">)])</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not found<span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> <span style="color: #696969;">(</span><span style="color: #e6db74;">"type-compute/cons unknow name : ~a~%"</span> n<span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span><span style="color: #e6db74;">"cons : ~a~%"</span> c<span style="color: #696969;">))</span>
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">([</span>meaning <span style="color: #696969;">(</span>cdr found<span style="color: #696969;">)])</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> meaning
                <span style="color: #696969;">[(</span>any-type <span style="color: #696969;">(</span>a . _<span style="color: #696969;">))</span>
                 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/cedent dl e<span style="color: #696969;">)</span>
                   <span style="color: #696969;">[(</span>'fail il<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>'fail il<span style="color: #696969;">)]</span>
                   <span style="color: #696969;">[(</span>'success e1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>compute/arrow a e1<span style="color: #696969;">)])]))))])]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb1b81eb" class="outline-3">
<h3 id="orgb1b81eb"><span class="todo _gt__lt_">&gt;&lt;</span> type-compute/arrow</h3>
<div class="outline-text-3" id="text-orgb1b81eb">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-compute/arrow</span> a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> <span style="color: #696969;">(</span><span style="color: #e6db74;">"type-compute/arrow is not handled for now~%"</span><span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb95c30a" class="outline-3">
<h3 id="orgb95c30a">type-compute/lambda</h3>
<div class="outline-text-3" id="text-orgb95c30a">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-compute/lambda</span> l e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> lambda env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #696969;">[(</span>ds bs ns<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> l
       <span style="color: #696969;">[(</span>a al<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span>list 'success
              <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>list 'arrow a<span style="color: #696969;">)</span> ds<span style="color: #696969;">)</span>
                    bs
                    ns<span style="color: #696969;">))])]))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7c416fd" class="outline-3">
<h3 id="org7c416fd">type-compute/trunk</h3>
<div class="outline-text-3" id="text-org7c416fd">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-compute/trunk</span> t e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> t
    <span style="color: #696969;">[(</span>a _ dl i<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute <span style="color: #696969;">(</span>list-ref dl <span style="color: #696969;">(</span>- <span style="color: #696969;">(</span>length dl<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>+ 1 i<span style="color: #696969;">)))</span> e<span style="color: #696969;">)</span>
       <span style="color: #696969;">[(</span>'fail il<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>'fail il<span style="color: #696969;">)]</span>
       <span style="color: #696969;">[(</span>'success e1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>compute/arrow a e1<span style="color: #696969;">)])]))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7ca621" class="outline-2">
<h2 id="org7ca621"><span class="todo _gt__lt_">&gt;&lt;</span> infer</h2>
</div>
</div>
<div id="postamble" class="status">
喪以不執 所執者喪 執喪相比 方死方生
</div>
</body>
</html>
