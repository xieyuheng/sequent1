<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2016-05-26 Thu 09:53 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>sequent1</title>
<meta name="generator" content="Org-mode" />
<meta name="author" content="XIE Yuheng" />
<link rel="stylesheet" href="http://xieyuheng.github.io/asset/css/page.css" type="text/css" media="screen" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
喪以不執 所執者喪 執喪相比 方死方生
</div>
<div id="content">
<h1 class="title">sequent1</h1>
<div id="table-of-contents">
<h2>overview</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org877c2af"><span class="done todo">todo</span> </a></li>
<li><a href="#org1eaf163"><span class="todo note">note</span> </a>
<ul>
<li><a href="#org767b4a1">alternative branches</a></li>
<li><a href="#orga5febf5">unsatisfactory features</a></li>
<li><a href="#org178e992">sequent</a></li>
<li><a href="#org6bc26ab">form1</a></li>
<li><a href="#orgf1bbbfa">form2</a></li>
<li><a href="#org1850d2">form3</a></li>
<li><a href="#orga589cc2">data</a></li>
<li><a href="#org372e878">env</a></li>
<li><a href="#org4e37fc6">report</a></li>
<li><a href="#orgbb1ee15">top</a></li>
<li><a href="#org77c4d41">no dependent type in scheme</a></li>
</ul>
</li>
<li><a href="#org8f107b7">pass1</a>
<ul>
<li><a href="#org64073d2"><span class="todo note">note</span> </a></li>
<li><a href="#orga4ba9b3">pass1/arrow</a></li>
<li><a href="#org58c49f1">pass1/cedent</a></li>
<li><a href="#org5a961b7">predicates</a></li>
<li><a href="#orge472478">pass1</a></li>
<li><a href="#org1d7835c">pass1/var</a></li>
</ul>
</li>
<li><a href="#org3599512">pass2</a>
<ul>
<li><a href="#org71dedd8"><span class="todo note">note</span> </a></li>
<li><a href="#org23c302b">pass2/get-arrow</a></li>
<li><a href="#orgaff49df">pass2/arrow</a></li>
<li><a href="#org38baa0a">pass2/cedent</a></li>
<li><a href="#orgda3cf81">pass2/lambda</a></li>
<li><a href="#org390d373">pass2</a></li>
<li><a href="#org2ea03bb">id/new</a></li>
<li><a href="#org6a9aced">pass2/var</a></li>
<li><a href="#org47efa38">pass2/bind</a></li>
</ul>
</li>
<li><a href="#orgc2c088a">pass3</a>
<ul>
<li><a href="#org8d498fd"><span class="todo note">note</span> </a></li>
<li><a href="#org33c6f6f">env/pop</a></li>
<li><a href="#org3df79c5">pass3/get-arrow</a></li>
<li><a href="#orge490f56">pass3/arrow</a></li>
<li><a href="#org8c99b06">pass3/get-arrow-check</a></li>
<li><a href="#orgee048a6">pass3/arrow-check</a></li>
<li><a href="#org347184">pass3/cedent</a></li>
<li><a href="#org7db3dbb">pass3/lambda</a></li>
<li><a href="#org12255a">pass3</a></li>
<li><a href="#orgeb8d395">pass3/var</a></li>
<li><a href="#orgf442d6d">pass3/apply</a></li>
<li><a href="#org8113f2b">pass3/apply/data</a></li>
<li><a href="#org9b31ecf">pass3/apply/arrow</a></li>
<li><a href="#org8d553ff">pass3/apply/lambda</a></li>
<li><a href="#org8dcf9f3">pass3/apply/var</a></li>
<li><a href="#orgd77351e">id-&gt;name &amp; id-&gt;counter &amp; id-&gt;ls</a></li>
<li><a href="#org54172f2">pass3/name</a></li>
<li><a href="#org58c3c9">pass3/name/cons</a></li>
<li><a href="#orgb6295bb">pass3/name/trunk</a></li>
<li><a href="#org9982468">pass3/bind</a></li>
<li><a href="#orgaf725e4">id/commit!</a></li>
</ul>
</li>
<li><a href="#org95c8b06">bind-stack</a>
<ul>
<li><a href="#org3a84e13"><span class="todo note">note</span> </a></li>
<li><a href="#org1131c3e">bs/find</a></li>
<li><a href="#orgfbbdd6f">bs/walk</a></li>
<li><a href="#org262cab6">bs/deep</a></li>
<li><a href="#org6fef526">var/fresh?</a></li>
<li><a href="#org4d8fcb">bs/extend</a></li>
<li><a href="#org536607a">var/eq?</a></li>
</ul>
</li>
<li><a href="#orge39a72e">copy-arrow</a>
<ul>
<li><a href="#org20c91f2"><span class="todo note">note</span> </a></li>
<li><a href="#orgdf2eb76">copy-arrow</a></li>
<li><a href="#orga43649a">copy-cedent</a></li>
<li><a href="#org4b210d2">copy/arrow</a></li>
<li><a href="#org4a76773">copy/data-list</a></li>
<li><a href="#orgabb260f">copy/cedent</a></li>
<li><a href="#orgbc32485">copy/lambda</a></li>
<li><a href="#org6f15514">copy/arrow-list</a></li>
<li><a href="#org609f86c">copy</a></li>
<li><a href="#org52db187">copy/var</a></li>
<li><a href="#orgedfa52f">copy/ls</a></li>
<li><a href="#org154adf3">copy/cons</a></li>
<li><a href="#org1aa437">copy/trunk</a></li>
</ul>
</li>
<li><a href="#orgfb076b5">compute</a>
<ul>
<li><a href="#orgc8be950">compute/arrow</a></li>
<li><a href="#orge67a6d">solve/arrow</a></li>
<li><a href="#org904153a">bs/commit!</a></li>
<li><a href="#org68891d7">compute/cedent</a></li>
<li><a href="#org9e535cd">compute</a></li>
<li><a href="#org48412ed">compute/var</a></li>
<li><a href="#orgb73ae1e">compute/cons</a></li>
<li><a href="#orgee4a38c">compute/trunk</a>
<ul>
<li><a href="#org4955eb">compute/trunk</a></li>
<li><a href="#org3f27012">compute/trunk/tody/var</a></li>
<li><a href="#org7e63705">compute/trunk/tody/name</a></li>
<li><a href="#orgc9e3b7f">compute/trunk/tody/arrow-list</a></li>
<li><a href="#org2e4e56f">trunk-&gt;trunk*</a></li>
</ul>
</li>
<li><a href="#org143ad8c">filter-arrow-list</a></li>
<li><a href="#orge05f932">proj</a></li>
</ul>
</li>
<li><a href="#org197cd01">print</a>
<ul>
<li><a href="#org9b54b47">print/cedent</a></li>
<li><a href="#orgf37b676">print/data-list</a></li>
<li><a href="#org220c2cb">print/data</a></li>
<li><a href="#orgff6f9e5">print/var</a></li>
<li><a href="#org406ae05">print/cons</a></li>
<li><a href="#org704778">print/arrow</a></li>
<li><a href="#org1954eb5"><span class="todo _gt__lt_">&gt;&lt;</span> print/lambda</a></li>
<li><a href="#org664c6b6"><span class="todo _gt__lt_">&gt;&lt;</span> print/trunk</a></li>
</ul>
</li>
<li><a href="#orgb4cf831">consistent-check</a>
<ul>
<li><a href="#orga5e417e">consistent-check</a></li>
<li><a href="#orgc98e52">consistent-check/level-diff</a></li>
<li><a href="#orgf8ebdec">type-compute/repeat</a></li>
<li><a href="#org5c1e6ff">var/highest? &amp; var/lowest?</a></li>
<li><a href="#org469e8d4">var/above &amp; var/below</a></li>
</ul>
</li>
<li><a href="#orgc7fb27d">occur-check</a>
<ul>
<li><a href="#org228a250"><span class="todo note">note</span> </a></li>
<li><a href="#orgab31644">occur-check/data</a></li>
<li><a href="#orgecda46d">occur-check/var</a></li>
<li><a href="#orgca2c3ca">occur-check/cons</a></li>
<li><a href="#org5da755d">occur-check/data-list</a></li>
<li><a href="#orga2596b6">occur-check/arrow</a></li>
<li><a href="#orgb072311">occur-check/lambda</a></li>
<li><a href="#org46801e0">occur-check/arrow-list</a></li>
<li><a href="#orgbe765f8">occur-check/trunk</a></li>
</ul>
</li>
<li><a href="#org1818a3a">unify</a>
<ul>
<li><a href="#org48faf3e"><span class="todo note">note</span> </a></li>
<li><a href="#orgd3418d6">unify/data-list</a></li>
<li><a href="#org5ca3064">unify/data</a></li>
<li><a href="#orgf1a6b7e">unify/var/data</a></li>
<li><a href="#org4382957">unify/cons</a></li>
<li><a href="#orgf223919">unify/arrow</a></li>
<li><a href="#orge02c70a">unify/lambda</a></li>
<li><a href="#org8e7a66">unify/arrow-list</a></li>
<li><a href="#orgad88a4a">unify/trunk</a>
<ul>
<li><a href="#org2268995"><span class="todo note">note</span> </a></li>
<li><a href="#org5ac2d3b">unify/trunk</a></li>
<li><a href="#org73f3981">unify/trunk/syntactic</a></li>
<li><a href="#org4f94afc">unify/trunk/semantic</a></li>
</ul>
</li>
<li><a href="#orgac1d80f">unify/trunk/data</a></li>
</ul>
</li>
<li><a href="#org8eab6d">eva</a>
<ul>
<li><a href="#org151431d">init-env</a></li>
<li><a href="#orgde4e11">eva</a></li>
<li><a href="#orgbd73e1a">eva/top-list</a></li>
<li><a href="#org93e7dca">parse/top</a></li>
<li><a href="#orgff21162">parse/top/deftype-body</a></li>
<li><a href="#org51e76f9">eva/top</a></li>
<li><a href="#org898f31a">form1/arrow-&gt;arrow</a></li>
<li><a href="#org32a61ce">form1/arrow-&gt;arrow-check</a></li>
<li><a href="#orgf7a193e">eva/app</a></li>
<li><a href="#org30b1440">eva/deftype</a></li>
<li><a href="#orgbe0449">cover-check? &amp; cover-check- &amp; cover-check+</a></li>
<li><a href="#org26960d2">recur-check? &amp; recur-check- &amp; recur-check+</a></li>
<li><a href="#orgb40e374">eva/defn</a></li>
</ul>
</li>
<li><a href="#orgc320fbf">sequent</a>
<ul>
<li><a href="#org2cfce3d">sequent</a></li>
<li><a href="#orgf1fb44d"><span class="todo _gt__lt_">&gt;&lt;</span> sequent/repl</a></li>
</ul>
</li>
<li><a href="#orgdcf9e1c">type-compute</a>
<ul>
<li><a href="#orgcd52641">type-compute/cedent</a></li>
<li><a href="#org8e14dd9">type-compute</a></li>
<li><a href="#org91f43cd">type-compute/var</a></li>
<li><a href="#org2b23109">type-compute/cons</a></li>
<li><a href="#org1c04c10">type-compute/arrow</a></li>
<li><a href="#orgcbacc00">type-compute/lambda</a></li>
<li><a href="#org2854796">type-compute/trunk</a></li>
</ul>
</li>
<li><a href="#orgfd9f444">infer</a>
<ul>
<li><a href="#orgd529b5">infer/arrow</a></li>
<li><a href="#orga44eac3">infer/arrow-list</a></li>
<li><a href="#org7f3916b">unite/arrow-list</a></li>
<li><a href="#orgd8680df">unite/two</a></li>
</ul>
</li>
<li><a href="#org8ce98ca">cover</a>
<ul>
<li><a href="#orgd3054ea"><span class="todo note">note</span> </a></li>
<li><a href="#orge9a1007">cover/data-list</a></li>
<li><a href="#orge872938">cover/data</a></li>
<li><a href="#org8e8baae">cover/var/data</a></li>
<li><a href="#org6a4fc84">cover/cons</a></li>
<li><a href="#org10f8eb2">cover/arrow</a></li>
<li><a href="#orgeb8cdf6">cover/lambda</a></li>
<li><a href="#orga349d06">cover/arrow-list</a></li>
<li><a href="#orgf874224">cover/trunk</a>
<ul>
<li><a href="#orgd1c1793"><span class="todo note">note</span> </a></li>
<li><a href="#org331428e">cover/trunk</a></li>
<li><a href="#org1198112">cover/trunk/syntactic</a></li>
<li><a href="#org364da94">cover/trunk/semantic</a></li>
</ul>
</li>
<li><a href="#orge44afeb">cover/trunk/data</a></li>
</ul>
</li>
<li><a href="#org57daae1">cover-check</a>
<ul>
<li><a href="#orge56880f">cover-check</a></li>
<li><a href="#orgab51dae">cover-check/cedent/arrow-list</a></li>
<li><a href="#org49d7905">cover-check/cedent</a></li>
<li><a href="#orgc04fc5a"><span class="todo note">note</span> alterdata</a></li>
<li><a href="#org6038272">data-gen</a></li>
<li><a href="#org3f06427">alter-expand</a>
<ul>
<li><a href="#org7eb0dc7">alter-expand</a></li>
<li><a href="#orgecb1275">alter-expand/get-data-list &amp; alter-expand/get-data</a></li>
<li><a href="#orgc289113">alter-expand/alterdata-list</a></li>
<li><a href="#org2092d08">bs/extend-alter</a></li>
</ul>
</li>
<li><a href="#org2dd7221">data-gen/cedent</a></li>
<li><a href="#org83230c9">data-gen/data</a></li>
<li><a href="#orgb07060c">data-gen/cons</a></li>
<li><a href="#orgc6cd34f">data-gen/alterdata-list</a>
<ul>
<li><a href="#org21fb510">data-gen/alterdata-list</a></li>
<li><a href="#org2e27817">n-&gt;na</a></li>
<li><a href="#org7166d7">na-&gt;nadl</a></li>
<li><a href="#orgc5860f8">nadl-&gt;alterdata</a></li>
<li><a href="#orgc3890f3">d-&gt;subd</a></li>
</ul>
</li>
<li><a href="#org8f38275">data-gen/var</a></li>
<li><a href="#org3bdb86">data-gen/arrow</a></li>
<li><a href="#org9928825">data-gen/trunk</a></li>
<li><a href="#org95b5a1f">data-gen/lambda</a></li>
</ul>
</li>
<li><a href="#orgd224fb1">recur-check</a>
<ul>
<li><a href="#org436c3cc"><span class="todo note">note</span> </a></li>
<li><a href="#org5127083"><span class="todo _gt__lt_">&gt;&lt;</span> recur-check</a></li>
</ul>
</li>
</ul>
</div>
</div>
<hr  />

<ul class="org-ul">
<li><p>the implementation of the interpreter (<a href="https://github.com/xieyuheng/sequent1">source</a>)</p></li></ul>

<hr  />

<div id="outline-container-org877c2af" class="outline-2">
<h2 id="org877c2af"><span class="done todo">todo</span> </h2>
<div class="outline-text-2" id="text-org877c2af">
<ul class="org-ul">
<li><p>recur-check</p></li>

<li><p>module system</p></li>

<li><p>no repl</p><p>but load file</p></li>

<li><p>report info should be strictly structured</p></li></ul>
</div>
</div>

<div id="outline-container-org1eaf163" class="outline-2">
<h2 id="org1eaf163"><span class="todo note">note</span> </h2>
<div class="outline-text-2" id="text-org1eaf163">
</div><div id="outline-container-org767b4a1" class="outline-3">
<h3 id="org767b4a1">alternative branches</h3>
<div class="outline-text-3" id="text-org767b4a1">
<ul class="org-ul">
<li><p>alternative branches of a function must be disjoint</p></li></ul>
</div>
</div>

<div id="outline-container-orga5febf5" class="outline-3">
<h3 id="orga5febf5">unsatisfactory features</h3>
<div class="outline-text-3" id="text-orga5febf5">
<ul class="org-ul">
<li><p>as a prototype implementation of an interpreter</p><p>its unsatisfactory features are</p><p><ol class="org-ol"></p><p><li>call-by-name</p><p>to use graph-rewrite-system instead of term-rewriting-system</p><p>can be used to solve this</li></p><p><li>using copy to handle scope</p><p>a vm</p><p>can be used to solve this</li></p><p><li>mutual recursive function is not handled</p><p>to use compiler instead of interpreter</p><p>can be used to solve this</li></ol></p></li></ul>
</div>
</div>

<div id="outline-container-org178e992" class="outline-3">
<h3 id="org178e992">sequent</h3>
<div class="outline-text-3" id="text-org178e992">
<ul class="org-ul">
<li><p>sequent is called arrow here</p><p>which is the core data type of the language</p></li></ul>
</div>
</div>

<div id="outline-container-org6bc26ab" class="outline-3">
<h3 id="org6bc26ab">form1</h3>
<div class="outline-text-3" id="text-org6bc26ab">
<ul class="org-ul">
<li><p>reduction strategy is revealed by the postfix notation</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form1
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form1/var
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">example</span>
      <span style="color: #a6e22e;">:var</span>
      <span style="color: #a6e22e;">:var^n</span><span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form1/name
    symbol<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form1/arrow
    '<span style="color: #696969;">(</span>form1 ... <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> form1 ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form1/lambda
    '<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> form1/arrow
       form1/arrow
       ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form1/im-bind
    '<span style="color: #696969;">(</span>form1/var ... : form1 ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form1/ex-bind
    '<span style="color: #696969;">(</span>form1/var ... @ form1 ...<span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf1bbbfa" class="outline-3">
<h3 id="orgf1bbbfa">form2</h3>
<div class="outline-text-3" id="text-orgf1bbbfa">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form2
  <span style="color: #B380A8;">{</span>'form2/var    <span style="color: #B380A8;">{</span>symbol level<span style="color: #B380A8;">}}</span>
  <span style="color: #B380A8;">{</span>'form2/name   symbol<span style="color: #B380A8;">}</span>
  <span style="color: #B380A8;">{</span>'form2/arrow  <span style="color: #B380A8;">{{</span>form2 ...<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>form2 ...<span style="color: #B380A8;">}}}</span>
  <span style="color: #B380A8;">{</span>'form2/lambda <span style="color: #B380A8;">{</span>form2/arrow <span style="color: #B380A8;">{</span>form2/arrow ...<span style="color: #B380A8;">}}}</span>
  <span style="color: #B380A8;">{</span>'form2/bind   <span style="color: #B380A8;">{{</span>form2/var ...<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>form2 ...<span style="color: #B380A8;">}</span> leave?<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> level natural-number<span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> leave? bool<span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1850d2" class="outline-3">
<h3 id="org1850d2">form3</h3>
<div class="outline-text-3" id="text-org1850d2">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> form3
  <span style="color: #B380A8;">{</span>'form3/var    <span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}}</span>
  <span style="color: #B380A8;">{</span>'form3/name   symbol<span style="color: #B380A8;">}</span>
  <span style="color: #B380A8;">{</span>'form3/arrow  <span style="color: #B380A8;">{{</span>form3 ...<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>form3 ...<span style="color: #B380A8;">}}}</span>
  <span style="color: #B380A8;">{</span>'form3/lambda <span style="color: #B380A8;">{</span>form3/arrow <span style="color: #B380A8;">{</span>form3/arrow ...<span style="color: #B380A8;">}}}</span>
  <span style="color: #B380A8;">{</span>'form3/bind   <span style="color: #B380A8;">{{</span>form3/var ...<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>form3 ...<span style="color: #B380A8;">}</span> leave?<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> id #<span style="color: #696969;">((</span>name . counter<span style="color: #696969;">)</span> ls<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga589cc2" class="outline-3">
<h3 id="orga589cc2">data</h3>
<div class="outline-text-3" id="text-orga589cc2">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> data
  <span style="color: #B380A8;">{</span>'var    <span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}}</span>
  <span style="color: #B380A8;">{</span>'cons   <span style="color: #B380A8;">{</span>name <span style="color: #B380A8;">{</span>data ...<span style="color: #B380A8;">}}}</span>
  <span style="color: #B380A8;">{</span>'arrow  <span style="color: #B380A8;">{</span>cedent cedent<span style="color: #B380A8;">}}</span>
  <span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>arrow <span style="color: #B380A8;">{</span>arrow ...<span style="color: #B380A8;">}}}</span>
  <span style="color: #B380A8;">{</span>'trunk  <span style="color: #B380A8;">{</span>arrow tody <span style="color: #B380A8;">{</span>data ...<span style="color: #B380A8;">}</span> index<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> cedent <span style="color: #B380A8;">{</span>data ...<span style="color: #B380A8;">}</span>
      <span style="color: #797979;">[</span>reverse a cedent get data-list<span style="color: #797979;">]</span><span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> tody <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">trunk-body</span>
  <span style="color: #B380A8;">{</span>'tody/name name<span style="color: #B380A8;">}</span>
  <span style="color: #B380A8;">{</span>'tody/arrow-list <span style="color: #B380A8;">{</span>arrow ...<span style="color: #B380A8;">}}</span>
  <span style="color: #B380A8;">{</span>'tody/var var<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org372e878" class="outline-3">
<h3 id="org372e878">env</h3>
<div class="outline-text-3" id="text-org372e878">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> env <span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> ds <span style="color: #B380A8;">{</span>data ...<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> bs <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>id . ls<span style="color: #696969;">)</span> ...<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> ns <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>name . meaning<span style="color: #696969;">)</span> ...<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> ls <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>level . data<span style="color: #696969;">)</span> ...<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> meaning
  <span style="color: #B380A8;">{</span>'cons/type <span style="color: #B380A8;">{</span>arrow name <span style="color: #B380A8;">{</span>name ...<span style="color: #B380A8;">}}}</span>
  <span style="color: #B380A8;">{</span>'cons/data <span style="color: #B380A8;">{</span>arrow name name<span style="color: #B380A8;">}}</span>
  <span style="color: #B380A8;">{</span>'lambda    <span style="color: #B380A8;">{</span>arrow <span style="color: #B380A8;">{</span>arrow ...<span style="color: #B380A8;">}}}</span><span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4e37fc6" class="outline-3">
<h3 id="org4e37fc6">report</h3>
<div class="outline-text-3" id="text-org4e37fc6">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> report
  <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>info ...<span style="color: #B380A8;">}}</span>
  <span style="color: #B380A8;">{</span>'success env<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> info <span style="color: #66d9ef; font-weight: bold;">&lt;free&gt;</span><span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbb1ee15" class="outline-3">
<h3 id="orgbb1ee15">top</h3>
<div class="outline-text-3" id="text-orgbb1ee15">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> top
  <span style="color: #B380A8;">{</span>'+ <span style="color: #B380A8;">{{</span>form1/name form1/arrow<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{{</span>form1/name form1/arrow<span style="color: #B380A8;">}</span> ...<span style="color: #B380A8;">}}}</span>
  <span style="color: #B380A8;">{</span>'~ <span style="color: #B380A8;">{{</span>form1/name form1/arrow<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>form1/arrow ...<span style="color: #B380A8;">}}}</span>
  <span style="color: #B380A8;">{</span>'app form1/arrow<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org77c4d41" class="outline-3">
<h3 id="org77c4d41">no dependent type in scheme</h3>
<div class="outline-text-3" id="text-org77c4d41">
<ul class="org-ul">
<li><p>because I am not documenting these scheme functions by dependent type</p><p>the type document already fail to express</p><p>most of the natural of env passing functions</p></li>

<li><p>not to mention the invariants of functions which is described by english</p><p>neither them can be expressed by the week type notation</p></li>

<li><p>it is such a cognitive burden</p><p>it is what makes programming a hard work where mistake is too easy</p></li></ul>
</div>
</div>
</div>

<div id="outline-container-org8f107b7" class="outline-2">
<h2 id="org8f107b7">pass1</h2>
<div class="outline-text-2" id="text-org8f107b7">
</div><div id="outline-container-org64073d2" class="outline-3">
<h3 id="org64073d2"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-org64073d2">
<ul class="org-ul">
<li><p>form1 -pass1-&gt; form2</p><p>default-level of var is handled here</p></li></ul>
</div>
</div>

<div id="outline-container-orga4ba9b3" class="outline-3">
<h3 id="orga4ba9b3">pass1/arrow</h3>
<div class="outline-text-3" id="text-orga4ba9b3">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass1/arrow</span> default-level s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> default-level form1/arrow <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> form2/arrow<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>pass1/cedent default-level <span style="color: #696969;">(</span>left-of '<span style="color: #66d9ef; font-weight: bold;">-&gt;</span> s<span style="color: #696969;">))</span>
        <span style="color: #696969;">(</span>pass1/cedent default-level <span style="color: #696969;">(</span>right-of '<span style="color: #66d9ef; font-weight: bold;">-&gt;</span> s<span style="color: #696969;">))))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org58c49f1" class="outline-3">
<h3 id="org58c49f1">pass1/cedent</h3>
<div class="outline-text-3" id="text-org58c49f1">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass1/cedent</span> default-level s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> default-level <span style="color: #696969;">(</span>form1 ...<span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>form2 ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> s
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>h . r<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>pass1 default-level h<span style="color: #696969;">)</span>
                   <span style="color: #696969;">(</span>pass1/cedent default-level r<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5a961b7" class="outline-3">
<h3 id="org5a961b7">predicates</h3>
<div class="outline-text-3" id="text-org5a961b7">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">form1/var?</span> v<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>symbol? v<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>equal? <span style="color: #e6db74;">":"</span> <span style="color: #696969;">(</span>substring <span style="color: #696969;">(</span>symbol-&gt;string v<span style="color: #696969;">)</span> 0 1<span style="color: #696969;">))))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">form1/name?</span> v<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>symbol? v<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>not <span style="color: #696969;">(</span>eq? <span style="color: #e6db74;">":"</span> <span style="color: #696969;">(</span>substring <span style="color: #696969;">(</span>symbol-&gt;string v<span style="color: #696969;">)</span> 0 1<span style="color: #696969;">)))))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">form1/arrow?</span> v<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>list? v<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>member '<span style="color: #66d9ef; font-weight: bold;">-&gt;</span> v<span style="color: #696969;">)))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">form1/lambda?</span> v<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>list? v<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>eq? <span style="color: #696969;">(</span>car v<span style="color: #696969;">)</span> 'lambda<span style="color: #696969;">)))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">form1/im-bind?</span> v<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>list? v<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>pair? v<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>equal? <span style="color: #696969;">(</span>car v<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>vector 'flower-barcket/in-eva<span style="color: #696969;">))</span>
       <span style="color: #696969;">(</span>member ': v<span style="color: #696969;">)))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">form1/ex-bind?</span> v<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>list? v<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>pair? v<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>not <span style="color: #696969;">(</span>equal? <span style="color: #696969;">(</span>car v<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>vector 'flower-barcket/in-eva<span style="color: #696969;">)))</span>
       <span style="color: #696969;">(</span>member ': v<span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge472478" class="outline-3">
<h3 id="orge472478">pass1</h3>
<div class="outline-text-3" id="text-orge472478">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass1</span> default-level v<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> default-level form1 <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> form2<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">cond</span> <span style="color: #797979;">[</span><span style="color: #696969;">(</span>form1/var? v<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span>list 'form2/var
               <span style="color: #696969;">(</span>pass1/var default-level v<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
        <span style="color: #797979;">[</span><span style="color: #696969;">(</span>form1/name? v<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span>list 'form2/name
               v<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
        <span style="color: #797979;">[</span><span style="color: #696969;">(</span>form1/arrow? v<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span>list 'form2/arrow
               <span style="color: #696969;">(</span>pass1/arrow default-level v<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
        <span style="color: #797979;">[</span><span style="color: #696969;">(</span>form1/lambda? v<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span>list 'form2/lambda
               <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>pass1/arrow default-level <span style="color: #696969;">(</span>cadr v<span style="color: #696969;">))</span>
                     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>pass1/arrow default-level x<span style="color: #696969;">))</span>
                       <span style="color: #696969;">(</span>cddr v<span style="color: #696969;">))))</span><span style="color: #797979;">]</span>
        <span style="color: #797979;">[</span><span style="color: #696969;">(</span>form1/im-bind? v<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>v <span style="color: #696969;">(</span>cdr v<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span>list 'form2/bind
                 <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>pass1/cedent 1 <span style="color: #696969;">(</span>left-of ': v<span style="color: #696969;">))</span>
                       <span style="color: #696969;">(</span>pass1/cedent 0 <span style="color: #696969;">(</span>right-of ': v<span style="color: #696969;">))</span>
                       #f<span style="color: #696969;">)))</span><span style="color: #797979;">]</span>
        <span style="color: #797979;">[</span><span style="color: #696969;">(</span>form1/ex-bind? v<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span>list 'form2/bind
               <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>pass1/cedent 1 <span style="color: #696969;">(</span>left-of ': v<span style="color: #696969;">))</span>
                     <span style="color: #696969;">(</span>pass1/cedent 0 <span style="color: #696969;">(</span>right-of ': v<span style="color: #696969;">))</span>
                     #t<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
        <span style="color: #797979;">[</span>else
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass1 <span style="color: #696969;">(</span><span style="color: #e6db74;">"pass1 can not handle sexp-form:~a"</span> v<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1d7835c" class="outline-3">
<h3 id="org1d7835c">pass1/var</h3>
<div class="outline-text-3" id="text-org1d7835c">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass1/var</span> default-level v<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> default-level symbol <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> form2/var<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>str <span style="color: #696969;">(</span>symbol-&gt;string v<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span>cursor <span style="color: #696969;">(</span>find-char <span style="color: #e6db74;">"^"</span> str<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> cursor
      <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>string-&gt;symbol <span style="color: #696969;">(</span>substring str 0 cursor<span style="color: #696969;">))</span>
            <span style="color: #696969;">(</span>string-&gt;number <span style="color: #696969;">(</span>substring str <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+</span> 1 cursor<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>string-length str<span style="color: #696969;">))))</span>
      <span style="color: #696969;">(</span>list v default-level<span style="color: #696969;">))))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3599512" class="outline-2">
<h2 id="org3599512">pass2</h2>
<div class="outline-text-2" id="text-org3599512">
</div><div id="outline-container-org71dedd8" class="outline-3">
<h3 id="org71dedd8"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-org71dedd8">
<ul class="org-ul">
<li><p>form2 -pass2-&gt; form3</p><p>id of var is handled here</p></li></ul>
</div>
</div>

<div id="outline-container-org23c302b" class="outline-3">
<h3 id="org23c302b">pass2/get-arrow</h3>
<div class="outline-text-3" id="text-org23c302b">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass2/get-arrow</span> a s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form2/arrow scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> form3/arrow<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/arrow a s<span style="color: #696969;">)</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a1 s<span style="color: #B380A8;">}</span> a1<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaff49df" class="outline-3">
<h3 id="orgaff49df">pass2/arrow</h3>
<div class="outline-text-3" id="text-orgaff49df">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass2/arrow</span> a s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form2/arrow scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>form3/arrow scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/cedent ac s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/cedent sc s1<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>sc1 s2<span style="color: #B380A8;">}</span>
           <span style="color: #B380A8;">{{</span>ac1 sc1<span style="color: #B380A8;">}</span> s2<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org38baa0a" class="outline-3">
<h3 id="org38baa0a">pass2/cedent</h3>
<div class="outline-text-3" id="text-org38baa0a">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass2/cedent</span> c s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>form2 ...<span style="color: #696969;">)</span> scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">((</span>form3 ...<span style="color: #696969;">)</span> scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{{}</span> s<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>f . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2 f s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>f1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/cedent r s1<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>c1 s2<span style="color: #B380A8;">}</span>
           <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons f1 c1<span style="color: #696969;">)</span> s2<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgda3cf81" class="outline-3">
<h3 id="orgda3cf81">pass2/lambda</h3>
<div class="outline-text-3" id="text-orgda3cf81">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass2/lambda</span> l s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form2/lambda scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>form3/lambda scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> l
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a al<span style="color: #B380A8;">}</span>
     <span style="color: #B380A8;">{{</span><span style="color: #696969;">(</span>pass2/get-arrow a s<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>pass2/get-arrow x s<span style="color: #696969;">))</span>
         al<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span>
      s<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org390d373" class="outline-3">
<h3 id="org390d373">pass2</h3>
<div class="outline-text-3" id="text-org390d373">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass2</span> f s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form2 scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>form2 scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> f
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'form2/var v<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/var v s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>v1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{{</span>'form3/var v1<span style="color: #B380A8;">}</span> s1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'form2/name n<span style="color: #B380A8;">}</span>
     <span style="color: #B380A8;">{{</span>'form3/name n<span style="color: #B380A8;">}</span> s<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'form2/arrow a<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/arrow a s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{{</span>'form3/arrow a1<span style="color: #B380A8;">}</span> s1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'form2/lambda l<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/lambda l s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>l1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{{</span>'form3/lambda l1<span style="color: #B380A8;">}</span> s1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'form2/bind b<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/bind b s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>b1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{{</span>'form3/bind b1<span style="color: #B380A8;">}</span> s1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2ea03bb" class="outline-3">
<h3 id="org2ea03bb">id/new</h3>
<div class="outline-text-3" id="text-org2ea03bb">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #a6e22e;">id/counter</span> 0<span style="color: #696969;">)</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">id/new</span> n ls<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> name ls <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> id<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">set!</span> id/counter <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+</span> 1 id/counter<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span>vector <span style="color: #696969;">(</span>cons n id/counter<span style="color: #696969;">)</span> ls<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6a9aced" class="outline-3">
<h3 id="org6a9aced">pass2/var</h3>
<div class="outline-text-3" id="text-org6a9aced">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass2/var</span> v s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form2/var scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>form3/var scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> v
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>symbol level<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>found <span style="color: #696969;">(</span>assq symbol s<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> found
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>old <span style="color: #696969;">(</span>cdr found<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
           <span style="color: #B380A8;">{{</span>old level<span style="color: #B380A8;">}</span> s<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>new <span style="color: #696969;">(</span>id/new symbol '<span style="color: #696969;">())</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
           <span style="color: #B380A8;">{{</span>new level<span style="color: #B380A8;">}</span>
            <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>cons symbol new<span style="color: #696969;">)</span> s<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #696969;">)))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org47efa38" class="outline-3">
<h3 id="org47efa38">pass2/bind</h3>
<div class="outline-text-3" id="text-org47efa38">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass2/bind</span> b s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form2/bind scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>form3/bind scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> b
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>vs c leave?<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/cedent vs s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>vs1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/cedent c s1<span style="color: #696969;">)</span>
          <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">this means vars in vs can occur in c</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>c1 s2<span style="color: #B380A8;">}</span>
           <span style="color: #B380A8;">{{</span>vs1 c1 leave?<span style="color: #B380A8;">}</span> s2<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc2c088a" class="outline-2">
<h2 id="orgc2c088a">pass3</h2>
<div class="outline-text-2" id="text-orgc2c088a">
</div><div id="outline-container-org8d498fd" class="outline-3">
<h3 id="org8d498fd"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-org8d498fd">
<ul class="org-ul">
<li><p>form3 -pass3-&gt; data</p><p>cons &amp; trunk are created here</p><p><ul class="org-ul"></p><p><li><p>ns is searched</p><p>but no effect on ns</p></li></ul></p></li>

<li><p>note that</p><p>we are building new function body</p><p>with the help of the data-stack</p><p>thus</p><p>whenever a list of data in data-stack are used to form a function body</p><p>the list should be reversed</p></li>

<li><p>bind is handled here</p><p>no unification here</p><p>bs is not used here</p><p>bind just effect on the id of var</p></li>

<li><p>apply is handled here</p><p>when meet 'apply' form a trunk from arrow or lambda</p><p>if it is arrow</p><p>use infer/arrow to get the type of it</p><p>if it is lambda</p><p>use infer/arrow-list to get the type of it</p></li>

<li><p>pass3 will use env passing</p><p>note that</p><p>when env passing is used</p><p>those functions would not be separately testable</p></li>

<li><p>note that</p><p>nested arrow or lambda will not block scope</p><p>different var must have different name</p><p>this is due to the natural of non-determinate data</p></li></ul>
</div>
</div>

<div id="outline-container-org33c6f6f" class="outline-3">
<h3 id="org33c6f6f">env/pop</h3>
<div class="outline-text-3" id="text-org33c6f6f">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">env/pop</span> e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>data env<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>d . r<span style="color: #696969;">)</span> bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #B380A8;">{</span>d <span style="color: #B380A8;">{</span>r bs ns<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3df79c5" class="outline-3">
<h3 id="org3df79c5">pass3/get-arrow</h3>
<div class="outline-text-3" id="text-org3df79c5">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/get-arrow</span> a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form3/arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> arrow<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>env/pop <span style="color: #696969;">(</span>pass3/arrow a e<span style="color: #696969;">))</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'arrow arrow<span style="color: #B380A8;">}</span> __<span style="color: #B380A8;">}</span>
     arrow<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge490f56" class="outline-3">
<h3 id="orge490f56">pass3/arrow</h3>
<div class="outline-text-3" id="text-orge490f56">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/arrow</span> a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form3/arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass3/cedent ac <span style="color: #B380A8;">{{}</span> bs ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>dl-ac __ __<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass3/cedent sc <span style="color: #B380A8;">{{}</span> bs ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>dl-sc __ __<span style="color: #B380A8;">}</span>
              <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons <span style="color: #B380A8;">{</span>'arrow <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>reverse dl-ac<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>reverse dl-sc<span style="color: #696969;">)</span><span style="color: #B380A8;">}}</span>
                     ds<span style="color: #696969;">)</span>
               bs
               ns<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8c99b06" class="outline-3">
<h3 id="org8c99b06">pass3/get-arrow-check</h3>
<div class="outline-text-3" id="text-org8c99b06">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/get-arrow-check</span> ta a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow form3/arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> arrow<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>env/pop <span style="color: #696969;">(</span>pass3/arrow-check ta a e<span style="color: #696969;">))</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'arrow arrow<span style="color: #B380A8;">}</span> __<span style="color: #B380A8;">}</span>
     arrow<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgee048a6" class="outline-3">
<h3 id="orgee048a6">pass3/arrow-check</h3>
<div class="outline-text-3" id="text-orgee048a6">
<ul class="org-ul">
<li><p>check should be merged into pass3</p><p>because to form trunk from var by apply</p><p>I need the type of var to arrow</p><p>to assign such type</p><p>I need to check antecedent first</p></li>

<li><p>note that the efforts of unifications here are commited</p><p>before this commite I copy the type arrow</p></li>

<li><p>I need to do commit here</p><p>because when apply a var</p><p>I need to get the type of it</p><p>to form a trunk</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/arrow-check</span> ta a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow form3/arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>ta <span style="color: #696969;">(</span>copy-arrow ta<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>ta a<span style="color: #B380A8;">}</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>tac tsc<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass3/cedent ac <span style="color: #B380A8;">{{}</span> <span style="color: #696969;">(</span>cons '<span style="color: #696969;">(</span>commit-point<span style="color: #696969;">)</span> bs<span style="color: #696969;">)</span> ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>dl-ac bs-ac __<span style="color: #B380A8;">}</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-compute/cedent <span style="color: #696969;">(</span>reverse dl-ac<span style="color: #696969;">)</span> <span style="color: #B380A8;">{{}</span> bs-ac ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
                <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/arrow-check
                  <span style="color: #696969;">(</span><span style="color: #e6db74;">"fail to type-compute/cedent~%"</span><span style="color: #696969;">)</span>
                  <span style="color: #696969;">(</span><span style="color: #e6db74;">"ac : ~a~%"</span> <span style="color: #696969;">(</span>reverse dl-ac<span style="color: #696969;">))</span>
                  <span style="color: #696969;">(</span><span style="color: #e6db74;">"info-list : ~a~%"</span> il<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>type-dl-ac type-bs-ac __<span style="color: #B380A8;">}}</span>
                <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/cedent tac <span style="color: #B380A8;">{{}</span> type-bs-ac ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
                  <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
                   <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/arrow-check
                     <span style="color: #696969;">(</span><span style="color: #e6db74;">"fail to compute/cedent~%"</span><span style="color: #696969;">)</span>
                     <span style="color: #696969;">(</span><span style="color: #e6db74;">"tac : ~a~%"</span> tac<span style="color: #696969;">)</span>
                     <span style="color: #696969;">(</span><span style="color: #e6db74;">"info-list : ~a~%"</span> il<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
                  <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>dl-tac bs-tac __<span style="color: #B380A8;">}}</span>
                   <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>unify/data-list
                           dl-tac type-dl-ac
                           <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{{}</span> bs-tac ns<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
                     <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
                      <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/arrow-check
                        <span style="color: #696969;">(</span><span style="color: #e6db74;">"fail to unify/data-list~%"</span><span style="color: #696969;">)</span>
                        <span style="color: #696969;">(</span><span style="color: #e6db74;">"dl-tac : ~a~%"</span> dl-tac<span style="color: #696969;">)</span>
                        <span style="color: #696969;">(</span><span style="color: #e6db74;">"type-dl-ac : ~a~%"</span> type-dl-ac<span style="color: #696969;">)</span>
                        <span style="color: #696969;">(</span><span style="color: #e6db74;">"info-list : ~a~%"</span> il<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
                     <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>__ bs-antecedent __<span style="color: #B380A8;">}}</span>
                      <span style="color: #696969;">(</span>bs/commit! bs-antecedent<span style="color: #696969;">)</span>
                      <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass3/cedent sc <span style="color: #B380A8;">{{}</span> <span style="color: #696969;">(</span>cons '<span style="color: #696969;">(</span>commit-point<span style="color: #696969;">)</span> bs<span style="color: #696969;">)</span> ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
                        <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>dl-sc bs-sc __<span style="color: #B380A8;">}</span>
                         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-compute/cedent <span style="color: #696969;">(</span>reverse dl-sc<span style="color: #696969;">)</span> <span style="color: #B380A8;">{{}</span> bs-sc ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
                           <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
                            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/arrow-check
                              <span style="color: #696969;">(</span><span style="color: #e6db74;">"fail to type-compute/cedent~%"</span><span style="color: #696969;">)</span>
                              <span style="color: #696969;">(</span><span style="color: #e6db74;">"sc : ~a~%"</span> <span style="color: #696969;">(</span>reverse dl-sc<span style="color: #696969;">))</span>
                              <span style="color: #696969;">(</span><span style="color: #e6db74;">"info-list : ~a~%"</span> il<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
                           <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>type-dl-sc type-bs-sc __<span style="color: #B380A8;">}}</span>
                            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/cedent tsc <span style="color: #B380A8;">{{}</span> type-bs-sc ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
                              <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
                               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/arrow-check
                                 <span style="color: #696969;">(</span><span style="color: #e6db74;">"fail to compute/cedent~%"</span><span style="color: #696969;">)</span>
                                 <span style="color: #696969;">(</span><span style="color: #e6db74;">"tsc : ~a~%"</span> tsc<span style="color: #696969;">)</span>
                                 <span style="color: #696969;">(</span><span style="color: #e6db74;">"info-list : ~a~%"</span> il<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
                              <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>dl-tsc bs-tsc __<span style="color: #B380A8;">}}</span>
                               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>unify/data-list
                                       dl-tsc type-dl-sc
                                       <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{{}</span> bs-tsc ns<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
                                 <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
                                  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/arrow-check
                                    <span style="color: #696969;">(</span><span style="color: #e6db74;">"fail to unify/data-list:~%"</span><span style="color: #696969;">)</span>
                                    <span style="color: #696969;">(</span><span style="color: #e6db74;">"dl-tsc : ~a~%"</span> dl-tsc<span style="color: #696969;">)</span>
                                    <span style="color: #696969;">(</span><span style="color: #e6db74;">"type-dl-sc : ~a~%"</span> type-dl-sc<span style="color: #696969;">)</span>
                                    <span style="color: #696969;">(</span><span style="color: #e6db74;">"info-list : ~a~%"</span> il<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
                                 <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>__ bs-succedent __<span style="color: #B380A8;">}}</span>
                                  <span style="color: #696969;">(</span>bs/commit! bs-succedent<span style="color: #696969;">)</span>
                                  <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons <span style="color: #B380A8;">{</span>'arrow <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>reverse dl-ac<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>reverse dl-sc<span style="color: #696969;">)</span><span style="color: #B380A8;">}}</span>
                                         ds<span style="color: #696969;">)</span>
                                   bs
                                   ns<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org347184" class="outline-3">
<h3 id="org347184">pass3/cedent</h3>
<div class="outline-text-3" id="text-org347184">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/cedent</span> c e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>form3 ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> e<span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #696969;">(</span>h . r<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>pass3/cedent r <span style="color: #696969;">(</span>pass3 h e<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7db3dbb" class="outline-3">
<h3 id="org7db3dbb">pass3/lambda</h3>
<div class="outline-text-3" id="text-org7db3dbb">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/lambda</span> l e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form3/lambda env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> l
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a al<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>ta <span style="color: #696969;">(</span>pass3/get-arrow a e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons <span style="color: #B380A8;">{</span>'lambda
                     <span style="color: #B380A8;">{</span>ta
                      <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span>
                             <span style="color: #696969;">(</span>pass3/get-arrow-check ta x e<span style="color: #696969;">))</span>
                        al<span style="color: #696969;">)</span><span style="color: #B380A8;">}}</span>
                 ds<span style="color: #696969;">)</span>
           bs
           ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org12255a" class="outline-3">
<h3 id="org12255a">pass3</h3>
<div class="outline-text-3" id="text-org12255a">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3</span> f e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form3 env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> f
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'form3/var x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>pass3/var x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'form3/name 'apply<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>pass3/apply e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'form3/name x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>pass3/name x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'form3/arrow x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>pass3/arrow x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'form3/lambda x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>pass3/lambda x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'form3/bind x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>pass3/bind x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeb8d395" class="outline-3">
<h3 id="orgeb8d395">pass3/var</h3>
<div class="outline-text-3" id="text-orgeb8d395">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/var</span> v e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form3/var env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">actually there is no need to search bs</span>
     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">but anyway</span>
     <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>bs/deep bs <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span> ds<span style="color: #696969;">)</span>
      bs
      ns<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf442d6d" class="outline-3">
<h3 id="orgf442d6d">pass3/apply</h3>
<div class="outline-text-3" id="text-orgf442d6d">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/apply</span> e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>d . r<span style="color: #696969;">)</span> bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span>pass3/apply/data d <span style="color: #B380A8;">{</span>r bs ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8113f2b" class="outline-3">
<h3 id="org8113f2b">pass3/apply/data</h3>
<div class="outline-text-3" id="text-org8113f2b">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/apply/data</span> d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow x<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span>pass3/apply/arrow x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda x<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span>pass3/apply/lambda x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var x<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span>pass3/apply/var x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span>__
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/apply/data
       <span style="color: #696969;">(</span><span style="color: #e6db74;">"can only apply arrow or lambda or var~%"</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #e6db74;">"but the data at the top of data-stack is : ~a~%"</span> d<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9b31ecf" class="outline-3">
<h3 id="org9b31ecf">pass3/apply/arrow</h3>
<div class="outline-text-3" id="text-org9b31ecf">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/apply/arrow</span> a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>t <span style="color: #696969;">(</span>infer/arrow a e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> t
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>alen <span style="color: #696969;">(</span>length ac<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
                 <span style="color: #797979;">[</span>slen <span style="color: #696969;">(</span>length sc<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
                 <span style="color: #797979;">[</span>dl <span style="color: #696969;">(</span>sublist ds 0 alen<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
                 <span style="color: #797979;">[</span>make-trunk
                  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>i<span style="color: #696969;">)</span>
                    <span style="color: #B380A8;">{</span>'trunk
                      <span style="color: #B380A8;">{</span>t <span style="color: #B380A8;">{</span>'tody/arrow-list <span style="color: #B380A8;">{</span>a<span style="color: #B380A8;">}}</span> dl i<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
            <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>append <span style="color: #696969;">(</span>reverse <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> make-trunk <span style="color: #696969;">(</span>genlist slen<span style="color: #696969;">)))</span>
                     <span style="color: #696969;">(</span>sublist ds alen <span style="color: #696969;">(</span>length ds<span style="color: #696969;">)))</span>
             bs
             ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8d553ff" class="outline-3">
<h3 id="org8d553ff">pass3/apply/lambda</h3>
<div class="outline-text-3" id="text-org8d553ff">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/apply/lambda</span> l e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> lambda env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> l
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>ac sc<span style="color: #B380A8;">}</span> al<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>alen <span style="color: #696969;">(</span>length ac<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span>slen <span style="color: #696969;">(</span>length sc<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span>dl <span style="color: #696969;">(</span>sublist ds 0 alen<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span>make-trunk
                <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>i<span style="color: #696969;">)</span>
                  <span style="color: #B380A8;">{</span>'trunk
                    <span style="color: #B380A8;">{{</span>ac sc<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span> dl i<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>append <span style="color: #696969;">(</span>reverse <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> make-trunk <span style="color: #696969;">(</span>genlist slen<span style="color: #696969;">)))</span>
                   <span style="color: #696969;">(</span>sublist ds alen <span style="color: #696969;">(</span>length ds<span style="color: #696969;">)))</span>
           bs
           ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8dcf9f3" class="outline-3">
<h3 id="org8dcf9f3">pass3/apply/var</h3>
<div class="outline-text-3" id="text-org8dcf9f3">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/apply/var</span> v e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> var env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not <span style="color: #696969;">(</span>var/fresh? v e<span style="color: #696969;">))</span>
       <span style="color: #696969;">(</span>pass3/apply/data <span style="color: #696969;">(</span>bs/deep bs <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span> e<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-compute/var v e<span style="color: #696969;">)</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/apply/var
            <span style="color: #696969;">(</span><span style="color: #e6db74;">"fail to compute the type of var : ~a~%"</span> v<span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span><span style="color: #e6db74;">"report info :~%~a~%"</span> il<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>d . __<span style="color: #696969;">)</span> __ __<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow <span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}}</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>alen <span style="color: #696969;">(</span>length ac<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
                    <span style="color: #797979;">[</span>slen <span style="color: #696969;">(</span>length sc<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
                    <span style="color: #797979;">[</span>dl <span style="color: #696969;">(</span>sublist ds 0 alen<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
                    <span style="color: #797979;">[</span>make-trunk
                     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>i<span style="color: #696969;">)</span>
                       <span style="color: #B380A8;">{</span>'trunk
                         <span style="color: #B380A8;">{{</span>ac sc<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/var v<span style="color: #B380A8;">}</span> dl i<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
               <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>append <span style="color: #696969;">(</span>reverse <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> make-trunk <span style="color: #696969;">(</span>genlist slen<span style="color: #696969;">)))</span>
                        <span style="color: #696969;">(</span>sublist ds alen <span style="color: #696969;">(</span>length ds<span style="color: #696969;">)))</span>
                bs
                ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span>__
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/apply/var
               <span style="color: #696969;">(</span><span style="color: #e6db74;">"to form trunk from var~%"</span><span style="color: #696969;">)</span>
               <span style="color: #696969;">(</span><span style="color: #e6db74;">"the type of var must be a arrow~%"</span><span style="color: #696969;">)</span>
               <span style="color: #696969;">(</span><span style="color: #e6db74;">"var : ~a~%"</span> v<span style="color: #696969;">)</span>
               <span style="color: #696969;">(</span><span style="color: #e6db74;">"type of var : ~a~%"</span> d<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd77351e" class="outline-3">
<h3 id="orgd77351e">id-&gt;name &amp; id-&gt;counter &amp; id-&gt;ls</h3>
<div class="outline-text-3" id="text-orgd77351e">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">id-&gt;name</span> id<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>car <span style="color: #696969;">(</span>vector-ref id 0<span style="color: #696969;">)))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">id-&gt;counter</span> id<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>cdr <span style="color: #696969;">(</span>vector-ref id 0<span style="color: #696969;">)))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">id-&gt;ls</span> id<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>vector-ref id 1<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org54172f2" class="outline-3">
<h3 id="org54172f2">pass3/name</h3>
<div class="outline-text-3" id="text-org54172f2">
<ul class="org-ul">
<li><p>this can be optimized by</p><p>to do more computations before storing things into ns</p><p>but I leave it for now</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/name</span> n e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form3/name env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>found <span style="color: #696969;">(</span>assq n ns<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not found<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/name <span style="color: #696969;">(</span><span style="color: #e6db74;">"unknow name : ~a~%"</span> n<span style="color: #696969;">))</span>
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>meaning <span style="color: #696969;">(</span>cdr found<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> meaning
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons/type <span style="color: #B380A8;">{</span>a n1 __<span style="color: #B380A8;">}}</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy-arrow a<span style="color: #696969;">)</span>
                <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac __<span style="color: #B380A8;">}</span>
                 <span style="color: #696969;">(</span>pass3/name/cons <span style="color: #696969;">(</span>length ac<span style="color: #696969;">)</span> ac n1 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons/data <span style="color: #B380A8;">{</span>a n1 __<span style="color: #B380A8;">}}</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy-arrow a<span style="color: #696969;">)</span>
                <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac __<span style="color: #B380A8;">}</span>
                 <span style="color: #696969;">(</span>pass3/name/cons <span style="color: #696969;">(</span>length ac<span style="color: #696969;">)</span> ac n1 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{{</span>ac sc<span style="color: #B380A8;">}</span> __<span style="color: #B380A8;">}}</span>
              <span style="color: #696969;">(</span>pass3/name/trunk <span style="color: #696969;">(</span>length ac<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>length sc<span style="color: #696969;">)</span> <span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span> n e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org58c3c9" class="outline-3">
<h3 id="org58c3c9">pass3/name/cons</h3>
<div class="outline-text-3" id="text-org58c3c9">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/name/cons</span> len ac n e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> length antecedent name env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>dl <span style="color: #696969;">(</span>sublist ds 0 len<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-compute/cedent <span style="color: #696969;">(</span>reverse dl<span style="color: #696969;">)</span>
                                   <span style="color: #B380A8;">{{}</span> <span style="color: #696969;">(</span>cons '<span style="color: #696969;">(</span>commit-point<span style="color: #696969;">)</span> bs<span style="color: #696969;">)</span> ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/name/cons
            <span style="color: #696969;">(</span><span style="color: #e6db74;">"type-compute/cedent fail~%"</span><span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span><span style="color: #e6db74;">"(reverse dl) : ~a~%"</span> <span style="color: #696969;">(</span>reverse dl<span style="color: #696969;">))</span>
            <span style="color: #696969;">(</span><span style="color: #e6db74;">"info list : ~%~a~%"</span> il<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds1 bs1 ns1<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>unify/data-list
                  ds1 <span style="color: #696969;">(</span>reverse ac<span style="color: #696969;">)</span>
                  <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds bs1 ns1<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/name/cons
               <span style="color: #696969;">(</span><span style="color: #e6db74;">"unify/data-list fail~%"</span><span style="color: #696969;">)</span>
               <span style="color: #696969;">(</span><span style="color: #e6db74;">"ds1 : ~a~%"</span> ds1<span style="color: #696969;">)</span>
               <span style="color: #696969;">(</span><span style="color: #e6db74;">"(reverse ac) : ~a~%"</span> <span style="color: #696969;">(</span>reverse ac<span style="color: #696969;">))</span>
               <span style="color: #696969;">(</span><span style="color: #e6db74;">"info list : ~%~a~%"</span> il<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds2 bs2 ns2<span style="color: #B380A8;">}}</span>
             <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons <span style="color: #B380A8;">{</span>'cons
                     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">dl in cons is as the order of dl in stack</span>
                     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">thus no reverse is needed</span>
                     <span style="color: #B380A8;">{</span>n dl<span style="color: #B380A8;">}}</span>
                    <span style="color: #696969;">(</span>sublist ds len <span style="color: #696969;">(</span>length ds<span style="color: #696969;">)))</span>
              <span style="color: #696969;">(</span>bs/commit! bs2<span style="color: #696969;">)</span>
              ns<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb6295bb" class="outline-3">
<h3 id="orgb6295bb">pass3/name/trunk</h3>
<div class="outline-text-3" id="text-orgb6295bb">
<ul class="org-ul">
<li><p>&gt;&lt;&gt;&lt;&gt;&lt; in this first write</p><p>no redex is reduced</p></li>

<li><p>when intro a trunk from name</p><p>only name should be recorded not the body</p><p>this is to handle recursive definitions</p></li>

<li><p>type arrow needs to be copied</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/name/trunk</span> alen slen a n e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> length length arrow name env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>a <span style="color: #696969;">(</span>copy-arrow a<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span>dl <span style="color: #696969;">(</span>sublist ds 0 alen<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
            <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">dl in trunk is as the order of dl in stack</span>
            <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">thus no reverse is needed</span>
            <span style="color: #797979;">[</span>make-trunk <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>i<span style="color: #696969;">)</span> <span style="color: #B380A8;">{</span>'trunk <span style="color: #B380A8;">{</span>a <span style="color: #B380A8;">{</span>'tody/name n<span style="color: #B380A8;">}</span> dl i<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>append <span style="color: #696969;">(</span>reverse <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> make-trunk <span style="color: #696969;">(</span>genlist slen<span style="color: #696969;">)))</span>
                <span style="color: #696969;">(</span>sublist ds alen <span style="color: #696969;">(</span>length ds<span style="color: #696969;">)))</span>
        bs
        ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9982468" class="outline-3">
<h3 id="org9982468">pass3/bind</h3>
<div class="outline-text-3" id="text-org9982468">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">pass3/bind</span> b e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form3/bind env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> b
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>vl c leave?<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass3/cedent c <span style="color: #B380A8;">{{}</span> bs ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds1 __ __<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not <span style="color: #696969;">(</span>eq? 1 <span style="color: #696969;">(</span>length ds1<span style="color: #696969;">)))</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/bind
               <span style="color: #696969;">(</span><span style="color: #e6db74;">"the cedent in bind should only return one data~%"</span><span style="color: #696969;">)</span>
               <span style="color: #696969;">(</span><span style="color: #e6db74;">"bind : ~a~%"</span> b<span style="color: #696969;">))</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>d1 <span style="color: #696969;">(</span>car ds1<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">letrec</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>recur
                         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>vl e<span style="color: #696969;">)</span>
                           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>form3/var ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
                           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
                             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
                              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> vl
                                <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> e<span style="color: #797979;">]</span>
                                <span style="color: #797979;">[</span><span style="color: #696969;">(</span><span style="color: #B380A8;">{</span>'form3/var <span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}}</span> . r<span style="color: #696969;">)</span>
                                 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not <span style="color: #696969;">(</span>var/fresh? <span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}</span> e<span style="color: #696969;">))</span>
                                   <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/bind
                                     <span style="color: #696969;">(</span><span style="color: #e6db74;">"var is not fresh : ~a~%"</span> <span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
                                     <span style="color: #696969;">(</span><span style="color: #e6db74;">"env : ~a~%"</span> e<span style="color: #696969;">))</span>
                                   <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not
                                        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>consistent-check
                                                <span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}</span> d1 e<span style="color: #696969;">)</span>
                                          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail __<span style="color: #B380A8;">}</span> #f<span style="color: #797979;">]</span>
                                          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span> #t<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
                                     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'pass3/bind
                                       <span style="color: #696969;">(</span><span style="color: #e6db74;">"var data is not consistent~%"</span><span style="color: #696969;">)</span>
                                       <span style="color: #696969;">(</span><span style="color: #e6db74;">"var : ~a~%"</span> <span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
                                       <span style="color: #696969;">(</span><span style="color: #e6db74;">"data : ~a~%"</span> d1<span style="color: #696969;">))</span>
                                     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">()</span>
                                       <span style="color: #696969;">(</span>id/commit! id <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons level d1<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
                                       <span style="color: #696969;">(</span>recur r <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> leave?
                                                   <span style="color: #696969;">(</span>cons d1 ds<span style="color: #696969;">)</span>
                                                   ds<span style="color: #696969;">)</span>
                                                 bs
                                                 ns<span style="color: #B380A8;">}</span><span style="color: #696969;">))))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span>recur vl e<span style="color: #696969;">))))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgaf725e4" class="outline-3">
<h3 id="orgaf725e4">id/commit!</h3>
<div class="outline-text-3" id="text-orgaf725e4">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">id/commit!</span> id ls<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> id ls <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> id
     <span style="color: #797979;">[</span>with effect on id<span style="color: #797979;">]</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">()</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">vector-set!</span> id 1 <span style="color: #696969;">(</span>append ls <span style="color: #696969;">(</span>vector-ref id 1<span style="color: #696969;">)))</span>
    id<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org95c8b06" class="outline-2">
<h2 id="org95c8b06">bind-stack</h2>
<div class="outline-text-2" id="text-org95c8b06">
</div><div id="outline-container-org3a84e13" class="outline-3">
<h3 id="org3a84e13"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-org3a84e13">
<ul class="org-ul">
<li><p>&gt;&lt;&gt;&lt;&gt;&lt;</p></li>

<li><p>infer level n can get level n+1</p></li>

<li><p>note how the types of these functions are different</p></li></ul>
</div>
</div>

<div id="outline-container-org1131c3e" class="outline-3">
<h3 id="org1131c3e">bs/find</h3>
<div class="outline-text-3" id="text-org1131c3e">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">bs/find</span> bs v<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> bs var <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">or</span> data #f<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> v
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>level <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>eq? level #f<span style="color: #696969;">)</span>
                     0
                     level<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span>found/commit <span style="color: #696969;">(</span>assq level <span style="color: #696969;">(</span>id-&gt;ls id<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> found/commit
         <span style="color: #696969;">(</span>cdr found/commit<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>found/ls <span style="color: #696969;">(</span>assq id bs<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
                <span style="color: #797979;">[</span>found/bind
                 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> found/ls
                   <span style="color: #696969;">(</span>assq level <span style="color: #696969;">(</span>cdr found/ls<span style="color: #696969;">))</span>
                   #f<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> found/bind
             <span style="color: #696969;">(</span>cdr found/bind<span style="color: #696969;">)</span>
             #f<span style="color: #696969;">))))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfbbdd6f" class="outline-3">
<h3 id="orgfbbdd6f">bs/walk</h3>
<div class="outline-text-3" id="text-orgfbbdd6f">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">bs/walk</span> bs d<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> bs data <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> data<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>found <span style="color: #696969;">(</span>bs/find bs v<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> found
         <span style="color: #696969;">(</span>bs/walk bs found<span style="color: #696969;">)</span>
         d<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ e<span style="color: #B380A8;">}</span> d<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org262cab6" class="outline-3">
<h3 id="org262cab6">bs/deep</h3>
<div class="outline-text-3" id="text-org262cab6">
<ul class="org-ul">
<li><p>do not handle trunk here</p><p>because I think maybe no computations should be done in pass3</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">bs/deep</span> bs d<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> bs data <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> data<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">letrec*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>bs/deep-list
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>bs dl<span style="color: #696969;">)</span>
               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>bs/deep bs x<span style="color: #696969;">))</span> dl<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span>bs/deep-arrow
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>bs a<span style="color: #696969;">)</span>
               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
                 <span style="color: #797979;">[</span><span style="color: #696969;">(</span>dl1 dl2<span style="color: #696969;">)</span>
                  <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>bs/deep-list bs dl1<span style="color: #696969;">)</span>
                        <span style="color: #696969;">(</span>bs/deep-list bs dl2<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span>bs/deep-arrow-list
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>bs al<span style="color: #696969;">)</span>
               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>a<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>bs/deep-arrow bs a<span style="color: #696969;">))</span> al<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>bs/walk bs d<span style="color: #696969;">)</span>
      <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">a var is fresh after bs/walk</span>
      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span>
       <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons <span style="color: #B380A8;">{</span>name dl<span style="color: #B380A8;">}}</span>
       <span style="color: #B380A8;">{</span>'cons <span style="color: #B380A8;">{</span>name <span style="color: #696969;">(</span>bs/deep-list bs dl<span style="color: #696969;">)</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow a<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'arrow <span style="color: #696969;">(</span>bs/deep-arrow bs a<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>a al<span style="color: #B380A8;">}}</span>
       <span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>bs/deep-arrow bs a<span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span>bs/deep-arrow-list bs al<span style="color: #696969;">)</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'trunk <span style="color: #B380A8;">{</span>a tody dl i<span style="color: #B380A8;">}}</span>
       <span style="color: #B380A8;">{</span>'trunk
         <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>bs/deep-arrow bs a<span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> tody
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/var v<span style="color: #B380A8;">}</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>bs/deep bs <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var v1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/var v1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow a1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/arrow-list <span style="color: #B380A8;">{</span>a1<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>a al<span style="color: #B380A8;">}}</span> <span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span>d
                <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'bs/deep
                  <span style="color: #696969;">(</span><span style="color: #e6db74;">"find something wrong from the var in the tody of trunk~%"</span><span style="color: #696969;">)</span>
                  <span style="color: #696969;">(</span><span style="color: #e6db74;">"data : ~a~%"</span> d<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/name n<span style="color: #B380A8;">}</span>
             <span style="color: #B380A8;">{</span>'tody/name n<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span>
             <span style="color: #B380A8;">{</span>'tody/arrow-list <span style="color: #696969;">(</span>bs/deep-arrow-list bs al<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span>bs/deep-list bs dl<span style="color: #696969;">)</span>
          i<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6fef526" class="outline-3">
<h3 id="org6fef526">var/fresh?</h3>
<div class="outline-text-3" id="text-org6fef526">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">var/fresh?</span> v e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> var env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> bool<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span>equal? <span style="color: #696969;">(</span>bs/walk bs <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
             <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4d8fcb" class="outline-3">
<h3 id="org4d8fcb">bs/extend</h3>
<div class="outline-text-3" id="text-org4d8fcb">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">bs/extend</span> bs v d<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> bs var data <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> bs<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> v
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>found/ls <span style="color: #696969;">(</span>assq id bs<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> found/ls
         <span style="color: #696969;">(</span>substitute <span style="color: #696969;">(</span>cons id <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>cons level d<span style="color: #696969;">)</span>
                                    <span style="color: #696969;">(</span>cdr found/ls<span style="color: #696969;">)))</span>
                     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>pair<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>eq? <span style="color: #696969;">(</span>car pair<span style="color: #696969;">)</span> id<span style="color: #696969;">))</span>
                     bs<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>cons id <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>cons level d<span style="color: #696969;">)))</span>
               bs<span style="color: #696969;">)))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org536607a" class="outline-3">
<h3 id="org536607a">var/eq?</h3>
<div class="outline-text-3" id="text-org536607a">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">var/eq?</span> v1 v2<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>list v1 v2<span style="color: #696969;">)</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>id1 level1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>id2 level2<span style="color: #B380A8;">}}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>eq? id1 id2<span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span>eq? level1 level2<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge39a72e" class="outline-2">
<h2 id="orge39a72e">copy-arrow</h2>
<div class="outline-text-2" id="text-orge39a72e">
</div><div id="outline-container-org20c91f2" class="outline-3">
<h3 id="org20c91f2"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-org20c91f2">
<ul class="org-ul">
<li><p>the name in trunk will be changed to (arrow &#x2026;)</p><p>(arrow &#x2026;) is fetched from ns and copied</p></li>

<li><p><p></p><p>copy-arrow is called when</p><p></p></p><p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides"></p><p></p><p></p><p><colgroup></p><p><col  class="org-left" /></p><p></p><p><col  class="org-left" /></p><p></colgroup></p><p><tbody></p><p><tr></p><p><td class="org-left">trunk intro in pass3</td></p><p><td class="org-left">copy type arrow</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">trunk-&gt;trunk*</td></p><p><td class="org-left">copy body arrow-list</td></p><p></tr></p><p></p><p><tr></p><p><td class="org-left">compute/arrow in type-compute</td></p><p><td class="org-left">copy arrow to maintain undo-ablity</td></p><p></tr></p><p></tbody></p><p></table></p></li>

<li><p>copy is arrow by arrow</p><p>every var in new arrow is different from old arrow</p><p>thus</p><p><ol class="org-ol"></p><p><li>scope is also arrow by arrow</li></p><p><li>a non-determinate var can not be substituted into lambda as it is</p><p>but is copied</li></ol></p></li>

<li><p>this copy is one of the main place where this prototype can be optimized</p><p>a vm can be designed to replace this copy function</p><p>and change the interpreter to a compiler</p></li></ul>
</div>
</div>

<div id="outline-container-orgdf2eb76" class="outline-3">
<h3 id="orgdf2eb76">copy-arrow</h3>
<div class="outline-text-3" id="text-orgdf2eb76">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy-arrow</span> a<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> arrow<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/arrow a '<span style="color: #696969;">())</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a1 __<span style="color: #B380A8;">}</span> a1<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga43649a" class="outline-3">
<h3 id="orga43649a">copy-cedent</h3>
<div class="outline-text-3" id="text-orga43649a">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy-cedent</span> c<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cedent <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> cedent<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/cedent c '<span style="color: #696969;">())</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>c1 __<span style="color: #B380A8;">}</span> c1<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4b210d2" class="outline-3">
<h3 id="org4b210d2">copy/arrow</h3>
<div class="outline-text-3" id="text-org4b210d2">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy/arrow</span> a s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>arrow scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/cedent ac s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/cedent sc s1<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>sc1 s2<span style="color: #B380A8;">}</span>
           <span style="color: #B380A8;">{{</span>ac1 sc1<span style="color: #B380A8;">}</span> s2<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4a76773" class="outline-3">
<h3 id="org4a76773">copy/data-list</h3>
<div class="outline-text-3" id="text-org4a76773">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy/data-list</span> dl s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">((</span>data ...<span style="color: #696969;">)</span> scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span>copy/cedent dl s<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgabb260f" class="outline-3">
<h3 id="orgabb260f">copy/cedent</h3>
<div class="outline-text-3" id="text-orgabb260f">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy/cedent</span> c s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cedent scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>cedent scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{{}</span> s<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>h . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy h s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>h1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/cedent r s1<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>r1 s2<span style="color: #B380A8;">}</span>
           <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons h1 r1<span style="color: #696969;">)</span> s2<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbc32485" class="outline-3">
<h3 id="orgbc32485">copy/lambda</h3>
<div class="outline-text-3" id="text-orgbc32485">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy/lambda</span> l s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> lambda scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> l
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a al<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/arrow a s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/arrow-list al s1<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>al1 s2<span style="color: #B380A8;">}</span>
           <span style="color: #B380A8;">{{</span>a1 al1<span style="color: #B380A8;">}</span> s2<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6f15514" class="outline-3">
<h3 id="org6f15514">copy/arrow-list</h3>
<div class="outline-text-3" id="text-org6f15514">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy/arrow-list</span> al s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)</span> scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">((</span>arrow ...<span style="color: #696969;">)</span> scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> al
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{{}</span> s<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>h . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/arrow h s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>h1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/arrow-list r s1<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>r1 s2<span style="color: #B380A8;">}</span>
           <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons h1 r1<span style="color: #696969;">)</span> s2<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org609f86c" class="outline-3">
<h3 id="org609f86c">copy</h3>
<div class="outline-text-3" id="text-org609f86c">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy</span> d s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> data scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>data scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var x<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/var x s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>x1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{{</span>'var x1<span style="color: #B380A8;">}</span> s1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons x<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/cons x s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>x1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{{</span>'cons x1<span style="color: #B380A8;">}</span> s1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow x<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/arrow x s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>x1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{{</span>'arrow x1<span style="color: #B380A8;">}</span> s1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda x<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/lambda x s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>x1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{{</span>'lambda x1<span style="color: #B380A8;">}</span> s1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'trunk x<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/trunk x s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>x1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{{</span>'trunk x1<span style="color: #B380A8;">}</span> s1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org52db187" class="outline-3">
<h3 id="org52db187">copy/var</h3>
<div class="outline-text-3" id="text-org52db187">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy/var</span> v s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> var scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>var scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> v
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>found <span style="color: #696969;">(</span>assq id s<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> found
         <span style="color: #B380A8;">{{</span><span style="color: #696969;">(</span>cdr found<span style="color: #696969;">)</span> level<span style="color: #B380A8;">}</span> s<span style="color: #B380A8;">}</span>
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>ls <span style="color: #696969;">(</span>id-&gt;ls id<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
                <span style="color: #797979;">[</span>id1 <span style="color: #696969;">(</span>id/new <span style="color: #696969;">(</span>id-&gt;name id<span style="color: #696969;">)</span> '<span style="color: #696969;">())</span><span style="color: #797979;">]</span>
                <span style="color: #797979;">[</span>s1 <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>cons id id1<span style="color: #696969;">)</span> s<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/ls ls s1<span style="color: #696969;">)</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ls1 s2<span style="color: #B380A8;">}</span>
              <span style="color: #696969;">(</span>id/commit! id1 ls1<span style="color: #696969;">)</span>
              <span style="color: #B380A8;">{{</span>id1 level<span style="color: #B380A8;">}</span> s2<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">))))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgedfa52f" class="outline-3">
<h3 id="orgedfa52f">copy/ls</h3>
<div class="outline-text-3" id="text-orgedfa52f">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy/ls</span> ls s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> ls scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>ls scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> ls
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{{}</span> s<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">((</span>level . data<span style="color: #696969;">)</span> . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy data s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>data1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/ls r s1<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>r1 s2<span style="color: #B380A8;">}</span>
           <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>cons level data1<span style="color: #696969;">)</span>
                  r1<span style="color: #696969;">)</span>
            s2<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org154adf3" class="outline-3">
<h3 id="org154adf3">copy/cons</h3>
<div class="outline-text-3" id="text-org154adf3">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy/cons</span> c s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cons scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>cons scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>n dl<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/data-list dl s<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>dl1 s1<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{{</span>n dl1<span style="color: #B380A8;">}</span> s1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1aa437" class="outline-3">
<h3 id="org1aa437">copy/trunk</h3>
<div class="outline-text-3" id="text-org1aa437">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">copy/trunk</span> p s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk scope <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">trunk</span> scope<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> p
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a tody dl i<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> tody
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/var v<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/arrow a s<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a1 s1<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/data-list dl s1<span style="color: #696969;">)</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>dl1 s2<span style="color: #B380A8;">}</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/var v s2<span style="color: #696969;">)</span>
                <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>v1 s3<span style="color: #B380A8;">}</span>
                 <span style="color: #B380A8;">{{</span>a1 <span style="color: #B380A8;">{</span>'tody/var v1<span style="color: #B380A8;">}</span> dl1 i<span style="color: #B380A8;">}</span> s3<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/name n<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/arrow a s<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a1 s1<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/data-list dl s1<span style="color: #696969;">)</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>dl1 s2<span style="color: #B380A8;">}</span>
              <span style="color: #B380A8;">{{</span>a1 <span style="color: #B380A8;">{</span>'tody/name n<span style="color: #B380A8;">}</span> dl1 i<span style="color: #B380A8;">}</span> s2<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/arrow a s<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a1 s1<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/arrow-list al s1<span style="color: #696969;">)</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>al1 s2<span style="color: #B380A8;">}</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy/data-list dl s2<span style="color: #696969;">)</span>
                <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>dl1 s3<span style="color: #B380A8;">}</span>
                 <span style="color: #B380A8;">{{</span>a1 <span style="color: #B380A8;">{</span>'tody/arrow-list al1<span style="color: #B380A8;">}</span> dl1 i<span style="color: #B380A8;">}</span> s3<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfb076b5" class="outline-2">
<h2 id="orgfb076b5">compute</h2>
<div class="outline-text-2" id="text-orgfb076b5">
</div><div id="outline-container-orgc8be950" class="outline-3">
<h3 id="orgc8be950">compute/arrow</h3>
<div class="outline-text-3" id="text-orgc8be950">
<ul class="org-ul">
<li><p>commit should be preformed arrow by arrow</p><p>one arrow can only commit on its own var</p><p>this is achieve by the natural of the structure of bs</p></li>

<li><p>note that</p><p>commit is only meant to handle non-determinate var</p><p>of which the level n is bound</p><p>where n &gt; 0</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">compute/arrow</span> a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>alen <span style="color: #696969;">(</span>length ac<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
              <span style="color: #797979;">[</span>slen <span style="color: #696969;">(</span>length sc<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/cedent ac <span style="color: #B380A8;">{</span>ds <span style="color: #696969;">(</span>cons '<span style="color: #696969;">(</span>commit-point<span style="color: #696969;">)</span> bs<span style="color: #696969;">)</span> ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds1 bs1 ns1<span style="color: #B380A8;">}}</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span><span style="color: #FF8888;">;; </span><span style="color: #FF8888;">unify/data-list</span>
                     cover/data-list
                     <span style="color: #696969;">(</span>take ds1 alen<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>take <span style="color: #696969;">(</span>drop ds1 alen<span style="color: #696969;">)</span> alen<span style="color: #696969;">)</span>
                     <span style="color: #B380A8;">{</span>'success
                      <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>drop <span style="color: #696969;">(</span>drop ds1 alen<span style="color: #696969;">)</span> alen<span style="color: #696969;">)</span>
                       bs1
                       ns1<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e2<span style="color: #B380A8;">}</span>
                <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/cedent sc e2<span style="color: #696969;">)</span>
                  <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
                  <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds3 bs3 ns3<span style="color: #B380A8;">}}</span>
                   <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds3 <span style="color: #696969;">(</span>bs/commit! bs3<span style="color: #696969;">)</span> ns3<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge67a6d" class="outline-3">
<h3 id="orge67a6d">solve/arrow</h3>
<div class="outline-text-3" id="text-orge67a6d">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">solve/arrow</span> a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>alen <span style="color: #696969;">(</span>length ac<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
              <span style="color: #797979;">[</span>slen <span style="color: #696969;">(</span>length sc<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/cedent ac <span style="color: #B380A8;">{</span>ds <span style="color: #696969;">(</span>cons '<span style="color: #696969;">(</span>commit-point<span style="color: #696969;">)</span> bs<span style="color: #696969;">)</span> ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds1 bs1 ns1<span style="color: #B380A8;">}}</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>unify/data-list
                     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">cover/data-list</span>
                     <span style="color: #696969;">(</span>take ds1 alen<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>take <span style="color: #696969;">(</span>drop ds1 alen<span style="color: #696969;">)</span> alen<span style="color: #696969;">)</span>
                     <span style="color: #B380A8;">{</span>'success
                      <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>drop <span style="color: #696969;">(</span>drop ds1 alen<span style="color: #696969;">)</span> alen<span style="color: #696969;">)</span>
                       bs1
                       ns1<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e2<span style="color: #B380A8;">}</span>
                <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/cedent sc e2<span style="color: #696969;">)</span>
                  <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
                  <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds3 bs3 ns3<span style="color: #B380A8;">}}</span>
                   <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds3 <span style="color: #696969;">(</span>bs/commit! bs3<span style="color: #696969;">)</span> ns3<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org904153a" class="outline-3">
<h3 id="org904153a">bs/commit!</h3>
<div class="outline-text-3" id="text-org904153a">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">bs/commit!</span> bs<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> bs <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> bs
     <span style="color: #797979;">[</span>with effect on part of elements of bs<span style="color: #797979;">]</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">cond</span> <span style="color: #797979;">[</span><span style="color: #696969;">(</span>equal? '<span style="color: #696969;">(</span>commit-point<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>car bs<span style="color: #696969;">))</span>
         <span style="color: #696969;">(</span>cdr bs<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
        <span style="color: #797979;">[</span>else
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>pair <span style="color: #696969;">(</span>car bs<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
                <span style="color: #797979;">[</span>id <span style="color: #696969;">(</span>car pair<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
                <span style="color: #797979;">[</span>ls <span style="color: #696969;">(</span>cdr pair<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span>id/commit! id ls<span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span>bs/commit! <span style="color: #696969;">(</span>cdr bs<span style="color: #696969;">)))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org68891d7" class="outline-3">
<h3 id="org68891d7">compute/cedent</h3>
<div class="outline-text-3" id="text-org68891d7">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">compute/cedent</span> c e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cedent env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
    <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">proper tail call</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>h<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>compute h e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>h . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute h e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>compute/cedent r e1<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9e535cd" class="outline-3">
<h3 id="org9e535cd">compute</h3>
<div class="outline-text-3" id="text-org9e535cd">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">compute</span> d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>ds bs ns<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>compute/var x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>compute/cons x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'trunk x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>compute/trunk x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">note that arrow in arrow is computed as literal</span>
       <span style="color: #797979;">[</span>__ <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons d ds<span style="color: #696969;">)</span> bs ns<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org48412ed" class="outline-3">
<h3 id="org48412ed">compute/var</h3>
<div class="outline-text-3" id="text-org48412ed">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">compute/var</span> v e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> var env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>ds bs ns<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>d <span style="color: #696969;">(</span>bs/deep bs <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
         <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">result found from this var needs to be compute again</span>
         <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">except for fresh var</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var __<span style="color: #B380A8;">}</span>
          <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons d ds<span style="color: #696969;">)</span> bs ns<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ __<span style="color: #B380A8;">}</span>
          <span style="color: #696969;">(</span>compute d e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb73ae1e" class="outline-3">
<h3 id="orgb73ae1e">compute/cons</h3>
<div class="outline-text-3" id="text-orgb73ae1e">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">compute/cons</span> c e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cons env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>ds bs ns<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
       <span style="color: #797979;">[</span><span style="color: #696969;">(</span>n dl<span style="color: #696969;">)</span>
        <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">the following reverse</span>
        <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">dl in stack -&gt; dl in function body</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/cedent <span style="color: #696969;">(</span>reverse dl<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>list '<span style="color: #696969;">()</span> bs ns<span style="color: #696969;">))</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
           <span style="color: #B380A8;">{</span>'fail <span style="color: #696969;">(</span>cons `<span style="color: #696969;">(</span>compute/cons
                          fail
                          <span style="color: #696969;">(</span>cons: ,c<span style="color: #696969;">))</span>
                        il<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds1 bs1 ns1<span style="color: #B380A8;">}}</span>
           <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons <span style="color: #B380A8;">{</span>'cons <span style="color: #B380A8;">{</span>n ds1<span style="color: #B380A8;">}}</span>
                            ds<span style="color: #696969;">)</span>
                      bs
                      ns<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgee4a38c" class="outline-3">
<h3 id="orgee4a38c">compute/trunk</h3>
<div class="outline-text-3" id="text-orgee4a38c">
</div><div id="outline-container-org4955eb" class="outline-4">
<h4 id="org4955eb">compute/trunk</h4>
<div class="outline-text-4" id="text-org4955eb">
<ul class="org-ul">
<li><p>I thought</p><p>there is no reducible trunk after compute/trunk</p><p>thus no reducible trunk after compute/arrow</p><p>but it is actually not true</p><p>because computations after a non-reducible trunk</p><p>might make the trunk reducible</p><p>but no look-back is implemented to handle such case</p></li>

<li><p>&gt;&lt;&gt;&lt;&gt;&lt;</p><p>since I do not really have this invariant</p><p>I should be careful to make sure that</p><p>no functions rely on this invariant</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">compute/trunk</span> t e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> t
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a tody dl i<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> tody
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/var __<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>compute/trunk/tody/var t e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/name __<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>compute/trunk/tody/name t e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/arrow-list __<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>compute/trunk/tody/arrow-list t e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3f27012" class="outline-4">
<h4 id="org3f27012">compute/trunk/tody/var</h4>
<div class="outline-text-4" id="text-org3f27012">
<ul class="org-ul">
<li><p>non-determinate may still here</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">compute/trunk/tody/var</span> t e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> t
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a <span style="color: #B380A8;">{</span>'tody/var v<span style="color: #B380A8;">}</span> dl i<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>bs/deep bs <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var v1<span style="color: #B380A8;">}</span>
           <span style="color: #B380A8;">{</span>'success
            <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons <span style="color: #B380A8;">{</span>'trunk <span style="color: #B380A8;">{</span>a <span style="color: #B380A8;">{</span>'tody/var v1<span style="color: #B380A8;">}</span> dl i<span style="color: #B380A8;">}}</span> ds<span style="color: #696969;">)</span>
             bs
             ns<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow a1<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span>compute/trunk/tody/arrow-list
            <span style="color: #B380A8;">{</span>a <span style="color: #B380A8;">{</span>'tody/arrow-list <span style="color: #B380A8;">{</span>a1<span style="color: #B380A8;">}}</span> dl i<span style="color: #B380A8;">}</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>a1 al<span style="color: #B380A8;">}}</span>
           <span style="color: #696969;">(</span>compute/trunk/tody/arrow-list
            <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">I can use a1 or a</span>
            <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">I use a here</span>
            <span style="color: #B380A8;">{</span>a <span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span> dl i<span style="color: #B380A8;">}</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span>d
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'compute/trunk/tody/var
             <span style="color: #696969;">(</span><span style="color: #e6db74;">"find something wrong from the var in the tody of trunk~%"</span><span style="color: #696969;">)</span>
             <span style="color: #696969;">(</span><span style="color: #e6db74;">"data : ~a~%"</span> d<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7e63705" class="outline-4">
<h4 id="org7e63705">compute/trunk/tody/name</h4>
<div class="outline-text-4" id="text-org7e63705">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">compute/trunk/tody/name</span> t e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> t
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a <span style="color: #B380A8;">{</span>'tody/name n<span style="color: #B380A8;">}</span> dl i<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>compute/trunk/tody/arrow-list <span style="color: #696969;">(</span>trunk-&gt;trunk* t e<span style="color: #696969;">)</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc9e3b7f" class="outline-4">
<h4 id="orgc9e3b7f">compute/trunk/tody/arrow-list</h4>
<div class="outline-text-4" id="text-orgc9e3b7f">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">compute/trunk/tody/arrow-list</span> t e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> t
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a <span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span> dl i<span style="color: #B380A8;">}</span>
        <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">the following reverse</span>
        <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">dl in stack -&gt; dl in function body</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/cedent <span style="color: #696969;">(</span>reverse dl<span style="color: #696969;">)</span> <span style="color: #B380A8;">{{}</span> bs ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
           <span style="color: #B380A8;">{</span>'fail <span style="color: #696969;">(</span>cons `<span style="color: #696969;">(</span>compute/trunk/tody/arrow-list
                          fail when computing data-list
                          <span style="color: #696969;">(</span>data-list: ,dl<span style="color: #696969;">))</span>
                        il<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e1
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds1 bs1 ns1<span style="color: #B380A8;">}</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>dl1 ds1<span style="color: #797979;">]</span>
                     <span style="color: #797979;">[</span>al1 <span style="color: #696969;">(</span>filter-arrow-list al dl1 e1<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
                <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> al1
                  <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span>
                   <span style="color: #B380A8;">{</span>'success
                    <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons <span style="color: #B380A8;">{</span>'trunk <span style="color: #B380A8;">{</span>a <span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span> dl1 i<span style="color: #B380A8;">}}</span>
                           ds<span style="color: #696969;">)</span>
                     bs1
                     ns1<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
                  <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a1<span style="color: #B380A8;">}</span>
                   <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/arrow a1 e1<span style="color: #696969;">)</span>
                     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">after this compute/arrow</span>
                     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">binds are commited</span>
                     <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e2<span style="color: #B380A8;">}</span>
                      <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>proj i e2<span style="color: #696969;">)</span> ds<span style="color: #696969;">)</span>
                                 bs1
                                 ns1<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
                     <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2e4e56f" class="outline-4">
<h4 id="org2e4e56f">trunk-&gt;trunk*</h4>
<div class="outline-text-4" id="text-org2e4e56f">
<ul class="org-ul">
<li><p>replace the name in trunk by arrow-list</p></li>

<li><p>the ns of env is needed</p><p>to find the arrow-list under the name</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">trunk-&gt;trunk*</span> t e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> trunk<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> t
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a <span style="color: #B380A8;">{</span>'tody/name n<span style="color: #B380A8;">}</span> dl i<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>found <span style="color: #696969;">(</span>assq n ns<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not found<span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'trunk-&gt;trunk*
              <span style="color: #696969;">(</span><span style="color: #e6db74;">"fail~%"</span><span style="color: #696969;">)</span>
              <span style="color: #696969;">(</span><span style="color: #e6db74;">"unknow name : ~a~%"</span> n<span style="color: #696969;">))</span>
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>meaning <span style="color: #696969;">(</span>cdr found<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> meaning
                <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{{</span>ac sc<span style="color: #B380A8;">}</span> al1<span style="color: #B380A8;">}}</span>
                 <span style="color: #B380A8;">{</span>a <span style="color: #B380A8;">{</span>'tody/arrow-list <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> copy-arrow al1<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span> dl i<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
                <span style="color: #797979;">[</span>__
                 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'trunk-&gt;trunk*
                   <span style="color: #696969;">(</span><span style="color: #e6db74;">"trunk-&gt;trunk* fail~%"</span> <span style="color: #696969;">)</span>
                   <span style="color: #696969;">(</span><span style="color: #e6db74;">"name is not lambda : ~a~%"</span> n<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))))</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a tody dl i<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>a tody dl i<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org143ad8c" class="outline-3">
<h3 id="org143ad8c">filter-arrow-list</h3>
<div class="outline-text-3" id="text-org143ad8c">
<ul class="org-ul">
<li><p>no commit should be made here</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">filter-arrow-list</span> al dl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>eq? '<span style="color: #696969;">()</span> al<span style="color: #696969;">)</span>
    '<span style="color: #696969;">()</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>car al<span style="color: #696969;">)</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac __<span style="color: #B380A8;">}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>alen <span style="color: #696969;">(</span>length ac<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/cedent ac e<span style="color: #696969;">)</span>
              <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail __<span style="color: #B380A8;">}</span>
               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'filter-arrow-list <span style="color: #696969;">(</span><span style="color: #e6db74;">"fail to compute/cedent~%"</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span>
              <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds1 bs1 ns1<span style="color: #B380A8;">}}</span>
               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span><span style="color: #FF8888;">;; </span><span style="color: #FF8888;">unify/data-list</span>
                       cover/data-list
                       <span style="color: #696969;">(</span>take ds1 alen<span style="color: #696969;">)</span> dl
                       <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>drop ds1 alen<span style="color: #696969;">)</span>
                                  bs1
                                  ns1<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
                 <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail __<span style="color: #B380A8;">}</span>
                  <span style="color: #696969;">(</span>filter-arrow-list <span style="color: #696969;">(</span>cdr al<span style="color: #696969;">)</span> dl e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
                 <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
                  <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>car al<span style="color: #696969;">)</span> '<span style="color: #696969;">())</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge05f932" class="outline-3">
<h3 id="orge05f932">proj</h3>
<div class="outline-text-3" id="text-orge05f932">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">proj</span> i e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> index env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> data<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>ds bs ns<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>list-ref ds <span style="color: #696969;">(</span>- <span style="color: #696969;">(</span>length ds<span style="color: #696969;">)</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+</span> 1 i<span style="color: #696969;">)))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org197cd01" class="outline-2">
<h2 id="org197cd01">print</h2>
<div class="outline-text-2" id="text-org197cd01">
</div><div id="outline-container-org9b54b47" class="outline-3">
<h3 id="org9b54b47">print/cedent</h3>
<div class="outline-text-3" id="text-org9b54b47">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">print/cedent</span> c e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cedent env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #797979;">[</span>effect on terminal<span style="color: #797979;">]</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #696969;">(</span>void<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>d<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>print/data d e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>d . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>print/data d e<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>format #t <span style="color: #e6db74;">" "</span><span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>print/cedent r e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf37b676" class="outline-3">
<h3 id="orgf37b676">print/data-list</h3>
<div class="outline-text-3" id="text-orgf37b676">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">print/data-list</span> dl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #797979;">[</span>effect on terminal<span style="color: #797979;">]</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>print/cedent <span style="color: #696969;">(</span>reverse dl<span style="color: #696969;">)</span> e<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org220c2cb" class="outline-3">
<h3 id="org220c2cb">print/data</h3>
<div class="outline-text-3" id="text-org220c2cb">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">print/data</span> d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #797979;">[</span>effect on terminal<span style="color: #797979;">]</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>print/var x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>print/cons x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>print/arrow x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>print/lambda x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'trunk x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>print/trunk x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgff6f9e5" class="outline-3">
<h3 id="orgff6f9e5">print/var</h3>
<div class="outline-text-3" id="text-orgff6f9e5">
<ul class="org-ul">
<li><p>different var should be print differently</p></li>

<li><p>note that</p><p>the env is not used by even print/var</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">print/var</span> v e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> var env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #797979;">[</span>effect on terminal<span style="color: #797979;">]</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> v
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>name <span style="color: #696969;">(</span>id-&gt;name id<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span>counter <span style="color: #696969;">(</span>id-&gt;counter id<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>format #t <span style="color: #e6db74;">":~a:~a^~a"</span> counter name level<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org406ae05" class="outline-3">
<h3 id="org406ae05">print/cons</h3>
<div class="outline-text-3" id="text-org406ae05">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">print/cons</span> c e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cons env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #797979;">[</span>effect on terminal<span style="color: #797979;">]</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>n dl<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span>format #t <span style="color: #e6db74;">"["</span><span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>print/data-list dl e<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>null? dl<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>format #t <span style="color: #e6db74;">"~a]"</span> n<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>format #t <span style="color: #e6db74;">" ~a]"</span> n<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org704778" class="outline-3">
<h3 id="org704778">print/arrow</h3>
<div class="outline-text-3" id="text-org704778">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">print/arrow</span> a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #797979;">[</span>effect on terminal<span style="color: #797979;">]</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span>format #t <span style="color: #e6db74;">"("</span><span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>print/cedent ac e<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>format #t <span style="color: #e6db74;">" -&gt; "</span><span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>print/cedent sc e<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>format #t <span style="color: #e6db74;">")"</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1954eb5" class="outline-3">
<h3 id="org1954eb5"><span class="todo _gt__lt_">&gt;&lt;</span> print/lambda</h3>
<div class="outline-text-3" id="text-org1954eb5">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">print/lambda</span> l e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> lambda env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #797979;">[</span>effect on terminal<span style="color: #797979;">]</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> l
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a al<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span>format #t <span style="color: #e6db74;">"&lt;lambda&gt;"</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org664c6b6" class="outline-3">
<h3 id="org664c6b6"><span class="todo _gt__lt_">&gt;&lt;</span> print/trunk</h3>
<div class="outline-text-3" id="text-org664c6b6">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">print/trunk</span> t e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #797979;">[</span>effect on terminal<span style="color: #797979;">]</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> t
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a tody dl i<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span>format #t <span style="color: #e6db74;">"&lt;trunk&gt;"</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb4cf831" class="outline-2">
<h2 id="orgb4cf831">consistent-check</h2>
<div class="outline-text-2" id="text-orgb4cf831">
</div><div id="outline-container-orga5e417e" class="outline-3">
<h3 id="orga5e417e">consistent-check</h3>
<div class="outline-text-3" id="text-orga5e417e">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">consistent-check</span> v d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>v e<span style="color: #B380A8;">}</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>id level<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>var/highest? v e<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>var/lowest? v e<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>#t #t<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>#t #f<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>var/below v e<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>__ low-level<span style="color: #B380A8;">}</span> low-d<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span>consistent-check/level-diff <span style="color: #696969;">(</span>- level low-level<span style="color: #696969;">)</span> low-d d e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>#f #t<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>var/above v e<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>__ high-level<span style="color: #B380A8;">}</span> high-d<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span>consistent-check/level-diff <span style="color: #696969;">(</span>- high-level level<span style="color: #696969;">)</span> d high-d e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>#f #f<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>var/below v e<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>__ low-level<span style="color: #B380A8;">}</span> low-d<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>consistent-check/level-diff <span style="color: #696969;">(</span>- level low-level<span style="color: #696969;">)</span> low-d d e<span style="color: #696969;">)</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>var/above v e<span style="color: #696969;">)</span>
                <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>__ high-level<span style="color: #B380A8;">}</span> high-d<span style="color: #B380A8;">}</span>
                 <span style="color: #696969;">(</span>consistent-check/level-diff <span style="color: #696969;">(</span>- high-level level<span style="color: #696969;">)</span> d high-d e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc98e52" class="outline-3">
<h3 id="orgc98e52">consistent-check/level-diff</h3>
<div class="outline-text-3" id="text-orgc98e52">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">consistent-check/level-diff</span> level-diff d1 d2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> level-diff data data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-compute/repeat level-diff d1 e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>d0 . __<span style="color: #696969;">)</span> bs1 ns1<span style="color: #B380A8;">}}</span>
        <span style="color: #696969;">(</span>unify/data d0 d2 <span style="color: #B380A8;">{</span>ds bs1 ns1<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf8ebdec" class="outline-3">
<h3 id="orgf8ebdec">type-compute/repeat</h3>
<div class="outline-text-3" id="text-orgf8ebdec">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-compute/repeat</span> c d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> counter data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>eq? 0 c<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span>#t <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons d ds<span style="color: #696969;">)</span> bs ns<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span>#f <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-compute d e<span style="color: #696969;">)</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>d1 . r<span style="color: #696969;">)</span> bs1 ns1<span style="color: #B380A8;">}}</span>
              <span style="color: #696969;">(</span>type-compute/repeat <span style="color: #696969;">(</span>- c 1<span style="color: #696969;">)</span> d1 <span style="color: #B380A8;">{</span>r bs1 ns1<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5c1e6ff" class="outline-3">
<h3 id="org5c1e6ff">var/highest? &amp; var/lowest?</h3>
<div class="outline-text-3" id="text-org5c1e6ff">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">var/highest?</span> v e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> bool<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> v
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>found <span style="color: #696969;">(</span>assq id bs<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span>ls <span style="color: #696969;">(</span>append <span style="color: #696969;">(</span>id-&gt;ls id<span style="color: #696969;">)</span>
                           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> found <span style="color: #696969;">(</span>cdr found<span style="color: #696969;">)</span> '<span style="color: #696969;">()))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span>list-every?
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>&gt; level <span style="color: #696969;">(</span>car x<span style="color: #696969;">)))</span>
           ls<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">var/lowest?</span> v e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> bool<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> v
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>found <span style="color: #696969;">(</span>assq id bs<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span>ls <span style="color: #696969;">(</span>append <span style="color: #696969;">(</span>id-&gt;ls id<span style="color: #696969;">)</span>
                           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> found <span style="color: #696969;">(</span>cdr found<span style="color: #696969;">)</span> '<span style="color: #696969;">()))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span>list-every?
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>&lt; level <span style="color: #696969;">(</span>car x<span style="color: #696969;">)))</span>
           ls<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org469e8d4" class="outline-3">
<h3 id="org469e8d4">var/above &amp; var/below</h3>
<div class="outline-text-3" id="text-org469e8d4">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">var/above</span> v e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>var data<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> v
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>found <span style="color: #696969;">(</span>assq id bs<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span>ls <span style="color: #696969;">(</span>append <span style="color: #696969;">(</span>id-&gt;ls id<span style="color: #696969;">)</span>
                           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> found <span style="color: #696969;">(</span>cdr found<span style="color: #696969;">)</span> '<span style="color: #696969;">()))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>pair
                 <span style="color: #696969;">(</span>car <span style="color: #696969;">(</span>filter <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>&gt; <span style="color: #696969;">(</span>car x<span style="color: #696969;">)</span> level<span style="color: #696969;">))</span>
                              <span style="color: #696969;">(</span>sort <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x y<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>&lt; <span style="color: #696969;">(</span>car x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>car y<span style="color: #696969;">)))</span>
                                    ls<span style="color: #696969;">)))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
            <span style="color: #B380A8;">{{</span>id <span style="color: #696969;">(</span>car pair<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>cdr pair<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">var/below</span> v e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>var data<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> v
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>found <span style="color: #696969;">(</span>assq id bs<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span>ls <span style="color: #696969;">(</span>append <span style="color: #696969;">(</span>id-&gt;ls id<span style="color: #696969;">)</span>
                           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> found <span style="color: #696969;">(</span>cdr found<span style="color: #696969;">)</span> '<span style="color: #696969;">()))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>pair
                 <span style="color: #696969;">(</span>car <span style="color: #696969;">(</span>filter <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>&lt; <span style="color: #696969;">(</span>car x<span style="color: #696969;">)</span> level<span style="color: #696969;">))</span>
                              <span style="color: #696969;">(</span>sort <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x y<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>&gt; <span style="color: #696969;">(</span>car x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>car y<span style="color: #696969;">)))</span>
                                    ls<span style="color: #696969;">)))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
            <span style="color: #B380A8;">{{</span>id <span style="color: #696969;">(</span>car pair<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>cdr pair<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc7fb27d" class="outline-2">
<h2 id="orgc7fb27d">occur-check</h2>
<div class="outline-text-2" id="text-orgc7fb27d">
</div><div id="outline-container-org228a250" class="outline-3">
<h3 id="org228a250"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-org228a250">
<ul class="org-ul">
<li><p>this is a simple occurrence check</p><p>&gt;&lt;&gt;&lt;&gt;&lt;</p><p>it should be merged with consistent check</p><p>without such merging</p><p>the occurrence check will be not complete</p></li></ul>
</div>
</div>

<div id="outline-container-orgab31644" class="outline-3">
<h3 id="orgab31644">occur-check/data</h3>
<div class="outline-text-3" id="text-orgab31644">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">occur-check/data</span> v d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>bs/deep bs d<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>occur-check/var v x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>occur-check/cons v x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>occur-check/arrow v x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>occur-check/lambda v x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'trunk x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>occur-check/trunk v x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgecda46d" class="outline-3">
<h3 id="orgecda46d">occur-check/var</h3>
<div class="outline-text-3" id="text-orgecda46d">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">occur-check/var</span> v v0 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var var env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>var/eq? v v0<span style="color: #696969;">)</span>
    <span style="color: #797979;">[</span>#t <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>occur-check/var fail <span style="color: #696969;">(</span>v: ,v<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span>#f <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgca2c3ca" class="outline-3">
<h3 id="orgca2c3ca">occur-check/cons</h3>
<div class="outline-text-3" id="text-orgca2c3ca">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">occur-check/cons</span> v c e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var cons env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>n dl<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span>occur-check/data-list v dl e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5da755d" class="outline-3">
<h3 id="org5da755d">occur-check/data-list</h3>
<div class="outline-text-3" id="text-org5da755d">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">occur-check/data-list</span> v dl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> dl
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>d . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>occur-check/data v d e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>occur-check/data-list v r e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga2596b6" class="outline-3">
<h3 id="orga2596b6">occur-check/arrow</h3>
<div class="outline-text-3" id="text-orga2596b6">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">occur-check/arrow</span> v a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>occur-check/data-list v ac e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>occur-check/data-list v sc e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb072311" class="outline-3">
<h3 id="orgb072311">occur-check/lambda</h3>
<div class="outline-text-3" id="text-orgb072311">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">occur-check/lambda</span> v l e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var lambda env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> l
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a al<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>occur-check/arrow v a e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>occur-check/arrow-list v al e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org46801e0" class="outline-3">
<h3 id="org46801e0">occur-check/arrow-list</h3>
<div class="outline-text-3" id="text-org46801e0">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">occur-check/arrow-list</span> v al e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> al
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>a . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>occur-check/arrow v a e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>occur-check/arrow-list v r e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbe765f8" class="outline-3">
<h3 id="orgbe765f8">occur-check/trunk</h3>
<div class="outline-text-3" id="text-orgbe765f8">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">occur-check/trunk</span> v t e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> t
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a tody dl i<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>occur-check/arrow v a e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>occur-check/data-list v dl e<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> tody
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/name __<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>occur-check/arrow-list v al e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'tody/var v1<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>occur-check/var v v1 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1818a3a" class="outline-2">
<h2 id="org1818a3a">unify</h2>
<div class="outline-text-2" id="text-org1818a3a">
</div><div id="outline-container-org48faf3e" class="outline-3">
<h3 id="org48faf3e"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-org48faf3e">
<ul class="org-ul">
<li><p>firstly we have first order syntactic unification</p></li>

<li><p>except for unify/trunk/data</p><p>where semantic unification is used</p></li>

<li><p>and for unify/trunk</p><p>where first syntactic unification is tried</p><p>if it fail</p><p>semantic unification is used</p></li>

<li><p>semantic unification is unification modulo theory</p><p>the theory here is term-rewriting-system</p></li></ul>
</div>
</div>

<div id="outline-container-orgd3418d6" class="outline-3">
<h3 id="orgd3418d6">unify/data-list</h3>
<div class="outline-text-3" id="text-orgd3418d6">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/data-list</span> pl dl r<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>pattern ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> report <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> r
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">cond</span> <span style="color: #797979;">[</span><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>eq? pl '<span style="color: #696969;">())</span> <span style="color: #696969;">(</span>eq? dl '<span style="color: #696969;">()))</span>
            r<span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span><span style="color: #696969;">(</span>eq? pl <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span>
            <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>unify/data-list
                      fail pl and dl is not of the same length
                      <span style="color: #696969;">(</span>additional-dl: ,dl<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span><span style="color: #696969;">(</span>eq? dl <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span>
            <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>unify/data-list
                      fail pl and dl is not of the same length
                      <span style="color: #696969;">(</span>additional-pl: ,pl<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span>else
            <span style="color: #696969;">(</span>unify/data-list
             <span style="color: #696969;">(</span>cdr pl<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>cdr dl<span style="color: #696969;">)</span>
             <span style="color: #696969;">(</span>unify/data <span style="color: #696969;">(</span>car pl<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>car dl<span style="color: #696969;">)</span> e<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org5ca3064" class="outline-3">
<h3 id="org5ca3064">unify/data</h3>
<div class="outline-text-3" id="text-org5ca3064">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/data</span> p d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> pattern data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">var -walk-&gt; fresh-var</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>p <span style="color: #696969;">(</span>bs/walk bs p<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span>d <span style="color: #696969;">(</span>bs/walk bs d<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>p d<span style="color: #B380A8;">}</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'var v1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'var v2<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>var/eq? v1 v2<span style="color: #696969;">)</span>
            <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span>
            <span style="color: #696969;">(</span>unify/var/data v1 d e<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'var v<span style="color: #B380A8;">}</span> __<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>unify/var/data v d e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>unify/var/data v p e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>

         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'trunk t1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'trunk t2<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>unify/trunk t1 t2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'trunk t<span style="color: #B380A8;">}</span> __<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>unify/trunk/data t d e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ <span style="color: #B380A8;">{</span>'trunk t<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>unify/trunk/data t p e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>

         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'cons c1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'cons c2<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>unify/cons c1 c2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'arrow a1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'arrow a2<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>unify/arrow a1 a2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'lambda l1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'lambda l2<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>unify/lambda l1 l2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ __<span style="color: #B380A8;">}</span>
          <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>unify/data
                    fail to unify
                    <span style="color: #696969;">(</span>pattern: ,p<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>data: ,d<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf1a6b7e" class="outline-3">
<h3 id="orgf1a6b7e">unify/var/data</h3>
<div class="outline-text-3" id="text-orgf1a6b7e">
<ul class="org-ul">
<li><p>before bs/extend need to ensure that</p><p>the bind to be added is consistent with binds already in bs</p><p>this is where the levels of var come into the game</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/var/data</span> v d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">{'success {ds (bs/extend bs v d) ns}}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>consistent-check v d e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{</span>'fail <span style="color: #696969;">(</span>cons `<span style="color: #696969;">(</span>unify/var/data
                       consistent-check fail
                       <span style="color: #696969;">(</span>v: ,v<span style="color: #696969;">)</span>
                       <span style="color: #696969;">(</span>d: ,d<span style="color: #696969;">))</span>
                     il<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>occur-check/data v d e<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
           <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds <span style="color: #696969;">(</span>bs/extend bs v d<span style="color: #696969;">)</span> ns<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4382957" class="outline-3">
<h3 id="org4382957">unify/cons</h3>
<div class="outline-text-3" id="text-org4382957">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/cons</span> c1 c2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cons cons env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>c1 c2<span style="color: #B380A8;">}</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>n1 dl1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>n2 dl2<span style="color: #B380A8;">}}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>eq? n1 n2<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>unify/data-list dl1 dl2 <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
       <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>unify/cons
                 fail
                 <span style="color: #696969;">(</span>cons1: ,c1<span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span>cons2: ,c2<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf223919" class="outline-3">
<h3 id="orgf223919">unify/arrow</h3>
<div class="outline-text-3" id="text-orgf223919">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/arrow</span> a1 a2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>a1 a2<span style="color: #B380A8;">}</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>ac1 sc1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>ac2 sc2<span style="color: #B380A8;">}}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>unify/data-list ac1 ac2 <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>unify/data-list sc1 sc2 <span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{</span>'fail <span style="color: #696969;">(</span>cons `<span style="color: #696969;">(</span>unify/arrow
                       fail <span style="color: #696969;">(</span>arrow1: ,a1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>arrow2: ,a2<span style="color: #696969;">))</span>
                     il<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge02c70a" class="outline-3">
<h3 id="orge02c70a">unify/lambda</h3>
<div class="outline-text-3" id="text-orge02c70a">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/lambda</span> l1 l2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> lambda lambda env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>l1 l2<span style="color: #B380A8;">}</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>a1 al1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>a2 al2<span style="color: #B380A8;">}}</span>
     <span style="color: #696969;">(</span>unify/arrow-list al1 al2 <span style="color: #696969;">(</span>unify/arrow a1 a2 e<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8e7a66" class="outline-3">
<h3 id="org8e7a66">unify/arrow-list</h3>
<div class="outline-text-3" id="text-org8e7a66">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/arrow-list</span> al1 al2 r<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)</span> report <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> r
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">cond</span>  <span style="color: #797979;">[</span><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>eq? al1 <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span> <span style="color: #696969;">(</span>eq? al2 <span style="color: #B380A8;">{}</span><span style="color: #696969;">))</span>
             r<span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span><span style="color: #696969;">(</span>eq? al1 <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span>
             <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>unify/arrow-list
                       fail al1 and al2 is not of the same length
                       <span style="color: #696969;">(</span>additional-al2: ,al2<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span><span style="color: #696969;">(</span>eq? al2 <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span>
             <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>unify/arrow-list
                       fail al1 and al2 is not of the same length
                       <span style="color: #696969;">(</span>additional-al1: ,al1<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span>else
             <span style="color: #696969;">(</span>unify/arrow-list
              <span style="color: #696969;">(</span>cdr al1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>cdr al2<span style="color: #696969;">)</span>
              <span style="color: #696969;">(</span>unify/arrow <span style="color: #696969;">(</span>car al1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>car al2<span style="color: #696969;">)</span> e<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgad88a4a" class="outline-3">
<h3 id="orgad88a4a">unify/trunk</h3>
<div class="outline-text-3" id="text-orgad88a4a">
</div><div id="outline-container-org2268995" class="outline-4">
<h4 id="org2268995"><span class="todo note">note</span> </h4>
<div class="outline-text-4" id="text-org2268995">
<ul class="org-ul">
<li><p>it will not diverge on recursive call here</p><p>because the trunk of recursive call</p><p>only have name in it</p><p>but not have the arrow-list</p></li>

<li><p>to be able to unify on trunk</p><p>is different from</p><p>to be able to unify on arrow or lambda</p><p>we do not really have</p><p>second order semantic unification here</p></li></ul>
</div>
</div>

<div id="outline-container-org5ac2d3b" class="outline-4">
<h4 id="org5ac2d3b">unify/trunk</h4>
<div class="outline-text-4" id="text-org5ac2d3b">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/trunk</span> t1 t2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>unify/trunk/syntactic t1 t2 e<span style="color: #696969;">)</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il1<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>unify/trunk/semantic t1 t2 e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e2<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'success e2<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il2<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{</span>'fail <span style="color: #696969;">(</span>append il2 il1<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org73f3981" class="outline-4">
<h4 id="org73f3981">unify/trunk/syntactic</h4>
<div class="outline-text-4" id="text-org73f3981">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/trunk/syntactic</span> t1 t2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>t1 t2<span style="color: #B380A8;">}</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>a1 tody1 dl1 i1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>a2 tody2 dl2 i2<span style="color: #B380A8;">}}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not <span style="color: #696969;">(</span>eq? i1 i2<span style="color: #696969;">))</span>
       <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>unify/trunk/syntactic
                 fail indexes are different
                 <span style="color: #696969;">(</span>trunk1: ,t1<span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span>trunk2: ,t2<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>tody1 tody2<span style="color: #B380A8;">}</span>
         <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">about name</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/name n1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/name n2<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>eq? n1 n2<span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span>unify/data-list dl1 dl2 <span style="color: #696969;">(</span>unify/arrow a1 a2 e<span style="color: #696969;">))</span>
            <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>unify/trunk/syntactic
                      fail names are different
                      <span style="color: #696969;">(</span>trunk1: ,t1<span style="color: #696969;">)</span>
                      <span style="color: #696969;">(</span>trunk2: ,t2<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/name n<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/var v<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span>unify/trunk/syntactic <span style="color: #696969;">(</span>trunk-&gt;trunk* t1 e<span style="color: #696969;">)</span> t2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/var v<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/name n<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span>unify/trunk/syntactic  t1 <span style="color: #696969;">(</span>trunk-&gt;trunk* t2 e<span style="color: #696969;">)</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/name n<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span>unify/trunk/syntactic <span style="color: #696969;">(</span>trunk-&gt;trunk* t1 e<span style="color: #696969;">)</span> t2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/name n<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span>unify/trunk/syntactic  t1 <span style="color: #696969;">(</span>trunk-&gt;trunk* t2 e<span style="color: #696969;">)</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">about var</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/var v1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/var v2<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>unify/data <span style="color: #B380A8;">{</span>'var v1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'var v2<span style="color: #B380A8;">}</span> e<span style="color: #696969;">)</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
             <span style="color: #696969;">(</span>unify/data-list dl1 dl2 <span style="color: #696969;">(</span>unify/arrow a1 a2 e1<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/var v<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>unify/data <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>a2 al<span style="color: #B380A8;">}}</span> e<span style="color: #696969;">)</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
             <span style="color: #696969;">(</span>unify/data-list dl1 dl2 <span style="color: #696969;">(</span>unify/arrow a1 a2 e1<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/var v<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>unify/data <span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>a1 al<span style="color: #B380A8;">}}</span> <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span> e<span style="color: #696969;">)</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
             <span style="color: #696969;">(</span>unify/data-list dl1 dl2 <span style="color: #696969;">(</span>unify/arrow a1 a2 e1<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">about arrow-list</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/arrow-list al1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/arrow-list al2<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span>unify/data-list
           dl1 dl2
           <span style="color: #696969;">(</span>unify/lambda <span style="color: #B380A8;">{</span>a1 al1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>a2 al2<span style="color: #B380A8;">}</span> e<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4f94afc" class="outline-4">
<h4 id="org4f94afc">unify/trunk/semantic</h4>
<div class="outline-text-4" id="text-org4f94afc">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/trunk/semantic</span> t1 t2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>t1 t2<span style="color: #B380A8;">}</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>a1 tody1 dl1 i1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>a2 tody2 dl2 i2<span style="color: #B380A8;">}}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>tody1 tody2<span style="color: #B380A8;">}</span>
       <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">about name</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/name n<span style="color: #B380A8;">}</span> __<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>unify/trunk/semantic <span style="color: #696969;">(</span>trunk-&gt;trunk* t1 e<span style="color: #696969;">)</span> t2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ <span style="color: #B380A8;">{</span>'tody/name n<span style="color: #B380A8;">}}</span>
        <span style="color: #696969;">(</span>unify/trunk/semantic t1 <span style="color: #696969;">(</span>trunk-&gt;trunk* t2 e<span style="color: #696969;">)</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">about var</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/var v<span style="color: #B380A8;">}</span> __<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/var v e<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>d . __<span style="color: #696969;">)</span> __ __<span style="color: #B380A8;">}}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow a<span style="color: #B380A8;">}</span>
              <span style="color: #696969;">(</span>unify/trunk/semantic
               <span style="color: #B380A8;">{</span>a1 <span style="color: #B380A8;">{</span>'tody/arrow-list <span style="color: #B380A8;">{</span>a<span style="color: #B380A8;">}}</span> dl1 i1<span style="color: #B380A8;">}</span> t2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>a al<span style="color: #B380A8;">}}</span>
              <span style="color: #696969;">(</span>unify/trunk/semantic
               <span style="color: #B380A8;">{</span>a1 <span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span> dl1 i1<span style="color: #B380A8;">}</span> t2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span>__
              <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>unify/trunk/semantic
                        a var computes to neither arrow nor lambda
                        <span style="color: #696969;">(</span>var: ,v<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ <span style="color: #B380A8;">{</span>'tody/var v<span style="color: #B380A8;">}}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/var v e<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>d . __<span style="color: #696969;">)</span> __ __<span style="color: #B380A8;">}}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow a<span style="color: #B380A8;">}</span>
              <span style="color: #696969;">(</span>unify/trunk/semantic
               t1 <span style="color: #B380A8;">{</span>a2 <span style="color: #B380A8;">{</span>'tody/arrow-list <span style="color: #B380A8;">{</span>a<span style="color: #B380A8;">}}</span> dl2 i2<span style="color: #B380A8;">}</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>a al<span style="color: #B380A8;">}}</span>
              <span style="color: #696969;">(</span>unify/trunk/semantic
               t1 <span style="color: #B380A8;">{</span>a2 <span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span> dl2 i2<span style="color: #B380A8;">}</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span>__
              <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>unify/trunk/semantic
                        a var computes to neither arrow nor lambda
                        <span style="color: #696969;">(</span>var: ,v<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">about arrow-list</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/arrow-list al1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/arrow-list al2<span style="color: #B380A8;">}}</span>
        <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">recur to unify/data</span>
        <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">only when at least one of the trunk is reducible</span>
        <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">and if the arguments of this recur are both trunk</span>
        <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">one of them may still be reducible</span>
        <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">thus will get in to this branch again</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>filter-arrow-list al1 dl1 e<span style="color: #696969;">)</span>
                <span style="color: #696969;">(</span>filter-arrow-list al2 dl2 e<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>l1 l2<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">or</span> <span style="color: #696969;">(</span>eq? 1 <span style="color: #696969;">(</span>length l1<span style="color: #696969;">))</span> <span style="color: #696969;">(</span>eq? 1 <span style="color: #696969;">(</span>length l2<span style="color: #696969;">))))</span>
             <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>unify/trunk/semantic
                       fail both trunks are non-reducible
                       <span style="color: #696969;">(</span>trunk1: ,t1<span style="color: #696969;">)</span>
                       <span style="color: #696969;">(</span>trunk2: ,t2<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>compute/trunk t1 e<span style="color: #696969;">)</span>
                     <span style="color: #696969;">(</span>compute/trunk t2 e<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>d1 . __<span style="color: #696969;">)</span> __ __<span style="color: #B380A8;">}}</span>
                 <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>d2 . __<span style="color: #696969;">)</span> __ __<span style="color: #B380A8;">}}}</span>
                <span style="color: #696969;">(</span>cat <span style="color: #696969;">(</span><span style="color: #e6db74;">"&lt;unify&gt;~%"</span><span style="color: #696969;">))</span>
                <span style="color: #696969;">(</span>unify/data d1 d2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ __<span style="color: #B380A8;">}</span>
                <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>unify/trunk/semantic
                          fail to compute/trunk one of the trunks
                          <span style="color: #696969;">(</span>trunk1: ,t1<span style="color: #696969;">)</span>
                          <span style="color: #696969;">(</span>trunk2: ,t2<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgac1d80f" class="outline-3">
<h3 id="orgac1d80f">unify/trunk/data</h3>
<div class="outline-text-3" id="text-orgac1d80f">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unify/trunk/data</span> t d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/trunk t e<span style="color: #696969;">)</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
     <span style="color: #B380A8;">{</span>'fail <span style="color: #696969;">(</span>cons `<span style="color: #696969;">(</span>unify/trunk/data
                    <span style="color: #696969;">(</span>trunk: ,t<span style="color: #696969;">)</span>
                    <span style="color: #696969;">(</span>data: ,d<span style="color: #696969;">))</span>
                  il<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>env/pop e1<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'trunk t1<span style="color: #B380A8;">}</span> e2<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>unify/trunk/data
                  <span style="color: #696969;">(</span>trunk: ,t<span style="color: #696969;">)</span>
                  compute to
                  <span style="color: #696969;">(</span>trunk: ,t1<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>d1 e2<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>unify/data d1 d e2<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8eab6d" class="outline-2">
<h2 id="org8eab6d">eva</h2>
<div class="outline-text-2" id="text-org8eab6d">
</div><div id="outline-container-org151431d" class="outline-3">
<h3 id="org151431d">init-env</h3>
<div class="outline-text-3" id="text-org151431d">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #a6e22e;">init-env</span>
  '<span style="color: #696969;">(()</span>
    <span style="color: #696969;">()</span>
    <span style="color: #696969;">((</span><span style="color: #f92672; font-weight: bold;">type</span> . <span style="color: #696969;">(</span>cons/type <span style="color: #696969;">((()</span>
                          <span style="color: #696969;">((</span>cons <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> <span style="color: #696969;">()))))</span>
                         type
                         type<span style="color: #696969;">))))))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgde4e11" class="outline-3">
<h3 id="orgde4e11">eva</h3>
<div class="outline-text-3" id="text-orgde4e11">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define-macro</span> <span style="color: #696969;">(</span><span style="color: #fd971f;">eva</span> . body<span style="color: #696969;">)</span>
  `<span style="color: #696969;">(</span>eva/top-list
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> parse/top
      <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">quote</span> ,<span style="color: #696969;">(</span>flower-barcket <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>dl<span style="color: #696969;">)</span>
                                <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>vector 'flower-barcket/in-eva<span style="color: #696969;">)</span>
                                      dl<span style="color: #696969;">))</span>
                              body<span style="color: #696969;">)))</span>
    init-env<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbd73e1a" class="outline-3">
<h3 id="orgbd73e1a">eva/top-list</h3>
<div class="outline-text-3" id="text-orgbd73e1a">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">eva/top-list</span> tl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>top ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> tl
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> e<span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>t . r<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>eva/top-list r <span style="color: #696969;">(</span>eva/top t e<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org93e7dca" class="outline-3">
<h3 id="org93e7dca">parse/top</h3>
<div class="outline-text-3" id="text-org93e7dca">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">parse/top</span> s<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> sexp-top <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> top<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> s
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>'+ n a . body<span style="color: #696969;">)</span>
     <span style="color: #B380A8;">{</span>'+ <span style="color: #B380A8;">{{</span>n a<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>parse/top/deftype-body body<span style="color: #696969;">)</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>'~ n a . al<span style="color: #696969;">)</span>
     <span style="color: #B380A8;">{</span>'~ <span style="color: #B380A8;">{{</span>n a<span style="color: #B380A8;">}</span> al<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'app a<span style="color: #B380A8;">}</span>
     <span style="color: #B380A8;">{</span>'app a<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgff21162" class="outline-3">
<h3 id="orgff21162">parse/top/deftype-body</h3>
<div class="outline-text-3" id="text-orgff21162">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">parse/top/deftype-body</span> body<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> deftype-body <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">((</span>form1/name form1/arrow<span style="color: #696969;">)</span> ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">cond</span> <span style="color: #797979;">[</span><span style="color: #696969;">(</span>eq? '<span style="color: #696969;">()</span> body<span style="color: #696969;">)</span> '<span style="color: #696969;">()</span><span style="color: #797979;">]</span>
        <span style="color: #797979;">[</span><span style="color: #696969;">(</span>eq? '<span style="color: #696969;">()</span> <span style="color: #696969;">(</span>cdr body<span style="color: #696969;">))</span>
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'parse/top/deftype-body <span style="color: #696969;">(</span><span style="color: #e6db74;">"wrong body : ~a~%"</span> body<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
        <span style="color: #797979;">[</span>else
         <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>car body<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>cadr body<span style="color: #696969;">))</span>
               <span style="color: #696969;">(</span>parse/top/deftype-body <span style="color: #696969;">(</span>cddr body<span style="color: #696969;">)))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org51e76f9" class="outline-3">
<h3 id="org51e76f9">eva/top</h3>
<div class="outline-text-3" id="text-org51e76f9">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">eva/top</span> t e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> top env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> t
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'+ deftype<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>eva/deftype deftype e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'~ defn<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>eva/defn defn e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'app a<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>eva/app a e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org898f31a" class="outline-3">
<h3 id="org898f31a">form1/arrow-&gt;arrow</h3>
<div class="outline-text-3" id="text-org898f31a">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">form1/arrow-&gt;arrow</span> a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form1/arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> arrow<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/arrow <span style="color: #696969;">(</span>pass1/arrow 0 a<span style="color: #696969;">)</span> <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a1 s<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>pass3/get-arrow a1 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org32a61ce" class="outline-3">
<h3 id="org32a61ce">form1/arrow-&gt;arrow-check</h3>
<div class="outline-text-3" id="text-org32a61ce">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">form1/arrow-&gt;arrow-check</span> ta a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form1/arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> arrow<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>pass2/arrow <span style="color: #696969;">(</span>pass1/arrow 0 a<span style="color: #696969;">)</span> <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a1 s<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>pass3/get-arrow-check ta a1 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf7a193e" class="outline-3">
<h3 id="orgf7a193e">eva/app</h3>
<div class="outline-text-3" id="text-orgf7a193e">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">eva/app</span> a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> form1/arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>a0 <span style="color: #696969;">(</span>form1/arrow-&gt;arrow a e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/arrow a0 e<span style="color: #696969;">)</span>
      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span> e1<span style="color: #797979;">]</span>
      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
       <span style="color: #696969;">(</span>cat <span style="color: #696969;">(</span><span style="color: #e6db74;">"eva/app fail~%"</span><span style="color: #696969;">))</span>
       <span style="color: #696969;">(</span>pretty-print il<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>cat <span style="color: #696969;">(</span><span style="color: #e6db74;">"~%"</span><span style="color: #696969;">))</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'eva/ap <span style="color: #696969;">(</span><span style="color: #e6db74;">"end of report~%"</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org30b1440" class="outline-3">
<h3 id="org30b1440">eva/deftype</h3>
<div class="outline-text-3" id="text-org30b1440">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">eva/deftype</span> deftype e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">((</span>form1/name form1/arrow<span style="color: #696969;">)</span> <span style="color: #696969;">((</span>form1/name form1/arrow<span style="color: #696969;">)</span> ...<span style="color: #696969;">))</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> deftype
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>n a<span style="color: #B380A8;">}</span> nal<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>nl <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> car nal<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span>a0 <span style="color: #696969;">(</span>form1/arrow-&gt;arrow a e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span>ns1 <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>cons n
                                <span style="color: #B380A8;">{</span>'cons/type <span style="color: #B380A8;">{</span>a0 n nl<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
                          ns<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span>eva/deftype/data-constructor-list n nal <span style="color: #B380A8;">{</span>ds bs ns1<span style="color: #B380A8;">}</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">eva/deftype/data-constructor</span> type-name na e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> name <span style="color: #696969;">(</span>form1/name form1/arrow<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> na
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>n a<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>a0 <span style="color: #696969;">(</span>form1/arrow-&gt;arrow a e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #B380A8;">{</span>ds
           bs
           <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>cons n <span style="color: #B380A8;">{</span>'cons/data <span style="color: #B380A8;">{</span>a0 n type-name<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
                 ns<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">eva/deftype/data-constructor-list</span> type-name nal e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> name <span style="color: #696969;">((</span>form1/name form1/arrow<span style="color: #696969;">)</span> ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> nal
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> e<span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>na . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>eva/deftype/data-constructor-list
      type-name r
      <span style="color: #696969;">(</span>eva/deftype/data-constructor type-name na e<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbe0449" class="outline-3">
<h3 id="orgbe0449">cover-check? &amp; cover-check- &amp; cover-check+</h3>
<div class="outline-text-3" id="text-orgbe0449">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #a6e22e;">cover-check?</span> #t<span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover-check-</span><span style="color: #696969;">)</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">set!</span> cover-check? #f<span style="color: #696969;">)</span> #f<span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover-check+</span><span style="color: #696969;">)</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">set!</span> cover-check? #t<span style="color: #696969;">)</span> #t<span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org26960d2" class="outline-3">
<h3 id="org26960d2">recur-check? &amp; recur-check- &amp; recur-check+</h3>
<div class="outline-text-3" id="text-org26960d2">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #a6e22e;">recur-check?</span> #t<span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">recur-check-</span><span style="color: #696969;">)</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">set!</span> recur-check? #f<span style="color: #696969;">)</span> #f<span style="color: #696969;">)</span>
<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">recur-check+</span><span style="color: #696969;">)</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">set!</span> recur-check? #t<span style="color: #696969;">)</span> #t<span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb40e374" class="outline-3">
<h3 id="orgb40e374">eva/defn</h3>
<div class="outline-text-3" id="text-orgb40e374">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">eva/defn</span> defn e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">((</span>form1/name form1/arrow<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>form1/arrow ...<span style="color: #696969;">))</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> env<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> defn
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>n a<span style="color: #B380A8;">}</span> al<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>a0 <span style="color: #696969;">(</span>form1/arrow-&gt;arrow a e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">need to put the type into ns first</span>
               <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">for recursive call in arrow-list</span>
               <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">that is</span>
               <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">in ns</span>
               <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">type global-bindings and arrow-list global-bindings</span>
               <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">must be separately interfaced</span>
               <span style="color: #797979;">[</span>ns0 <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>cons n <span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>a0 'placeholder<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span> ns<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span>l1 <span style="color: #B380A8;">{</span>a0 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span>
                              <span style="color: #696969;">(</span>form1/arrow-&gt;arrow-check
                               a0 x <span style="color: #B380A8;">{</span>ds bs ns0<span style="color: #B380A8;">}</span><span style="color: #696969;">))</span>
                         al<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span>ns1 <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>cons n <span style="color: #B380A8;">{</span>'lambda l1<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span> ns<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span>e1 <span style="color: #B380A8;">{</span>ds bs ns1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> cover-check?
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>cover-check l1 e1<span style="color: #696969;">)</span>
              <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'eva/defn
                            <span style="color: #696969;">(</span><span style="color: #e6db74;">"info-list :~%~a~%"</span> il<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
              <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span> 'ok<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> recur-check?
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>recur-check n l1 e1<span style="color: #696969;">)</span>
              <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'eva/defn
                            <span style="color: #696969;">(</span><span style="color: #e6db74;">"info-list :~%~a~%"</span> il<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
              <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span> 'ok<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
          e1<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc320fbf" class="outline-2">
<h2 id="orgc320fbf">sequent</h2>
<div class="outline-text-2" id="text-orgc320fbf">
</div><div id="outline-container-org2cfce3d" class="outline-3">
<h3 id="org2cfce3d">sequent</h3>
<div class="outline-text-3" id="text-org2cfce3d">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">sequent</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #797979;">[</span>loop<span style="color: #797979;">]</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>cat <span style="color: #696969;">(</span><span style="color: #e6db74;">"welcome to sequent ^-^/~%"</span><span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span>sequent/repl init-env<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf1fb44d" class="outline-3">
<h3 id="orgf1fb44d"><span class="todo _gt__lt_">&gt;&lt;</span> sequent/repl</h3>
<div class="outline-text-3" id="text-orgf1fb44d">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">sequent/repl</span> e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #797979;">[</span>loop<span style="color: #797979;">]</span><span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>top <span style="color: #696969;">(</span>read<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span>e1 <span style="color: #696969;">(</span>eva/top <span style="color: #696969;">(</span>parse/top top<span style="color: #696969;">)</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e1
      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds1 bs1 ns1<span style="color: #B380A8;">}</span>
       <span style="color: #696969;">(</span>print/data-list ds1 e1<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>newline<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>sequent/repl e1<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgdcf9e1c" class="outline-2">
<h2 id="orgdcf9e1c">type-compute</h2>
<div class="outline-text-2" id="text-orgdcf9e1c">
</div><div id="outline-container-orgcd52641" class="outline-3">
<h3 id="orgcd52641">type-compute/cedent</h3>
<div class="outline-text-3" id="text-orgcd52641">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-compute/cedent</span> c e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cedent env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>d . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-compute d e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>type-compute/cedent r e1<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8e14dd9" class="outline-3">
<h3 id="org8e14dd9">type-compute</h3>
<div class="outline-text-3" id="text-org8e14dd9">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-compute</span> d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>type-compute/var x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>type-compute/cons x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>type-compute/arrow x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>type-compute/lambda x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'trunk x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>type-compute/trunk x e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org91f43cd" class="outline-3">
<h3 id="org91f43cd">type-compute/var</h3>
<div class="outline-text-3" id="text-org91f43cd">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-compute/var</span> v e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> var env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> v
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span>compute/var <span style="color: #B380A8;">{</span>id <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">+</span> 1 level<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2b23109" class="outline-3">
<h3 id="org2b23109">type-compute/cons</h3>
<div class="outline-text-3" id="text-org2b23109">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-compute/cons</span> c e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cons env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>n dl<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>found <span style="color: #696969;">(</span>assq n ns<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not found<span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'type-compute/cons
              <span style="color: #696969;">(</span><span style="color: #e6db74;">"unknow name : ~a~%"</span> n<span style="color: #696969;">)</span>
              <span style="color: #696969;">(</span><span style="color: #e6db74;">"cons : ~a~%"</span> c<span style="color: #696969;">))</span>
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>meaning <span style="color: #696969;">(</span>cdr found<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> meaning
                <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>any-type <span style="color: #696969;">(</span>t . __<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span>
                 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-compute/cedent <span style="color: #696969;">(</span>reverse dl<span style="color: #696969;">)</span> e<span style="color: #696969;">)</span>
                   <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
                   <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
                    <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">(compute/arrow (copy-arrow t) e1)</span>
                    <span style="color: #696969;">(</span>solve/arrow <span style="color: #696969;">(</span>copy-arrow t<span style="color: #696969;">)</span> e1<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1c04c10" class="outline-3">
<h3 id="org1c04c10">type-compute/arrow</h3>
<div class="outline-text-3" id="text-org1c04c10">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-compute/arrow</span> a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>copy-arrow a<span style="color: #696969;">)</span>
       <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">need to copy the arrow first</span>
       <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">because the return arrow might be applied somewhere else</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-compute/cedent ac <span style="color: #B380A8;">{{}</span> <span style="color: #696969;">(</span>cons '<span style="color: #696969;">(</span>commit-point<span style="color: #696969;">)</span> bs<span style="color: #696969;">)</span> ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds1 bs1 ns1<span style="color: #B380A8;">}}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-compute/cedent sc <span style="color: #B380A8;">{{}</span> bs1 ns1<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds2 bs2 ns2<span style="color: #B380A8;">}}</span>
              <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons <span style="color: #B380A8;">{</span>'arrow <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>reverse ds1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>reverse ds2<span style="color: #696969;">)</span><span style="color: #B380A8;">}}</span>
                               ds<span style="color: #696969;">)</span>
                         <span style="color: #696969;">(</span>bs/commit! bs2<span style="color: #696969;">)</span>
                         ns2<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcbacc00" class="outline-3">
<h3 id="orgcbacc00">type-compute/lambda</h3>
<div class="outline-text-3" id="text-orgcbacc00">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-compute/lambda</span> l e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> lambda env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> l
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a al<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons <span style="color: #B380A8;">{</span>'arrow a<span style="color: #B380A8;">}</span> ds<span style="color: #696969;">)</span>
                   bs
                   ns<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2854796" class="outline-3">
<h3 id="org2854796">type-compute/trunk</h3>
<div class="outline-text-3" id="text-org2854796">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">type-compute/trunk</span> t e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> t
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>a __ dl i<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-compute/cedent <span style="color: #696969;">(</span>reverse dl<span style="color: #696969;">)</span> <span style="color: #B380A8;">{{}</span> bs ns<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e1
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds1 bs1 ns1<span style="color: #B380A8;">}</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">(compute/arrow (copy-arrow a) e1)</span>
                  <span style="color: #696969;">(</span>solve/arrow <span style="color: #696969;">(</span>copy-arrow a<span style="color: #696969;">)</span> e1<span style="color: #696969;">)</span>
                <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
                <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e2<span style="color: #B380A8;">}</span>
                 <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>proj i e2<span style="color: #696969;">)</span> ds<span style="color: #696969;">)</span>
                            bs1
                            ns1<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfd9f444" class="outline-2">
<h2 id="orgfd9f444">infer</h2>
<div class="outline-text-2" id="text-orgfd9f444">
</div><div id="outline-container-orgd529b5" class="outline-3">
<h3 id="orgd529b5">infer/arrow</h3>
<div class="outline-text-3" id="text-orgd529b5">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">infer/arrow</span> a e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> arrow<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>type-compute/arrow a e<span style="color: #696969;">)</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'infer/arrow
       <span style="color: #696969;">(</span><span style="color: #e6db74;">"fail to type-compute/arrow : ~a~%"</span> a<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #e6db74;">"reported info-list : ~a~%"</span> il<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>a1 . __<span style="color: #696969;">)</span> __ __<span style="color: #B380A8;">}}</span>
     a1<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga44eac3" class="outline-3">
<h3 id="orga44eac3">infer/arrow-list</h3>
<div class="outline-text-3" id="text-orga44eac3">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">infer/arrow-list</span> al e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> arrow<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>unite/arrow-list
   <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>infer/arrow x e<span style="color: #696969;">))</span> al<span style="color: #696969;">)</span>
   e<span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7f3916b" class="outline-3">
<h3 id="org7f3916b">unite/arrow-list</h3>
<div class="outline-text-3" id="text-org7f3916b">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unite/arrow-list</span> al e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> arrow<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">letrec</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>recur
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>a l<span style="color: #696969;">)</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> arrow<span style="color: #696969;">)</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> l
                <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> a<span style="color: #797979;">]</span>
                <span style="color: #797979;">[</span><span style="color: #696969;">(</span>h . r<span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span>recur <span style="color: #696969;">(</span>unite/two a h e<span style="color: #696969;">)</span> r<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span>recur <span style="color: #696969;">(</span>car al<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>cdr al<span style="color: #696969;">))))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd8680df" class="outline-3">
<h3 id="orgd8680df">unite/two</h3>
<div class="outline-text-3" id="text-orgd8680df">
<ul class="org-ul">
<li><p>this is the meet operation of the subsumption lattice of arrow</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">unite/two</span> a1 a2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> arrow<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>a1 a2<span style="color: #B380A8;">}</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>ac1 sc1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>ac2 sc2<span style="color: #B380A8;">}}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>ac1 <span style="color: #696969;">(</span>copy-arrow ac1<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
              <span style="color: #797979;">[</span>sc1 <span style="color: #696969;">(</span>copy-arrow sc1<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
              <span style="color: #797979;">[</span>ac2 <span style="color: #696969;">(</span>copy-arrow ac2<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
              <span style="color: #797979;">[</span>sc2 <span style="color: #696969;">(</span>copy-arrow sc2<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>unify/data-list
                  ac1 ac2
                  <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{{}</span> <span style="color: #696969;">(</span>cons '<span style="color: #696969;">(</span>commit-point<span style="color: #696969;">)</span> bs<span style="color: #696969;">)</span> ns<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'unite/two
                          <span style="color: #696969;">(</span><span style="color: #e6db74;">"fail to unify antecedent~%"</span><span style="color: #696969;">)</span>
                          <span style="color: #696969;">(</span><span style="color: #e6db74;">"ac1 : ~a~%"</span> ac1<span style="color: #696969;">)</span>
                          <span style="color: #696969;">(</span><span style="color: #e6db74;">"ac2 : ~a~%"</span> ac2<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>__ bs1 ns1<span style="color: #B380A8;">}}</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>unify/data-list
                     sc1 sc2
                     <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{{}</span> bs1 ns1<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'unite/two
                             <span style="color: #696969;">(</span><span style="color: #e6db74;">"fail to unify succedent~%"</span><span style="color: #696969;">)</span>
                             <span style="color: #696969;">(</span><span style="color: #e6db74;">"sc1 : ~a~%"</span> sc1<span style="color: #696969;">)</span>
                             <span style="color: #696969;">(</span><span style="color: #e6db74;">"sc2 : ~a~%"</span> sc2<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds2 bs2 ns2<span style="color: #B380A8;">}}</span>
                <span style="color: #696969;">(</span>bs/commit! bs2<span style="color: #696969;">)</span>
                <span style="color: #B380A8;">{</span>ac1 sc1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8ce98ca" class="outline-2">
<h2 id="org8ce98ca">cover</h2>
<div class="outline-text-2" id="text-org8ce98ca">
</div><div id="outline-container-orgd3054ea" class="outline-3">
<h3 id="orgd3054ea"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-orgd3054ea">
<ul class="org-ul">
<li><p>this is the poset structure of term lattice</p></li></ul>
</div>
</div>

<div id="outline-container-orge9a1007" class="outline-3">
<h3 id="orge9a1007">cover/data-list</h3>
<div class="outline-text-3" id="text-orge9a1007">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover/data-list</span> pl dl r<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>pattern ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> report <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> r
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">cond</span> <span style="color: #797979;">[</span><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">and</span> <span style="color: #696969;">(</span>eq? pl '<span style="color: #696969;">())</span> <span style="color: #696969;">(</span>eq? dl '<span style="color: #696969;">()))</span>
            r<span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span><span style="color: #696969;">(</span>eq? pl <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span>
            <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>cover/data-list
                      fail pl and dl is not of the same length
                      <span style="color: #696969;">(</span>additional-dl: ,dl<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span><span style="color: #696969;">(</span>eq? dl <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span>
            <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>cover/data-list
                      fail pl and dl is not of the same length
                      <span style="color: #696969;">(</span>additional-pl: ,pl<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span>else
            <span style="color: #696969;">(</span>cover/data-list
             <span style="color: #696969;">(</span>cdr pl<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>cdr dl<span style="color: #696969;">)</span>
             <span style="color: #696969;">(</span>cover/data <span style="color: #696969;">(</span>car pl<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>car dl<span style="color: #696969;">)</span> e<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge872938" class="outline-3">
<h3 id="orge872938">cover/data</h3>
<div class="outline-text-3" id="text-orge872938">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover/data</span> p d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> pattern data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">var -walk-&gt; fresh-var</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>p <span style="color: #696969;">(</span>bs/walk bs p<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span>d <span style="color: #696969;">(</span>bs/walk bs d<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>p d<span style="color: #B380A8;">}</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'var v1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'var v2<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>var/eq? v1 v2<span style="color: #696969;">)</span>
            <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span>
            <span style="color: #696969;">(</span>cover/var/data v1 d e<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'var v<span style="color: #B380A8;">}</span> __<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>cover/var/data v d e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}}</span>
          <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">here is the only different between unify/data</span>
          <span style="color: #B380A8;">{</span>'fail `<span style="color: #696969;">(</span>cover/data
                   fail
                   <span style="color: #696969;">(</span>pattern: ,p<span style="color: #696969;">)</span>
                   <span style="color: #696969;">(</span>data: ,d<span style="color: #696969;">))</span><span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'trunk t1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'trunk t2<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>cover/trunk t1 t2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'trunk t<span style="color: #B380A8;">}</span> __<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>cover/trunk/data t d e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ <span style="color: #B380A8;">{</span>'trunk t<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>cover/trunk/data t p e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>

         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'cons c1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'cons c2<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>cover/cons c1 c2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'arrow a1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'arrow a2<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>cover/arrow a1 a2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'lambda l1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'lambda l2<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>cover/lambda l1 l2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ __<span style="color: #B380A8;">}</span>
          <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>cover/data
                    fail to unify
                    <span style="color: #696969;">(</span>pattern: ,p<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>data: ,d<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8e8baae" class="outline-3">
<h3 id="org8e8baae">cover/var/data</h3>
<div class="outline-text-3" id="text-org8e8baae">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover/var/data</span> v d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> fresh-var data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">{'success {ds (bs/extend bs v d) ns}}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>consistent-check v d e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{</span>'fail <span style="color: #696969;">(</span>cons `<span style="color: #696969;">(</span>cover/var/data
                       consistent-check fail
                       <span style="color: #696969;">(</span>v: ,v<span style="color: #696969;">)</span>
                       <span style="color: #696969;">(</span>d: ,d<span style="color: #696969;">))</span>
                     il<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>occur-check/data v d e<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span>
           <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds <span style="color: #696969;">(</span>bs/extend bs v d<span style="color: #696969;">)</span> ns<span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6a4fc84" class="outline-3">
<h3 id="org6a4fc84">cover/cons</h3>
<div class="outline-text-3" id="text-org6a4fc84">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover/cons</span> c1 c2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cons cons env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>c1 c2<span style="color: #B380A8;">}</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>n1 dl1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>n2 dl2<span style="color: #B380A8;">}}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>eq? n1 n2<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span>cover/data-list dl1 dl2 <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
       <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>cover/cons
                 fail
                 <span style="color: #696969;">(</span>cons1: ,c1<span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span>cons2: ,c2<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org10f8eb2" class="outline-3">
<h3 id="org10f8eb2">cover/arrow</h3>
<div class="outline-text-3" id="text-org10f8eb2">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover/arrow</span> a1 a2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow arrow env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>a1 a2<span style="color: #B380A8;">}</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>ac1 sc1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>ac2 sc2<span style="color: #B380A8;">}}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>cover/data-list ac1 ac2 <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>cover/data-list sc1 sc2 <span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{</span>'fail <span style="color: #696969;">(</span>cons `<span style="color: #696969;">(</span>cover/arrow
                       fail <span style="color: #696969;">(</span>arrow1: ,a1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>arrow2: ,a2<span style="color: #696969;">))</span>
                     il<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgeb8cdf6" class="outline-3">
<h3 id="orgeb8cdf6">cover/lambda</h3>
<div class="outline-text-3" id="text-orgeb8cdf6">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover/lambda</span> l1 l2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> lambda lambda env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>l1 l2<span style="color: #B380A8;">}</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>a1 al1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>a2 al2<span style="color: #B380A8;">}}</span>
     <span style="color: #696969;">(</span>cover/arrow-list al1 al2 <span style="color: #696969;">(</span>cover/arrow a1 a2 e<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga349d06" class="outline-3">
<h3 id="orga349d06">cover/arrow-list</h3>
<div class="outline-text-3" id="text-orga349d06">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover/arrow-list</span> al1 al2 r<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>arrow ...<span style="color: #696969;">)</span> report <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> r
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>eq? al1 <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span>
       r
       <span style="color: #696969;">(</span>cover/arrow-list
        <span style="color: #696969;">(</span>cdr al1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>cdr al2<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span>cover/arrow <span style="color: #696969;">(</span>car al1<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>car al2<span style="color: #696969;">)</span> e<span style="color: #696969;">)))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf874224" class="outline-3">
<h3 id="orgf874224">cover/trunk</h3>
<div class="outline-text-3" id="text-orgf874224">
</div><div id="outline-container-orgd1c1793" class="outline-4">
<h4 id="orgd1c1793"><span class="todo note">note</span> </h4>
<div class="outline-text-4" id="text-orgd1c1793">
<ul class="org-ul">
<li><p>it will not diverge on recursive call here</p><p>because the trunk of recursive call</p><p>only have name in it</p><p>but not have the arrow-list</p></li>

<li><p>to be able to unify on trunk</p><p>is different from</p><p>to be able to unify on arrow or lambda</p><p>we do not really have</p><p>second order semantic unification here</p></li></ul>
</div>
</div>

<div id="outline-container-org331428e" class="outline-4">
<h4 id="org331428e">cover/trunk</h4>
<div class="outline-text-4" id="text-org331428e">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover/trunk</span> t1 t2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>cover/trunk/syntactic t1 t2 e<span style="color: #696969;">)</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il1<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>cover/trunk/semantic t1 t2 e<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e2<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'success e2<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il2<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{</span>'fail <span style="color: #696969;">(</span>append il2 il1<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1198112" class="outline-4">
<h4 id="org1198112">cover/trunk/syntactic</h4>
<div class="outline-text-4" id="text-org1198112">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover/trunk/syntactic</span> t1 t2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>t1 t2<span style="color: #B380A8;">}</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>a1 tody1 dl1 i1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>a2 tody2 dl2 i2<span style="color: #B380A8;">}}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not <span style="color: #696969;">(</span>eq? i1 i2<span style="color: #696969;">))</span>
       <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>cover/trunk/syntactic
                 fail indexes are different
                 <span style="color: #696969;">(</span>trunk1: ,t1<span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span>trunk2: ,t2<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>tody1 tody2<span style="color: #B380A8;">}</span>
         <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">about name</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/name n1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/name n2<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>eq? n1 n2<span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span>cover/data-list dl1 dl2 <span style="color: #696969;">(</span>cover/arrow a1 a2 e<span style="color: #696969;">))</span>
            <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>cover/trunk/syntactic
                      fail names are different
                      <span style="color: #696969;">(</span>trunk1: ,t1<span style="color: #696969;">)</span>
                      <span style="color: #696969;">(</span>trunk2: ,t2<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/name n<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/var v<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span>cover/trunk/syntactic <span style="color: #696969;">(</span>trunk-&gt;trunk* t1 e<span style="color: #696969;">)</span> t2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/var v<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/name n<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span>cover/trunk/syntactic  t1 <span style="color: #696969;">(</span>trunk-&gt;trunk* t2 e<span style="color: #696969;">)</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/name n<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span>cover/trunk/syntactic <span style="color: #696969;">(</span>trunk-&gt;trunk* t1 e<span style="color: #696969;">)</span> t2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/name n<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span>cover/trunk/syntactic  t1 <span style="color: #696969;">(</span>trunk-&gt;trunk* t2 e<span style="color: #696969;">)</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">about var</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/var v1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/var v2<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>cover/data <span style="color: #B380A8;">{</span>'var v1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'var v2<span style="color: #B380A8;">}</span> e<span style="color: #696969;">)</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
             <span style="color: #696969;">(</span>cover/data-list dl1 dl2 <span style="color: #696969;">(</span>cover/arrow a1 a2 e1<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/var v<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>cover/data <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>a2 al<span style="color: #B380A8;">}}</span> e<span style="color: #696969;">)</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
             <span style="color: #696969;">(</span>cover/data-list dl1 dl2 <span style="color: #696969;">(</span>cover/arrow a1 a2 e1<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/var v<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>cover/data <span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>a1 al<span style="color: #B380A8;">}}</span> <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span> e<span style="color: #696969;">)</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
             <span style="color: #696969;">(</span>cover/data-list dl1 dl2 <span style="color: #696969;">(</span>cover/arrow a1 a2 e1<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">about arrow-list</span>
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/arrow-list al1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/arrow-list al2<span style="color: #B380A8;">}}</span>
          <span style="color: #696969;">(</span>cover/data-list
           dl1 dl2
           <span style="color: #696969;">(</span>cover/lambda <span style="color: #B380A8;">{</span>a1 al1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>a2 al2<span style="color: #B380A8;">}</span> e<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org364da94" class="outline-4">
<h4 id="org364da94">cover/trunk/semantic</h4>
<div class="outline-text-4" id="text-org364da94">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover/trunk/semantic</span> t1 t2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk trunk env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>t1 t2<span style="color: #B380A8;">}</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>a1 tody1 dl1 i1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>a2 tody2 dl2 i2<span style="color: #B380A8;">}}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span>tody1 tody2<span style="color: #B380A8;">}</span>
       <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">about name</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/name n<span style="color: #B380A8;">}</span> __<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>cover/trunk/semantic <span style="color: #696969;">(</span>trunk-&gt;trunk* t1 e<span style="color: #696969;">)</span> t2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ <span style="color: #B380A8;">{</span>'tody/name n<span style="color: #B380A8;">}}</span>
        <span style="color: #696969;">(</span>cover/trunk/semantic t1 <span style="color: #696969;">(</span>trunk-&gt;trunk* t2 e<span style="color: #696969;">)</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">about var</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/var v<span style="color: #B380A8;">}</span> __<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/var v e<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>d . __<span style="color: #696969;">)</span> __ __<span style="color: #B380A8;">}}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow a<span style="color: #B380A8;">}</span>
              <span style="color: #696969;">(</span>cover/trunk/semantic
               <span style="color: #B380A8;">{</span>a1 <span style="color: #B380A8;">{</span>'tody/arrow-list <span style="color: #B380A8;">{</span>a<span style="color: #B380A8;">}}</span> dl1 i1<span style="color: #B380A8;">}</span> t2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>a al<span style="color: #B380A8;">}}</span>
              <span style="color: #696969;">(</span>cover/trunk/semantic
               <span style="color: #B380A8;">{</span>a1 <span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span> dl1 i1<span style="color: #B380A8;">}</span> t2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span>__
              <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>cover/trunk/semantic
                        a var computes to neither arrow nor lambda
                        <span style="color: #696969;">(</span>var: ,v<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ <span style="color: #B380A8;">{</span>'tody/var v<span style="color: #B380A8;">}}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/var v e<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>d . __<span style="color: #696969;">)</span> __ __<span style="color: #B380A8;">}}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow a<span style="color: #B380A8;">}</span>
              <span style="color: #696969;">(</span>cover/trunk/semantic
               t1 <span style="color: #B380A8;">{</span>a2 <span style="color: #B380A8;">{</span>'tody/arrow-list <span style="color: #B380A8;">{</span>a<span style="color: #B380A8;">}}</span> dl2 i2<span style="color: #B380A8;">}</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>a al<span style="color: #B380A8;">}}</span>
              <span style="color: #696969;">(</span>cover/trunk/semantic
               t1 <span style="color: #B380A8;">{</span>a2 <span style="color: #B380A8;">{</span>'tody/arrow-list al<span style="color: #B380A8;">}</span> dl2 i2<span style="color: #B380A8;">}</span> e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
             <span style="color: #797979;">[</span>__
              <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>cover/trunk/semantic
                        a var computes to neither arrow nor lambda
                        <span style="color: #696969;">(</span>var: ,v<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span>
       <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">about arrow-list</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'tody/arrow-list al1<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'tody/arrow-list al2<span style="color: #B380A8;">}}</span>
        <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">recur to cover/data</span>
        <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">only when at least one of the trunk is reducible</span>
        <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">and if the arguments of this recur are both trunk</span>
        <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">one of them may still be reducible</span>
        <span style="color: #FF8888;">;; </span><span style="color: #FF8888;">thus will get in to this branch again</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>filter-arrow-list al1 dl1 e<span style="color: #696969;">)</span>
                <span style="color: #696969;">(</span>filter-arrow-list al2 dl2 e<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>l1 l2<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">or</span> <span style="color: #696969;">(</span>eq? 1 <span style="color: #696969;">(</span>length l1<span style="color: #696969;">))</span> <span style="color: #696969;">(</span>eq? 1 <span style="color: #696969;">(</span>length l2<span style="color: #696969;">))))</span>
             <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>cover/trunk/semantic
                       fail both trunks are non-reducible
                       <span style="color: #696969;">(</span>trunk1: ,t1<span style="color: #696969;">)</span>
                       <span style="color: #696969;">(</span>trunk2: ,t2<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>compute/trunk t1 e<span style="color: #696969;">)</span>
                     <span style="color: #696969;">(</span>compute/trunk t2 e<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>d1 . __<span style="color: #696969;">)</span> __ __<span style="color: #B380A8;">}}</span>
                 <span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>d2 . __<span style="color: #696969;">)</span> __ __<span style="color: #B380A8;">}}}</span>
                <span style="color: #696969;">(</span>cat <span style="color: #696969;">(</span><span style="color: #e6db74;">"&lt;cover&gt;~%"</span><span style="color: #696969;">))</span>
                <span style="color: #696969;">(</span>cover/data d1 d2 e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>__ __<span style="color: #B380A8;">}</span>
                <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>cover/trunk/semantic
                          fail to compute/trunk one of the trunks
                          <span style="color: #696969;">(</span>trunk1: ,t1<span style="color: #696969;">)</span>
                          <span style="color: #696969;">(</span>trunk2: ,t2<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orge44afeb" class="outline-3">
<h3 id="orge44afeb">cover/trunk/data</h3>
<div class="outline-text-3" id="text-orge44afeb">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover/trunk/data</span> t d e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk data env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>compute/trunk t e<span style="color: #696969;">)</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span>
     <span style="color: #B380A8;">{</span>'fail <span style="color: #696969;">(</span>cons `<span style="color: #696969;">(</span>cover/trunk/data
                    <span style="color: #696969;">(</span>trunk: ,t<span style="color: #696969;">)</span>
                    <span style="color: #696969;">(</span>data: ,d<span style="color: #696969;">))</span>
                  il<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success e1<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>env/pop e1<span style="color: #696969;">)</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>'trunk t1<span style="color: #B380A8;">}</span> e2<span style="color: #B380A8;">}</span>
        <span style="color: #B380A8;">{</span>'fail <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>cover/trunk/data
                  <span style="color: #696969;">(</span>trunk: ,t<span style="color: #696969;">)</span>
                  compute to
                  <span style="color: #696969;">(</span>trunk: ,t1<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #797979;">]</span>
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>d1 e2<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span>cover/data d1 d e2<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org57daae1" class="outline-2">
<h2 id="org57daae1">cover-check</h2>
<div class="outline-text-2" id="text-org57daae1">
</div><div id="outline-container-orge56880f" class="outline-3">
<h3 id="orge56880f">cover-check</h3>
<div class="outline-text-3" id="text-orge56880f">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover-check</span> l e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> lambda env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> l
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{{</span>ac __<span style="color: #B380A8;">}</span> al<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>data-gen ac <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> car al<span style="color: #696969;">)</span> e<span style="color: #696969;">)</span>
          <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>c bsl<span style="color: #B380A8;">}</span>
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>report-list
                  <span style="color: #696969;">(</span>filter
                   <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>r<span style="color: #696969;">)</span>
                     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> r
                       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail __<span style="color: #B380A8;">}</span> #t<span style="color: #797979;">]</span>
                       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span> #f<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
                   <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>bs0<span style="color: #696969;">)</span>
                          <span style="color: #696969;">(</span>cover-check/cedent/arrow-list
                           c al
                           <span style="color: #B380A8;">{</span>ds <span style="color: #696969;">(</span>append bs0 bs<span style="color: #696969;">)</span> ns<span style="color: #B380A8;">}</span><span style="color: #696969;">))</span>
                     bsl<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>null? report-list<span style="color: #696969;">)</span>
               <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span>
               <span style="color: #B380A8;">{</span>'fail
                <span style="color: #B380A8;">{</span>`<span style="color: #696969;">(</span>cover-check
                   fail
                   <span style="color: #696969;">(</span>report-list: ,report-list<span style="color: #696969;">))</span><span style="color: #B380A8;">}}</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgab51dae" class="outline-3">
<h3 id="orgab51dae">cover-check/cedent/arrow-list</h3>
<div class="outline-text-3" id="text-orgab51dae">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover-check/cedent/arrow-list</span> c al e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cedent <span style="color: #696969;">(</span>cedent ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>report-list
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>a<span style="color: #696969;">)</span>
                 <span style="color: #696969;">(</span>cover-check/cedent c <span style="color: #696969;">(</span>car a<span style="color: #696969;">)</span> e<span style="color: #696969;">))</span>
            al<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
         <span style="color: #797979;">[</span>good-report-list
          <span style="color: #696969;">(</span>filter <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>report<span style="color: #696969;">)</span>
                    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> report
                      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success __<span style="color: #B380A8;">}</span> #t<span style="color: #797979;">]</span>
                      <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail __<span style="color: #B380A8;">}</span> #t<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
                  report-list<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>null? good-report-list<span style="color: #696969;">)</span>
      <span style="color: #696969;">(</span>list 'fail
            <span style="color: #696969;">(</span>list
             `<span style="color: #696969;">(</span>cover-check/cedent/arrow-list
               fail
               <span style="color: #696969;">(</span>report-list: ,report-list<span style="color: #696969;">))))</span>
      <span style="color: #696969;">(</span>list 'success e<span style="color: #696969;">))))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org49d7905" class="outline-3">
<h3 id="org49d7905">cover-check/cedent</h3>
<div class="outline-text-3" id="text-org49d7905">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">cover-check/cedent</span> c1 c2 e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cedent cedent env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span>cover/data-list c1 c2 <span style="color: #696969;">(</span>list 'success e<span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc04fc5a" class="outline-3">
<h3 id="orgc04fc5a"><span class="todo note">note</span> alterdata</h3>
<div class="outline-text-3" id="text-orgc04fc5a">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">type</span> alterdata
  <span style="color: #B380A8;">{</span>'altervar <span style="color: #696969;">(</span>var . <span style="color: #B380A8;">{</span>alterdata ...<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #B380A8;">}</span>
  <span style="color: #B380A8;">{</span>'cons   <span style="color: #B380A8;">{</span>name <span style="color: #B380A8;">{</span>alterdata ...<span style="color: #B380A8;">}}}</span>
  <span style="color: #B380A8;">{</span>'arrow  <span style="color: #B380A8;">{</span>cedent cedent<span style="color: #B380A8;">}}</span>
  <span style="color: #B380A8;">{</span>'lambda <span style="color: #B380A8;">{</span>arrow <span style="color: #B380A8;">{</span>arrow ...<span style="color: #B380A8;">}}}</span>
  <span style="color: #B380A8;">{</span>'trunk  <span style="color: #B380A8;">{</span>arrow tody <span style="color: #B380A8;">{</span>data ...<span style="color: #B380A8;">}</span> index<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org6038272" class="outline-3">
<h3 id="org6038272">data-gen</h3>
<div class="outline-text-3" id="text-org6038272">
<ul class="org-ul">
<li><p>this can be viewed as the reverse of infer</p><p>it generate data from type</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">data-gen</span> ac acl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> antecedent <span style="color: #696969;">(</span>antecedent ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>cedent <span style="color: #696969;">(</span>bs ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>alter-expand <span style="color: #696969;">(</span>data-gen/cedent ac acl e<span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3f06427" class="outline-3">
<h3 id="org3f06427">alter-expand</h3>
<div class="outline-text-3" id="text-org3f06427">
</div><div id="outline-container-org7eb0dc7" class="outline-4">
<h4 id="org7eb0dc7">alter-expand</h4>
<div class="outline-text-4" id="text-org7eb0dc7">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">alter-expand</span> adl<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>alterdata ...<span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">((</span>data ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>bs ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span>list <span style="color: #696969;">(</span>alter-expand/get-data-list adl<span style="color: #696969;">)</span>
        <span style="color: #696969;">(</span>alter-expand/alterdata-list adl<span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgecb1275" class="outline-4">
<h4 id="orgecb1275">alter-expand/get-data-list &amp; alter-expand/get-data</h4>
<div class="outline-text-4" id="text-orgecb1275">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">alter-expand/get-data-list</span> adl<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>alterdata ...<span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> adl
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>ad . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>alter-expand/get-data ad<span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span>alter-expand/get-data-list r<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">alter-expand/get-data</span> ad<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> alterdata <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> data<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> ad
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'altervar <span style="color: #696969;">(</span>v . __<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span>__ <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'alter-expand/get-data
          <span style="color: #696969;">(</span><span style="color: #e6db74;">"alterdata is not altervar : ~a~%"</span> ad<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc289113" class="outline-4">
<h4 id="orgc289113">alter-expand/alterdata-list</h4>
<div class="outline-text-4" id="text-orgc289113">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">alter-expand/alterdata-list</span> adl<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>alterdata ...<span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>bs ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> adl
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{{}}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span><span style="color: #B380A8;">{</span>'altervar <span style="color: #696969;">(</span>v . adl<span style="color: #696969;">)</span><span style="color: #B380A8;">}</span> . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>alter-expand/more
      v adl
      <span style="color: #696969;">(</span>alter-expand/alterdata-list r<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>

<span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">alter-expand/more</span> v adl bsl<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> var <span style="color: #696969;">(</span>alterdata ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>bs ...<span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>bs ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>null? adl<span style="color: #696969;">)</span>
    bsl
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">apply</span> append
      <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>ad<span style="color: #696969;">)</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">apply</span> append
               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>bs<span style="color: #696969;">)</span>
                      <span style="color: #696969;">(</span>bs/extend-alter bs v ad<span style="color: #696969;">))</span>
                 bsl<span style="color: #696969;">)))</span>
        adl<span style="color: #696969;">))))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2092d08" class="outline-4">
<h4 id="org2092d08">bs/extend-alter</h4>
<div class="outline-text-4" id="text-org2092d08">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">bs/extend-alter</span> bs v ad<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> bs var alterdata <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>bs ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> ad
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons <span style="color: #B380A8;">{</span>n adl<span style="color: #B380A8;">}}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>bsl1 <span style="color: #696969;">(</span>alter-expand/alterdata-list adl<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span>bsl2 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span>
                         <span style="color: #696969;">(</span>bs/extend
                          x v
                          <span style="color: #B380A8;">{</span>'cons <span style="color: #B380A8;">{</span>n <span style="color: #696969;">(</span>alter-expand/get-data-list adl<span style="color: #696969;">)</span><span style="color: #B380A8;">}}</span><span style="color: #696969;">))</span>
                    bsl1<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
            <span style="color: #797979;">[</span>bsl3 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span>
                         <span style="color: #696969;">(</span>append x bs<span style="color: #696969;">))</span>
                    bsl2<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       bsl3<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span>__ <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'bs/extend-alter
          <span style="color: #696969;">(</span><span style="color: #e6db74;">"alterdata is not cons : ~a~%"</span> ad<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org2dd7221" class="outline-3">
<h3 id="org2dd7221">data-gen/cedent</h3>
<div class="outline-text-3" id="text-org2dd7221">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">data-gen/cedent</span> c cl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cedent <span style="color: #696969;">(</span>cedent ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>alterdata ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{}</span> <span style="color: #B380A8;">{}</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #696969;">(</span>h . r<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span>cons <span style="color: #696969;">(</span>data-gen/data h <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> car cl<span style="color: #696969;">)</span> e<span style="color: #696969;">)</span>
           <span style="color: #696969;">(</span>data-gen/cedent r <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> cdr cl<span style="color: #696969;">)</span> e<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org83230c9" class="outline-3">
<h3 id="org83230c9">data-gen/data</h3>
<div class="outline-text-3" id="text-org83230c9">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">data-gen/data</span> d dl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> data <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> alterdata<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>data-gen/var x dl e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>data-gen/cons x dl e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'arrow x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>data-gen/arrow x dl e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>data-gen/lambda x dl e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'trunk x<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>data-gen/trunk x dl e<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb07060c" class="outline-3">
<h3 id="orgb07060c">data-gen/cons</h3>
<div class="outline-text-3" id="text-orgb07060c">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">data-gen/cons</span> c dl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cons <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> alterdata<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> c
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>n dl0<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>found <span style="color: #696969;">(</span>assq n ns<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not found<span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'data-gen/cons
              <span style="color: #696969;">(</span><span style="color: #e6db74;">"unknow name : ~a~%"</span> n<span style="color: #696969;">))</span>
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>cdr found<span style="color: #696969;">)</span>
              <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons/data __<span style="color: #B380A8;">}</span>
               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'data-gen/cons
                 <span style="color: #696969;">(</span><span style="color: #e6db74;">"name is not type constructor but a data constructor : ~a~%"</span> n<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
              <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda __<span style="color: #B380A8;">}</span>
               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'data-gen/cons
                 <span style="color: #696969;">(</span><span style="color: #e6db74;">"name is not type constructor but a lambda : ~a~%"</span> n<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
              <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons/type <span style="color: #B380A8;">{</span>__ __ nl<span style="color: #B380A8;">}}</span>
               <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>id1 <span style="color: #696969;">(</span>id/new <span style="color: #696969;">(</span>symbol-append n '<span style="color: #a6e22e;">:gen</span><span style="color: #696969;">)</span>
                                  <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons 1 <span style="color: #B380A8;">{</span>'cons c<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
                 <span style="color: #B380A8;">{</span>'altervar
                  <span style="color: #696969;">(</span>cons <span style="color: #B380A8;">{</span>id1 0<span style="color: #B380A8;">}</span>
                        <span style="color: #696969;">(</span>data-gen/alterdata-list c nl dl e<span style="color: #696969;">))</span><span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)))</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc6cd34f" class="outline-3">
<h3 id="orgc6cd34f">data-gen/alterdata-list</h3>
<div class="outline-text-3" id="text-orgc6cd34f">
</div><div id="outline-container-org21fb510" class="outline-4">
<h4 id="org21fb510">data-gen/alterdata-list</h4>
<div class="outline-text-4" id="text-org21fb510">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">data-gen/alterdata-list</span> c nl dl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cons <span style="color: #696969;">(</span>name ...<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>alterdata ...<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>list-any? <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span>
                   <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> x
                     <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span> <span style="color: #696969;">(</span>var/fresh? v e<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
                     <span style="color: #797979;">[</span>__ #f<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
                 dl<span style="color: #696969;">)</span>
    '<span style="color: #696969;">()</span>
    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let*</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>nal <span style="color: #696969;">(</span>remove #f <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>n-&gt;na c x e<span style="color: #696969;">))</span> nl<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span>nadll <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>na-&gt;nadl x dl<span style="color: #696969;">))</span> nal<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span>alterdata-list <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>nadl-&gt;alterdata x e<span style="color: #696969;">))</span> nadll<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
      alterdata-list<span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org2e27817" class="outline-4">
<h4 id="org2e27817">n-&gt;na</h4>
<div class="outline-text-4" id="text-org2e27817">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">n-&gt;na</span> c n e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> cons name env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> <span style="color: #696969;">(</span>name . arrow<span style="color: #696969;">))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>found <span style="color: #696969;">(</span>assq n ns<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not found<span style="color: #696969;">)</span>
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'n-&gt;na
           <span style="color: #696969;">(</span><span style="color: #e6db74;">"unknow name : ~a~%"</span> n<span style="color: #696969;">))</span>
         <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>cdr found<span style="color: #696969;">)</span>
           <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'lambda __<span style="color: #B380A8;">}</span>
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'n-&gt;na
              <span style="color: #696969;">(</span><span style="color: #e6db74;">"name is not data constructor but a lambda : ~a~%"</span> n<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons/type __<span style="color: #B380A8;">}</span>
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'n-&gt;na
              <span style="color: #696969;">(</span><span style="color: #e6db74;">"name is not data constructor but a type constructor : ~a~%"</span> n<span style="color: #696969;">))</span><span style="color: #797979;">]</span>
           <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons/data <span style="color: #B380A8;">{</span>a __ __<span style="color: #B380A8;">}}</span>
            <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>a <span style="color: #696969;">(</span>copy-arrow a<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
              <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
                <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac sc<span style="color: #B380A8;">}</span>
                 <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> <span style="color: #696969;">(</span>unify/data-list
                         <span style="color: #B380A8;">{{</span>'cons c<span style="color: #B380A8;">}}</span> sc
                         <span style="color: #B380A8;">{</span>'success
                          <span style="color: #B380A8;">{</span>ds <span style="color: #696969;">(</span>cons '<span style="color: #696969;">(</span>commit-point<span style="color: #696969;">)</span> bs<span style="color: #696969;">)</span> ns<span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span>
                   <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'fail il<span style="color: #B380A8;">}</span> #f<span style="color: #797979;">]</span>
                   <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'success <span style="color: #B380A8;">{</span>ds1 bs1 ns1<span style="color: #B380A8;">}}</span>
                    <span style="color: #696969;">(</span>bs/commit! bs1<span style="color: #696969;">)</span>
                    <span style="color: #696969;">(</span>cons n a<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">)))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7166d7" class="outline-4">
<h4 id="org7166d7">na-&gt;nadl</h4>
<div class="outline-text-4" id="text-org7166d7">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">na-&gt;nadl</span> na dl<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">(</span>name . arrow<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> <span style="color: #66d9ef; font-weight: bold;">-&gt;</span>
     <span style="color: #696969;">((</span>name . arrow<span style="color: #696969;">)</span> . <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)))</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>n <span style="color: #696969;">(</span>car na<span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span>cons na
          <span style="color: #696969;">(</span>filter
           <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span>
             <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> x
               <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons <span style="color: #B380A8;">{</span>n1 __<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>eq? n n1<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
               <span style="color: #797979;">[</span>__ #f<span style="color: #797979;">]</span><span style="color: #696969;">))</span>
           dl<span style="color: #696969;">))))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc5860f8" class="outline-4">
<h4 id="orgc5860f8">nadl-&gt;alterdata</h4>
<div class="outline-text-4" id="text-orgc5860f8">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">nadl-&gt;alterdata</span> nadl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> <span style="color: #696969;">((</span>name . arrow<span style="color: #696969;">)</span> . <span style="color: #696969;">(</span>data ...<span style="color: #696969;">))</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> alterdata<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> nadl
    <span style="color: #797979;">[</span><span style="color: #696969;">((</span>n . a<span style="color: #696969;">)</span> . dl<span style="color: #696969;">)</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> a
       <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ac __<span style="color: #B380A8;">}</span>
        <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>null? dl<span style="color: #696969;">)</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'nadl-&gt;alterdata
            <span style="color: #696969;">(</span><span style="color: #e6db74;">"na can not be covered~%"</span><span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span><span style="color: #e6db74;">"n : ~a~%"</span> n<span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span><span style="color: #e6db74;">"a : ~a~%"</span> a<span style="color: #696969;">)</span>
            <span style="color: #696969;">(</span><span style="color: #e6db74;">"dl : ~a~%"</span> dl<span style="color: #696969;">))</span>
          <span style="color: #B380A8;">{</span>'cons
           <span style="color: #B380A8;">{</span>n <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>t i<span style="color: #696969;">)</span>
                     <span style="color: #696969;">(</span>data-gen/data t
                                    <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">map</span> <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">lambda</span> <span style="color: #696969;">(</span>x<span style="color: #696969;">)</span> <span style="color: #696969;">(</span>d-&gt;subd i x<span style="color: #696969;">))</span> dl<span style="color: #696969;">)</span>
                                    e<span style="color: #696969;">))</span>
                ac <span style="color: #696969;">(</span>genlist <span style="color: #696969;">(</span>length ac<span style="color: #696969;">)))</span><span style="color: #B380A8;">}}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc3890f3" class="outline-4">
<h4 id="orgc3890f3">d-&gt;subd</h4>
<div class="outline-text-4" id="text-orgc3890f3">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">d-&gt;subd</span> i d<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> index data <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> data<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> d
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>'cons <span style="color: #B380A8;">{</span>n dl<span style="color: #B380A8;">}}</span> <span style="color: #696969;">(</span>list-ref dl i<span style="color: #696969;">)</span><span style="color: #797979;">]</span>
    <span style="color: #797979;">[</span>__ <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'd-&gt;subd
          <span style="color: #696969;">(</span><span style="color: #e6db74;">"data is not cons : ~a~%"</span> d<span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org8f38275" class="outline-3">
<h3 id="org8f38275">data-gen/var</h3>
<div class="outline-text-3" id="text-org8f38275">
<ul class="org-ul">
<li><p>suppose we meet a fresh var</p><p>there must be a wild var in function body</p><p>to cover it</p></li>

<li><p>&gt;&lt;&gt;&lt;&gt;&lt;</p><p>if the type of the fresh var is a type constructor other than the 'type'</p><p>then it is possible to generate a list of type</p><p>from this type constructor</p><p>but I do not handle higher level var here</p></li></ul>

<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">data-gen/var</span> v dl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> var <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> alterdata<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">if</span> <span style="color: #696969;">(</span>not <span style="color: #696969;">(</span>var/fresh? v e<span style="color: #696969;">))</span>
       <span style="color: #696969;">(</span>data-gen/data <span style="color: #696969;">(</span>bs/deep bs <span style="color: #B380A8;">{</span>'var v<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span> dl e<span style="color: #696969;">)</span>
       <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> v
         <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>id level<span style="color: #B380A8;">}</span>
          <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>id1 <span style="color: #696969;">(</span>id/new <span style="color: #696969;">(</span>symbol-append
                              <span style="color: #696969;">(</span>id-&gt;name id<span style="color: #696969;">)</span>
                              ': <span style="color: #696969;">(</span>string-&gt;symbol <span style="color: #696969;">(</span>number-&gt;string level<span style="color: #696969;">))</span>
                              '<span style="color: #a6e22e;">:var-gen</span><span style="color: #696969;">)</span>
                             <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
            <span style="color: #B380A8;">{</span>'altervar <span style="color: #696969;">(</span>cons <span style="color: #B380A8;">{</span>id1 0<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3bdb86" class="outline-3">
<h3 id="org3bdb86">data-gen/arrow</h3>
<div class="outline-text-3" id="text-org3bdb86">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">data-gen/arrow</span> a dl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> arrow <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> alterdata<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>id1 <span style="color: #696969;">(</span>id/new '<span style="color: #a6e22e;">:arrow-gen</span>
                        <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons 1 <span style="color: #B380A8;">{</span>'arrow a<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #B380A8;">{</span>'altervar <span style="color: #696969;">(</span>cons <span style="color: #B380A8;">{</span>id1 0<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9928825" class="outline-3">
<h3 id="org9928825">data-gen/trunk</h3>
<div class="outline-text-3" id="text-org9928825">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">data-gen/trunk</span> t dl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> trunk <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> alterdata<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">let</span> <span style="color: #696969;">(</span><span style="color: #797979;">[</span>id1 <span style="color: #696969;">(</span>id/new '<span style="color: #a6e22e;">:trunk-gen</span>
                        <span style="color: #B380A8;">{</span><span style="color: #696969;">(</span>cons 1 <span style="color: #B380A8;">{</span>'trunk t<span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">)</span>
       <span style="color: #B380A8;">{</span>'altervar <span style="color: #696969;">(</span>cons <span style="color: #B380A8;">{</span>id1 0<span style="color: #B380A8;">}</span> <span style="color: #B380A8;">{}</span><span style="color: #696969;">)</span><span style="color: #B380A8;">}</span><span style="color: #696969;">)</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org95b5a1f" class="outline-3">
<h3 id="org95b5a1f">data-gen/lambda</h3>
<div class="outline-text-3" id="text-org95b5a1f">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">data-gen/lambda</span> l dl e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> lambda <span style="color: #696969;">(</span>data ...<span style="color: #696969;">)</span> env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> alterdata<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">orz</span> 'data-gen/lambda
    <span style="color: #696969;">(</span><span style="color: #e6db74;">"can not generate data from lambda~%"</span><span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #e6db74;">"l : ~a~%"</span> l<span style="color: #696969;">)</span>
    <span style="color: #696969;">(</span><span style="color: #e6db74;">"dl : ~a~%"</span> dl<span style="color: #696969;">)))</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd224fb1" class="outline-2">
<h2 id="orgd224fb1">recur-check</h2>
<div class="outline-text-2" id="text-orgd224fb1">
</div><div id="outline-container-org436c3cc" class="outline-3">
<h3 id="org436c3cc"><span class="todo note">note</span> </h3>
<div class="outline-text-3" id="text-org436c3cc">
<ul class="org-ul">
<li><p>recur-check is done by functions</p><p>of type : term -&gt; bounded-total-order-set</p><p>to use bounded-total-order-set</p><p>is to use the infinite descent method of Fermat</p></li>

<li><p>recur-check is extensible</p><p>because a list of such functions can be used to confirm descent</p></li></ul>
</div>
</div>

<div id="outline-container-org5127083" class="outline-3">
<h3 id="org5127083"><span class="todo _gt__lt_">&gt;&lt;</span> recur-check</h3>
<div class="outline-text-3" id="text-org5127083">
<div class="org-src-container">

<pre class="src src-scheme"><span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">define</span> <span style="color: #696969;">(</span><span style="color: #a6e22e;">recur-check</span> n l e<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">:</span> name lambda env <span style="color: #66d9ef; font-weight: bold;">-&gt;</span> report<span style="color: #696969;">)</span>
  <span style="color: #696969;">(</span><span style="color: #f92672; font-weight: bold;">match</span> e
    <span style="color: #797979;">[</span><span style="color: #B380A8;">{</span>ds bs ns<span style="color: #B380A8;">}</span>
     <span style="color: #B380A8;">{</span>'success e<span style="color: #B380A8;">}</span><span style="color: #797979;">]</span><span style="color: #696969;">))</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
喪以不執 所執者喪 執喪相比 方死方生
</div>
</body>
</html>
